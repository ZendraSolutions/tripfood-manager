var Oe=Object.defineProperty;var $e=(o,t,e)=>t in o?Oe(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var f=(o,t,e)=>$e(o,typeof t!="symbol"?t+"":t,e);import{r as qe,a as Fe,b as y,u as Ve,L as nt,d as qt,N as he,e as Qe,f as We,R as De,h as ft,i as Ce,B as ze}from"./vendor-C5KOkYOE.js";import{D as Ue}from"./database-CJKZqENN.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();var ee={exports:{}},kt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var me;function He(){if(me)return kt;me=1;var o=qe(),t=Symbol.for("react.element"),e=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function n(c,d,l){var p,m={},w=null,_=null;l!==void 0&&(w=""+l),d.key!==void 0&&(w=""+d.key),d.ref!==void 0&&(_=d.ref);for(p in d)r.call(d,p)&&!s.hasOwnProperty(p)&&(m[p]=d[p]);if(c&&c.defaultProps)for(p in d=c.defaultProps,d)m[p]===void 0&&(m[p]=d[p]);return{$$typeof:t,type:c,key:w,ref:_,props:m,_owner:i.current}}return kt.Fragment=e,kt.jsx=n,kt.jsxs=n,kt}var ye;function Ge(){return ye||(ye=1,ee.exports=He()),ee.exports}var a=Ge(),zt={},fe;function Xe(){if(fe)return zt;fe=1;var o=Fe();return zt.createRoot=o.createRoot,zt.hydrateRoot=o.hydrateRoot,zt}var Ye=Xe();const St=class St extends Ue{constructor(){super(St.DATABASE_NAME);f(this,"trips");f(this,"participants");f(this,"products");f(this,"consumptions");f(this,"availabilities");this.version(St.CURRENT_VERSION).stores({trips:"id, name, startDate, endDate, createdAt",participants:"id, tripId, name, createdAt",products:"id, name, category, type, createdAt",consumptions:"id, tripId, participantId, productId, date, meal, [tripId+date], [tripId+participantId], [tripId+productId]",availabilities:"id, participantId, tripId, date, [tripId+date], [participantId+date], [participantId+tripId]"})}async clearAllData(){await this.transaction("rw",[this.trips,this.participants,this.products,this.consumptions,this.availabilities],async()=>{await Promise.all([this.trips.clear(),this.participants.clear(),this.products.clear(),this.consumptions.clear(),this.availabilities.clear()])})}async healthCheck(){try{return await this.trips.count(),!0}catch{return!1}}};f(St,"DATABASE_NAME","tripfood-db"),f(St,"CURRENT_VERSION",1);let Ht=St;new Ht;class J{constructor(){}static toRecord(t){return{id:t.id,name:t.name,description:t.description,startDate:t.startDate.toISOString(),endDate:t.endDate.toISOString(),createdAt:t.createdAt.toISOString(),updatedAt:(t.updatedAt??t.createdAt).toISOString()}}static toDomainProps(t){return{id:t.id,name:t.name,description:t.description,startDate:new Date(t.startDate),endDate:new Date(t.endDate),createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)}}static toDomainPropsList(t){return t.map(e=>J.toDomainProps(e))}static toRecordList(t){return t.map(e=>J.toRecord(e))}static toPartialRecord(t){const e={updatedAt:new Date().toISOString()};return t.name!==void 0&&(e.name=t.name),t.description!==void 0&&(e.description=t.description),t.startDate!==void 0&&(e.startDate=t.startDate.toISOString()),t.endDate!==void 0&&(e.endDate=t.endDate.toISOString()),e}}class Tt extends Error{constructor(e,r){super(e);f(this,"name","InfrastructureError");f(this,"originalError");f(this,"timestamp");this.originalError=r,this.timestamp=new Date,Error.captureStackTrace&&Error.captureStackTrace(this,Tt),r!=null&&r.stack&&(this.stack=`${this.stack}

Caused by: ${r.stack}`)}toJSON(){return{name:this.name,message:this.message,timestamp:this.timestamp.toISOString(),originalError:this.originalError?{name:this.originalError.name,message:this.originalError.message}:void 0,stack:this.stack}}static isInfrastructureError(e){return e instanceof Tt}}class h extends Tt{constructor(e,r,i,s){const n=h.buildMessage(e,r,s);super(n,i);f(this,"name","DatabaseError");f(this,"operation");f(this,"tableName");f(this,"recordId");this.operation=e,this.tableName=r,this.recordId=s,Error.captureStackTrace&&Error.captureStackTrace(this,h)}static buildMessage(e,r,i){const s=`Database operation '${e}' failed on table '${r}'`;return i?`${s} for record '${i}'`:s}toJSON(){return{...super.toJSON(),operation:this.operation,tableName:this.tableName,recordId:this.recordId}}static isDatabaseError(e){return e instanceof h}static connectionError(e){return new h("connection","database",e)}static migrationError(e){return new h("migration","database",e)}}class Je{constructor(t,e){f(this,"db");f(this,"tripFactory");this.db=t,this.tripFactory=e}async findById(t){try{const e=await this.db.trips.get(t);if(!e)return null;const r=J.toDomainProps(e);return this.tripFactory(r)}catch(e){throw new h("findById","trips",e instanceof Error?e:void 0,t)}}async findAll(){try{const t=await this.db.trips.toArray();return J.toDomainPropsList(t).map(r=>this.tripFactory(r))}catch(t){throw new h("findAll","trips",t instanceof Error?t:void 0)}}async save(t){try{const e=J.toRecord(t);return await this.db.trips.put(e),t}catch(e){throw new h("create","trips",e instanceof Error?e:void 0,t.id)}}async delete(t){try{await this.db.trips.delete(t)}catch(e){throw new h("delete","trips",e instanceof Error?e:void 0,t)}}async findByName(t){try{const e=t.toLowerCase(),r=await this.db.trips.filter(s=>s.name.toLowerCase().includes(e)).toArray();return J.toDomainPropsList(r).map(s=>this.tripFactory(s))}catch(e){throw new h("find","trips",e instanceof Error?e:void 0)}}async findByDate(t){try{const e=t.toISOString(),r=await this.db.trips.filter(s=>s.startDate<=e&&s.endDate>=e).toArray();return J.toDomainPropsList(r).map(s=>this.tripFactory(s))}catch(e){throw new h("find","trips",e instanceof Error?e:void 0)}}async findByDateRange(t,e){try{const r=t.toISOString(),i=e.toISOString(),s=await this.db.trips.filter(c=>c.startDate<=i&&c.endDate>=r).toArray();return J.toDomainPropsList(s).map(c=>this.tripFactory(c))}catch(r){throw new h("find","trips",r instanceof Error?r:void 0)}}async findAllOrderedByStartDate(){try{const t=await this.db.trips.orderBy("startDate").reverse().toArray();return J.toDomainPropsList(t).map(r=>this.tripFactory(r))}catch(t){throw new h("findAll","trips",t instanceof Error?t:void 0)}}async count(){try{return await this.db.trips.count()}catch(t){throw new h("count","trips",t instanceof Error?t:void 0)}}async exists(t){try{return await this.db.trips.where("id").equals(t).count()>0}catch(e){throw new h("find","trips",e instanceof Error?e:void 0,t)}}async update(t){try{const e=J.toRecord(t);return await this.db.trips.put(e),t}catch(e){throw new h("update","trips",e instanceof Error?e:void 0,t.id)}}async deleteMany(t){try{await this.db.trips.bulkDelete(t)}catch(e){throw new h("delete","trips",e instanceof Error?e:void 0)}}async saveMany(t){try{const e=J.toRecordList(t);return await this.db.trips.bulkPut(e),t}catch(e){throw new h("create","trips",e instanceof Error?e:void 0)}}async findActive(){try{const t=new Date().toISOString(),e=await this.db.trips.filter(i=>i.startDate<=t&&i.endDate>=t).toArray();return J.toDomainPropsList(e).map(i=>this.tripFactory(i))}catch(t){throw new h("find","trips",t instanceof Error?t:void 0)}}async findUpcoming(){try{const t=new Date().toISOString(),e=await this.db.trips.filter(i=>i.startDate>t).toArray();return J.toDomainPropsList(e).map(i=>this.tripFactory(i))}catch(t){throw new h("find","trips",t instanceof Error?t:void 0)}}async findPast(){try{const t=new Date().toISOString(),e=await this.db.trips.filter(i=>i.endDate<t).toArray();return J.toDomainPropsList(e).map(i=>this.tripFactory(i))}catch(t){throw new h("find","trips",t instanceof Error?t:void 0)}}async partialUpdate(t,e){try{const r=await this.db.trips.get(t);if(!r)return null;const i={...r,...e.name!==void 0&&{name:e.name},...e.description!==void 0&&{description:e.description===null?void 0:e.description},...e.startDate!==void 0&&{startDate:e.startDate.toISOString()},...e.endDate!==void 0&&{endDate:e.endDate.toISOString()},updatedAt:new Date().toISOString()};await this.db.trips.put(i);const s=J.toDomainProps(i);return this.tripFactory(s)}catch(r){throw new h("update","trips",r instanceof Error?r:void 0,t)}}async existsByName(t,e){try{const r=t.toLowerCase().trim();return await this.db.trips.filter(s=>e&&s.id===e?!1:s.name.toLowerCase().trim()===r).first()!==void 0}catch(r){throw new h("find","trips",r instanceof Error?r:void 0)}}async findWithFilters(t){try{let e=await this.db.trips.toArray();const r=new Date().toISOString();if(t.name){const s=t.name.toLowerCase();e=e.filter(n=>n.name.toLowerCase().includes(s))}if(t.startDate){const s=t.startDate.toISOString();e=e.filter(n=>n.endDate>=s)}if(t.endDate){const s=t.endDate.toISOString();e=e.filter(n=>n.startDate<=s)}if(t.status&&t.status!=="all")switch(t.status){case"active":e=e.filter(s=>s.startDate<=r&&s.endDate>=r);break;case"upcoming":e=e.filter(s=>s.startDate>r);break;case"past":e=e.filter(s=>s.endDate<r);break}return J.toDomainPropsList(e).map(s=>this.tripFactory(s))}catch(e){throw new h("find","trips",e instanceof Error?e:void 0)}}}class et{constructor(){}static toRecord(t){return{id:t.id,tripId:t.tripId,name:t.name,email:t.email,notes:t.notes,createdAt:t.createdAt.toISOString()}}static toDomainProps(t){return{id:t.id,tripId:t.tripId,name:t.name,email:t.email,notes:t.notes,createdAt:new Date(t.createdAt)}}static toDomainPropsList(t){return t.map(e=>et.toDomainProps(e))}static toRecordList(t){return t.map(e=>et.toRecord(e))}static toPartialRecord(t){const e={};return t.name!==void 0&&(e.name=t.name),t.email!==void 0&&(e.email=t.email),t.notes!==void 0&&(e.notes=t.notes),e}}class Ke{constructor(t,e){f(this,"db");f(this,"participantFactory");this.db=t,this.participantFactory=e}async findById(t){try{const e=await this.db.participants.get(t);if(!e)return null;const r=et.toDomainProps(e);return this.participantFactory(r)}catch(e){throw new h("findById","participants",e instanceof Error?e:void 0,t)}}async findAll(){try{const t=await this.db.participants.toArray();return et.toDomainPropsList(t).map(r=>this.participantFactory(r))}catch(t){throw new h("findAll","participants",t instanceof Error?t:void 0)}}async save(t){try{const e=et.toRecord(t);return await this.db.participants.put(e),t}catch(e){throw new h("create","participants",e instanceof Error?e:void 0,t.id)}}async delete(t){try{await this.db.participants.delete(t)}catch(e){throw new h("delete","participants",e instanceof Error?e:void 0,t)}}async findByTripId(t){try{const e=await this.db.participants.where("tripId").equals(t).toArray();return et.toDomainPropsList(e).map(i=>this.participantFactory(i))}catch(e){throw new h("findByIndex","participants",e instanceof Error?e:void 0,t)}}async findByName(t){try{const e=t.toLowerCase(),r=await this.db.participants.filter(s=>s.name.toLowerCase().includes(e)).toArray();return et.toDomainPropsList(r).map(s=>this.participantFactory(s))}catch(e){throw new h("find","participants",e instanceof Error?e:void 0)}}async findByTripIdAndName(t,e){try{const r=await this.db.participants.where("tripId").equals(t).filter(s=>s.name.toLowerCase()===e.toLowerCase()).first();if(!r)return null;const i=et.toDomainProps(r);return this.participantFactory(i)}catch(r){throw new h("find","participants",r instanceof Error?r:void 0)}}async findByEmail(t){try{const e=t.toLowerCase(),r=await this.db.participants.filter(s=>s.email?s.email.toLowerCase().includes(e):!1).toArray();return et.toDomainPropsList(r).map(s=>this.participantFactory(s))}catch(e){throw new h("find","participants",e instanceof Error?e:void 0)}}async countByTripId(t){try{return await this.db.participants.where("tripId").equals(t).count()}catch(e){throw new h("count","participants",e instanceof Error?e:void 0)}}async exists(t){try{return await this.db.participants.where("id").equals(t).count()>0}catch(e){throw new h("find","participants",e instanceof Error?e:void 0,t)}}async update(t){try{const e=et.toRecord(t);return await this.db.participants.put(e),t}catch(e){throw new h("update","participants",e instanceof Error?e:void 0,t.id)}}async deleteByTripId(t){try{return await this.db.participants.where("tripId").equals(t).delete()}catch(e){throw new h("delete","participants",e instanceof Error?e:void 0,t)}}async deleteMany(t){try{await this.db.participants.bulkDelete(t)}catch(e){throw new h("delete","participants",e instanceof Error?e:void 0)}}async saveMany(t){try{const e=et.toRecordList(t);return await this.db.participants.bulkPut(e),t}catch(e){throw new h("create","participants",e instanceof Error?e:void 0)}}async count(){try{return await this.db.participants.count()}catch(t){throw new h("count","participants",t instanceof Error?t:void 0)}}async partialUpdate(t,e){try{const r=await this.db.participants.get(t);if(!r)return null;const i={...r,...e.name!==void 0&&{name:e.name},...e.email!==void 0&&{email:e.email===null?void 0:e.email},...e.notes!==void 0&&{notes:e.notes===null?void 0:e.notes}};await this.db.participants.put(i);const s=et.toDomainProps(i);return this.participantFactory(s)}catch(r){throw new h("update","participants",r instanceof Error?r:void 0,t)}}async existsInTrip(t,e,r){try{const i=e.toLowerCase().trim();return await this.db.participants.where("tripId").equals(t).filter(n=>r&&n.id===r?!1:n.name.toLowerCase().trim()===i).first()!==void 0}catch(i){throw new h("find","participants",i instanceof Error?i:void 0)}}async findWithFilters(t){try{let e=await this.db.participants.toArray();if(t.tripId&&(e=e.filter(i=>i.tripId===t.tripId)),t.name){const i=t.name.toLowerCase();e=e.filter(s=>s.name.toLowerCase().includes(i))}if(t.email){const i=t.email.toLowerCase();e=e.filter(s=>{var n;return(n=s.email)==null?void 0:n.toLowerCase().includes(i)})}return et.toDomainPropsList(e).map(i=>this.participantFactory(i))}catch(e){throw new h("find","participants",e instanceof Error?e:void 0)}}async findByTripIdOrderedByName(t){try{const e=await this.db.participants.where("tripId").equals(t).toArray();return e.sort((i,s)=>i.name.localeCompare(s.name)),et.toDomainPropsList(e).map(i=>this.participantFactory(i))}catch(e){throw new h("find","participants",e instanceof Error?e:void 0)}}}class H{constructor(){}static toRecord(t){return{id:t.id,name:t.name,category:t.category,type:t.type,unit:t.unit,defaultQuantityPerPerson:t.defaultQuantityPerPerson,notes:t.notes,createdAt:t.createdAt.toISOString()}}static toDomainProps(t){return{id:t.id,name:t.name,category:t.category,type:t.type,unit:t.unit,defaultQuantityPerPerson:t.defaultQuantityPerPerson,notes:t.notes,createdAt:new Date(t.createdAt),updatedAt:void 0}}static toDomainPropsList(t){return t.map(e=>H.toDomainProps(e))}static toRecordList(t){return t.map(e=>H.toRecord(e))}static toPartialRecord(t){const e={};return t.name!==void 0&&(e.name=t.name),t.category!==void 0&&(e.category=t.category),t.type!==void 0&&(e.type=t.type),t.unit!==void 0&&(e.unit=t.unit),t.defaultQuantityPerPerson!==void 0&&(e.defaultQuantityPerPerson=t.defaultQuantityPerPerson),t.notes!==void 0&&(e.notes=t.notes),e}}class Ze{constructor(t,e){f(this,"db");f(this,"productFactory");this.db=t,this.productFactory=e}async findById(t){try{const e=await this.db.products.get(t);if(!e)return null;const r=H.toDomainProps(e);return this.productFactory(r)}catch(e){throw new h("findById","products",e instanceof Error?e:void 0,t)}}async findAll(){try{const t=await this.db.products.toArray();return H.toDomainPropsList(t).map(r=>this.productFactory(r))}catch(t){throw new h("findAll","products",t instanceof Error?t:void 0)}}async save(t){try{const e=H.toRecord(t);return await this.db.products.put(e),t}catch(e){throw new h("create","products",e instanceof Error?e:void 0,t.id)}}async delete(t){try{await this.db.products.delete(t)}catch(e){throw new h("delete","products",e instanceof Error?e:void 0,t)}}async findByCategory(t){try{const e=await this.db.products.where("category").equals(t).toArray();return H.toDomainPropsList(e).map(i=>this.productFactory(i))}catch(e){throw new h("findByIndex","products",e instanceof Error?e:void 0)}}async findByType(t){try{const e=await this.db.products.where("type").equals(t).toArray();return H.toDomainPropsList(e).map(i=>this.productFactory(i))}catch(e){throw new h("findByIndex","products",e instanceof Error?e:void 0)}}async findByName(t){try{const e=t.toLowerCase(),r=await this.db.products.filter(s=>s.name.toLowerCase().includes(e)).toArray();return H.toDomainPropsList(r).map(s=>this.productFactory(s))}catch(e){throw new h("find","products",e instanceof Error?e:void 0)}}async findByExactName(t){try{const e=await this.db.products.filter(i=>i.name.toLowerCase()===t.toLowerCase()).first();if(!e)return null;const r=H.toDomainProps(e);return this.productFactory(r)}catch(e){throw new h("find","products",e instanceof Error?e:void 0)}}async getDistinctCategories(){try{return await this.db.products.orderBy("category").uniqueKeys()}catch(t){throw new h("find","products",t instanceof Error?t:void 0)}}async exists(t){try{return await this.db.products.where("id").equals(t).count()>0}catch(e){throw new h("find","products",e instanceof Error?e:void 0,t)}}async update(t){try{const e=H.toRecord(t);return await this.db.products.put(e),t}catch(e){throw new h("update","products",e instanceof Error?e:void 0,t.id)}}async count(){try{return await this.db.products.count()}catch(t){throw new h("count","products",t instanceof Error?t:void 0)}}async countByCategory(t){try{return await this.db.products.where("category").equals(t).count()}catch(e){throw new h("count","products",e instanceof Error?e:void 0)}}async countByType(t){try{return await this.db.products.where("type").equals(t).count()}catch(e){throw new h("count","products",e instanceof Error?e:void 0)}}async deleteMany(t){try{await this.db.products.bulkDelete(t)}catch(e){throw new h("delete","products",e instanceof Error?e:void 0)}}async saveMany(t){try{const e=H.toRecordList(t);return await this.db.products.bulkPut(e),t}catch(e){throw new h("create","products",e instanceof Error?e:void 0)}}async findAllOrderedByName(){try{const t=await this.db.products.orderBy("name").toArray();return H.toDomainPropsList(t).map(r=>this.productFactory(r))}catch(t){throw new h("findAll","products",t instanceof Error?t:void 0)}}async findAllGroupedByCategory(){try{const t=await this.db.products.toArray(),e=new Map;for(const r of t){const i=H.toDomainProps(r),s=this.productFactory(i),n=s.category;e.has(n)||e.set(n,[]),e.get(n).push(s)}for(const r of e.values())r.sort((i,s)=>i.name.localeCompare(s.name));return e}catch(t){throw new h("findAll","products",t instanceof Error?t:void 0)}}async findByUnit(t){try{const e=await this.db.products.filter(i=>i.unit===t).toArray();return H.toDomainPropsList(e).map(i=>this.productFactory(i))}catch(e){throw new h("find","products",e instanceof Error?e:void 0)}}async findWithDefaultQuantity(){try{const t=await this.db.products.filter(r=>r.defaultQuantityPerPerson!==void 0&&r.defaultQuantityPerPerson>0).toArray();return H.toDomainPropsList(t).map(r=>this.productFactory(r))}catch(t){throw new h("find","products",t instanceof Error?t:void 0)}}async partialUpdate(t,e){try{const r=await this.db.products.get(t);if(!r)return null;const i={...r,...e.name!==void 0&&{name:e.name},...e.category!==void 0&&{category:e.category},...e.type!==void 0&&{type:e.type},...e.unit!==void 0&&{unit:e.unit},...e.defaultQuantityPerPerson!==void 0&&{defaultQuantityPerPerson:e.defaultQuantityPerPerson===null?void 0:e.defaultQuantityPerPerson},...e.notes!==void 0&&{notes:e.notes===null?void 0:e.notes}};await this.db.products.put(i);const s=H.toDomainProps(i);return this.productFactory(s)}catch(r){throw new h("update","products",r instanceof Error?r:void 0,t)}}async existsByName(t,e){try{const r=t.toLowerCase().trim();return await this.db.products.filter(s=>e&&s.id===e?!1:s.name.toLowerCase().trim()===r).first()!==void 0}catch(r){throw new h("find","products",r instanceof Error?r:void 0)}}async findWithFilters(t){try{let e=await this.db.products.toArray();if(t.category&&(e=e.filter(i=>i.category===t.category)),t.type&&(e=e.filter(i=>i.type===t.type)),t.unit&&(e=e.filter(i=>i.unit===t.unit)),t.name){const i=t.name.toLowerCase();e=e.filter(s=>s.name.toLowerCase().includes(i))}return t.hasDefaultQuantity!==void 0&&(t.hasDefaultQuantity?e=e.filter(i=>i.defaultQuantityPerPerson!==void 0&&i.defaultQuantityPerPerson>0):e=e.filter(i=>i.defaultQuantityPerPerson===void 0||i.defaultQuantityPerPerson<=0)),H.toDomainPropsList(e).map(i=>this.productFactory(i))}catch(e){throw new h("find","products",e instanceof Error?e:void 0)}}}const bt=class bt{constructor(){}static isValidMealType(t){return bt.VALID_MEALS.includes(t)}static toRecord(t){return{id:t.id,tripId:t.tripId,participantId:t.participantId,productId:t.productId,date:t.date.toISOString(),meal:t.meal,quantity:t.quantity,createdAt:t.createdAt.toISOString()}}static toDomainProps(t){if(!bt.isValidMealType(t.meal))throw new Error(`Invalid meal type: ${t.meal}. Expected one of: ${bt.VALID_MEALS.join(", ")}.`);return{id:t.id,tripId:t.tripId,participantId:t.participantId,productId:t.productId,date:new Date(t.date),meal:t.meal,quantity:t.quantity,createdAt:new Date(t.createdAt)}}static toDomainPropsList(t){return t.map(e=>bt.toDomainProps(e))}static toRecordList(t){return t.map(e=>bt.toRecord(e))}static toPartialRecord(t){const e={};return t.participantId!==void 0&&(e.participantId=t.participantId),t.productId!==void 0&&(e.productId=t.productId),t.date!==void 0&&(e.date=t.date.toISOString()),t.meal!==void 0&&(e.meal=t.meal),t.quantity!==void 0&&(e.quantity=t.quantity),e}static toDateOnlyString(t){return t.toISOString().split("T")[0]??""}};f(bt,"VALID_MEALS",["breakfast","lunch","dinner","snack"]);let Q=bt;class ta{constructor(t,e){f(this,"db");f(this,"consumptionFactory");this.db=t,this.consumptionFactory=e}async findById(t){try{const e=await this.db.consumptions.get(t);if(!e)return null;const r=Q.toDomainProps(e);return this.consumptionFactory(r)}catch(e){throw new h("findById","consumptions",e instanceof Error?e:void 0,t)}}async findAll(){try{const t=await this.db.consumptions.toArray();return Q.toDomainPropsList(t).map(r=>this.consumptionFactory(r))}catch(t){throw new h("findAll","consumptions",t instanceof Error?t:void 0)}}async save(t){try{const e=Q.toRecord(t);return await this.db.consumptions.put(e),t}catch(e){throw new h("create","consumptions",e instanceof Error?e:void 0,t.id)}}async delete(t){try{await this.db.consumptions.delete(t)}catch(e){throw new h("delete","consumptions",e instanceof Error?e:void 0,t)}}async findByTripId(t){try{const e=await this.db.consumptions.where("tripId").equals(t).toArray();return Q.toDomainPropsList(e).map(i=>this.consumptionFactory(i))}catch(e){throw new h("findByIndex","consumptions",e instanceof Error?e:void 0,t)}}async findByParticipantId(t){try{const e=await this.db.consumptions.where("participantId").equals(t).toArray();return Q.toDomainPropsList(e).map(i=>this.consumptionFactory(i))}catch(e){throw new h("findByIndex","consumptions",e instanceof Error?e:void 0,t)}}async findByProductId(t){try{const e=await this.db.consumptions.where("productId").equals(t).toArray();return Q.toDomainPropsList(e).map(i=>this.consumptionFactory(i))}catch(e){throw new h("findByIndex","consumptions",e instanceof Error?e:void 0,t)}}async findByTripIdAndDate(t,e){try{const r=Q.toDateOnlyString(e),i=await this.db.consumptions.where("tripId").equals(t).filter(n=>n.date.startsWith(r)).toArray();return Q.toDomainPropsList(i).map(n=>this.consumptionFactory(n))}catch(r){throw new h("findByIndex","consumptions",r instanceof Error?r:void 0,t)}}async findByTripIdAndParticipantId(t,e){try{const r=await this.db.consumptions.where("[tripId+participantId]").equals([t,e]).toArray();return Q.toDomainPropsList(r).map(s=>this.consumptionFactory(s))}catch(r){throw new h("findByIndex","consumptions",r instanceof Error?r:void 0)}}async findByTripIdAndProductId(t,e){try{const r=await this.db.consumptions.where("[tripId+productId]").equals([t,e]).toArray();return Q.toDomainPropsList(r).map(s=>this.consumptionFactory(s))}catch(r){throw new h("findByIndex","consumptions",r instanceof Error?r:void 0)}}async findByTripIdAndMeal(t,e){try{const r=await this.db.consumptions.where("tripId").equals(t).filter(s=>s.meal===e).toArray();return Q.toDomainPropsList(r).map(s=>this.consumptionFactory(s))}catch(r){throw new h("findByIndex","consumptions",r instanceof Error?r:void 0)}}async findByTripIdAndDateRange(t,e){try{const r=e.startDate.toISOString(),i=e.endDate.toISOString(),s=await this.db.consumptions.where("tripId").equals(t).filter(c=>c.date>=r&&c.date<=i).toArray();return Q.toDomainPropsList(s).map(c=>this.consumptionFactory(c))}catch(r){throw new h("findByIndex","consumptions",r instanceof Error?r:void 0)}}async exists(t){try{return await this.db.consumptions.where("id").equals(t).count()>0}catch(e){throw new h("find","consumptions",e instanceof Error?e:void 0,t)}}async update(t){try{const e=Q.toRecord(t);return await this.db.consumptions.put(e),t}catch(e){throw new h("update","consumptions",e instanceof Error?e:void 0,t.id)}}async deleteByTripId(t){try{return await this.db.consumptions.where("tripId").equals(t).delete()}catch(e){throw new h("delete","consumptions",e instanceof Error?e:void 0,t)}}async deleteByParticipantId(t){try{return await this.db.consumptions.where("participantId").equals(t).delete()}catch(e){throw new h("delete","consumptions",e instanceof Error?e:void 0,t)}}async deleteByProductId(t){try{return await this.db.consumptions.where("productId").equals(t).delete()}catch(e){throw new h("delete","consumptions",e instanceof Error?e:void 0,t)}}async count(){try{return await this.db.consumptions.count()}catch(t){throw new h("count","consumptions",t instanceof Error?t:void 0)}}async countByTripId(t){try{return await this.db.consumptions.where("tripId").equals(t).count()}catch(e){throw new h("count","consumptions",e instanceof Error?e:void 0)}}async deleteMany(t){try{await this.db.consumptions.bulkDelete(t)}catch(e){throw new h("delete","consumptions",e instanceof Error?e:void 0)}}async saveMany(t){try{const e=Q.toRecordList(t);return await this.db.consumptions.bulkPut(e),t}catch(e){throw new h("create","consumptions",e instanceof Error?e:void 0)}}async sumQuantityByTripIdAndProductId(t,e){try{return(await this.db.consumptions.where("[tripId+productId]").equals([t,e]).toArray()).reduce((i,s)=>i+s.quantity,0)}catch(r){throw new h("find","consumptions",r instanceof Error?r:void 0)}}async findByParticipantIdAndDate(t,e){try{const r=Q.toDateOnlyString(e),i=await this.db.consumptions.where("participantId").equals(t).filter(n=>n.date.startsWith(r)).toArray();return Q.toDomainPropsList(i).map(n=>this.consumptionFactory(n))}catch(r){throw new h("findByIndex","consumptions",r instanceof Error?r:void 0,t)}}async partialUpdate(t,e){try{const r=await this.db.consumptions.get(t);if(!r)return null;const i={...r,...e.participantId!==void 0&&{participantId:e.participantId},...e.productId!==void 0&&{productId:e.productId},...e.date!==void 0&&{date:e.date.toISOString()},...e.meal!==void 0&&{meal:e.meal},...e.quantity!==void 0&&{quantity:e.quantity},...e.notes!==void 0&&{notes:e.notes===null?void 0:e.notes}};await this.db.consumptions.put(i);const s=Q.toDomainProps(i);return this.consumptionFactory(s)}catch(r){throw new h("update","consumptions",r instanceof Error?r:void 0,t)}}async findWithFilters(t){try{let e=await this.db.consumptions.toArray();if(t.tripId&&(e=e.filter(i=>i.tripId===t.tripId)),t.participantId&&(e=e.filter(i=>i.participantId===t.participantId)),t.productId&&(e=e.filter(i=>i.productId===t.productId)),t.meal&&(e=e.filter(i=>i.meal===t.meal)),t.date){const i=Q.toDateOnlyString(t.date);e=e.filter(s=>s.date.startsWith(i))}if(t.dateRange){const i=t.dateRange.startDate.toISOString(),s=t.dateRange.endDate.toISOString();e=e.filter(n=>n.date>=i&&n.date<=s)}return Q.toDomainPropsList(e).map(i=>this.consumptionFactory(i))}catch(e){throw new h("find","consumptions",e instanceof Error?e:void 0)}}async getSummaryByProduct(t){try{const e=await this.db.consumptions.where("tripId").equals(t).toArray(),r=new Map;for(const s of e){r.has(s.productId)||r.set(s.productId,{totalQuantity:0,consumptionCount:0,participantIds:new Set});const n=r.get(s.productId);n.totalQuantity+=s.quantity,n.consumptionCount+=1,n.participantIds.add(s.participantId)}const i=[];for(const[s,n]of r.entries())i.push({productId:s,totalQuantity:n.totalQuantity,consumptionCount:n.consumptionCount,uniqueParticipants:n.participantIds.size});return i}catch(e){throw new h("find","consumptions",e instanceof Error?e:void 0)}}async getTotalQuantityByProduct(t,e){return this.sumQuantityByTripIdAndProductId(t,e)}}const yt=class yt{constructor(){}static isValidMealType(t){return yt.VALID_MEALS.includes(t)}static validateMeals(t){const e=[];for(const r of t){if(!yt.isValidMealType(r))throw new Error(`Invalid meal type: ${r}. Expected one of: ${yt.VALID_MEALS.join(", ")}.`);e.push(r)}return e}static toRecord(t){return{id:t.id,participantId:t.participantId,tripId:t.tripId,date:t.date.toISOString(),meals:[...t.meals]}}static toDomainProps(t){return{id:t.id,participantId:t.participantId,tripId:t.tripId,date:new Date(t.date),meals:yt.validateMeals(t.meals),createdAt:new Date,updatedAt:void 0}}static toDomainPropsList(t){return t.map(e=>yt.toDomainProps(e))}static toRecordList(t){return t.map(e=>yt.toRecord(e))}static toPartialRecord(t){const e={};return t.date!==void 0&&(e.date=t.date.toISOString()),t.meals!==void 0&&(e.meals=[...t.meals]),e}static toDateOnlyString(t){return t.toISOString().split("T")[0]??""}static createCompositeKey(t,e,r){const i=yt.toDateOnlyString(r);return`${t}:${e}:${i}`}};f(yt,"VALID_MEALS",["breakfast","lunch","dinner","snack"]);let O=yt;class ea{constructor(t,e){f(this,"db");f(this,"availabilityFactory");this.db=t,this.availabilityFactory=e}async findById(t){try{const e=await this.db.availabilities.get(t);if(!e)return null;const r=O.toDomainProps(e);return this.availabilityFactory(r)}catch(e){throw new h("findById","availabilities",e instanceof Error?e:void 0,t)}}async findAll(){try{const t=await this.db.availabilities.toArray();return O.toDomainPropsList(t).map(r=>this.availabilityFactory(r))}catch(t){throw new h("findAll","availabilities",t instanceof Error?t:void 0)}}async save(t){try{const e=O.toRecord(t);return await this.db.availabilities.put(e),t}catch(e){throw new h("create","availabilities",e instanceof Error?e:void 0,t.id)}}async delete(t){try{await this.db.availabilities.delete(t)}catch(e){throw new h("delete","availabilities",e instanceof Error?e:void 0,t)}}async findByTripId(t){try{const e=await this.db.availabilities.where("tripId").equals(t).toArray();return O.toDomainPropsList(e).map(i=>this.availabilityFactory(i))}catch(e){throw new h("findByIndex","availabilities",e instanceof Error?e:void 0,t)}}async findByParticipantId(t){try{const e=await this.db.availabilities.where("participantId").equals(t).toArray();return O.toDomainPropsList(e).map(i=>this.availabilityFactory(i))}catch(e){throw new h("findByIndex","availabilities",e instanceof Error?e:void 0,t)}}async findByTripIdAndDate(t,e){try{const r=O.toDateOnlyString(e),i=await this.db.availabilities.where("tripId").equals(t).filter(n=>n.date.startsWith(r)).toArray();return O.toDomainPropsList(i).map(n=>this.availabilityFactory(n))}catch(r){throw new h("findByIndex","availabilities",r instanceof Error?r:void 0,t)}}async findByParticipantIdAndDate(t,e){try{const r=O.toDateOnlyString(e),i=await this.db.availabilities.where("participantId").equals(t).filter(n=>n.date.startsWith(r)).first();if(!i)return null;const s=O.toDomainProps(i);return this.availabilityFactory(s)}catch(r){throw new h("findByIndex","availabilities",r instanceof Error?r:void 0,t)}}async findByParticipantIdAndTripId(t,e){try{const r=await this.db.availabilities.where("[participantId+tripId]").equals([t,e]).toArray();return O.toDomainPropsList(r).map(s=>this.availabilityFactory(s))}catch(r){throw new h("findByIndex","availabilities",r instanceof Error?r:void 0)}}async findByTripIdAndDateRange(t,e){try{const r=e.startDate.toISOString(),i=e.endDate.toISOString(),s=await this.db.availabilities.where("tripId").equals(t).filter(c=>c.date>=r&&c.date<=i).toArray();return O.toDomainPropsList(s).map(c=>this.availabilityFactory(c))}catch(r){throw new h("findByIndex","availabilities",r instanceof Error?r:void 0)}}async findByTripIdDateAndMeal(t,e,r){try{const i=O.toDateOnlyString(e),s=await this.db.availabilities.where("tripId").equals(t).filter(c=>c.date.startsWith(i)&&c.meals.includes(r)).toArray();return O.toDomainPropsList(s).map(c=>this.availabilityFactory(c))}catch(i){throw new h("findByIndex","availabilities",i instanceof Error?i:void 0)}}async exists(t){try{return await this.db.availabilities.where("id").equals(t).count()>0}catch(e){throw new h("find","availabilities",e instanceof Error?e:void 0,t)}}async update(t){try{const e=O.toRecord(t);return await this.db.availabilities.put(e),t}catch(e){throw new h("update","availabilities",e instanceof Error?e:void 0,t.id)}}async updateMeals(t,e){try{const r=await this.db.availabilities.get(t);if(!r)return null;const i={...r,meals:e};await this.db.availabilities.put(i);const s=O.toDomainProps(i);return this.availabilityFactory(s)}catch(r){throw new h("update","availabilities",r instanceof Error?r:void 0,t)}}async deleteByParticipantId(t){try{return await this.db.availabilities.where("participantId").equals(t).delete()}catch(e){throw new h("delete","availabilities",e instanceof Error?e:void 0,t)}}async deleteByTripId(t){try{return await this.db.availabilities.where("tripId").equals(t).delete()}catch(e){throw new h("delete","availabilities",e instanceof Error?e:void 0,t)}}async count(){try{return await this.db.availabilities.count()}catch(t){throw new h("count","availabilities",t instanceof Error?t:void 0)}}async countByTripId(t){try{return await this.db.availabilities.where("tripId").equals(t).count()}catch(e){throw new h("count","availabilities",e instanceof Error?e:void 0)}}async countByParticipantId(t){try{return await this.db.availabilities.where("participantId").equals(t).count()}catch(e){throw new h("count","availabilities",e instanceof Error?e:void 0)}}async deleteMany(t){try{await this.db.availabilities.bulkDelete(t)}catch(e){throw new h("delete","availabilities",e instanceof Error?e:void 0)}}async saveMany(t){try{const e=O.toRecordList(t);return await this.db.availabilities.bulkPut(e),t}catch(e){throw new h("create","availabilities",e instanceof Error?e:void 0)}}async upsertByParticipantAndDate(t){try{const e=await this.findByParticipantIdAndDate(t.participantId,t.date);return e?(await this.updateMeals(e.id,[...t.meals]),t):this.save(t)}catch(e){throw new h("create","availabilities",e instanceof Error?e:void 0,t.id)}}async upsert(t){return this.upsertByParticipantAndDate(t)}async findByParticipantTripAndDate(t,e,r){try{const i=O.toDateOnlyString(r),s=await this.db.availabilities.where("[participantId+tripId]").equals([t,e]).filter(c=>c.date.startsWith(i)).first();if(!s)return null;const n=O.toDomainProps(s);return this.availabilityFactory(n)}catch(i){throw new h("findByIndex","availabilities",i instanceof Error?i:void 0)}}async partialUpdate(t,e){try{const r=await this.db.availabilities.get(t);if(!r)return null;const i={...r,...e.date!==void 0&&{date:e.date.toISOString()},...e.meals!==void 0&&{meals:[...e.meals]}};await this.db.availabilities.put(i);const s=O.toDomainProps(i);return this.availabilityFactory(s)}catch(r){throw new h("update","availabilities",r instanceof Error?r:void 0,t)}}async findWithFilters(t){try{let e=await this.db.availabilities.toArray();if(t.tripId&&(e=e.filter(i=>i.tripId===t.tripId)),t.participantId&&(e=e.filter(i=>i.participantId===t.participantId)),t.date){const i=O.toDateOnlyString(t.date);e=e.filter(s=>s.date.startsWith(i))}if(t.dateRange){const i=t.dateRange.startDate.toISOString(),s=t.dateRange.endDate.toISOString();e=e.filter(n=>n.date>=i&&n.date<=s)}return t.meal&&(e=e.filter(i=>i.meals.includes(t.meal))),O.toDomainPropsList(e).map(i=>this.availabilityFactory(i))}catch(e){throw new h("find","availabilities",e instanceof Error?e:void 0)}}async getSummaryByDate(t,e){try{const r=O.toDateOnlyString(e),i=await this.db.availabilities.where("tripId").equals(t).filter(c=>c.date.startsWith(r)).toArray(),s=["breakfast","lunch","dinner","snack"],n=[];for(const c of s){const d=i.filter(l=>l.meals.includes(c));n.push({date:new Date(e),meal:c,availableCount:d.length,participantIds:d.map(l=>l.participantId)})}return n}catch(r){throw new h("find","availabilities",r instanceof Error?r:void 0)}}async countAvailableForMeal(t,e,r){try{const i=O.toDateOnlyString(e);return await this.db.availabilities.where("tripId").equals(t).filter(n=>n.date.startsWith(i)&&n.meals.includes(r)).count()}catch(i){throw new h("count","availabilities",i instanceof Error?i:void 0)}}async getParticipantsAvailableForMeal(t,e,r){try{const i=O.toDateOnlyString(e);return(await this.db.availabilities.where("tripId").equals(t).filter(n=>n.date.startsWith(i)&&n.meals.includes(r)).toArray()).map(n=>n.participantId)}catch(i){throw new h("find","availabilities",i instanceof Error?i:void 0)}}}const Y=[];for(let o=0;o<256;++o)Y.push((o+256).toString(16).slice(1));function aa(o,t=0){return(Y[o[t+0]]+Y[o[t+1]]+Y[o[t+2]]+Y[o[t+3]]+"-"+Y[o[t+4]]+Y[o[t+5]]+"-"+Y[o[t+6]]+Y[o[t+7]]+"-"+Y[o[t+8]]+Y[o[t+9]]+"-"+Y[o[t+10]]+Y[o[t+11]]+Y[o[t+12]]+Y[o[t+13]]+Y[o[t+14]]+Y[o[t+15]]).toLowerCase()}let ae;const ra=new Uint8Array(16);function ia(){if(!ae){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ae=crypto.getRandomValues.bind(crypto)}return ae(ra)}const sa=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ge={randomUUID:sa};function Ft(o,t,e){var i;if(ge.randomUUID&&!o)return ge.randomUUID();o=o||{};const r=o.random??((i=o.rng)==null?void 0:i.call(o))??ia();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,aa(r)}var Ct=(o=>(o.DOMAIN_ERROR="DOMAIN_ERROR",o.VALIDATION_ERROR="VALIDATION_ERROR",o.NOT_FOUND_ERROR="NOT_FOUND_ERROR",o.DUPLICATE_ERROR="DUPLICATE_ERROR",o.BUSINESS_RULE_ERROR="BUSINESS_RULE_ERROR",o.INVALID_OPERATION_ERROR="INVALID_OPERATION_ERROR",o))(Ct||{});class It extends Error{constructor(e,r="DOMAIN_ERROR",i){super(e);f(this,"code");f(this,"details");f(this,"timestamp");Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name,this.code=r,this.details=i,this.timestamp=new Date,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}toJSON(e=!1){const r={name:this.name,code:this.code,message:this.message,timestamp:this.timestamp.toISOString()};return this.details!==void 0?{...r,details:this.details}:e&&this.stack?{...r,stack:this.stack}:r}toString(){const e=`${this.name} [${this.code}]: ${this.message}`;return this.details?`${e}
Details: ${JSON.stringify(this.details,null,2)}`:e}static isDomainError(e){return e instanceof It}}class v extends It{constructor(e,r,i,s){const n={};r!==void 0&&(n.field=r),i!==void 0&&(n.rule=i),s!==void 0&&(n.value=s);super(e,Ct.VALIDATION_ERROR,Object.keys(n).length>0?n:void 0);f(this,"field");f(this,"rule");f(this,"failures");this.field=r,this.rule=i,r&&i?this.failures=[{field:r,rule:i,message:e,value:s}]:this.failures=[]}static fromFailures(e){if(e.length===0)return new v("Validation failed with no specific errors");if(e.length===1){const s=e[0];return new v(s.message,s.field,s.rule,s.value)}const r=`Validation failed with ${e.length} errors: ${e.map(s=>s.message).join("; ")}`,i=new v(r);return Object.defineProperty(i,"failures",{value:e,writable:!1,enumerable:!0,configurable:!1}),i}static required(e,r){const i=r?`${r} `:"";return new v(`${i}${e} is required`,e,"required")}static invalidFormat(e,r,i){return new v(`${e} must be a ${r}`,e,"format",i)}static outOfRange(e,r,i,s){let n;return r!==void 0&&i!==void 0?n=`${e} must be between ${r} and ${i}`:r!==void 0?n=`${e} must be at least ${r}`:i!==void 0?n=`${e} must be at most ${i}`:n=`${e} is out of range`,new v(n,e,"range",s)}static invalidLength(e,r,i,s){let n;return r!==void 0&&i!==void 0?n=`${e} must be between ${r} and ${i} characters`:r!==void 0?n=`${e} must be at least ${r} characters`:i!==void 0?n=`${e} must be at most ${i} characters`:n=`${e} has invalid length`,new v(n,e,"length",s)}static invalidDateRange(e,r){return new v(`${e} must be before ${r}`,`${e}_${r}`,"dateRange")}hasMultipleFailures(){return this.failures.length>1}getFailedFields(){return this.failures.map(e=>e.field)}static isValidationError(e){return e instanceof v}}class B extends It{constructor(e,r,i){const s=B.buildMessage(e,r,i),n={entityType:e};r!==void 0&&(n.entityId=r),i!==void 0&&(n.searchCriteria=i);super(s,Ct.NOT_FOUND_ERROR,n);f(this,"entityType");f(this,"entityId");f(this,"searchCriteria");this.entityType=e,this.entityId=r,this.searchCriteria=i}static buildMessage(e,r,i){if(r!==void 0)return`${e} with ID '${r}' was not found`;if(i!==void 0){const s=Object.entries(i).map(([n,c])=>`${n}=${JSON.stringify(c)}`).join(", ");return`${e} matching criteria {${s}} was not found`}return`${e} was not found`}static forEntity(e,r){return new B(e,r)}static withId(e,r){return B.forEntity(e,r)}static forQuery(e,r){return new B(e,void 0,r)}static tripNotFound(e){return B.forEntity("Trip",e)}static participantNotFound(e){return B.forEntity("Participant",e)}static productNotFound(e){return B.forEntity("Product",e)}static consumptionNotFound(e){return B.forEntity("Consumption",e)}static availabilityNotFound(e){return B.forEntity("Availability",e)}static isNotFoundError(e){return e instanceof B}}class at extends It{constructor(e,r,i,s){const n=at.buildMessage(e,r,i,s),c={entityType:e};r!==void 0&&(c.field=r),i!==void 0&&(c.duplicateValue=i),s!==void 0&&(c.compositeKey=s);super(n,Ct.DUPLICATE_ERROR,c);f(this,"entityType");f(this,"field");f(this,"duplicateValue");f(this,"compositeKey");this.entityType=e,this.field=r,this.duplicateValue=i,this.compositeKey=s}static buildMessage(e,r,i,s){if(s!==void 0){const n=Object.entries(s).map(([c,d])=>`${c}=${JSON.stringify(d)}`).join(", ");return`${e} with composite key {${n}} already exists`}return r!==void 0&&i!==void 0?`${e} with ${r} '${String(i)}' already exists`:r!==void 0?`${e} with duplicate ${r} already exists`:`${e} already exists`}static forField(e,r,i){return new at(e,r,i)}static withField(e,r,i){return at.forField(e,r,i)}static forId(e,r){return new at(e,"id",r)}static forCompositeKey(e,r){return new at(e,void 0,void 0,r)}static tripNameExists(e){return at.forField("Trip","name",e)}static participantExistsInTrip(e,r){return at.forCompositeKey("Participant",{name:e,tripId:r})}static productNameExists(e){return at.forField("Product","name",e)}static availabilityExists(e,r,i){return at.forCompositeKey("Availability",{participantId:e,tripId:r,date:i})}static isDuplicateError(e){return e instanceof at}}const $t=["breakfast","lunch","dinner","snack"],ve={breakfast:1,lunch:2,snack:3,dinner:4};function Pe(o){return typeof o=="string"&&$t.includes(o)}function na(o){return[...o].sort((t,e)=>ve[t]-ve[e])}const Ae=["food","beverage","other"],Ee=["meat","dairy","vegetables","fruits","grains","snacks","condiments","prepared_food","water","soft_drink","alcohol","hot_beverage","miscellaneous"],oa={meat:"food",dairy:"food",vegetables:"food",fruits:"food",grains:"food",snacks:"food",condiments:"food",prepared_food:"food",water:"beverage",soft_drink:"beverage",alcohol:"beverage",hot_beverage:"beverage",miscellaneous:"other"},Re=["kg","g","lb","oz","l","ml","gal","unit","pack","box","bottle","can","bag","serving","portion","slice","piece"];function ne(o){return typeof o=="string"&&Ae.includes(o)}function oe(o){return typeof o=="string"&&Ee.includes(o)}function ca(o){return typeof o=="string"&&Re.includes(o)}function da(o){return oa[o]}function la(o,t){if(o>t)throw new Error("Start date must be before or equal to end date");return{startDate:new Date(o),endDate:new Date(t)}}function pa(o,t){const e=o.getTime();return e>=t.startDate.getTime()&&e<=t.endDate.getTime()}function ua(o){const e=o.endDate.getTime()-o.startDate.getTime();return Math.floor(e/864e5)+1}const ha=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function ma(o){return ha.test(o)}function Gt(o){const t=new Date(o);return t.setHours(0,0,0,0),t}const F=class F{constructor(t){f(this,"id");f(this,"name");f(this,"description");f(this,"startDate");f(this,"endDate");f(this,"createdAt");f(this,"updatedAt");this.id=t.id,this.name=t.name,this.description=t.description,this.startDate=new Date(t.startDate),this.endDate=new Date(t.endDate),this.createdAt=new Date(t.createdAt),this.updatedAt=t.updatedAt?new Date(t.updatedAt):void 0,Object.freeze(this)}static create(t){var r;F.validateName(t.name),t.description!==void 0&&F.validateDescription(t.description),F.validateDateRange(t.startDate,t.endDate);const e=new Date;return new F({id:Ft(),name:t.name.trim(),description:(r=t.description)==null?void 0:r.trim(),startDate:t.startDate,endDate:t.endDate,createdAt:e})}static fromPersistence(t){return new F(t)}update(t){const e=t.name!==void 0?t.name:this.name,r=t.description===null?void 0:t.description!==void 0?t.description:this.description,i=t.startDate!==void 0?t.startDate:this.startDate,s=t.endDate!==void 0?t.endDate:this.endDate;return t.name!==void 0&&F.validateName(t.name),t.description!==void 0&&t.description!==null&&F.validateDescription(t.description),(t.startDate!==void 0||t.endDate!==void 0)&&F.validateDateRange(i,s),new F({id:this.id,name:e.trim(),description:r==null?void 0:r.trim(),startDate:i,endDate:s,createdAt:this.createdAt,updatedAt:new Date})}getDateRange(){return la(this.startDate,this.endDate)}getDurationInDays(){return ua(this.getDateRange())}isDateWithinTrip(t){return pa(t,this.getDateRange())}isActive(){return this.isDateWithinTrip(new Date)}hasStarted(){return new Date>=this.startDate}hasEnded(){return new Date>this.endDate}isUpcoming(){return new Date<this.startDate}toJSON(){return{id:this.id,name:this.name,description:this.description,startDate:this.startDate,endDate:this.endDate,createdAt:this.createdAt,updatedAt:this.updatedAt}}static validateName(t){if(!t||typeof t!="string")throw v.required("name","Trip");const e=t.trim();if(e.length<F.MIN_NAME_LENGTH||e.length>F.MAX_NAME_LENGTH)throw v.invalidLength("name",F.MIN_NAME_LENGTH,F.MAX_NAME_LENGTH,e.length)}static validateDescription(t){if(t.length>F.MAX_DESCRIPTION_LENGTH)throw v.invalidLength("description",void 0,F.MAX_DESCRIPTION_LENGTH,t.length)}static validateDateRange(t,e){if(!t||!(t instanceof Date)||isNaN(t.getTime()))throw v.required("startDate","Trip");if(!e||!(e instanceof Date)||isNaN(e.getTime()))throw v.required("endDate","Trip");if(t>e)throw v.invalidDateRange("startDate","endDate")}equals(t){return t instanceof F?this.id===t.id:!1}};f(F,"MIN_NAME_LENGTH",3),f(F,"MAX_NAME_LENGTH",100),f(F,"MAX_DESCRIPTION_LENGTH",500);let Xt=F;const we=Object.freeze(Object.defineProperty({__proto__:null,Trip:Xt},Symbol.toStringTag,{value:"Module"})),q=class q{constructor(t){f(this,"id");f(this,"tripId");f(this,"name");f(this,"email");f(this,"notes");f(this,"createdAt");f(this,"updatedAt");this.id=t.id,this.tripId=t.tripId,this.name=t.name,this.email=t.email,this.notes=t.notes,this.createdAt=new Date(t.createdAt),this.updatedAt=t.updatedAt?new Date(t.updatedAt):void 0,Object.freeze(this)}static create(t){var r,i;q.validateTripId(t.tripId),q.validateName(t.name),t.email!==void 0&&q.validateEmail(t.email),t.notes!==void 0&&q.validateNotes(t.notes);const e=new Date;return new q({id:Ft(),tripId:t.tripId,name:t.name.trim(),email:(r=t.email)==null?void 0:r.trim().toLowerCase(),notes:(i=t.notes)==null?void 0:i.trim(),createdAt:e})}static fromPersistence(t){return new q(t)}update(t){const e=t.name!==void 0?t.name:this.name,r=t.email===null?void 0:t.email!==void 0?t.email:this.email,i=t.notes===null?void 0:t.notes!==void 0?t.notes:this.notes;return t.name!==void 0&&q.validateName(t.name),t.email!==void 0&&t.email!==null&&q.validateEmail(t.email),t.notes!==void 0&&t.notes!==null&&q.validateNotes(t.notes),new q({id:this.id,tripId:this.tripId,name:e.trim(),email:r==null?void 0:r.trim().toLowerCase(),notes:i==null?void 0:i.trim(),createdAt:this.createdAt,updatedAt:new Date})}hasEmail(){return this.email!==void 0&&this.email.length>0}hasNotes(){return this.notes!==void 0&&this.notes.length>0}belongsToTrip(t){return this.tripId===t}toJSON(){return{id:this.id,tripId:this.tripId,name:this.name,email:this.email,notes:this.notes,createdAt:this.createdAt,updatedAt:this.updatedAt}}static validateTripId(t){if(!t||typeof t!="string"||t.trim().length===0)throw v.required("tripId","Participant")}static validateName(t){if(!t||typeof t!="string")throw v.required("name","Participant");const e=t.trim();if(e.length<q.MIN_NAME_LENGTH||e.length>q.MAX_NAME_LENGTH)throw v.invalidLength("name",q.MIN_NAME_LENGTH,q.MAX_NAME_LENGTH,e.length)}static validateEmail(t){const e=t.trim();if(e.length>0&&!ma(e))throw v.invalidFormat("email","valid email address",t)}static validateNotes(t){if(t.length>q.MAX_NOTES_LENGTH)throw v.invalidLength("notes",void 0,q.MAX_NOTES_LENGTH,t.length)}equals(t){return t instanceof q?this.id===t.id:!1}};f(q,"MIN_NAME_LENGTH",2),f(q,"MAX_NAME_LENGTH",100),f(q,"MAX_NOTES_LENGTH",500);let Yt=q;const xe=Object.freeze(Object.defineProperty({__proto__:null,Participant:Yt},Symbol.toStringTag,{value:"Module"})),L=class L{constructor(t){f(this,"id");f(this,"name");f(this,"category");f(this,"type");f(this,"unit");f(this,"defaultQuantityPerPerson");f(this,"notes");f(this,"createdAt");f(this,"updatedAt");this.id=t.id,this.name=t.name,this.category=t.category,this.type=t.type,this.unit=t.unit,this.defaultQuantityPerPerson=t.defaultQuantityPerPerson,this.notes=t.notes,this.createdAt=new Date(t.createdAt),this.updatedAt=t.updatedAt?new Date(t.updatedAt):void 0,Object.freeze(this)}static create(t){var r;L.validateName(t.name),L.validateCategory(t.category),L.validateType(t.type),L.validateTypeMatchesCategory(t.type,t.category),L.validateUnit(t.unit),t.defaultQuantityPerPerson!==void 0&&L.validateQuantity(t.defaultQuantityPerPerson),t.notes!==void 0&&L.validateNotes(t.notes);const e=new Date;return new L({id:Ft(),name:t.name.trim(),category:t.category,type:t.type,unit:t.unit,defaultQuantityPerPerson:t.defaultQuantityPerPerson,notes:(r=t.notes)==null?void 0:r.trim(),createdAt:e})}static fromPersistence(t){return new L(t)}update(t){const e=t.name!==void 0?t.name:this.name,r=t.category!==void 0?t.category:this.category,i=t.type!==void 0?t.type:this.type,s=t.unit!==void 0?t.unit:this.unit,n=t.defaultQuantityPerPerson===null?void 0:t.defaultQuantityPerPerson!==void 0?t.defaultQuantityPerPerson:this.defaultQuantityPerPerson,c=t.notes===null?void 0:t.notes!==void 0?t.notes:this.notes;return t.name!==void 0&&L.validateName(t.name),t.category!==void 0&&L.validateCategory(t.category),t.type!==void 0&&L.validateType(t.type),(t.type!==void 0||t.category!==void 0)&&L.validateTypeMatchesCategory(i,r),t.unit!==void 0&&L.validateUnit(t.unit),t.defaultQuantityPerPerson!==void 0&&t.defaultQuantityPerPerson!==null&&L.validateQuantity(t.defaultQuantityPerPerson),t.notes!==void 0&&t.notes!==null&&L.validateNotes(t.notes),new L({id:this.id,name:e.trim(),category:r,type:i,unit:s,defaultQuantityPerPerson:n,notes:c==null?void 0:c.trim(),createdAt:this.createdAt,updatedAt:new Date})}isFood(){return this.category==="food"}isBeverage(){return this.category==="beverage"}hasDefaultQuantity(){return this.defaultQuantityPerPerson!==void 0&&this.defaultQuantityPerPerson>0}calculateQuantityForPeople(t){if(!(!this.hasDefaultQuantity()||this.defaultQuantityPerPerson===void 0))return t<=0?0:this.defaultQuantityPerPerson*t}toJSON(){return{id:this.id,name:this.name,category:this.category,type:this.type,unit:this.unit,defaultQuantityPerPerson:this.defaultQuantityPerPerson,notes:this.notes,createdAt:this.createdAt,updatedAt:this.updatedAt}}static validateName(t){if(!t||typeof t!="string")throw v.required("name","Product");const e=t.trim();if(e.length<L.MIN_NAME_LENGTH||e.length>L.MAX_NAME_LENGTH)throw v.invalidLength("name",L.MIN_NAME_LENGTH,L.MAX_NAME_LENGTH,e.length)}static validateCategory(t){if(!ne(t))throw new v(`Invalid product category: '${String(t)}'. Valid categories are: ${Ae.join(", ")}`,"category","enum")}static validateType(t){if(!oe(t))throw new v(`Invalid product type: '${String(t)}'. Valid types are: ${Ee.join(", ")}`,"type","enum")}static validateTypeMatchesCategory(t,e){const r=da(t);if(r!==e)throw new v(`Product type '${t}' does not belong to category '${e}'. Expected category: '${r}'`,"type","categoryMismatch")}static validateUnit(t){if(!ca(t))throw new v(`Invalid product unit: '${String(t)}'. Valid units are: ${Re.join(", ")}`,"unit","enum")}static validateQuantity(t){if(typeof t!="number"||isNaN(t))throw v.invalidFormat("defaultQuantityPerPerson","number");if(t<L.MIN_QUANTITY||t>L.MAX_QUANTITY)throw v.outOfRange("defaultQuantityPerPerson",L.MIN_QUANTITY,L.MAX_QUANTITY,t)}static validateNotes(t){if(t.length>L.MAX_NOTES_LENGTH)throw v.invalidLength("notes",void 0,L.MAX_NOTES_LENGTH,t.length)}equals(t){return t instanceof L?this.id===t.id:!1}};f(L,"MIN_NAME_LENGTH",2),f(L,"MAX_NAME_LENGTH",100),f(L,"MAX_NOTES_LENGTH",500),f(L,"MIN_QUANTITY",.01),f(L,"MAX_QUANTITY",1e3);let Jt=L;const _e=Object.freeze(Object.defineProperty({__proto__:null,Product:Jt},Symbol.toStringTag,{value:"Module"})),W=class W{constructor(t){f(this,"id");f(this,"tripId");f(this,"participantId");f(this,"productId");f(this,"date");f(this,"meal");f(this,"quantity");f(this,"createdAt");f(this,"updatedAt");this.id=t.id,this.tripId=t.tripId,this.participantId=t.participantId,this.productId=t.productId,this.date=Gt(new Date(t.date)),this.meal=t.meal,this.quantity=t.quantity,this.createdAt=new Date(t.createdAt),this.updatedAt=t.updatedAt?new Date(t.updatedAt):void 0,Object.freeze(this)}static create(t){W.validateTripId(t.tripId),W.validateParticipantId(t.participantId),W.validateProductId(t.productId),W.validateDate(t.date),W.validateMeal(t.meal),W.validateQuantity(t.quantity);const e=new Date;return new W({id:Ft(),tripId:t.tripId,participantId:t.participantId,productId:t.productId,date:t.date,meal:t.meal,quantity:t.quantity,createdAt:e})}static fromPersistence(t){return new W(t)}update(t){const e=t.date!==void 0?t.date:this.date,r=t.meal!==void 0?t.meal:this.meal,i=t.quantity!==void 0?t.quantity:this.quantity;return t.date!==void 0&&W.validateDate(t.date),t.meal!==void 0&&W.validateMeal(t.meal),t.quantity!==void 0&&W.validateQuantity(t.quantity),new W({id:this.id,tripId:this.tripId,participantId:this.participantId,productId:this.productId,date:e,meal:r,quantity:i,createdAt:this.createdAt,updatedAt:new Date})}belongsToTrip(t){return this.tripId===t}isFromParticipant(t){return this.participantId===t}isForProduct(t){return this.productId===t}isOnDate(t){const e=Gt(t);return this.date.getTime()===e.getTime()}isForMeal(t){return this.meal===t}getDateString(){return this.date.toISOString().split("T")[0]??""}toJSON(){return{id:this.id,tripId:this.tripId,participantId:this.participantId,productId:this.productId,date:this.date,meal:this.meal,quantity:this.quantity,createdAt:this.createdAt,updatedAt:this.updatedAt}}static validateTripId(t){if(!t||typeof t!="string"||t.trim().length===0)throw v.required("tripId","Consumption")}static validateParticipantId(t){if(!t||typeof t!="string"||t.trim().length===0)throw v.required("participantId","Consumption")}static validateProductId(t){if(!t||typeof t!="string"||t.trim().length===0)throw v.required("productId","Consumption")}static validateDate(t){if(!t||!(t instanceof Date)||isNaN(t.getTime()))throw v.required("date","Consumption")}static validateMeal(t){if(!Pe(t))throw new v(`Invalid meal type: '${String(t)}'. Valid types are: ${$t.join(", ")}`,"meal","enum")}static validateQuantity(t){if(typeof t!="number"||isNaN(t))throw v.invalidFormat("quantity","number");if(t<W.MIN_QUANTITY||t>W.MAX_QUANTITY)throw v.outOfRange("quantity",W.MIN_QUANTITY,W.MAX_QUANTITY,t)}equals(t){return t instanceof W?this.id===t.id:!1}};f(W,"MIN_QUANTITY",.01),f(W,"MAX_QUANTITY",1e4);let Kt=W;const re=Object.freeze(Object.defineProperty({__proto__:null,Consumption:Kt},Symbol.toStringTag,{value:"Module"}));class ct{constructor(t){f(this,"id");f(this,"participantId");f(this,"tripId");f(this,"date");f(this,"meals");f(this,"createdAt");f(this,"updatedAt");this.id=t.id,this.participantId=t.participantId,this.tripId=t.tripId,this.date=Gt(new Date(t.date)),this.meals=Object.freeze(na([...new Set(t.meals)])),this.createdAt=new Date(t.createdAt),this.updatedAt=t.updatedAt?new Date(t.updatedAt):void 0,Object.freeze(this)}static create(t){ct.validateParticipantId(t.participantId),ct.validateTripId(t.tripId),ct.validateDate(t.date),ct.validateMeals(t.meals);const e=new Date;return new ct({id:Ft(),participantId:t.participantId,tripId:t.tripId,date:t.date,meals:t.meals,createdAt:e})}static fromPersistence(t){return new ct(t)}update(t){const e=t.date!==void 0?t.date:this.date,r=t.meals!==void 0?t.meals:this.meals;return t.date!==void 0&&ct.validateDate(t.date),t.meals!==void 0&&ct.validateMeals(t.meals),new ct({id:this.id,participantId:this.participantId,tripId:this.tripId,date:e,meals:r,createdAt:this.createdAt,updatedAt:new Date})}isAvailableForMeal(t){return this.meals.includes(t)}isAvailableForAllMeals(){return $t.every(t=>this.meals.includes(t))}isNotAvailable(){return this.meals.length===0}getMealCount(){return this.meals.length}addMeal(t){return this.isAvailableForMeal(t)?this:this.update({meals:[...this.meals,t]})}removeMeal(t){return this.isAvailableForMeal(t)?this.update({meals:this.meals.filter(e=>e!==t)}):this}setAvailableForAllMeals(){return this.update({meals:[...$t]})}clearAllMeals(){return this.update({meals:[]})}belongsToTrip(t){return this.tripId===t}isForParticipant(t){return this.participantId===t}isOnDate(t){const e=Gt(t);return this.date.getTime()===e.getTime()}getDateString(){return this.date.toISOString().split("T")[0]??""}toJSON(){return{id:this.id,participantId:this.participantId,tripId:this.tripId,date:this.date,meals:[...this.meals],createdAt:this.createdAt,updatedAt:this.updatedAt}}static validateParticipantId(t){if(!t||typeof t!="string"||t.trim().length===0)throw v.required("participantId","Availability")}static validateTripId(t){if(!t||typeof t!="string"||t.trim().length===0)throw v.required("tripId","Availability")}static validateDate(t){if(!t||!(t instanceof Date)||isNaN(t.getTime()))throw v.required("date","Availability")}static validateMeals(t){if(!Array.isArray(t))throw new v("meals must be an array","meals","type");for(const e of t)if(!Pe(e))throw new v(`Invalid meal type: '${String(e)}'. Valid types are: ${$t.join(", ")}`,"meals","enum")}equals(t){return t instanceof ct?this.id===t.id:!1}}const ya=Object.freeze(Object.defineProperty({__proto__:null,Availability:ct},Symbol.toStringTag,{value:"Module"})),fa="modulepreload",ga=function(o){return"/tripfood-manager/"+o},be={},gt=function(t,e,r){let i=Promise.resolve();if(e&&e.length>0){let n=function(l){return Promise.all(l.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),d=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));i=n(e.map(l=>{if(l=ga(l),l in be)return;be[l]=!0;const p=l.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${m}`))return;const w=document.createElement("link");if(w.rel=p?"stylesheet":fa,p||(w.as="script"),w.crossOrigin="",w.href=l,d&&w.setAttribute("nonce",d),document.head.appendChild(w),p)return new Promise((_,b)=>{w.addEventListener("load",_),w.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(n){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n}return i.then(n=>{for(const c of n||[])c.status==="rejected"&&s(c.reason);return t().catch(s)})};class va{constructor(t,e,r,i){this.tripRepository=t,this.participantRepository=e,this.consumptionRepository=r,this.availabilityRepository=i}async create(t){this.validateCreateDTO(t);const{Trip:e}=await gt(async()=>{const{Trip:i}=await Promise.resolve().then(()=>we);return{Trip:i}},void 0),r=e.create({name:t.name,description:t.description,startDate:t.startDate,endDate:t.endDate});return this.tripRepository.save(r)}async createTrip(t){const{Trip:e}=await gt(async()=>{const{Trip:i}=await Promise.resolve().then(()=>we);return{Trip:i}},void 0),r=e.create(t);return this.tripRepository.save(r)}async getById(t){return this.tripRepository.findById(t)}async getTripById(t){const e=await this.tripRepository.findById(t);if(!e)throw B.withId("Trip",t);return e}async getDetails(t){const e=await this.tripRepository.findById(t);if(!e)throw B.withId("Trip",t);const r=this.participantRepository?await this.participantRepository.findByTripId(t):[],i=this.consumptionRepository?(await this.consumptionRepository.findByTripId(t)).length:0;return this.toDetailResponseDTO(e,r,i)}async getAll(){return this.tripRepository.findAll()}async getAllTrips(){return this.tripRepository.findAll()}async getAllTripsOrderedByStartDate(){return this.tripRepository.findAllOrderedByStartDate()}async getAllAsResponseDTO(){const t=await this.tripRepository.findAll(),e=[];for(const r of t){const i=this.participantRepository?await this.participantRepository.countByTripId(r.id):0;e.push(this.toResponseDTO(r,i))}return e}async searchByName(t){return this.tripRepository.findByName(t)}async searchTripsByName(t){return this.tripRepository.findByName(t)}async findTripsByDate(t){return this.tripRepository.findByDate(t)}async findTripsByDateRange(t,e){if(t>e)throw v.invalidDateRange("startDate","endDate");return this.tripRepository.findByDateRange(t,e)}async update(t,e){const r=await this.tripRepository.findById(t);if(!r)throw B.withId("Trip",t);this.validateUpdateDTO(e,r);const i=r.update({name:e.name,description:e.description,startDate:e.startDate,endDate:e.endDate});return this.tripRepository.save(i)}async updateTrip(t,e){const i=(await this.getTripById(t)).update(e);return this.tripRepository.save(i)}async delete(t,e=!1){if(!await this.tripRepository.exists(t))throw B.withId("Trip",t);if(this.participantRepository&&!e){const i=await this.participantRepository.countByTripId(t);if(i>0)throw new It(`Cannot delete trip with ${i} participant(s). Use force=true to delete all related data.`,Ct.BUSINESS_RULE_ERROR,{tripId:t,participantCount:i})}e&&(this.consumptionRepository&&await this.consumptionRepository.deleteByTripId(t),this.availabilityRepository&&await this.availabilityRepository.deleteByTripId(t),this.participantRepository&&await this.participantRepository.deleteByTripId(t)),await this.tripRepository.delete(t)}async deleteTrip(t){if(!await this.tripRepository.exists(t))throw B.withId("Trip",t);await this.tripRepository.delete(t)}async exists(t){return this.tripRepository.exists(t)}async tripExists(t){return this.tripRepository.exists(t)}async count(){return this.tripRepository.count()}async getTripCount(){return this.tripRepository.count()}validateCreateDTO(t){if(!t.name||t.name.trim().length===0)throw v.required("name","Trip");if(!t.startDate)throw v.required("startDate","Trip");if(!t.endDate)throw v.required("endDate","Trip");if(!(t.startDate instanceof Date)||isNaN(t.startDate.getTime()))throw v.invalidFormat("startDate","valid Date");if(!(t.endDate instanceof Date)||isNaN(t.endDate.getTime()))throw v.invalidFormat("endDate","valid Date");if(t.startDate>t.endDate)throw v.invalidDateRange("startDate","endDate")}validateUpdateDTO(t,e){if(t.name!==void 0&&t.name.trim().length===0)throw v.invalidLength("name",1,void 0,0);const r=t.startDate??e.startDate,i=t.endDate??e.endDate;if(r>i)throw v.invalidDateRange("startDate","endDate")}toResponseDTO(t,e){return{id:t.id,name:t.name,description:t.description,startDate:t.startDate,endDate:t.endDate,durationDays:t.getDurationInDays(),participantCount:e,createdAt:t.createdAt,updatedAt:t.updatedAt??t.createdAt}}toDetailResponseDTO(t,e,r){return{...this.toResponseDTO(t,e.length),participants:e.map(i=>({id:i.id,name:i.name})),productCount:0,consumptionCount:r}}}class wa{constructor(t,e,r,i){this.participantRepository=t,this.tripRepository=e,this.consumptionRepository=r,this.availabilityRepository=i}async create(t){if(this.validateCreateDTO(t),!await this.tripRepository.exists(t.tripId))throw B.withId("Trip",t.tripId);if(await this.participantRepository.findByTripIdAndName(t.tripId,t.name))throw at.withField("Participant","name",t.name);const{Participant:i}=await gt(async()=>{const{Participant:n}=await Promise.resolve().then(()=>xe);return{Participant:n}},void 0),s=i.create({tripId:t.tripId,name:t.name,email:t.email,notes:t.notes});return this.participantRepository.save(s)}async createParticipant(t){if(!await this.tripRepository.exists(t.tripId))throw B.withId("Trip",t.tripId);if(await this.participantRepository.findByTripIdAndName(t.tripId,t.name))throw at.withField("Participant","name",t.name);const{Participant:i}=await gt(async()=>{const{Participant:n}=await Promise.resolve().then(()=>xe);return{Participant:n}},void 0),s=i.create(t);return this.participantRepository.save(s)}async getById(t){return this.participantRepository.findById(t)}async getParticipantById(t){const e=await this.participantRepository.findById(t);if(!e)throw B.withId("Participant",t);return e}async getByTripId(t){if(!await this.tripRepository.exists(t))throw B.withId("Trip",t);return this.participantRepository.findByTripId(t)}async getParticipantsByTripId(t){if(!await this.tripRepository.exists(t))throw B.withId("Trip",t);return this.participantRepository.findByTripId(t)}async getParticipantsWithAvailability(t){const e=await this.getByTripId(t);if(!this.availabilityRepository)return e.map(i=>this.toWithAvailabilityDTO(i,[],0));const r=[];for(const i of e){const n=(await this.availabilityRepository.findByParticipantId(i.id)).map(p=>p.date),c=await this.tripRepository.findById(t),d=c?c.getDurationInDays():1,l=n.length/d*100;r.push(this.toWithAvailabilityDTO(i,n,l))}return r}async update(t,e){const r=await this.getParticipantById(t);if(this.validateUpdateDTO(e),e.name&&e.name!==r.name){const s=await this.participantRepository.findByTripIdAndName(r.tripId,e.name);if(s&&s.id!==t)throw at.withField("Participant","name",e.name)}const i=r.update({name:e.name,email:e.email,notes:e.notes});return this.participantRepository.save(i)}async updateParticipant(t,e){const r=await this.getParticipantById(t);if(e.name&&e.name!==r.name){const s=await this.participantRepository.findByTripIdAndName(r.tripId,e.name);if(s&&s.id!==t)throw at.withField("Participant","name",e.name)}const i=r.update(e);return this.participantRepository.save(i)}async delete(t,e=!1){if(!await this.participantRepository.exists(t))throw B.withId("Participant",t);if(this.consumptionRepository&&!e){const i=await this.consumptionRepository.findByParticipantId(t);if(i.length>0)throw new It(`Cannot delete participant with ${i.length} consumption record(s). Use force=true to delete all related data.`,Ct.BUSINESS_RULE_ERROR,{participantId:t,consumptionCount:i.length})}e&&(this.consumptionRepository&&await this.consumptionRepository.deleteByParticipantId(t),this.availabilityRepository&&await this.availabilityRepository.deleteByParticipantId(t)),await this.participantRepository.delete(t)}async deleteParticipant(t){if(!await this.participantRepository.exists(t))throw B.withId("Participant",t);await this.participantRepository.delete(t)}async deleteByTripId(t){return this.participantRepository.deleteByTripId(t)}async deleteParticipantsByTripId(t){return this.participantRepository.deleteByTripId(t)}async countByTripId(t){return this.participantRepository.countByTripId(t)}async getParticipantCountByTripId(t){return this.participantRepository.countByTripId(t)}async searchByName(t){return this.participantRepository.findByName(t)}async searchParticipantsByName(t){return this.participantRepository.findByName(t)}async searchByEmail(t){return this.participantRepository.findByEmail(t)}async exists(t){return this.participantRepository.exists(t)}validateCreateDTO(t){if(!t.tripId||t.tripId.trim().length===0)throw v.required("tripId","Participant");if(!t.name||t.name.trim().length===0)throw v.required("name","Participant");if(t.email&&!this.isValidEmail(t.email))throw v.invalidFormat("email","valid email address",t.email)}validateUpdateDTO(t){if(t.name!==void 0&&t.name.trim().length===0)throw v.invalidLength("name",1,void 0,0);if(t.email!==void 0&&t.email!==null&&!this.isValidEmail(t.email))throw v.invalidFormat("email","valid email address",t.email)}isValidEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}toResponseDTO(t){return{id:t.id,tripId:t.tripId,name:t.name,email:t.email,notes:t.notes,dietaryRestrictions:[],createdAt:t.createdAt,updatedAt:t.updatedAt??t.createdAt}}toWithAvailabilityDTO(t,e,r){return{...this.toResponseDTO(t),availableDates:e,availabilityPercentage:r}}}class xa{constructor(t,e){this.productRepository=t,this.consumptionRepository=e}async create(t){this.validateCreateDTO(t);const{Product:e}=await gt(async()=>{const{Product:i}=await Promise.resolve().then(()=>_e);return{Product:i}},void 0),r=e.create(t);return this.productRepository.save(r)}async createProduct(t){const{Product:e}=await gt(async()=>{const{Product:i}=await Promise.resolve().then(()=>_e);return{Product:i}},void 0),r=e.create(t);return this.productRepository.save(r)}async getById(t){return this.productRepository.findById(t)}async getProductById(t){const e=await this.productRepository.findById(t);if(!e)throw B.withId("Product",t);return e}async getAll(){return this.productRepository.findAll()}async getAllProducts(){return this.productRepository.findAll()}async getFiltered(t){let e=await this.productRepository.findAll();if(t.category&&(e=e.filter(r=>r.category===t.category)),t.type&&(e=e.filter(r=>r.type===t.type)),t.name){const r=t.name.toLowerCase();e=e.filter(i=>i.name.toLowerCase().includes(r))}return t.hasDefaultQuantity!==void 0&&(e=e.filter(r=>t.hasDefaultQuantity?r.defaultQuantityPerPerson!==void 0&&r.defaultQuantityPerPerson>0:r.defaultQuantityPerPerson===void 0||r.defaultQuantityPerPerson===0)),e}async getByCategory(t){if(!ne(t))throw new v(`Invalid product category: ${t}`,"category","enum");return this.productRepository.findByCategory(t)}async getProductsByCategory(t){if(!ne(t))throw new v(`Invalid product category: ${t}`,"category","enum");return this.productRepository.findByCategory(t)}async getByType(t){if(!oe(t))throw new v(`Invalid product type: ${t}`,"type","enum");return this.productRepository.findByType(t)}async getProductsByType(t){if(!oe(t))throw new v(`Invalid product type: ${t}`,"type","enum");return this.productRepository.findByType(t)}async getGroupedByCategory(){const t=await this.productRepository.findAll(),e=new Map;for(const r of t){const i=r.category;e.has(i)||e.set(i,[]),e.get(i).push(r)}return e}async getProductsWithConsumption(t){const e=await this.productRepository.findAll();if(!this.consumptionRepository)return e.map(s=>this.toWithConsumptionDTO(s,0,0));const r=await this.consumptionRepository.findByTripId(t),i=new Map;for(const s of r){const n=i.get(s.productId)||{totalQuantity:0,count:0};i.set(s.productId,{totalQuantity:n.totalQuantity+s.quantity,count:n.count+1})}return e.map(s=>{const n=i.get(s.id)||{totalQuantity:0,count:0};return this.toWithConsumptionDTO(s,n.totalQuantity,n.count)})}async searchByName(t){return this.productRepository.findByName(t)}async searchProductsByName(t){return this.productRepository.findByName(t)}async update(t,e){const r=await this.getProductById(t);this.validateUpdateDTO(e);const i=r.update(e);return this.productRepository.save(i)}async updateProduct(t,e){const i=(await this.getProductById(t)).update(e);return this.productRepository.save(i)}async delete(t,e=!1){if(!await this.productRepository.exists(t))throw B.withId("Product",t);if(this.consumptionRepository&&!e){const i=await this.consumptionRepository.findByProductId(t);if(i.length>0)throw new It(`Cannot delete product with ${i.length} consumption record(s). Use force=true to delete.`,Ct.BUSINESS_RULE_ERROR,{productId:t,consumptionCount:i.length})}await this.productRepository.delete(t)}async deleteProduct(t){if(!await this.productRepository.exists(t))throw B.withId("Product",t);await this.productRepository.delete(t)}async exists(t){return this.productRepository.exists(t)}async count(){return this.productRepository.count()}async getProductCount(){return this.productRepository.count()}validateCreateDTO(t){if(!t.name||t.name.trim().length===0)throw v.required("name","Product");if(!t.category)throw v.required("category","Product");if(!t.type)throw v.required("type","Product");if(!t.unit)throw v.required("unit","Product");if(t.defaultQuantityPerPerson!==void 0&&t.defaultQuantityPerPerson<0)throw v.outOfRange("defaultQuantityPerPerson",0,void 0,t.defaultQuantityPerPerson)}validateUpdateDTO(t){if(t.name!==void 0&&t.name.trim().length===0)throw v.invalidLength("name",1,void 0,0);if(t.defaultQuantityPerPerson!==void 0&&t.defaultQuantityPerPerson!==null&&t.defaultQuantityPerPerson<0)throw v.outOfRange("defaultQuantityPerPerson",0,void 0,t.defaultQuantityPerPerson)}toResponseDTO(t){return{id:t.id,tripId:"",name:t.name,category:t.category,unit:t.unit,defaultQuantityPerPerson:t.defaultQuantityPerPerson??0,notes:t.notes,isEssential:!0,createdAt:t.createdAt,updatedAt:t.updatedAt??t.createdAt}}toWithConsumptionDTO(t,e,r){return{...this.toResponseDTO(t),totalQuantityNeeded:e,totalEstimatedCost:0,consumptionCount:r}}}class _a{constructor(t,e,r,i){this.consumptionRepository=t,this.participantRepository=e,this.productRepository=r,this.tripRepository=i,this._toResponseDTO}async create(t){if(this.validateCreateDTO(t),!await this.participantRepository.exists(t.participantId))throw B.withId("Participant",t.participantId);if(!await this.productRepository.exists(t.productId))throw B.withId("Product",t.productId);if(this.tripRepository){const n=await this.tripRepository.findById(t.tripId);if(n){const c=new Date(t.date);if(c<n.startDate||c>n.endDate)throw v.invalidDateRange("date","trip dates")}}const{Consumption:i}=await gt(async()=>{const{Consumption:n}=await Promise.resolve().then(()=>re);return{Consumption:n}},void 0),s=i.create({tripId:t.tripId,participantId:t.participantId,productId:t.productId,date:t.date,meal:t.meal,quantity:t.quantity});return this.consumptionRepository.save(s)}async createConsumption(t){if(!await this.participantRepository.exists(t.participantId))throw B.withId("Participant",t.participantId);if(!await this.productRepository.exists(t.productId))throw B.withId("Product",t.productId);const{Consumption:i}=await gt(async()=>{const{Consumption:n}=await Promise.resolve().then(()=>re);return{Consumption:n}},void 0),s=i.create({tripId:t.tripId,participantId:t.participantId,productId:t.productId,date:t.date,meal:t.meal,quantity:t.quantity});return this.consumptionRepository.save(s)}async createBulk(t,e){const{Consumption:r}=await gt(async()=>{const{Consumption:s}=await Promise.resolve().then(()=>re);return{Consumption:s}},void 0),i=[];for(const s of e){const n=r.create({tripId:t,participantId:s.participantId,productId:s.productId,date:s.date,meal:s.meal,quantity:s.quantity});i.push(n)}return this.consumptionRepository.saveMany(i)}async getById(t){return this.consumptionRepository.findById(t)}async getConsumptionById(t){const e=await this.consumptionRepository.findById(t);if(!e)throw B.withId("Consumption",t);return e}async getByTripId(t){return this.consumptionRepository.findByTripId(t)}async getConsumptionsByTripId(t){return this.consumptionRepository.findByTripId(t)}async getByTripIdAndDate(t,e){return this.consumptionRepository.findByTripIdAndDate(t,e)}async getConsumptionsByTripIdAndDate(t,e){return this.consumptionRepository.findByTripIdAndDate(t,e)}async getByParticipantId(t){return this.consumptionRepository.findByParticipantId(t)}async getConsumptionsByParticipantId(t){return this.consumptionRepository.findByParticipantId(t)}async getByProductId(t){return this.consumptionRepository.findByProductId(t)}async getConsumptionsByProductId(t){return this.consumptionRepository.findByProductId(t)}async getSummaryByDate(t){const e=await this.consumptionRepository.findByTripId(t),r=new Map;for(const s of e){const n=s.date.toISOString().split("T")[0]??"";r.has(n)||r.set(n,{date:s.date,participants:new Set,count:0,byMeal:new Map});const c=r.get(n);c&&(c.participants.add(s.participantId),c.count++,c.byMeal.set(s.meal,(c.byMeal.get(s.meal)??0)+1))}const i=[];for(const[,s]of r)i.push({date:s.date,participantCount:s.participants.size,totalConsumptions:s.count,byMealType:Array.from(s.byMeal.entries()).map(([n,c])=>({mealType:n,count:c}))});return i.sort((s,n)=>s.date.getTime()-n.date.getTime())}async getSummaryByParticipant(t){const e=await this.consumptionRepository.findByTripId(t),r=new Map;for(const s of e){r.has(s.participantId)||r.set(s.participantId,{count:0,products:new Map});const n=r.get(s.participantId);n.count++,n.products.set(s.productId,(n.products.get(s.productId)||0)+s.quantity)}const i=[];for(const[s,n]of r){const c=await this.participantRepository.findById(s),d=[];for(const[l,p]of n.products){const m=await this.productRepository.findById(l);d.push({productId:l,productName:(m==null?void 0:m.name)||"Unknown",totalQuantity:p})}i.push({participantId:s,participantName:(c==null?void 0:c.name)||"Unknown",totalConsumptions:n.count,products:d})}return i}async update(t,e){const r=await this.getConsumptionById(t);this.validateUpdateDTO(e);const i=r.update(e);return this.consumptionRepository.save(i)}async updateConsumption(t,e){const i=(await this.getConsumptionById(t)).update(e);return this.consumptionRepository.save(i)}async delete(t){if(!await this.consumptionRepository.exists(t))throw B.withId("Consumption",t);await this.consumptionRepository.delete(t)}async deleteConsumption(t){if(!await this.consumptionRepository.exists(t))throw B.withId("Consumption",t);await this.consumptionRepository.delete(t)}async deleteByTripId(t){return this.consumptionRepository.deleteByTripId(t)}async deleteConsumptionsByTripId(t){return this.consumptionRepository.deleteByTripId(t)}async deleteByParticipantId(t){return this.consumptionRepository.deleteByParticipantId(t)}async deleteConsumptionsByParticipantId(t){return this.consumptionRepository.deleteByParticipantId(t)}async exists(t){return this.consumptionRepository.exists(t)}async count(){return this.consumptionRepository.count()}async getConsumptionCount(){return this.consumptionRepository.count()}validateCreateDTO(t){if(!t.tripId||t.tripId.trim().length===0)throw v.required("tripId","Consumption");if(!t.participantId||t.participantId.trim().length===0)throw v.required("participantId","Consumption");if(!t.productId||t.productId.trim().length===0)throw v.required("productId","Consumption");if(!t.date)throw v.required("date","Consumption");if(!t.meal)throw v.required("meal","Consumption");if(t.quantity===void 0||t.quantity<0)throw v.outOfRange("quantity",0,void 0,t.quantity)}validateUpdateDTO(t){if(t.quantity!==void 0&&t.quantity<0)throw v.outOfRange("quantity",0,void 0,t.quantity)}_toResponseDTO(t,e,r){return{id:t.id,tripId:t.tripId,participantId:t.participantId,participantName:e,productId:t.productId,productName:r,date:t.date,quantity:t.quantity,mealType:t.meal,createdAt:t.createdAt,updatedAt:t.updatedAt??t.createdAt}}}class ba{constructor(t,e,r){this.availabilityRepository=t,this.participantRepository=e,this.tripRepository=r,this._toResponseDTO}async setAvailability(t){if(this.validateSetAvailabilityDTO(t),!await this.participantRepository.exists(t.participantId))throw B.withId("Participant",t.participantId);if(this.tripRepository){const s=await this.tripRepository.findById(t.tripId);if(s){const n=new Date(t.date);if(n<s.startDate||n>s.endDate)throw v.invalidDateRange("date","trip dates")}}const r=await this.availabilityRepository.findByParticipantIdAndDate(t.participantId,t.date),{Availability:i}=await gt(async()=>{const{Availability:s}=await Promise.resolve().then(()=>ya);return{Availability:s}},void 0);if(r){const s=r.update({meals:t.meals});return this.availabilityRepository.save(s)}else{const s=i.create({participantId:t.participantId,tripId:t.tripId,date:t.date,meals:t.meals});return this.availabilityRepository.save(s)}}async setAvailabilityRange(t,e,r,i,s){const n=[],c=new Date(r);for(;c<=i;){const d=await this.setAvailability({tripId:t,participantId:e,date:new Date(c),meals:s});n.push(d),c.setDate(c.getDate()+1)}return n}async setAvailabilityForAllParticipants(t,e,r){const i=await this.participantRepository.findByTripId(t),s=[];for(const n of i){const c=await this.setAvailability({tripId:t,participantId:n.id,date:e,meals:r});s.push(c)}return s}async getById(t){return this.availabilityRepository.findById(t)}async getAvailabilityById(t){const e=await this.availabilityRepository.findById(t);if(!e)throw B.withId("Availability",t);return e}async getByTripId(t){return this.availabilityRepository.findByTripId(t)}async getAvailabilitiesByTripId(t){return this.availabilityRepository.findByTripId(t)}async getByTripIdAndDate(t,e){return this.availabilityRepository.findByTripIdAndDate(t,e)}async getAvailabilitiesByTripIdAndDate(t,e){return this.availabilityRepository.findByTripIdAndDate(t,e)}async getByParticipantId(t){return this.availabilityRepository.findByParticipantId(t)}async getAvailabilitiesByParticipantId(t){return this.availabilityRepository.findByParticipantId(t)}async getByParticipantIdAndDate(t,e){return this.availabilityRepository.findByParticipantIdAndDate(t,e)}async getAvailabilityByParticipantIdAndDate(t,e){return this.availabilityRepository.findByParticipantIdAndDate(t,e)}async getSummaryByDate(t){const e=await this.availabilityRepository.findByTripId(t),r=new Map;for(const s of e){const n=s.date.toISOString().split("T")[0]??"";r.has(n)||r.set(n,{date:s.date,participants:[]});const c=await this.participantRepository.findById(s.participantId),d=r.get(n);d&&d.participants.push({participantId:s.participantId,participantName:(c==null?void 0:c.name)??"Unknown",meals:this.toMealAvailabilityDTO(s.meals)})}const i=[];for(const[,s]of r){const n=s.participants.filter(l=>l.meals.breakfast).length,c=s.participants.filter(l=>l.meals.lunch).length,d=s.participants.filter(l=>l.meals.dinner).length;i.push({date:s.date,totalAvailable:s.participants.length,breakfastCount:n,lunchCount:c,dinnerCount:d,participants:s.participants})}return i.sort((s,n)=>s.date.getTime()-n.date.getTime())}async getSummaryByParticipant(t){const e=await this.availabilityRepository.findByTripId(t),r=await this.participantRepository.findByTripId(t);let i=1;if(this.tripRepository){const c=await this.tripRepository.findById(t);c&&(i=c.getDurationInDays())}const s=new Map;for(const c of r)s.set(c.id,{name:c.name,dates:[]});for(const c of e){const d=s.get(c.participantId);d&&d.dates.push({date:c.date,meals:this.toMealAvailabilityDTO(c.meals)})}const n=[];for(const[c,d]of s){const l=d.dates.length/i*100;n.push({participantId:c,participantName:d.name,totalDaysAvailable:d.dates.length,availabilityPercentage:Math.round(l*100)/100,dates:d.dates})}return n}async getAvailabilityMatrix(t){const e=await this.availabilityRepository.findByTripId(t),r=await this.participantRepository.findByTripId(t);let i=[];if(this.tripRepository){const l=await this.tripRepository.findById(t);if(l){const p=new Date(l.startDate);for(;p<=l.endDate;)i.push(new Date(p)),p.setDate(p.getDate()+1)}}const s={};for(const l of r){s[l.id]={};const p=s[l.id];if(p)for(const m of i){const w=m.toISOString().split("T")[0]??"";p[w]=null}}for(const l of e){const p=l.date.toISOString().split("T")[0]??"",m=s[l.participantId];m&&(m[p]=this.toMealAvailabilityDTO(l.meals))}let n=0;for(const l of e)l.meals.length>0&&n++;const c=r.length*i.length,d=c>0?Math.round(n/c*100*100)/100:0;return{tripId:t,dates:i,participants:r.map(l=>({id:l.id,name:l.name})),matrix:s,summary:{totalParticipants:r.length,totalDays:i.length,averageAvailability:d}}}async getParticipantsAvailableForMeal(t,e,r){return(await this.getByTripIdAndDate(t,e)).filter(s=>s.meals.includes(r)).map(s=>s.participantId)}async countAvailableByMeal(t,e){const r=await this.getByTripIdAndDate(t,e);return{breakfast:r.filter(i=>i.meals.includes("breakfast")).length,lunch:r.filter(i=>i.meals.includes("lunch")).length,dinner:r.filter(i=>i.meals.includes("dinner")).length,snack:r.filter(i=>i.meals.includes("snack")).length}}async delete(t){if(!await this.availabilityRepository.exists(t))throw B.withId("Availability",t);await this.availabilityRepository.delete(t)}async deleteAvailability(t){if(!await this.availabilityRepository.exists(t))throw B.withId("Availability",t);await this.availabilityRepository.delete(t)}async deleteByParticipantId(t){return this.availabilityRepository.deleteByParticipantId(t)}async deleteAvailabilitiesByParticipantId(t){return this.availabilityRepository.deleteByParticipantId(t)}async deleteByTripId(t){return this.availabilityRepository.deleteByTripId(t)}async deleteAvailabilitiesByTripId(t){return this.availabilityRepository.deleteByTripId(t)}async exists(t){return this.availabilityRepository.exists(t)}async count(){return this.availabilityRepository.count()}validateSetAvailabilityDTO(t){if(!t.tripId||t.tripId.trim().length===0)throw v.required("tripId","Availability");if(!t.participantId||t.participantId.trim().length===0)throw v.required("participantId","Availability");if(!t.date)throw v.required("date","Availability");if(!Array.isArray(t.meals))throw v.invalidFormat("meals","array of meal types")}toMealAvailabilityDTO(t){return{breakfast:t.includes("breakfast"),lunch:t.includes("lunch"),dinner:t.includes("dinner")}}_toResponseDTO(t,e){return{id:t.id,tripId:t.tripId,participantId:t.participantId,participantName:e,date:t.date,meals:this.toMealAvailabilityDTO(t.meals),createdAt:t.createdAt,updatedAt:t.updatedAt??t.createdAt}}}class ja{constructor(t,e,r,i,s){this.consumptionRepository=t,this.productRepository=e,this.availabilityRepository=r,this.tripRepository=i,this.participantRepository=s}async generate(t,e){let r=null,i="Unknown Trip",s=new Date,n=new Date,c=1;if(this.tripRepository){if(r=await this.tripRepository.findById(t),!r)throw B.withId("Trip",t);i=r.name,s=r.startDate,n=r.endDate,c=r.getDurationInDays()}let d=0;this.participantRepository&&(d=await this.participantRepository.countByTripId(t));const l=await this.consumptionRepository.findByTripId(t),p=await this.availabilityRepository.findByTripId(t),m=new Map;for(const P of l){const g=P.date.toISOString(),j=g.split("T")[0]??g.substring(0,10);m.has(P.productId)||m.set(P.productId,{quantity:0,byDate:new Map});const A=m.get(P.productId);if(A.quantity+=P.quantity,!A.byDate.has(j)){const $=p.filter(dt=>{const Z=dt.date.toISOString();return(Z.split("T")[0]??Z.substring(0,10))===j});A.byDate.set(j,{quantity:0,participantCount:$.length})}const N=A.byDate.get(j);N.quantity+=P.quantity}const w=[],_=await this.productRepository.findAll(),b=new Map(_.map(P=>[P.id,P]));for(const[P,g]of m){const j=b.get(P);if(!j||e!=null&&e.essentialOnly&&!j.defaultQuantityPerPerson||e!=null&&e.categories&&!e.categories.map(V=>String(V)).includes(String(j.category)))continue;const A=(e==null?void 0:e.quantityMultiplier)??1,N=Math.ceil(g.quantity*A),$=[];for(const[Z,V]of g.byDate)$.push({date:new Date(Z),quantity:Math.ceil(V.quantity*A),participantCount:V.participantCount});const dt={productId:j.id,productName:j.name,category:j.category,totalQuantity:N,unit:j.unit,isEssential:!!j.defaultQuantityPerPerson,byDate:$.sort((Z,V)=>Z.date.getTime()-V.date.getTime())};j.notes!==void 0&&(dt.notes=j.notes),w.push(dt)}w.sort((P,g)=>P.category!==g.category?String(P.category).localeCompare(String(g.category)):P.productName.localeCompare(g.productName));const u=[],x=new Map;for(const P of w){const g=String(P.category);x.has(g)||x.set(g,[]),x.get(g).push(P)}for(const[P,g]of x){const j=g.reduce((A,N)=>A+(N.totalEstimatedCost??0),0);u.push({category:P,categoryDisplayName:this.getCategoryDisplayName(P),items:g,categoryTotalCost:j,itemCount:g.length})}const I=w.filter(P=>P.isEssential).length,D=w.filter(P=>!P.isEssential).length,S=w.reduce((P,g)=>P+(g.totalEstimatedCost??0),0);return{tripId:t,tripName:i,startDate:s,endDate:n,totalDays:c,participantCount:d,items:w,byCategory:u,totalItems:w.length,totalEstimatedCost:S,essentialItemsCount:I,optionalItemsCount:D,generatedAt:new Date}}async generateShoppingList(t){const e=await this.consumptionRepository.findByTripId(t),r=new Map;for(const s of e){const n=r.get(s.productId)||0;r.set(s.productId,n+s.quantity)}const i=[];for(const[s,n]of r){const c=await this.productRepository.findById(s);c&&i.push({product:c,totalQuantity:n,unit:c.unit})}return i.sort((s,n)=>s.product.category!==n.product.category?s.product.category.localeCompare(n.product.category):s.product.name.localeCompare(n.product.name)),{tripId:t,items:i,generatedAt:new Date}}async getConsumptionSummaryByProduct(t){const e=await this.consumptionRepository.findByTripId(t),r=new Map;for(const s of e){const n=r.get(s.productId)||{quantity:0,count:0};r.set(s.productId,{quantity:n.quantity+s.quantity,count:n.count+1})}const i=[];for(const[s,n]of r){const c=await this.productRepository.findById(s);c&&i.push({productId:s,productName:c.name,totalQuantity:n.quantity,unit:c.unit,consumptionCount:n.count})}return i.sort((s,n)=>n.totalQuantity-s.totalQuantity),i}async calculateEstimatedQuantities(t,e){const r=await this.availabilityRepository.findByTripIdAndDate(t,e),i=await this.productRepository.findAll(),s=new Map,n=new Map;for(const d of r)for(const l of d.meals){const p=n.get(l)||0;n.set(l,p+1)}let c=0;for(const d of n.values())c+=d;for(const d of i)if(d.defaultQuantityPerPerson){const l=d.defaultQuantityPerPerson*c;s.set(d.id,l)}return s}async calculateTotalEstimatedQuantities(t){const e=await this.availabilityRepository.findByTripId(t),r=await this.productRepository.findAll(),i=new Map;let s=0;for(const n of e)s+=n.meals.length;for(const n of r)if(n.defaultQuantityPerPerson){const c=n.defaultQuantityPerPerson*s;i.set(n.id,c)}return i}async getConsumptionVariance(t){const e=await this.consumptionRepository.findByTripId(t),r=await this.productRepository.findAll(),s=(await this.availabilityRepository.findByTripId(t)).reduce((d,l)=>d+l.meals.length,0),n=new Map;for(const d of e){const l=n.get(d.productId)||0;n.set(d.productId,l+d.quantity)}const c=[];for(const d of r)if(d.defaultQuantityPerPerson){const l=d.defaultQuantityPerPerson*s,p=n.get(d.id)||0,m=p-l,w=l>0?Math.round(m/l*100*100)/100:0;c.push({productId:d.id,productName:d.name,estimated:l,actual:p,variance:m,variancePercentage:w,unit:d.unit})}return c.sort((d,l)=>Math.abs(l.variance)-Math.abs(d.variance)),c}async getShoppingSuggestions(t){const e=await this.getConsumptionVariance(t),r=[];for(const i of e)if(i.variance>0){const s=i.variancePercentage>50?"high":i.variancePercentage>20?"medium":"low";r.push({productId:i.productId,productName:i.productName,suggestion:`Consider increasing stock by ${Math.ceil(i.variance)} ${i.unit}`,priority:s,suggestedQuantity:Math.ceil(i.estimated*1.2),unit:i.unit})}else i.variance<-i.estimated*.3&&r.push({productId:i.productId,productName:i.productName,suggestion:`Consider reducing stock - ${Math.abs(i.variance)} ${i.unit} unused`,priority:"low",suggestedQuantity:Math.ceil(i.actual*1.1),unit:i.unit});return r}async getShoppingList(t){return this.generate(t)}async exportToCSV(t,e){const r=await this.generate(t),i=(e==null?void 0:e.includeNotes)??!0,s=(e==null?void 0:e.includeDailyBreakdown)??!1,n=(e==null?void 0:e.sortByCategory)??!0,c=(e==null?void 0:e.includeHeader)??!0,d=[];if(c){const p=["Categoria","Producto","Cantidad","Unidad"];if(i&&p.push("Notas"),s){const m=this.extractUniqueDates(r.items);for(const w of m)p.push(this.formatDateForCSV(w))}d.push(this.escapeCSVRow(p))}let l=[...r.items];n&&l.sort((p,m)=>p.category!==m.category?String(p.category).localeCompare(String(m.category)):p.productName.localeCompare(m.productName));for(const p of l){const w=[this.getCategoryDisplayName(p.category),p.productName,p.totalQuantity.toString(),String(p.unit)];if(i&&w.push(p.notes||""),s){const _=this.extractUniqueDates(r.items);for(const b of _){const u=p.byDate.find(x=>this.normalizeDate(x.date)===this.normalizeDate(b));w.push(u?u.quantity.toString():"0")}}d.push(this.escapeCSVRow(w))}return d.push(""),d.push(this.escapeCSVRow(["--- RESUMEN ---"])),d.push(this.escapeCSVRow(["Viaje",r.tripName])),d.push(this.escapeCSVRow(["Fecha inicio",this.formatDateForCSV(r.startDate)])),d.push(this.escapeCSVRow(["Fecha fin",this.formatDateForCSV(r.endDate)])),d.push(this.escapeCSVRow(["Total dias",r.totalDays.toString()])),d.push(this.escapeCSVRow(["Participantes",r.participantCount.toString()])),d.push(this.escapeCSVRow(["Total productos",r.totalItems.toString()])),d.push(this.escapeCSVRow(["Productos esenciales",r.essentialItemsCount.toString()])),d.push(this.escapeCSVRow(["Productos opcionales",r.optionalItemsCount.toString()])),d.push(this.escapeCSVRow(["Generado",r.generatedAt.toISOString()])),d.join(`
`)}async exportToJSON(t,e){const r=await this.generate(t),i=(e==null?void 0:e.prettyPrint)!==!1?2:0;return JSON.stringify(r,null,i)}async getShoppingListByCategory(t){return[...(await this.generate(t,{groupByCategory:!0})).byCategory]}async getLowStockProducts(t,e=20){return(await this.getConsumptionVariance(t)).filter(s=>(s.estimated>0?(s.estimated-s.actual)/s.estimated*100:100)<=e).map(s=>({productId:s.productId,productName:s.productName,remainingPercentage:s.estimated>0?Math.round((s.estimated-s.actual)/s.estimated*100*100)/100:100,currentQuantity:Math.max(0,s.estimated-s.actual),estimatedNeed:s.estimated,unit:s.unit})).sort((s,n)=>s.remainingPercentage-n.remainingPercentage)}async getShoppingListSummary(t){const e=await this.generate(t),r=e.byCategory.map(i=>({category:i.categoryDisplayName,count:i.itemCount}));return{tripId:e.tripId,tripName:e.tripName,totalProducts:e.totalItems,essentialProducts:e.essentialItemsCount,optionalProducts:e.optionalItemsCount,totalEstimatedCost:e.totalEstimatedCost,categoryCounts:r,generatedAt:e.generatedAt}}getCategoryDisplayName(t){const e=String(t);return{food:"Comida",beverage:"Bebidas",alcohol:"Alcohol",snack:"Snacks",other:"Otros",FOOD:"Comida",BEVERAGE:"Bebidas",BEVERAGES:"Bebidas",ALCOHOL:"Alcohol",SNACK:"Snacks",SNACKS:"Snacks",OTHER:"Otros",MEAT:"Carnes",SEAFOOD:"Mariscos",DAIRY:"Lacteos",PRODUCE:"Frutas y Verduras",BAKERY:"Panaderia",CONDIMENTS:"Condimentos",FROZEN:"Congelados",CANNED:"Enlatados",DRY_GOODS:"Secos"}[e]||e}extractUniqueDates(t){const e=new Set;for(const r of t)for(const i of r.byDate)e.add(this.normalizeDate(i.date));return Array.from(e).map(r=>new Date(r)).sort((r,i)=>r.getTime()-i.getTime())}normalizeDate(t){const e=t.toISOString();return e.split("T")[0]??e.substring(0,10)}formatDateForCSV(t){const e=t.toISOString();return e.split("T")[0]??e.substring(0,10)}escapeCSVRow(t){return t.map(e=>{const r=String(e);return r.includes(",")||r.includes('"')||r.includes(`
`)||r.includes(";")?`"${r.replace(/"/g,'""')}"`:r}).join(",")}}const Vt=new Ht,Ia=o=>Xt.fromPersistence(o),Na=o=>Yt.fromPersistence(o),Da=o=>Jt.fromPersistence(o),Ca=o=>Kt.fromPersistence(o),Pa=o=>ct.fromPersistence(o),Se=new Je(Vt,Ia),ce=new Ke(Vt,Na),de=new Ze(Vt,Da),Te=new ta(Vt,Ca),Be=new ea(Vt,Pa),Aa=new va(Se),Ea=new wa(ce,Se),Ra=new xa(de),Sa=new _a(Te,ce,de),Ta=new ba(Be,ce),Ba=new ja(Te,de,Be),La={tripService:Aa,participantService:Ea,productService:Ra,consumptionService:Sa,availabilityService:Ta,shoppingService:Ba},Le=y.createContext(null),ka=({children:o})=>{const t=y.useMemo(()=>La,[]);return a.jsx(Le.Provider,{value:t,children:o})},Zt=()=>{const o=y.useContext(Le);if(!o)throw new Error("useServices must be used within a ServiceProvider");return o},Ma="_header_9ro8n_2",Oa="_container_9ro8n_10",$a="_left_9ro8n_21",qa="_menuButton_9ro8n_27",Fa="_logo_9ro8n_47",Va="_logoText_9ro8n_62",Qa="_tripBadge_9ro8n_67",Wa="_nav_9ro8n_83",za="_navLink_9ro8n_89",Ua="_active_9ro8n_105",Ha="_right_9ro8n_111",Ga="_iconButton_9ro8n_117",rt={header:Ma,container:Oa,left:$a,menuButton:qa,logo:Fa,logoText:Va,tripBadge:Qa,nav:Wa,navLink:za,active:Ua,right:Ha,iconButton:Ga},Xa=({tripName:o,showNav:t=!0,onToggleSidebar:e})=>{const r=Ve(),i=s=>r.pathname===s;return a.jsx("header",{className:rt.header,children:a.jsxs("div",{className:rt.container,children:[a.jsxs("div",{className:rt.left,children:[e&&a.jsx("button",{type:"button",className:rt.menuButton,onClick:e,"aria-label":"Abrir menu",children:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M3 12h18M3 6h18M3 18h18"})})}),a.jsxs(nt,{to:"/",className:rt.logo,children:[a.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M3 3h18v18H3zM12 8v8m-4-4h8"})}),a.jsx("span",{className:rt.logoText,children:"TripFood"})]}),o&&a.jsxs("div",{className:rt.tripBadge,children:[a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M9 18l6-6-6-6"})}),a.jsx("span",{children:o})]})]}),t&&a.jsxs("nav",{className:rt.nav,"aria-label":"Navegacion principal",children:[a.jsx(nt,{to:"/",className:`${rt.navLink} ${i("/")?rt.active:""}`,children:"Inicio"}),a.jsx(nt,{to:"/trips",className:`${rt.navLink} ${r.pathname.startsWith("/trips")?rt.active:""}`,children:"Viajes"})]}),a.jsx("div",{className:rt.right,children:a.jsx("button",{type:"button",className:rt.iconButton,"aria-label":"Configuracion",children:a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("circle",{cx:"12",cy:"12",r:"3"}),a.jsx("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"})]})})})]})})},Ya="_overlay_x3rsb_2",Ja="_sidebar_x3rsb_10",Ka="_header_x3rsb_25",Za="_title_x3rsb_33",tr="_closeButton_x3rsb_40",er="_nav_x3rsb_60",ar="_navItem_x3rsb_66",rr="_active_x3rsb_86",ir="_navIcon_x3rsb_91",sr="_navLabel_x3rsb_103",nr="_footer_x3rsb_108",or="_backLink_x3rsb_113",cr="_open_x3rsb_144",ot={overlay:Ya,sidebar:Ja,header:Ka,title:Za,closeButton:tr,nav:er,navItem:ar,active:rr,navIcon:ir,navLabel:sr,footer:nr,backLink:or,open:cr},dr=({isOpen:o,onClose:t})=>{const{tripId:e}=qt(),r=[{path:`/trips/${e}`,label:"Dashboard",icon:a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),a.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),a.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),a.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]})},{path:`/trips/${e}/participants`,label:"Participantes",icon:a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),a.jsx("circle",{cx:"9",cy:"7",r:"4"}),a.jsx("path",{d:"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"})]})},{path:`/trips/${e}/products`,label:"Productos",icon:a.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0"})})},{path:`/trips/${e}/availability`,label:"Disponibilidad",icon:a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M9 11l3 3L22 4"}),a.jsx("path",{d:"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"})]})},{path:`/trips/${e}/shopping`,label:"Lista de Compras",icon:a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("circle",{cx:"9",cy:"21",r:"1"}),a.jsx("circle",{cx:"20",cy:"21",r:"1"}),a.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"})]})}];return a.jsxs(a.Fragment,{children:[o&&a.jsx("div",{className:ot.overlay,onClick:t,"aria-hidden":"true"}),a.jsxs("aside",{className:`${ot.sidebar} ${o?ot.open:""}`,"aria-label":"Menu de navegacion del viaje",children:[a.jsxs("div",{className:ot.header,children:[a.jsx("h2",{className:ot.title,children:"Menu"}),a.jsx("button",{type:"button",className:ot.closeButton,onClick:t,"aria-label":"Cerrar menu",children:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),a.jsx("nav",{className:ot.nav,children:r.map(i=>a.jsxs(he,{to:i.path,end:i.path===`/trips/${e}`,className:({isActive:s})=>`${ot.navItem} ${s?ot.active:""}`,onClick:t,children:[a.jsx("span",{className:ot.navIcon,children:i.icon}),a.jsx("span",{className:ot.navLabel,children:i.label})]},i.path))}),a.jsx("div",{className:ot.footer,children:a.jsxs(he,{to:"/trips",className:ot.backLink,onClick:t,children:[a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Volver a Viajes"]})})]})]})},lr="_layout_21p42_2",pr="_body_21p42_9",ur="_main_21p42_15",hr="_withSidebar_21p42_22",mr="_content_21p42_26",Mt={layout:lr,body:pr,main:ur,withSidebar:hr,content:mr},K=({children:o,tripName:t,showSidebar:e=!1,showNav:r=!0})=>{const[i,s]=y.useState(!1),n=y.useCallback(()=>{s(d=>!d)},[]),c=y.useCallback(()=>{s(!1)},[]);return a.jsxs("div",{className:Mt.layout,children:[a.jsx(Xa,{tripName:t,showNav:r,onToggleSidebar:e?n:void 0}),a.jsxs("div",{className:Mt.body,children:[e&&a.jsx(dr,{isOpen:i,onClose:c}),a.jsx("main",{className:`${Mt.main} ${e?Mt.withSidebar:""}`,children:a.jsx("div",{className:Mt.content,children:o})})]})]})},yr="_button_1ow04_2",fr="_primary_1ow04_30",gr="_secondary_1ow04_46",vr="_danger_1ow04_61",wr="_ghost_1ow04_77",xr="_sm_1ow04_92",_r="_md_1ow04_97",br="_lg_1ow04_102",jr="_fullWidth_1ow04_108",Ir="_loading_1ow04_113",Nr="_content_1ow04_118",Dr="_spinner_1ow04_122",Cr="_spin_1ow04_122",Pr="_icon_1ow04_148",wt={button:yr,primary:fr,secondary:gr,danger:vr,ghost:wr,sm:xr,md:_r,lg:br,fullWidth:jr,loading:Ir,content:Nr,spinner:Dr,spin:Cr,icon:Pr},U=({children:o,variant:t="primary",size:e="md",isLoading:r=!1,leftIcon:i,rightIcon:s,fullWidth:n=!1,disabled:c,className:d,type:l="button",...p})=>{const m=[wt.button,wt[t],wt[e],n?wt.fullWidth:"",r?wt.loading:"",d??""].filter(Boolean).join(" ");return a.jsxs("button",{type:l,className:m,disabled:c||r,"aria-busy":r,...p,children:[r&&a.jsx("span",{className:wt.spinner,"aria-hidden":"true"}),!r&&i&&a.jsx("span",{className:wt.icon,"aria-hidden":"true",children:i}),a.jsx("span",{className:wt.content,children:o}),!r&&s&&a.jsx("span",{className:wt.icon,"aria-hidden":"true",children:s})]})},Ar="_overlay_1ver5_2",Er="_fadeIn_1ver5_1",Rr="_modal_1ver5_23",Sr="_slideIn_1ver5_1",Tr="_sm_1ver5_46",Br="_md_1ver5_51",Lr="_lg_1ver5_56",kr="_xl_1ver5_61",Mr="_header_1ver5_67",Or="_title_1ver5_76",$r="_closeButton_1ver5_83",qr="_body_1ver5_108",Fr="_footer_1ver5_115",xt={overlay:Ar,fadeIn:Er,modal:Rr,slideIn:Sr,sm:Tr,md:Br,lg:Lr,xl:kr,header:Mr,title:Or,closeButton:$r,body:qr,footer:Fr},Bt=({isOpen:o,onClose:t,title:e,children:r,footer:i,size:s="md",closeOnOverlayClick:n=!0,closeOnEscape:c=!0})=>{const d=y.useRef(null),l=y.useRef(null),p=y.useCallback(_=>{c&&_.key==="Escape"&&t()},[c,t]),m=y.useCallback(_=>{n&&_.target===_.currentTarget&&t()},[n,t]);if(y.useEffect(()=>{var _,b;return o?(l.current=document.activeElement,(_=d.current)==null||_.focus(),document.body.style.overflow="hidden"):(document.body.style.overflow="",(b=l.current)==null||b.focus()),()=>{document.body.style.overflow=""}},[o]),!o)return null;const w=a.jsx("div",{className:xt.overlay,onClick:m,onKeyDown:p,role:"presentation",children:a.jsxs("div",{ref:d,className:`${xt.modal} ${xt[s]}`,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",tabIndex:-1,children:[a.jsxs("div",{className:xt.header,children:[a.jsx("h2",{id:"modal-title",className:xt.title,children:e}),a.jsx("button",{type:"button",className:xt.closeButton,onClick:t,"aria-label":"Cerrar modal",children:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),a.jsx("div",{className:xt.body,children:r}),i&&a.jsx("div",{className:xt.footer,children:i})]})});return Qe.createPortal(w,document.body)},Vr="_card_x6pxi_2",Qr="_outlined_x6pxi_15",Wr="_elevated_x6pxi_20",zr="_body_x6pxi_25",Ur="_header_x6pxi_42",Hr="_headerText_x6pxi_50",Gr="_title_x6pxi_55",Xr="_subtitle_x6pxi_63",Yr="_headerActions_x6pxi_70",Jr="_footer_x6pxi_84",Kr="_interactive_x6pxi_91",ut={card:Vr,default:"_default_x6pxi_11",outlined:Qr,elevated:Wr,"padding-none":"_padding-none_x6pxi_25",body:zr,"padding-sm":"_padding-sm_x6pxi_29","padding-md":"_padding-md_x6pxi_33","padding-lg":"_padding-lg_x6pxi_37",header:Ur,headerText:Hr,title:Gr,subtitle:Xr,headerActions:Yr,footer:Jr,interactive:Kr},G=({title:o,subtitle:t,headerActions:e,footer:r,variant:i="default",padding:s="md",interactive:n=!1,children:c,className:d,onClick:l,...p})=>{const m=[ut.card,ut[i],ut[`padding-${s}`],n?ut.interactive:"",d??""].filter(Boolean).join(" "),w=o||t||e;return a.jsxs("div",{className:m,onClick:l,role:n?"button":void 0,tabIndex:n?0:void 0,onKeyDown:n?_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),l==null||l(_))}:void 0,...p,children:[w&&a.jsxs("div",{className:ut.header,children:[a.jsxs("div",{className:ut.headerText,children:[o&&a.jsx("h3",{className:ut.title,children:o}),t&&a.jsx("p",{className:ut.subtitle,children:t})]}),e&&a.jsx("div",{className:ut.headerActions,children:e})]}),a.jsx("div",{className:ut.body,children:c}),r&&a.jsx("div",{className:ut.footer,children:r})]})},Zr="_container_xvbs2_2",ti="_fullWidth_xvbs2_8",ei="_label_xvbs2_13",ai="_required_xvbs2_19",ri="_inputWrapper_xvbs2_24",ii="_error_xvbs2_39",si="_disabled_xvbs2_47",ni="_sm_xvbs2_53",oi="_input_xvbs2_24",ci="_md_xvbs2_62",di="_lg_xvbs2_71",li="_addon_xvbs2_101",pi="_hasLeftAddon_xvbs2_109",ui="_hasRightAddon_xvbs2_113",hi="_helperText_xvbs2_118",mi="_errorText_xvbs2_124",tt={container:Zr,fullWidth:ti,label:ei,required:ai,inputWrapper:ri,error:ii,disabled:si,sm:ni,input:oi,md:ci,lg:di,addon:li,hasLeftAddon:pi,hasRightAddon:ui,helperText:hi,errorText:mi},mt=y.forwardRef(({label:o,helperText:t,error:e,size:r="md",leftAddon:i,rightAddon:s,required:n=!1,fullWidth:c=!1,className:d,id:l,disabled:p,...m},w)=>{const _=l||`input-${Math.random().toString(36).substr(2,9)}`,b=!!e,u=[tt.container,c?tt.fullWidth:"",d??""].filter(Boolean).join(" "),x=[tt.inputWrapper,tt[r],b?tt.error:"",p?tt.disabled:"",i?tt.hasLeftAddon:"",s?tt.hasRightAddon:""].filter(Boolean).join(" ");return a.jsxs("div",{className:u,children:[o&&a.jsxs("label",{htmlFor:_,className:tt.label,children:[o,n&&a.jsx("span",{className:tt.required,"aria-hidden":"true",children:" *"})]}),a.jsxs("div",{className:x,children:[i&&a.jsx("span",{className:tt.addon,"aria-hidden":"true",children:i}),a.jsx("input",{ref:w,id:_,className:tt.input,disabled:p,"aria-invalid":b,"aria-describedby":e?`${_}-error`:t?`${_}-helper`:void 0,required:n,...m}),s&&a.jsx("span",{className:tt.addon,"aria-hidden":"true",children:s})]}),e&&a.jsx("p",{id:`${_}-error`,className:tt.errorText,role:"alert",children:e}),!e&&t&&a.jsx("p",{id:`${_}-helper`,className:tt.helperText,children:t})]})});mt.displayName="Input";const yi="_container_mu5gb_2",fi="_fullWidth_mu5gb_8",gi="_label_mu5gb_13",vi="_required_mu5gb_19",wi="_selectWrapper_mu5gb_24",xi="_error_mu5gb_39",_i="_disabled_mu5gb_47",bi="_sm_mu5gb_53",ji="_select_mu5gb_24",Ii="_md_mu5gb_62",Ni="_lg_mu5gb_71",Di="_icon_mu5gb_109",Ci="_hasLeftIcon_mu5gb_119",Pi="_chevron_mu5gb_124",Ai="_helperText_mu5gb_135",Ei="_errorText_mu5gb_141",it={container:yi,fullWidth:fi,label:gi,required:vi,selectWrapper:wi,error:xi,disabled:_i,sm:bi,select:ji,md:Ii,lg:Ni,icon:Di,hasLeftIcon:Ci,chevron:Pi,helperText:Ai,errorText:Ei},Ot=y.forwardRef(({label:o,options:t,placeholder:e,helperText:r,error:i,size:s="md",required:n=!1,fullWidth:c=!1,leftIcon:d,className:l,id:p,disabled:m,...w},_)=>{const b=p||`select-${Math.random().toString(36).substr(2,9)}`,u=!!i,x=[it.container,c?it.fullWidth:"",l??""].filter(Boolean).join(" "),I=[it.selectWrapper,it[s],u?it.error:"",m?it.disabled:"",d?it.hasLeftIcon:""].filter(Boolean).join(" ");return a.jsxs("div",{className:x,children:[o&&a.jsxs("label",{htmlFor:b,className:it.label,children:[o,n&&a.jsx("span",{className:it.required,"aria-hidden":"true",children:" *"})]}),a.jsxs("div",{className:I,children:[d&&a.jsx("span",{className:it.icon,"aria-hidden":"true",children:d}),a.jsxs("select",{ref:_,id:b,className:it.select,disabled:m,"aria-invalid":u,"aria-describedby":i?`${b}-error`:r?`${b}-helper`:void 0,required:n,...w,children:[e&&a.jsx("option",{value:"",disabled:!0,children:e}),t.map(D=>a.jsx("option",{value:D.value,disabled:D.disabled,children:D.label},D.value))]}),a.jsx("span",{className:it.chevron,"aria-hidden":"true",children:a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M6 9l6 6 6-6"})})})]}),i&&a.jsx("p",{id:`${b}-error`,className:it.errorText,role:"alert",children:i}),!i&&r&&a.jsx("p",{id:`${b}-helper`,className:it.helperText,children:r})]})});Ot.displayName="Select";const Ri="_wrapper_1ua89_2",Si="_table_1ua89_9",Ti="_thead_1ua89_16",Bi="_th_1ua89_16",Li="_sortButton_1ua89_45",ki="_sortIcon_1ua89_66",Mi="_tbody_1ua89_72",Oi="_tr_1ua89_76",$i="_clickable_1ua89_89",qi="_selected_1ua89_93",Fi="_td_1ua89_101",Vi="_checkboxCell_1ua89_108",Qi="_emptyCell_1ua89_122",Wi="_striped_1ua89_129",zi="_compact_1ua89_138",Ui="_loadingContainer_1ua89_147",Hi="_loadingSpinner_1ua89_157",Gi="_spin_1ua89_1",z={wrapper:Ri,table:Si,thead:Ti,th:Bi,"align-left":"_align-left_1ua89_32","align-center":"_align-center_1ua89_36","align-right":"_align-right_1ua89_40",sortButton:Li,sortIcon:ki,tbody:Mi,tr:Oi,clickable:$i,selected:qi,td:Fi,checkboxCell:Vi,emptyCell:Qi,striped:Wi,compact:zi,loadingContainer:Ui,loadingSpinner:Hi,spin:Gi};function ke({data:o,columns:t,getRowKey:e,isLoading:r=!1,emptyMessage:i="No hay datos disponibles",sortKey:s,sortDirection:n,onSort:c,onRowClick:d,selectedKeys:l,onSelectRow:p,onSelectAll:m,selectable:w=!1,striped:_=!1,compact:b=!1}){const u=o.length>0&&(l==null?void 0:l.size)===o.length,x=l&&l.size>0&&l.size<o.length,I=[z.table,_?z.striped:"",b?z.compact:""].filter(Boolean).join(" "),D=g=>{c&&c(g)},S=()=>{m&&m(!u)},P=g=>{p&&l&&p(g,!l.has(g))};return r?a.jsxs("div",{className:z.loadingContainer,children:[a.jsx("div",{className:z.loadingSpinner}),a.jsx("p",{children:"Cargando datos..."})]}):a.jsx("div",{className:z.wrapper,children:a.jsxs("table",{className:I,children:[a.jsx("thead",{className:z.thead,children:a.jsxs("tr",{children:[w&&a.jsx("th",{className:z.checkboxCell,children:a.jsx("input",{type:"checkbox",checked:u,ref:g=>{g&&(g.indeterminate=x??!1)},onChange:S,"aria-label":"Seleccionar todos"})}),t.map(g=>a.jsx("th",{className:`${z.th} ${z[`align-${g.align||"left"}`]}`,style:{width:g.width},children:g.sortable&&c?a.jsxs("button",{type:"button",className:z.sortButton,onClick:()=>D(g.key),"aria-label":`Ordenar por ${g.header}`,children:[g.header,a.jsx("span",{className:z.sortIcon,children:s===g.key?n==="asc"?a.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M18 15l-6-6-6 6"})}):a.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M6 9l6 6 6-6"})}):a.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",opacity:"0.3",children:a.jsx("path",{d:"M7 15l5 5 5-5M7 9l5-5 5 5"})})})]}):g.header},g.key))]})}),a.jsx("tbody",{className:z.tbody,children:o.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:t.length+(w?1:0),className:z.emptyCell,children:i})}):o.map((g,j)=>{const A=e(g,j),N=l==null?void 0:l.has(A);return a.jsxs("tr",{className:`${z.tr} ${N?z.selected:""} ${d?z.clickable:""}`,onClick:d?()=>d(g,j):void 0,children:[w&&a.jsx("td",{className:z.checkboxCell,children:a.jsx("input",{type:"checkbox",checked:N,onChange:()=>P(A),onClick:$=>$.stopPropagation(),"aria-label":`Seleccionar fila ${j+1}`})}),t.map($=>a.jsx("td",{className:`${z.td} ${z[`align-${$.align||"left"}`]}`,children:$.render(g,j)},$.key))]},A)})})]})})}const Xi="_container_38p1t_2",Yi="_overlay_38p1t_11",Ji="_fullscreen_38p1t_18",Ki="_spinner_38p1t_26",Zi="_rotate_38p1t_1",ts="_sm_38p1t_36",es="_md_38p1t_41",as="_lg_38p1t_46",rs="_track_38p1t_52",is="_progress_38p1t_57",ss="_dash_38p1t_1",ns="_message_38p1t_64",_t={container:Xi,overlay:Yi,fullscreen:Ji,spinner:Ki,rotate:Zi,sm:ts,md:es,lg:as,track:rs,progress:is,dash:ss,message:ns},Pt=({size:o="md",message:t="Cargando...",overlay:e=!1,fullscreen:r=!1})=>{const i=[_t.container,e?_t.overlay:"",r?_t.fullscreen:""].filter(Boolean).join(" ");return a.jsxs("div",{className:i,role:"status","aria-live":"polite",children:[a.jsx("div",{className:`${_t.spinner} ${_t[o]}`,"aria-hidden":"true",children:a.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{className:_t.track,cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3"}),a.jsx("circle",{className:_t.progress,cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})]})}),t&&a.jsx("p",{className:_t.message,children:t}),a.jsx("span",{className:"sr-only",children:t})]})},os="_container_dx1es_2",cs="_sm_dx1es_12",ds="_iconWrapper_dx1es_16",ls="_title_dx1es_26",ps="_description_dx1es_30",us="_md_dx1es_34",hs="_lg_dx1es_48",ms="_action_dx1es_97",Rt={container:os,sm:cs,iconWrapper:ds,title:ls,description:ps,md:us,lg:hs,action:ms},At=({icon:o,title:t,description:e,action:r,size:i="md"})=>{const s=a.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:a.jsx("path",{d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})});return a.jsxs("div",{className:`${Rt.container} ${Rt[i]}`,role:"status",children:[a.jsx("div",{className:Rt.iconWrapper,"aria-hidden":"true",children:o||s}),a.jsx("h3",{className:Rt.title,children:t}),e&&a.jsx("p",{className:Rt.description,children:e}),r&&a.jsx("div",{className:Rt.action,children:r})]})},ys="_container_ut5yo_4",fs="_card_ut5yo_13",gs="_fullpage_ut5yo_20",vs="_iconWrapper_ut5yo_28",ws="_title_ut5yo_41",xs="_message_ut5yo_49",_s="_actions_ut5yo_58",bs="_retryButton_ut5yo_66",js="_inline_ut5yo_91",Is="_inlineIcon_ut5yo_102",Ns="_inlineMessage_ut5yo_108",Ds="_inlineRetry_ut5yo_113",ht={container:ys,card:fs,fullpage:gs,iconWrapper:vs,title:ws,message:xs,actions:_s,retryButton:bs,inline:js,inlineIcon:Is,inlineMessage:Ns,inlineRetry:Ds},Lt=({title:o="Error",message:t,onRetry:e,retryText:r="Reintentar",icon:i,action:s,variant:n="card"})=>{const c=a.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 8v4m0 4h.01"})]});return n==="inline"?a.jsxs("div",{className:ht.inline,role:"alert",children:[a.jsx("span",{className:ht.inlineIcon,"aria-hidden":"true",children:a.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 8v4m0 4h.01"})]})}),a.jsx("span",{className:ht.inlineMessage,children:t}),e&&a.jsx("button",{type:"button",className:ht.inlineRetry,onClick:e,children:r})]}):a.jsxs("div",{className:`${ht.container} ${ht[n]}`,role:"alert",children:[a.jsx("div",{className:ht.iconWrapper,"aria-hidden":"true",children:i||c}),a.jsx("h3",{className:ht.title,children:o}),a.jsx("p",{className:ht.message,children:t}),a.jsxs("div",{className:ht.actions,children:[e&&a.jsxs("button",{type:"button",className:ht.retryButton,onClick:e,children:[a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M1 4v6h6M23 20v-6h-6"}),a.jsx("path",{d:"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"})]}),r]}),s]})]})},Cs="_content_198wn_2",Ps="_iconWrapper_198wn_11",As="_danger_198wn_20",Es="_warning_198wn_25",Rs="_info_198wn_30",Ss="_message_198wn_36",Ut={content:Cs,iconWrapper:Ps,danger:As,warning:Es,info:Rs,message:Ss},le=({isOpen:o,onClose:t,onConfirm:e,title:r,message:i,confirmText:s="Confirmar",cancelText:n="Cancelar",variant:c="danger",isLoading:d=!1,icon:l})=>{const p={danger:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0zM12 9v4m0 4h.01"})}),warning:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 8v4m0 4h.01"})]}),info:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("circle",{cx:"12",cy:"12",r:"10"}),a.jsx("path",{d:"M12 16v-4m0-4h.01"})]})},m=c==="danger"?"danger":"primary",w=a.jsxs(a.Fragment,{children:[a.jsx(U,{variant:"secondary",onClick:t,disabled:d,children:n}),a.jsx(U,{variant:m,onClick:e,isLoading:d,children:s})]});return a.jsx(Bt,{isOpen:o,onClose:t,title:r,footer:w,size:"sm",closeOnOverlayClick:!d,closeOnEscape:!d,children:a.jsxs("div",{className:Ut.content,children:[a.jsx("div",{className:`${Ut.iconWrapper} ${Ut[c]}`,"aria-hidden":"true",children:l||p[c]}),a.jsx("div",{className:Ut.message,children:typeof i=="string"?a.jsx("p",{children:i}):i})]})})};function jt(o={}){const{initialOpen:t=!1,onOpen:e,onClose:r}=o,[i,s]=y.useState(t),n=y.useCallback(()=>{s(!0),e==null||e()},[e]),c=y.useCallback(()=>{s(!1),r==null||r()},[r]),d=y.useCallback(()=>{s(p=>{const m=!p;return m?e==null||e():r==null||r(),m})},[e,r]),l=y.useMemo(()=>({isOpen:i,onClose:c}),[i,c]);return{isOpen:i,open:n,close:c,toggle:d,modalProps:l}}function pe(){const[o,t]=y.useState([]),[e,r]=y.useState(!0),[i,s]=y.useState(null),{tripService:n}=Zt(),c=y.useCallback(()=>{s(null)},[]),d=y.useCallback(async()=>{try{r(!0),s(null);const _=await n.getAllTripsOrderedByStartDate();t(_)}catch(_){const b=_ instanceof Error?_:new Error("Error al cargar los viajes");s(b)}finally{r(!1)}},[n]),l=y.useCallback(async _=>{try{r(!0),s(null);const b=await n.createTrip(_);return t(u=>[...u,b]),b}catch(b){const u=b instanceof Error?b:new Error("Error al crear el viaje");throw s(u),u}finally{r(!1)}},[n]),p=y.useCallback(async(_,b)=>{try{r(!0),s(null);const u=await n.updateTrip(_,b);return t(x=>x.map(I=>I.id===_?u:I)),u}catch(u){const x=u instanceof Error?u:new Error("Error al actualizar el viaje");throw s(x),x}finally{r(!1)}},[n]),m=y.useCallback(async _=>{try{r(!0),s(null),await n.deleteTrip(_),t(b=>b.filter(u=>u.id!==_))}catch(b){const u=b instanceof Error?b:new Error("Error al eliminar el viaje");throw s(u),u}finally{r(!1)}},[n]),w=y.useCallback(async _=>{try{return s(null),await n.getTripById(_)}catch(b){const u=b instanceof Error?b:new Error("Error al obtener el viaje");throw s(u),u}},[n]);return y.useEffect(()=>{d()},[d]),{trips:o,isLoading:e,error:i,fetchTrips:d,createTrip:l,updateTrip:p,deleteTrip:m,getTripById:w,clearError:c,refetch:d}}function te(o){const[t,e]=y.useState([]),[r,i]=y.useState(!0),[s,n]=y.useState(null),{participantService:c}=Zt(),d=y.useCallback(()=>{n(null)},[]),l=y.useCallback(async()=>{if(!o){e([]),i(!1);return}try{i(!0),n(null);const u=await c.getParticipantsByTripId(o);e(u)}catch(u){const x=u instanceof Error?u:new Error("Error al cargar los participantes");n(x)}finally{i(!1)}},[o,c]),p=y.useCallback(async u=>{try{i(!0),n(null);const x=await c.createParticipant({...u,tripId:o});return e(I=>[...I,x]),x}catch(x){const I=x instanceof Error?x:new Error("Error al crear el participante");throw n(I),I}finally{i(!1)}},[o,c]),m=y.useCallback(async(u,x)=>{try{i(!0),n(null);const I=await c.updateParticipant(u,x);return e(D=>D.map(S=>S.id===u?I:S)),I}catch(I){const D=I instanceof Error?I:new Error("Error al actualizar el participante");throw n(D),D}finally{i(!1)}},[c]),w=y.useCallback(async u=>{try{i(!0),n(null),await c.deleteParticipant(u),e(x=>x.filter(I=>I.id!==u))}catch(x){const I=x instanceof Error?x:new Error("Error al eliminar el participante");throw n(I),I}finally{i(!1)}},[c]),_=y.useCallback(async u=>{try{return n(null),await c.getParticipantById(u)}catch(x){const I=x instanceof Error?x:new Error("Error al obtener el participante");throw n(I),I}},[c]),b=y.useCallback(async()=>{try{return await c.getParticipantCountByTripId(o)}catch(u){const x=u instanceof Error?u:new Error("Error al obtener el conteo de participantes");throw n(x),x}},[o,c]);return y.useEffect(()=>{l()},[l]),{participants:t,isLoading:r,error:s,fetchParticipants:l,createParticipant:p,updateParticipant:m,deleteParticipant:w,getParticipantById:_,getParticipantCount:b,clearError:d,refetch:l}}const je={};function ue(){const[o,t]=y.useState([]),[e,r]=y.useState(je),[i,s]=y.useState(!0),[n,c]=y.useState(null),{productService:d}=Zt(),l=y.useMemo(()=>{let g=[...o];if(e.category&&(g=g.filter(j=>j.category===e.category)),e.type&&(g=g.filter(j=>j.type===e.type)),e.searchTerm&&e.searchTerm.trim()!==""){const j=e.searchTerm.toLowerCase().trim();g=g.filter(A=>A.name.toLowerCase().includes(j)||A.notes&&A.notes.toLowerCase().includes(j))}return g},[o,e]),p=y.useCallback(()=>{c(null)},[]),m=y.useCallback(async()=>{try{s(!0),c(null);const g=await d.getAllProducts();t(g)}catch(g){const j=g instanceof Error?g:new Error("Error al cargar los productos");c(j)}finally{s(!1)}},[d]),w=y.useCallback(async g=>{try{s(!0),c(null);const j=await d.createProduct(g);return t(A=>[...A,j]),j}catch(j){const A=j instanceof Error?j:new Error("Error al crear el producto");throw c(A),A}finally{s(!1)}},[d]),_=y.useCallback(async(g,j)=>{try{s(!0),c(null);const A=await d.updateProduct(g,j);return t(N=>N.map($=>$.id===g?A:$)),A}catch(A){const N=A instanceof Error?A:new Error("Error al actualizar el producto");throw c(N),N}finally{s(!1)}},[d]),b=y.useCallback(async g=>{try{s(!0),c(null),await d.deleteProduct(g),t(j=>j.filter(A=>A.id!==g))}catch(j){const A=j instanceof Error?j:new Error("Error al eliminar el producto");throw c(A),A}finally{s(!1)}},[d]),u=y.useCallback(async g=>{try{return c(null),await d.getProductById(g)}catch(j){const A=j instanceof Error?j:new Error("Error al obtener el producto");throw c(A),A}},[d]),x=y.useCallback(g=>{r(g)},[]),I=y.useCallback(()=>{r(je)},[]),D=y.useCallback(g=>{r(j=>({...j,category:g,type:g!==j.category?void 0:j.type}))},[]),S=y.useCallback(g=>{r(j=>({...j,type:g}))},[]),P=y.useCallback(g=>{r(j=>({...j,searchTerm:g}))},[]);return y.useEffect(()=>{m()},[m]),{products:o,filteredProducts:l,filters:e,isLoading:i,error:n,fetchProducts:m,createProduct:w,updateProduct:_,deleteProduct:b,getProductById:u,setFilters:x,clearFilters:I,filterByCategory:D,filterByType:S,searchByName:P,clearError:p,refetch:m}}const Ts={delimiter:",",quoteChar:'"',includeHeader:!0,dateFormat:"iso",fileName:"export.csv",includeBOM:!0};class ie{constructor(t){f(this,"options");this.options={...Ts,...t}}async exportToCSV(t,e,r){try{const i={...this.options,...r},{delimiter:s,quoteChar:n,includeHeader:c,includeBOM:d,fileName:l}=i,p=[];if(c){const b=e.map(u=>this.escapeField(u.header,n,s));p.push(b.join(s))}for(const b of t){const u=e.map(x=>{const I=x.accessor(b),D=x.formatter?x.formatter(I):this.formatValue(I,i.dateFormat);return this.escapeField(D,n,s)});p.push(u.join(s))}let m=p.join(`\r
`);d&&(m="\uFEFF"+m);const _=new TextEncoder().encode(m).length;return{content:m,fileName:l,mimeType:"text/csv;charset=utf-8",size:_,rowCount:t.length}}catch(i){throw new Tt("Failed to export data to CSV",i instanceof Error?i:void 0)}}async exportToBlob(t,e,r){const i=await this.exportToCSV(t,e,r);return new Blob([i.content],{type:i.mimeType})}download(t){try{const e=new Blob([t.content],{type:t.mimeType}),r=URL.createObjectURL(e),i=document.createElement("a");i.href=r,i.download=t.fileName,i.style.display="none",document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),URL.revokeObjectURL(r)},100)}catch(e){throw new Tt("Failed to download CSV file",e instanceof Error?e:void 0)}}escapeField(t,e,r){if(t.includes(r)||t.includes(e)||t.includes(`
`)||t.includes("\r")){const s=t.replace(new RegExp(e,"g"),e+e);return`${e}${s}${e}`}return t}formatValue(t,e){return t==null?"":t instanceof Date?this.formatDate(t,e):typeof t=="boolean"?t?"true":"false":typeof t=="number"?t.toString():String(t)}formatDate(t,e){switch(e){case"iso":return t.toISOString();case"locale":return t.toLocaleString();case"short":return t.toLocaleDateString();default:return t.toISOString()}}static getTripColumns(){return[{header:"ID",accessor:t=>t.id},{header:"Nombre",accessor:t=>t.name},{header:"Descripcion",accessor:t=>t.description},{header:"Fecha Inicio",accessor:t=>t.startDate},{header:"Fecha Fin",accessor:t=>t.endDate},{header:"Creado",accessor:t=>t.createdAt}]}static getParticipantColumns(){return[{header:"ID",accessor:t=>t.id},{header:"ID Viaje",accessor:t=>t.tripId},{header:"Nombre",accessor:t=>t.name},{header:"Email",accessor:t=>t.email},{header:"Notas",accessor:t=>t.notes},{header:"Creado",accessor:t=>t.createdAt}]}static getProductColumns(){return[{header:"ID",accessor:t=>t.id},{header:"Nombre",accessor:t=>t.name},{header:"Categoria",accessor:t=>t.category},{header:"Tipo",accessor:t=>t.type},{header:"Unidad",accessor:t=>t.unit},{header:"Cantidad por Persona",accessor:t=>t.defaultQuantityPerPerson},{header:"Notas",accessor:t=>t.notes}]}static getConsumptionColumns(){return[{header:"ID",accessor:t=>t.id},{header:"ID Viaje",accessor:t=>t.tripId},{header:"ID Participante",accessor:t=>t.participantId},{header:"ID Producto",accessor:t=>t.productId},{header:"Fecha",accessor:t=>t.date},{header:"Comida",accessor:t=>t.meal},{header:"Cantidad",accessor:t=>t.quantity}]}static getShoppingListColumns(){return[{header:"Producto",accessor:t=>t.productName},{header:"Categoria",accessor:t=>t.category},{header:"Cantidad Total",accessor:t=>t.totalQuantity},{header:"Unidad",accessor:t=>t.unit}]}}const Ie=[{header:"Producto",accessor:o=>o.productName},{header:"Categoria",accessor:o=>o.category},{header:"Cantidad Total",accessor:o=>o.totalQuantity},{header:"Unidad",accessor:o=>o.unit}];function Bs(o){const[t,e]=y.useState(null),[r,i]=y.useState([]),[s,n]=y.useState(!1),[c,d]=y.useState(null),{shoppingService:l}=Zt(),p=y.useCallback(()=>{d(null)},[]),m=y.useCallback(async()=>{if(!o)throw new Error("No se ha especificado un viaje");try{n(!0),d(null);const D=await l.generateShoppingList(o);return e(D),D}catch(D){const S=D instanceof Error?D:new Error("Error al generar la lista de compras");throw d(S),S}finally{n(!1)}},[o,l]),w=y.useCallback(async()=>{if(!o)throw new Error("No se ha especificado un viaje");try{n(!0),d(null);const D=await l.getConsumptionSummaryByProduct(o);return i(D),D}catch(D){const S=D instanceof Error?D:new Error("Error al obtener el resumen de consumo");throw d(S),S}finally{n(!1)}},[o,l]),_=y.useCallback(()=>t?t.items.map(D=>({productName:D.product.name,category:D.product.category,totalQuantity:D.totalQuantity,unit:D.unit})):[],[t]),b=y.useCallback(async D=>{if(t||await m(),!t&&!c)throw new Error("No hay datos para exportar");const S=_(),P=new ie,g=`lista-compras-${o}-${new Date().toISOString().split("T")[0]}.csv`;return P.exportToCSV(S,Ie,{fileName:D||g,includeHeader:!0,dateFormat:"locale"})},[t,o,_,m,c]),u=y.useCallback(async D=>{try{d(null);const S=await b(D);new ie().download(S)}catch(S){const P=S instanceof Error?S:new Error("Error al descargar el CSV");throw d(P),P}},[b]),x=y.useCallback(async()=>{t||await m();const D=_();return new ie().exportToBlob(D,Ie)},[t,_,m]),I=y.useCallback(async()=>{await Promise.all([m(),w()])},[m,w]);return y.useEffect(()=>{o&&m().catch(()=>{})},[o,m]),{shoppingList:t,consumptionSummary:r,isLoading:s,error:c,generateShoppingList:m,getConsumptionSummary:w,exportToCSV:b,downloadCSV:u,exportToBlob:x,refresh:I,clearError:p}}const Ls="_page_1s1fr_2",ks="_hero_1s1fr_8",Ms="_heroContent_1s1fr_17",Os="_heroTitle_1s1fr_22",$s="_heroSubtitle_1s1fr_29",qs="_heroActions_1s1fr_36",Fs="_heroImage_1s1fr_41",Vs="_section_1s1fr_53",Qs="_sectionHeader_1s1fr_57",Ws="_sectionTitle_1s1fr_64",zs="_sectionLink_1s1fr_71",Us="_statsGrid_1s1fr_84",Hs="_statCard_1s1fr_90",Gs="_statContent_1s1fr_94",Xs="_statIcon_1s1fr_100",Ys="_statInfo_1s1fr_110",Js="_statValue_1s1fr_116",Ks="_statLabel_1s1fr_123",Zs="_tripGrid_1s1fr_129",tn="_tripLink_1s1fr_135",en="_tripCard_1s1fr_144",an="_tripInfo_1s1fr_148",rn="_tripDate_1s1fr_154",sn="_tripParticipants_1s1fr_155",nn="_featureGrid_1s1fr_169",on="_featureCard_1s1fr_175",cn="_featureIcon_1s1fr_189",dn="_featureTitle_1s1fr_201",ln="_featureDescription_1s1fr_208",pn="_error_1s1fr_216",C={page:Ls,hero:ks,heroContent:Ms,heroTitle:Os,heroSubtitle:$s,heroActions:qs,heroImage:Fs,section:Vs,sectionHeader:Qs,sectionTitle:Ws,sectionLink:zs,statsGrid:Us,statCard:Hs,statContent:Gs,statIcon:Xs,statInfo:Ys,statValue:Js,statLabel:Ks,tripGrid:Zs,tripLink:tn,tripCard:en,tripInfo:an,tripDate:rn,tripParticipants:sn,featureGrid:nn,featureCard:on,featureIcon:cn,featureTitle:dn,featureDescription:ln,error:pn},un=()=>{const{trips:o,isLoading:t,error:e}=pe(),r=o.slice(0,3),i=y.useMemo(()=>{const n=new Date,c=o.filter(p=>new Date(p.startDate)>n).length,d=o.filter(p=>new Date(p.endDate)<n).length;return{totalTrips:o.length,totalParticipants:0,upcomingTrips:c,pastTrips:d}},[o]),s=()=>t?a.jsx(Pt,{message:"Cargando viajes..."}):e?a.jsx("div",{className:C.error,children:a.jsx("p",{children:e.message})}):a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:C.hero,children:[a.jsxs("div",{className:C.heroContent,children:[a.jsx("h1",{className:C.heroTitle,children:"TripFood Manager"}),a.jsx("p",{className:C.heroSubtitle,children:"Organiza las compras de comida y bebida para tus viajes en grupo de manera facil y colaborativa"}),a.jsxs("div",{className:C.heroActions,children:[a.jsx(nt,{to:"/trips",children:a.jsx(U,{variant:"primary",size:"lg",children:"Ver mis viajes"})}),a.jsx(nt,{to:"/trips/new",children:a.jsx(U,{variant:"secondary",size:"lg",children:"Crear nuevo viaje"})})]})]}),a.jsx("div",{className:C.heroImage,"aria-hidden":"true",children:a.jsxs("svg",{viewBox:"0 0 200 200",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("circle",{cx:"100",cy:"100",r:"80",fill:"var(--color-primary-100)"}),a.jsx("path",{d:"M60 80h80v60a10 10 0 01-10 10H70a10 10 0 01-10-10V80z",fill:"var(--color-primary-500)"}),a.jsx("rect",{x:"70",y:"60",width:"60",height:"20",rx:"5",fill:"var(--color-primary-600)"}),a.jsx("circle",{cx:"85",cy:"110",r:"8",fill:"white"}),a.jsx("circle",{cx:"115",cy:"110",r:"8",fill:"white"}),a.jsx("rect",{x:"90",y:"125",width:"20",height:"5",rx:"2",fill:"white"})]})})]}),o.length>0&&a.jsxs("section",{className:C.section,children:[a.jsx("h2",{className:C.sectionTitle,children:"Estadisticas generales"}),a.jsxs("div",{className:C.statsGrid,children:[a.jsx(G,{className:C.statCard,children:a.jsxs("div",{className:C.statContent,children:[a.jsx("div",{className:C.statIcon,style:{background:"var(--color-primary-50)",color:"var(--color-primary-600)"},children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),a.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]})}),a.jsxs("div",{className:C.statInfo,children:[a.jsx("span",{className:C.statValue,children:i.totalTrips}),a.jsx("span",{className:C.statLabel,children:"Viajes totales"})]})]})}),a.jsx(G,{className:C.statCard,children:a.jsxs("div",{className:C.statContent,children:[a.jsx("div",{className:C.statIcon,style:{background:"rgba(16, 185, 129, 0.1)",color:"var(--color-success)"},children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),a.jsx("circle",{cx:"9",cy:"7",r:"4"}),a.jsx("path",{d:"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"})]})}),a.jsxs("div",{className:C.statInfo,children:[a.jsx("span",{className:C.statValue,children:i.totalParticipants}),a.jsx("span",{className:C.statLabel,children:"Participantes totales"})]})]})}),a.jsx(G,{className:C.statCard,children:a.jsxs("div",{className:C.statContent,children:[a.jsx("div",{className:C.statIcon,style:{background:"rgba(59, 130, 246, 0.1)",color:"#2563eb"},children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),a.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),a.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),a.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})}),a.jsxs("div",{className:C.statInfo,children:[a.jsx("span",{className:C.statValue,children:i.upcomingTrips}),a.jsx("span",{className:C.statLabel,children:"Viajes proximos"})]})]})}),a.jsx(G,{className:C.statCard,children:a.jsxs("div",{className:C.statContent,children:[a.jsx("div",{className:C.statIcon,style:{background:"var(--color-gray-100)",color:"var(--color-gray-600)"},children:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("polyline",{points:"22 12 18 12 15 21 9 3 6 12 2 12"})})}),a.jsxs("div",{className:C.statInfo,children:[a.jsx("span",{className:C.statValue,children:i.pastTrips}),a.jsx("span",{className:C.statLabel,children:"Viajes completados"})]})]})})]})]}),a.jsxs("section",{className:C.section,children:[a.jsxs("div",{className:C.sectionHeader,children:[a.jsx("h2",{className:C.sectionTitle,children:"Viajes recientes"}),a.jsx(nt,{to:"/trips",className:C.sectionLink,children:"Ver todos"})]}),r.length===0?a.jsx(At,{title:"No tienes viajes todavia",description:"Crea tu primer viaje para empezar a organizar las compras del grupo",action:a.jsx(nt,{to:"/trips/new",children:a.jsx(U,{variant:"primary",children:"Crear viaje"})})}):a.jsx("div",{className:C.tripGrid,children:r.map(n=>a.jsx(nt,{to:`/trips/${n.id}`,className:C.tripLink,children:a.jsx(G,{title:n.name,subtitle:n.description,interactive:!0,className:C.tripCard,children:a.jsxs("div",{className:C.tripInfo,children:[a.jsxs("div",{className:C.tripDate,children:[a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),a.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),a.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),a.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),a.jsxs("span",{children:[new Date(n.startDate).toLocaleDateString("es-ES",{day:"numeric",month:"short"})," - ",new Date(n.endDate).toLocaleDateString("es-ES",{day:"numeric",month:"short"})]})]}),a.jsxs("div",{className:C.tripParticipants,children:[a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),a.jsx("circle",{cx:"9",cy:"7",r:"4"}),a.jsx("path",{d:"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"})]}),a.jsxs("span",{children:[n.getDurationInDays()," dias"]})]})]})})},n.id))})]}),a.jsxs("section",{className:C.section,children:[a.jsx("h2",{className:C.sectionTitle,children:"Funcionalidades"}),a.jsxs("div",{className:C.featureGrid,children:[a.jsxs("div",{className:C.featureCard,children:[a.jsx("div",{className:C.featureIcon,children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),a.jsx("circle",{cx:"9",cy:"7",r:"4"}),a.jsx("path",{d:"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"})]})}),a.jsx("h3",{className:C.featureTitle,children:"Gestion de participantes"}),a.jsx("p",{className:C.featureDescription,children:"Anade y gestiona los participantes del viaje facilmente"})]}),a.jsxs("div",{className:C.featureCard,children:[a.jsx("div",{className:C.featureIcon,children:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0"})})}),a.jsx("h3",{className:C.featureTitle,children:"Catalogo de productos"}),a.jsx("p",{className:C.featureDescription,children:"Crea una lista completa de productos necesarios para el viaje"})]}),a.jsxs("div",{className:C.featureCard,children:[a.jsx("div",{className:C.featureIcon,children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M9 11l3 3L22 4"}),a.jsx("path",{d:"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"})]})}),a.jsx("h3",{className:C.featureTitle,children:"Matriz de disponibilidad"}),a.jsx("p",{className:C.featureDescription,children:"Cada participante indica que productos puede conseguir"})]}),a.jsxs("div",{className:C.featureCard,children:[a.jsx("div",{className:C.featureIcon,children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("circle",{cx:"9",cy:"21",r:"1"}),a.jsx("circle",{cx:"20",cy:"21",r:"1"}),a.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"})]})}),a.jsx("h3",{className:C.featureTitle,children:"Lista de compras"}),a.jsx("p",{className:C.featureDescription,children:"Genera automaticamente la lista de compras optimizada"})]})]})]})]});return a.jsx(K,{showNav:!0,children:a.jsx("div",{className:C.page,children:s()})})},hn="_page_h80zn_2",mn="_header_h80zn_8",yn="_title_h80zn_15",fn="_tripGrid_h80zn_23",gn="_tripCard_h80zn_29",vn="_tripContent_h80zn_33",wn="_tripDescription_h80zn_39",xn="_tripMeta_h80zn_50",_n="_tripDate_h80zn_56",bn="_viewLink_h80zn_71",jn="_deleteButton_h80zn_81",In="_form_h80zn_106",Nn="_dateRow_h80zn_112",Dn="_formActions_h80zn_118",st={page:hn,header:mn,title:yn,tripGrid:fn,tripCard:gn,tripContent:vn,tripDescription:wn,tripMeta:xn,tripDate:_n,viewLink:bn,deleteButton:jn,form:In,dateRow:Nn,formActions:Dn},Cn=()=>{const o=We(),{trips:t,isLoading:e,error:r,createTrip:i,deleteTrip:s,clearError:n}=pe(),c=jt(),d=jt(),[l,p]=y.useState({name:"",description:"",startDate:"",endDate:""}),[m,w]=y.useState({}),[_,b]=y.useState(!1),[u,x]=y.useState(null),I=()=>{p({name:"",description:"",startDate:"",endDate:""}),w({})},D=()=>{const N={};return l.name.trim()||(N.name="El nombre es obligatorio"),l.startDate||(N.startDate="La fecha de inicio es obligatoria"),l.endDate||(N.endDate="La fecha de fin es obligatoria"),l.startDate&&l.endDate&&l.startDate>l.endDate&&(N.endDate="La fecha de fin debe ser posterior a la de inicio"),w(N),Object.keys(N).length===0},S=async N=>{if(N.preventDefault(),!!D()){b(!0);try{const $=await i({name:l.name,description:l.description||void 0,startDate:new Date(l.startDate),endDate:new Date(l.endDate)});c.close(),I(),o(`/trips/${$.id}`)}catch{}finally{b(!1)}}},P=N=>{x(N),d.open()},g=async()=>{if(u)try{await s(u),d.close(),x(null)}catch{}},j=()=>{I(),c.open()},A=()=>e&&t.length===0?a.jsx(Pt,{message:"Cargando viajes..."}):r?a.jsx(Lt,{title:"Error al cargar viajes",message:r.message,onRetry:n}):t.length===0?a.jsx(At,{title:"No tienes viajes todavia",description:"Crea tu primer viaje para empezar a organizar las compras del grupo",action:a.jsx(U,{variant:"primary",onClick:j,children:"Crear viaje"})}):a.jsx("div",{className:st.tripGrid,children:t.map(N=>a.jsx(G,{title:N.name,className:st.tripCard,headerActions:a.jsx("button",{type:"button",className:st.deleteButton,onClick:$=>{$.stopPropagation(),P(N.id)},"aria-label":`Eliminar ${N.name}`,children:a.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("polyline",{points:"3 6 5 6 21 6"}),a.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})]})}),children:a.jsxs("div",{className:st.tripContent,children:[N.description&&a.jsx("p",{className:st.tripDescription,children:N.description}),a.jsx("div",{className:st.tripMeta,children:a.jsxs("div",{className:st.tripDate,children:[a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),a.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),a.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),a.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),a.jsxs("span",{children:[new Date(N.startDate).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})," - ",new Date(N.endDate).toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})]})]})}),a.jsx(nt,{to:`/trips/${N.id}`,className:st.viewLink,children:a.jsx(U,{variant:"primary",fullWidth:!0,children:"Ver viaje"})})]})},N.id))});return a.jsx(K,{showNav:!0,children:a.jsxs("div",{className:st.page,children:[a.jsxs("div",{className:st.header,children:[a.jsx("h1",{className:st.title,children:"Mis Viajes"}),a.jsxs(U,{variant:"primary",onClick:j,children:[a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),a.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Nuevo viaje"]})]}),A(),a.jsx(Bt,{isOpen:c.isOpen,onClose:c.close,title:"Crear nuevo viaje",size:"md",children:a.jsxs("form",{onSubmit:S,className:st.form,children:[a.jsx(mt,{label:"Nombre del viaje",placeholder:"Ej: Viaje a la playa",value:l.name,onChange:N=>p({...l,name:N.target.value}),error:m.name,required:!0,fullWidth:!0}),a.jsx(mt,{label:"Descripcion",placeholder:"Describe brevemente el viaje",value:l.description,onChange:N=>p({...l,description:N.target.value}),fullWidth:!0}),a.jsxs("div",{className:st.dateRow,children:[a.jsx(mt,{type:"date",label:"Fecha de inicio",value:l.startDate,onChange:N=>p({...l,startDate:N.target.value}),error:m.startDate,required:!0,fullWidth:!0}),a.jsx(mt,{type:"date",label:"Fecha de fin",value:l.endDate,onChange:N=>p({...l,endDate:N.target.value}),error:m.endDate,required:!0,fullWidth:!0})]}),a.jsxs("div",{className:st.formActions,children:[a.jsx(U,{type:"button",variant:"secondary",onClick:c.close,disabled:_,children:"Cancelar"}),a.jsx(U,{type:"submit",variant:"primary",isLoading:_,children:"Crear viaje"})]})]})}),a.jsx(le,{isOpen:d.isOpen,onClose:d.close,onConfirm:g,title:"Eliminar viaje",message:"Estas seguro de que quieres eliminar este viaje? Esta accion no se puede deshacer y se eliminaran todos los datos asociados.",confirmText:"Eliminar",variant:"danger"})]})})},Pn="_page_5lpmb_2",An="_header_5lpmb_9",En="_headerContent_5lpmb_16",Rn="_title_5lpmb_20",Sn="_description_5lpmb_27",Tn="_meta_5lpmb_34",Bn="_metaItem_5lpmb_40",Ln="_statsGrid_5lpmb_54",kn="_statCard_5lpmb_60",Mn="_statContent_5lpmb_64",On="_statIcon_5lpmb_70",$n="_statInfo_5lpmb_80",qn="_statValue_5lpmb_86",Fn="_statLabel_5lpmb_93",Vn="_progressCard_5lpmb_99",Qn="_progressContent_5lpmb_103",Wn="_progressInfo_5lpmb_123",zn="_actionsGrid_5lpmb_137",Un="_actionLink_5lpmb_143",Hn="_actionCard_5lpmb_152",Gn="_actionContent_5lpmb_156",Xn="_actionIcon_5lpmb_162",Yn="_actionText_5lpmb_174",Jn="_actionArrow_5lpmb_191",R={page:Pn,header:An,headerContent:En,title:Rn,description:Sn,meta:Tn,metaItem:Bn,statsGrid:Ln,statCard:kn,statContent:Mn,statIcon:On,statInfo:$n,statValue:qn,statLabel:Fn,progressCard:Vn,progressContent:Qn,progressInfo:Wn,actionsGrid:zn,actionLink:Un,actionCard:Hn,actionContent:Gn,actionIcon:Xn,actionText:Yn,actionArrow:Jn},Kn=()=>{const{tripId:o}=qt(),{trips:t,isLoading:e,error:r}=pe(),{participants:i,isLoading:s}=te(o||""),{products:n,isLoading:c}=ue(),d=t.find(w=>w.id===o),l=e||s||c,p=i.length,m=n.length;return l?a.jsx(K,{showSidebar:!0,tripName:"Cargando...",children:a.jsx(Pt,{message:"Cargando viaje..."})}):r?a.jsx(K,{showSidebar:!0,children:a.jsx(Lt,{title:"Error al cargar el viaje",message:r.message})}):d?a.jsx(K,{showSidebar:!0,tripName:d.name,children:a.jsxs("div",{className:R.page,children:[a.jsx("div",{className:R.header,children:a.jsxs("div",{className:R.headerContent,children:[a.jsx("h1",{className:R.title,children:d.name}),d.description&&a.jsx("p",{className:R.description,children:d.description}),a.jsx("div",{className:R.meta,children:a.jsxs("span",{className:R.metaItem,children:[a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),a.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),a.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),a.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),new Date(d.startDate).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})," - ",new Date(d.endDate).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})]})})]})}),a.jsxs("div",{className:R.statsGrid,children:[a.jsx(G,{className:R.statCard,children:a.jsxs("div",{className:R.statContent,children:[a.jsx("div",{className:R.statIcon,style:{background:"var(--color-primary-50)",color:"var(--color-primary-600)"},children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),a.jsx("circle",{cx:"9",cy:"7",r:"4"}),a.jsx("path",{d:"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"})]})}),a.jsxs("div",{className:R.statInfo,children:[a.jsx("span",{className:R.statValue,children:p}),a.jsx("span",{className:R.statLabel,children:"Participantes"})]})]})}),a.jsx(G,{className:R.statCard,children:a.jsxs("div",{className:R.statContent,children:[a.jsx("div",{className:R.statIcon,style:{background:"rgba(16, 185, 129, 0.1)",color:"var(--color-success)"},children:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0"})})}),a.jsxs("div",{className:R.statInfo,children:[a.jsx("span",{className:R.statValue,children:m}),a.jsx("span",{className:R.statLabel,children:"Productos planificados"})]})]})})]}),a.jsx(G,{title:"Resumen del viaje",className:R.progressCard,children:a.jsx("div",{className:R.progressContent,children:a.jsx("div",{className:R.progressInfo,children:a.jsxs("span",{children:["Viaje con ",p," participantes y ",m," productos para planificar"]})})})}),a.jsxs("div",{className:R.actionsGrid,children:[a.jsx(nt,{to:`/trips/${o}/participants`,className:R.actionLink,children:a.jsx(G,{interactive:!0,className:R.actionCard,children:a.jsxs("div",{className:R.actionContent,children:[a.jsx("div",{className:R.actionIcon,children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),a.jsx("circle",{cx:"9",cy:"7",r:"4"}),a.jsx("path",{d:"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"})]})}),a.jsxs("div",{className:R.actionText,children:[a.jsx("h3",{children:"Participantes"}),a.jsx("p",{children:"Gestiona los miembros del viaje"})]}),a.jsx("svg",{className:R.actionArrow,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M9 18l6-6-6-6"})})]})})}),a.jsx(nt,{to:`/trips/${o}/products`,className:R.actionLink,children:a.jsx(G,{interactive:!0,className:R.actionCard,children:a.jsxs("div",{className:R.actionContent,children:[a.jsx("div",{className:R.actionIcon,children:a.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0"})})}),a.jsxs("div",{className:R.actionText,children:[a.jsx("h3",{children:"Productos"}),a.jsx("p",{children:"Gestiona el catalogo de productos"})]}),a.jsx("svg",{className:R.actionArrow,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M9 18l6-6-6-6"})})]})})}),a.jsx(nt,{to:`/trips/${o}/availability`,className:R.actionLink,children:a.jsx(G,{interactive:!0,className:R.actionCard,children:a.jsxs("div",{className:R.actionContent,children:[a.jsx("div",{className:R.actionIcon,children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M9 11l3 3L22 4"}),a.jsx("path",{d:"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"})]})}),a.jsxs("div",{className:R.actionText,children:[a.jsx("h3",{children:"Disponibilidad"}),a.jsx("p",{children:"Matriz de quien trae que"})]}),a.jsx("svg",{className:R.actionArrow,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M9 18l6-6-6-6"})})]})})}),a.jsx(nt,{to:`/trips/${o}/shopping`,className:R.actionLink,children:a.jsx(G,{interactive:!0,className:R.actionCard,children:a.jsxs("div",{className:R.actionContent,children:[a.jsx("div",{className:R.actionIcon,children:a.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("circle",{cx:"9",cy:"21",r:"1"}),a.jsx("circle",{cx:"20",cy:"21",r:"1"}),a.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"})]})}),a.jsxs("div",{className:R.actionText,children:[a.jsx("h3",{children:"Lista de compras"}),a.jsx("p",{children:"Ver y gestionar la lista final"})]}),a.jsx("svg",{className:R.actionArrow,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M9 18l6-6-6-6"})})]})})})]})]})}):a.jsx(K,{showSidebar:!0,children:a.jsx(At,{title:"Viaje no encontrado",description:"El viaje que buscas no existe o ha sido eliminado",action:a.jsx(nt,{to:"/trips",children:a.jsx(U,{variant:"primary",children:"Volver a viajes"})})})})},Zn="_page_uhean_2",to="_header_uhean_9",eo="_title_uhean_16",ao="_subtitle_uhean_23",ro="_nameCell_uhean_30",io="_avatar_uhean_36",so="_actions_uhean_81",no="_actionButton_uhean_88",oo="_danger_uhean_107",co="_form_uhean_118",lo="_formActions_uhean_124",lt={page:Zn,header:to,title:eo,subtitle:ao,nameCell:ro,avatar:io,actions:so,actionButton:no,danger:oo,form:co,formActions:lo},po=()=>{const{tripId:o}=qt(),{participants:t,isLoading:e,error:r,createParticipant:i,updateParticipant:s,deleteParticipant:n,clearError:c}=te(o||""),d=jt(),l=jt(),p=jt(),[m,w]=y.useState({name:"",email:"",notes:""}),[_,b]=y.useState({}),[u,x]=y.useState(!1),[I,D]=y.useState(null),[S,P]=y.useState(null),g=()=>{w({name:"",email:"",notes:""}),b({}),D(null)},j=()=>{const M={};return m.name.trim()||(M.name="El nombre es obligatorio"),m.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m.email)&&(M.email="El email no es valido"),b(M),Object.keys(M).length===0},A=async M=>{if(M.preventDefault(),!!j()){x(!0);try{await i({name:m.name,email:m.email||void 0,notes:m.notes||void 0}),d.close(),g()}catch{}finally{x(!1)}}},N=async M=>{if(M.preventDefault(),!(!j()||!I)){x(!0);try{const vt={name:m.name,email:m.email||void 0,notes:m.notes||void 0};await s(I.id,vt),l.close(),g()}catch{}finally{x(!1)}}},$=M=>{D(M),w({name:M.name,email:M.email||"",notes:M.notes||""}),l.open()},dt=M=>{P(M),p.open()},Z=async()=>{if(S)try{await n(S.id),p.close(),P(null)}catch{}},V=()=>{g(),d.open()},Nt=[{key:"name",header:"Nombre",render:M=>a.jsxs("div",{className:lt.nameCell,children:[a.jsx("div",{className:lt.avatar,children:M.name.charAt(0).toUpperCase()}),a.jsx("span",{children:M.name})]})},{key:"email",header:"Email",render:M=>M.email||"-"},{key:"notes",header:"Notas",render:M=>M.notes||"-"},{key:"actions",header:"Acciones",align:"right",render:M=>a.jsxs("div",{className:lt.actions,children:[a.jsx("button",{type:"button",className:lt.actionButton,onClick:()=>$(M),"aria-label":`Editar ${M.name}`,children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),a.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),a.jsx("button",{type:"button",className:`${lt.actionButton} ${lt.danger}`,onClick:()=>dt(M),"aria-label":`Eliminar ${M.name}`,children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("polyline",{points:"3 6 5 6 21 6"}),a.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})]})})]})}],Qt=()=>e&&t.length===0?a.jsx(Pt,{message:"Cargando participantes..."}):r?a.jsx(Lt,{title:"Error al cargar participantes",message:r.message,onRetry:c}):t.length===0?a.jsx(At,{title:"No hay participantes",description:"Anade participantes al viaje para empezar a organizar las compras",icon:a.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[a.jsx("path",{d:"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"}),a.jsx("circle",{cx:"9",cy:"7",r:"4"}),a.jsx("path",{d:"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"})]}),action:a.jsx(U,{variant:"primary",onClick:V,children:"Anadir participante"})}):a.jsx(ke,{data:t,columns:Nt,getRowKey:M=>M.id}),Wt=(M,vt=!1)=>a.jsxs("form",{onSubmit:M,className:lt.form,children:[a.jsx(mt,{label:"Nombre",placeholder:"Nombre del participante",value:m.name,onChange:Dt=>w({...m,name:Dt.target.value}),error:_.name,required:!0,fullWidth:!0}),a.jsx(mt,{type:"email",label:"Email",placeholder:"email@ejemplo.com",value:m.email,onChange:Dt=>w({...m,email:Dt.target.value}),error:_.email,fullWidth:!0}),a.jsx(mt,{label:"Notas",placeholder:"Notas adicionales (alergias, preferencias...)",value:m.notes,onChange:Dt=>w({...m,notes:Dt.target.value}),fullWidth:!0}),a.jsxs("div",{className:lt.formActions,children:[a.jsx(U,{type:"button",variant:"secondary",onClick:()=>{(vt?l:d).close(),g()},disabled:u,children:"Cancelar"}),a.jsx(U,{type:"submit",variant:"primary",isLoading:u,children:vt?"Guardar cambios":"Anadir"})]})]});return a.jsx(K,{showSidebar:!0,tripName:"Viaje",children:a.jsxs("div",{className:lt.page,children:[a.jsxs("div",{className:lt.header,children:[a.jsxs("div",{children:[a.jsx("h1",{className:lt.title,children:"Participantes"}),a.jsxs("p",{className:lt.subtitle,children:[t.length," participantes en total"]})]}),a.jsxs(U,{variant:"primary",onClick:V,children:[a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),a.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Anadir participante"]})]}),Qt(),a.jsx(Bt,{isOpen:d.isOpen,onClose:()=>{d.close(),g()},title:"Anadir participante",size:"sm",children:Wt(A)}),a.jsx(Bt,{isOpen:l.isOpen,onClose:()=>{l.close(),g()},title:"Editar participante",size:"sm",children:Wt(N,!0)}),a.jsx(le,{isOpen:p.isOpen,onClose:()=>{p.close(),P(null)},onConfirm:Z,title:"Eliminar participante",message:`Estas seguro de que quieres eliminar a "${S==null?void 0:S.name}"? Esta accion no se puede deshacer.`,confirmText:"Eliminar",variant:"danger"})]})})},uo="_page_xj3za_2",ho="_header_xj3za_9",mo="_title_xj3za_16",yo="_subtitle_xj3za_23",fo="_filters_xj3za_30",go="_productCell_xj3za_36",vo="_productName_xj3za_42",wo="_productNotes_xj3za_47",xo="_categoryBadge_xj3za_53",_o="_bebida_xj3za_62",bo="_comida_xj3za_67",jo="_snack_xj3za_72",Io="_otro_xj3za_77",No="_statusBadge_xj3za_83",Do="_purchased_xj3za_95",Co="_pending_xj3za_104",Po="_actions_xj3za_114",Ao="_actionButton_xj3za_121",Eo="_danger_xj3za_140",Ro="_form_xj3za_151",So="_row_xj3za_157",To="_formActions_xj3za_163",X={page:uo,header:ho,title:mo,subtitle:yo,filters:fo,productCell:go,productName:vo,productNotes:wo,categoryBadge:xo,bebida:_o,comida:bo,snack:jo,otro:Io,statusBadge:No,purchased:Do,pending:Co,actions:Po,actionButton:Ao,danger:Eo,form:Ro,row:So,formActions:To},Ne=[{value:"beverage",label:"Bebida"},{value:"food",label:"Comida"}],Bo=[{value:"water",label:"Agua"},{value:"soda",label:"Refresco"},{value:"juice",label:"Zumo"},{value:"alcohol",label:"Alcohol"},{value:"meat",label:"Carne"},{value:"dairy",label:"Lacteos"},{value:"grains",label:"Cereales"},{value:"vegetables",label:"Verduras"},{value:"fruits",label:"Frutas"},{value:"snacks",label:"Snacks"},{value:"other",label:"Otro"}],Lo=[{value:"unit",label:"Unidad"},{value:"bottle",label:"Botella"},{value:"can",label:"Lata"},{value:"pack",label:"Paquete"},{value:"kg",label:"Kilogramo"},{value:"liter",label:"Litro"}],ko={beverage:"Bebida",food:"Comida",other:"Otro"},Mo=()=>{const{products:o,isLoading:t,error:e,createProduct:r,updateProduct:i,deleteProduct:s,clearError:n}=ue(),c=jt(),d=jt(),l=jt(),[p,m]=y.useState({name:"",category:"food",type:"miscellaneous",unit:"unit",defaultQuantityPerPerson:1,notes:""}),[w,_]=y.useState({}),[b,u]=y.useState(!1),[x,I]=y.useState(null),[D,S]=y.useState(null),[P,g]=y.useState(""),j=P?o.filter(T=>T.category===P):o,A=()=>{m({name:"",category:"food",type:"miscellaneous",unit:"unit",defaultQuantityPerPerson:1,notes:""}),_({}),I(null)},N=()=>{const T={};return p.name.trim()||(T.name="El nombre es obligatorio"),_(T),Object.keys(T).length===0},$=async T=>{if(T.preventDefault(),!!N()){u(!0);try{await r({name:p.name,category:p.category,type:p.type,unit:p.unit,defaultQuantityPerPerson:p.defaultQuantityPerPerson,notes:p.notes||void 0}),c.close(),A()}catch{}finally{u(!1)}}},dt=async T=>{if(T.preventDefault(),!(!N()||!x)){u(!0);try{const Et={name:p.name,category:p.category,type:p.type,unit:p.unit,defaultQuantityPerPerson:p.defaultQuantityPerPerson,notes:p.notes||null};await i(x.id,Et),d.close(),A()}catch{}finally{u(!1)}}},Z=T=>{I(T),m({name:T.name,category:T.category,type:T.type,unit:T.unit,defaultQuantityPerPerson:T.defaultQuantityPerPerson??1,notes:T.notes||""}),d.open()},V=T=>{S(T),l.open()},Nt=async()=>{if(D)try{await s(D.id),l.close(),S(null)}catch{}},Qt=()=>{A(),c.open()},Wt=[{key:"name",header:"Producto",render:T=>a.jsxs("div",{className:X.productCell,children:[a.jsx("span",{className:X.productName,children:T.name}),T.notes&&a.jsx("span",{className:X.productNotes,children:T.notes})]})},{key:"category",header:"Categoria",render:T=>a.jsx("span",{className:`${X.categoryBadge} ${X[T.category]}`,children:ko[T.category]})},{key:"unit",header:"Unidad",align:"center",render:T=>a.jsx("span",{children:T.unit})},{key:"defaultQuantity",header:"Cantidad/Persona",align:"center",render:T=>a.jsx("span",{children:T.defaultQuantityPerPerson??"-"})},{key:"actions",header:"Acciones",align:"right",render:T=>a.jsxs("div",{className:X.actions,children:[a.jsx("button",{type:"button",className:X.actionButton,onClick:()=>Z(T),"aria-label":`Editar ${T.name}`,children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),a.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),a.jsx("button",{type:"button",className:`${X.actionButton} ${X.danger}`,onClick:()=>V(T),"aria-label":`Eliminar ${T.name}`,children:a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("polyline",{points:"3 6 5 6 21 6"}),a.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})]})})]})}],M=()=>t&&o.length===0?a.jsx(Pt,{message:"Cargando productos..."}):e?a.jsx(Lt,{title:"Error al cargar productos",message:e.message,onRetry:n}):o.length===0?a.jsx(At,{title:"No hay productos",description:"Anade productos al catalogo para empezar a organizar las compras",icon:a.jsx("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:a.jsx("path",{d:"M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0"})}),action:a.jsx(U,{variant:"primary",onClick:Qt,children:"Anadir producto"})}):a.jsx(ke,{data:j,columns:Wt,getRowKey:T=>T.id,emptyMessage:"No hay productos en esta categoria"}),vt=(T,Et=!1)=>a.jsxs("form",{onSubmit:T,className:X.form,children:[a.jsx(mt,{label:"Nombre del producto",placeholder:"Ej: Agua mineral",value:p.name,onChange:pt=>m({...p,name:pt.target.value}),error:w.name,required:!0,fullWidth:!0}),a.jsx(Ot,{label:"Categoria",options:Ne,value:p.category,onChange:pt=>m({...p,category:pt.target.value}),required:!0,fullWidth:!0}),a.jsx(Ot,{label:"Tipo",options:Bo,value:p.type,onChange:pt=>m({...p,type:pt.target.value}),required:!0,fullWidth:!0}),a.jsxs("div",{className:X.row,children:[a.jsx(mt,{type:"number",label:"Cantidad por persona",value:p.defaultQuantityPerPerson.toString(),onChange:pt=>m({...p,defaultQuantityPerPerson:parseInt(pt.target.value)||1}),required:!0,fullWidth:!0}),a.jsx(Ot,{label:"Unidad",options:Lo,value:p.unit,onChange:pt=>m({...p,unit:pt.target.value}),required:!0,fullWidth:!0})]}),a.jsx(mt,{label:"Notas",placeholder:"Notas adicionales...",value:p.notes,onChange:pt=>m({...p,notes:pt.target.value}),fullWidth:!0}),a.jsxs("div",{className:X.formActions,children:[a.jsx(U,{type:"button",variant:"secondary",onClick:()=>{(Et?d:c).close(),A()},disabled:b,children:"Cancelar"}),a.jsx(U,{type:"submit",variant:"primary",isLoading:b,children:Et?"Guardar cambios":"Anadir"})]})]}),Dt=o.length;return a.jsx(K,{showSidebar:!0,tripName:"Viaje",children:a.jsxs("div",{className:X.page,children:[a.jsxs("div",{className:X.header,children:[a.jsxs("div",{children:[a.jsx("h1",{className:X.title,children:"Productos"}),a.jsxs("p",{className:X.subtitle,children:[Dt," productos en el catalogo"]})]}),a.jsxs(U,{variant:"primary",onClick:Qt,children:[a.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),a.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Anadir producto"]})]}),o.length>0&&a.jsx("div",{className:X.filters,children:a.jsx(Ot,{options:[{value:"",label:"Todas las categorias"},...Ne],value:P,onChange:T=>g(T.target.value),size:"sm"})}),M(),a.jsx(Bt,{isOpen:c.isOpen,onClose:()=>{c.close(),A()},title:"Anadir producto",size:"md",children:vt($)}),a.jsx(Bt,{isOpen:d.isOpen,onClose:()=>{d.close(),A()},title:"Editar producto",size:"md",children:vt(dt,!0)}),a.jsx(le,{isOpen:l.isOpen,onClose:()=>{l.close(),S(null)},onConfirm:Nt,title:"Eliminar producto",message:`Estas seguro de que quieres eliminar "${D==null?void 0:D.name}"? Esta accion no se puede deshacer.`,confirmText:"Eliminar",variant:"danger"})]})})},Oo="_page_9p5ln_2",$o="_header_9p5ln_9",qo="_title_9p5ln_16",Fo="_subtitle_9p5ln_23",Vo="_legend_9p5ln_30",Qo="_legendContent_9p5ln_34",Wo="_legendItem_9p5ln_40",zo="_legendBox_9p5ln_48",Uo="_available_9p5ln_57",Ho="_unavailable_9p5ln_62",Go="_matrixWrapper_9p5ln_68",Xo="_matrix_9p5ln_68",Yo="_warningRow_9p5ln_101",Jo="_cornerCell_9p5ln_106",Ko="_participantHeader_9p5ln_114",Zo="_participantInfo_9p5ln_119",tc="_avatar_9p5ln_126",ec="_participantName_9p5ln_139",ac="_participantCount_9p5ln_148",rc="_totalHeader_9p5ln_154",ic="_productCell_9p5ln_162",sc="_productName_9p5ln_168",nc="_productUnit_9p5ln_173",oc="_checkCell_9p5ln_179",cc="_checkButton_9p5ln_183",dc="_checked_9p5ln_206",lc="_totalCell_9p5ln_217",pc="_warning_9p5ln_101",uc="_summary_9p5ln_228",hc="_summaryGrid_9p5ln_232",mc="_summaryItem_9p5ln_238",yc="_summaryValue_9p5ln_245",fc="_summaryLabel_9p5ln_255",E={page:Oo,header:$o,title:qo,subtitle:Fo,legend:Vo,legendContent:Qo,legendItem:Wo,legendBox:zo,available:Uo,unavailable:Ho,matrixWrapper:Go,matrix:Xo,warningRow:Yo,cornerCell:Jo,participantHeader:Ko,participantInfo:Zo,avatar:tc,participantName:ec,participantCount:ac,totalHeader:rc,productCell:ic,productName:sc,productUnit:nc,checkCell:oc,checkButton:cc,checked:dc,totalCell:lc,warning:pc,summary:uc,summaryGrid:hc,summaryItem:mc,summaryValue:yc,summaryLabel:fc},gc=()=>{const{tripId:o}=qt(),{participants:t,isLoading:e,error:r}=te(o||""),{products:i,isLoading:s,error:n}=ue(),[c,d]=y.useState({}),l=e||s,p=r||n;y.useEffect(()=>{const u={};t.forEach(x=>{const I={};i.forEach(D=>{I[D.id]=!1}),u[x.id]=I}),d(u)},[t,i]);const m=(u,x)=>{d(I=>{var D;return{...I,[u]:{...I[u],[x]:!((D=I[u])!=null&&D[x])}}})},w=u=>Object.values(c).filter(x=>x[u]).length,_=u=>Object.values(c[u]||{}).filter(Boolean).length,b=t;return l?a.jsx(K,{showSidebar:!0,tripName:"Viaje",children:a.jsx(Pt,{message:"Cargando matriz de disponibilidad..."})}):p?a.jsx(K,{showSidebar:!0,tripName:"Viaje",children:a.jsx(Lt,{title:"Error al cargar datos",message:p.message})}):b.length===0||i.length===0?a.jsx(K,{showSidebar:!0,tripName:"Viaje",children:a.jsxs("div",{className:E.page,children:[a.jsxs("div",{className:E.header,children:[a.jsx("h1",{className:E.title,children:"Disponibilidad"}),a.jsx("p",{className:E.subtitle,children:"Indica que productos puede traer cada participante"})]}),a.jsx(At,{title:b.length===0?"No hay participantes":"No hay productos",description:b.length===0?"Anade participantes al viaje para crear la matriz de disponibilidad":"Anade productos al catalogo para crear la matriz de disponibilidad",icon:a.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[a.jsx("path",{d:"M9 11l3 3L22 4"}),a.jsx("path",{d:"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"})]})})]})}):a.jsx(K,{showSidebar:!0,tripName:"Viaje",children:a.jsxs("div",{className:E.page,children:[a.jsx("div",{className:E.header,children:a.jsxs("div",{children:[a.jsx("h1",{className:E.title,children:"Disponibilidad"}),a.jsx("p",{className:E.subtitle,children:"Marca las casillas para indicar que productos puede traer cada participante"})]})}),a.jsx(G,{className:E.legend,children:a.jsxs("div",{className:E.legendContent,children:[a.jsxs("div",{className:E.legendItem,children:[a.jsx("div",{className:`${E.legendBox} ${E.available}`,children:a.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:a.jsx("polyline",{points:"20 6 9 17 4 12"})})}),a.jsx("span",{children:"Puede traer"})]}),a.jsxs("div",{className:E.legendItem,children:[a.jsx("div",{className:`${E.legendBox} ${E.unavailable}`}),a.jsx("span",{children:"No disponible"})]})]})}),a.jsx("div",{className:E.matrixWrapper,children:a.jsxs("table",{className:E.matrix,children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{className:E.cornerCell,children:"Producto / Participante"}),b.map(u=>a.jsx("th",{className:E.participantHeader,children:a.jsxs("div",{className:E.participantInfo,children:[a.jsx("div",{className:E.avatar,children:u.name.charAt(0).toUpperCase()}),a.jsx("span",{className:E.participantName,children:u.name}),a.jsx("span",{className:E.participantCount,children:_(u.id)})]})},u.id)),a.jsx("th",{className:E.totalHeader,children:"Total"})]})}),a.jsx("tbody",{children:i.map(u=>{const x=w(u.id),I=x===0;return a.jsxs("tr",{className:I?E.warningRow:"",children:[a.jsxs("td",{className:E.productCell,children:[a.jsx("span",{className:E.productName,children:u.name}),a.jsx("span",{className:E.productUnit,children:u.unit})]}),b.map(D=>{var P;const S=((P=c[D.id])==null?void 0:P[u.id])||!1;return a.jsx("td",{className:E.checkCell,children:a.jsx("button",{type:"button",className:`${E.checkButton} ${S?E.checked:""}`,onClick:()=>m(D.id,u.id),"aria-label":`${D.name} ${S?"puede":"no puede"} traer ${u.name}`,"aria-pressed":S,children:S&&a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:a.jsx("polyline",{points:"20 6 9 17 4 12"})})})},D.id)}),a.jsx("td",{className:`${E.totalCell} ${I?E.warning:""}`,children:x})]},u.id)})})]})}),a.jsx(G,{title:"Resumen",className:E.summary,children:a.jsxs("div",{className:E.summaryGrid,children:[a.jsxs("div",{className:E.summaryItem,children:[a.jsx("span",{className:E.summaryValue,children:i.length}),a.jsx("span",{className:E.summaryLabel,children:"Productos totales"})]}),a.jsxs("div",{className:E.summaryItem,children:[a.jsx("span",{className:E.summaryValue,children:b.length}),a.jsx("span",{className:E.summaryLabel,children:"Participantes"})]}),a.jsxs("div",{className:E.summaryItem,children:[a.jsx("span",{className:`${E.summaryValue} ${i.filter(u=>w(u.id)===0).length>0?E.warning:""}`,children:i.filter(u=>w(u.id)===0).length}),a.jsx("span",{className:E.summaryLabel,children:"Sin asignar"})]}),a.jsxs("div",{className:E.summaryItem,children:[a.jsx("span",{className:E.summaryValue,children:i.filter(u=>w(u.id)>0).length}),a.jsx("span",{className:E.summaryLabel,children:"Asignados"})]})]})})]})})},vc="_page_1bjn3_2",wc="_header_1bjn3_9",xc="_title_1bjn3_16",_c="_subtitle_1bjn3_23",bc="_headerActions_1bjn3_29",jc="_progressCard_1bjn3_35",Ic="_progressContent_1bjn3_39",Nc="_progressHeader_1bjn3_45",Dc="_progressTitle_1bjn3_51",Cc="_progressStats_1bjn3_76",Pc="_progressStat_1bjn3_76",Ac="_statValue_1bjn3_89",Ec="_statLabel_1bjn3_95",Rc="_listsContainer_1bjn3_101",Sc="_categoryCard_1bjn3_107",Tc="_productList_1bjn3_112",Bc="_productItem_1bjn3_118",Lc="_productName_1bjn3_135",kc="_productInfo_1bjn3_171",Mc="_productQuantity_1bjn3_187",Oc="_costCard_1bjn3_200",$c="_costContent_1bjn3_204",qc="_participantsList_1bjn3_242",Fc="_participantCost_1bjn3_248",Vc="_participantInfo_1bjn3_257",Qc="_avatar_1bjn3_263",Wc="_participantAmount_1bjn3_276",k={page:vc,header:wc,title:xc,subtitle:_c,headerActions:bc,progressCard:jc,progressContent:Ic,progressHeader:Nc,progressTitle:Dc,progressStats:Cc,progressStat:Pc,statValue:Ac,statLabel:Ec,listsContainer:Rc,categoryCard:Sc,productList:Tc,productItem:Bc,productName:Lc,productInfo:kc,productQuantity:Mc,costCard:Oc,costContent:$c,participantsList:qc,participantCost:Fc,participantInfo:Vc,avatar:Qc,participantAmount:Wc},zc=()=>{const{tripId:o}=qt(),{shoppingList:t,isLoading:e,error:r,downloadCSV:i}=Bs(o||""),{participants:s,isLoading:n}=te(o||""),c=e||n,d=r,l=(t==null?void 0:t.items.reduce((u,x)=>{const I=x.product.category;return u[I]||(u[I]=[]),u[I].push(x),u},{}))||{},p={food:"Comida",beverage:"Bebidas",other:"Otros"},m=["food","beverage","other"],w=async()=>{try{const u=new Date().toISOString().split("T")[0];await i(`lista-compras-${u}.csv`)}catch{}},_=(t==null?void 0:t.items.length)||0,b=s.length;return c?a.jsx(K,{showSidebar:!0,tripName:"Viaje",children:a.jsx(Pt,{message:"Cargando lista de compras..."})}):d?a.jsx(K,{showSidebar:!0,tripName:"Viaje",children:a.jsx(Lt,{title:"Error al cargar datos",message:d.message})}):!t||t.items.length===0?a.jsx(K,{showSidebar:!0,tripName:"Viaje",children:a.jsxs("div",{className:k.page,children:[a.jsx("div",{className:k.header,children:a.jsx("h1",{className:k.title,children:"Lista de Compras Planificada"})}),a.jsx(At,{title:"No hay productos planificados",description:"Registra consumos planificados para generar la lista de compras",icon:a.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[a.jsx("circle",{cx:"9",cy:"21",r:"1"}),a.jsx("circle",{cx:"20",cy:"21",r:"1"}),a.jsx("path",{d:"M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"})]})})]})}):a.jsx(K,{showSidebar:!0,tripName:"Viaje",children:a.jsxs("div",{className:k.page,children:[a.jsxs("div",{className:k.header,children:[a.jsxs("div",{children:[a.jsx("h1",{className:k.title,children:"Lista de Compras Planificada"}),a.jsxs("p",{className:k.subtitle,children:[_," productos planificados para ",b," participantes"]})]}),a.jsx("div",{className:k.headerActions,children:a.jsxs(U,{variant:"secondary",onClick:w,"aria-label":"Exportar lista de compras como CSV",children:[a.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"})}),"Exportar CSV"]})})]}),a.jsx(G,{className:k.progressCard,children:a.jsxs("div",{className:k.progressContent,children:[a.jsx("div",{className:k.progressHeader,children:a.jsx("span",{className:k.progressTitle,children:"Resumen de planificacion"})}),a.jsxs("div",{className:k.progressStats,children:[a.jsxs("div",{className:k.progressStat,children:[a.jsx("span",{className:k.statValue,children:_}),a.jsx("span",{className:k.statLabel,children:"Productos"})]}),a.jsxs("div",{className:k.progressStat,children:[a.jsx("span",{className:k.statValue,children:b}),a.jsx("span",{className:k.statLabel,children:"Participantes"})]}),a.jsxs("div",{className:k.progressStat,children:[a.jsx("span",{className:k.statValue,children:Object.keys(l).length}),a.jsx("span",{className:k.statLabel,children:"Categorias"})]})]})]})}),a.jsx("div",{className:k.listsContainer,children:m.map(u=>{const x=l[u];return!x||x.length===0?null:a.jsx(G,{title:p[u]||u,subtitle:`${x.length} productos`,className:k.categoryCard,children:a.jsx("ul",{className:k.productList,children:x.map(I=>a.jsx("li",{className:k.productItem,children:a.jsxs("div",{className:k.productInfo,children:[a.jsx("span",{className:k.productName,children:I.product.name}),a.jsxs("span",{className:k.productQuantity,children:[I.totalQuantity," ",I.unit]})]})},I.product.id))})},u)})}),s.length>0&&a.jsx(G,{title:"Participantes del viaje",className:k.costCard,children:a.jsx("div",{className:k.costContent,children:a.jsx("div",{className:k.participantsList,children:s.map(u=>a.jsxs("div",{className:k.participantCost,children:[a.jsxs("div",{className:k.participantInfo,children:[a.jsx("div",{className:k.avatar,children:u.name.charAt(0).toUpperCase()}),a.jsx("span",{children:u.name})]}),u.email&&a.jsx("span",{className:k.participantAmount,children:u.email})]},u.id))})})})]})})};function Uc(o,t){const e=o.length,r=0,i=t.length-r,s=0,n=t.length>0?Math.round(r/t.length*100):0;return{totalParticipants:o.length,activeParticipants:e,totalProducts:t.length,purchasedProducts:r,pendingProducts:i,estimatedTotal:s,completionPercentage:n}}const Hc=y.createContext(null),Gc=({children:o,tripId:t})=>{const[e,r]=y.useState(null),[i,s]=y.useState([]),[n,c]=y.useState([]),[d,l]=y.useState([]),[p,m]=y.useState(!1),[w,_]=y.useState(null),b=y.useMemo(()=>Uc(i,n),[i,n]),u=y.useCallback(N=>{r(N)},[]),x=y.useCallback(N=>{s(N)},[]),I=y.useCallback(N=>{c(N)},[]),D=y.useCallback(N=>{l(N)},[]),S=y.useCallback((N,$)=>{l(dt=>{const Z=dt.findIndex(V=>V.participantId===N&&V.productId===$);if(Z>=0){const V=[...dt],Nt=V[Z];return Nt&&(V[Z]={...Nt,available:!Nt.available}),V}else{const V={participantId:N,productId:$,available:!0};return[...dt,V]}})},[]),P=y.useCallback(N=>{m(N)},[]),g=y.useCallback(N=>{_(N)},[]),j=y.useCallback(()=>{r(null),s([]),c([]),l([]),_(null)},[]);y.useEffect(()=>{if(t){m(!0);const N=setTimeout(()=>{m(!1)},500);return()=>clearTimeout(N)}else{j();return}},[t,j]);const A=y.useMemo(()=>({trip:e,participants:i,products:n,availability:d,stats:b,isLoading:p,error:w,setTrip:u,setParticipants:x,setProducts:I,setAvailability:D,toggleAvailability:S,setLoading:P,setError:g,clearTrip:j}),[e,i,n,d,b,p,w,u,x,I,D,S,P,g,j]);return a.jsx(Hc.Provider,{value:A,children:o})},se={HOME:"/",TRIPS:"/trips"},Xc=()=>a.jsxs(De,{children:[a.jsx(ft,{index:!0,element:a.jsx(Kn,{})}),a.jsx(ft,{path:"participants",element:a.jsx(po,{})}),a.jsx(ft,{path:"products",element:a.jsx(Mo,{})}),a.jsx(ft,{path:"availability",element:a.jsx(gc,{})}),a.jsx(ft,{path:"shopping",element:a.jsx(zc,{})}),a.jsx(ft,{path:"*",element:a.jsx(Ce,{to:"",replace:!0})})]}),Yc=()=>a.jsxs(De,{children:[a.jsx(ft,{path:se.HOME,element:a.jsx(un,{})}),a.jsx(ft,{path:se.TRIPS,element:a.jsx(Cn,{})}),a.jsx(ft,{path:"/trips/:tripId/*",element:a.jsx(Gc,{children:a.jsx(Xc,{})})}),a.jsx(ft,{path:"*",element:a.jsx(Ce,{to:se.HOME,replace:!0})})]}),Jc=()=>a.jsx(ze,{basename:"/tripfood-manager",children:a.jsx(ka,{children:a.jsx(Yc,{})})}),Me=document.getElementById("root");if(!Me)throw new Error('Root element not found. Make sure there is a div with id="root" in your HTML.');Ye.createRoot(Me).render(a.jsx(y.StrictMode,{children:a.jsx(Jc,{})}));
//# sourceMappingURL=index-CyFwfxsh.js.map
