{"version":3,"mappings":"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","names":["f","require$$0","k","l","m","n","p","q","a","g","b","d","e","h","reactJsxRuntime_production_min","jsxRuntimeModule","client","_TripFoodDatabase","Dexie","__publicField","TripFoodDatabase","TripMapper","trip","record","records","trips","updates","InfrastructureError","message","originalError","error","DatabaseError","operation","tableName","recordId","baseMessage","IndexedDBTripRepository","database","tripFactory","id","props","name","searchTerm","date","dateStr","startDate","endDate","startStr","endStr","entity","ids","today","existingRecord","updatedRecord","excludeId","normalizedName","filters","ParticipantMapper","participant","participants","IndexedDBParticipantRepository","participantFactory","tripId","email","_a","ProductMapper","product","products","IndexedDBProductRepository","productFactory","category","type","grouped","unit","_ConsumptionMapper","meal","consumption","consumptions","ConsumptionMapper","IndexedDBConsumptionRepository","consumptionFactory","participantId","productId","dateRange","sum","c","productMap","summary","summaries","data","_AvailabilityMapper","meals","validatedMeals","availability","availabilities","AvailabilityMapper","IndexedDBAvailabilityRepository","availabilityFactory","r","existing","mealTypes","availableRecords","byteToHex","i","unsafeStringify","arr","offset","getRandomValues","rnds8","rng","randomUUID","native","v4","options","buf","rnds","DomainErrorCode","DomainError","code","details","includeStack","serialized","baseString","ValidationError","field","rule","value","failures","failure","fieldName","entityName","prefix","expectedFormat","actualValue","min","max","minLength","maxLength","actualLength","startFieldName","endFieldName","NotFoundError","entityType","entityId","searchCriteria","criteriaString","key","consumptionId","availabilityId","DuplicateError","duplicateValue","compositeKey","keyString","tripName","participantName","productName","MEAL_TYPES","MEAL_TYPE_ORDER","isMealType","sortMealsByOrder","PRODUCT_CATEGORIES","PRODUCT_TYPES","PRODUCT_TYPE_TO_CATEGORY","PRODUCT_UNITS","isProductCategory","isProductType","isProductUnit","getCategoryForType","productType","createDateRange","isDateInRange","range","dateTime","getDaysInRange","diffInMilliseconds","EMAIL_REGEX","isValidEmail","normalizeToStartOfDay","normalized","_Trip","dto","now","uuidv4","newName","newDescription","newStartDate","newEndDate","trimmedName","description","other","Trip","_Participant","_b","newEmail","newNotes","trimmedEmail","notes","Participant","_Product","newCategory","newType","newUnit","newDefaultQuantity","numberOfPeople","expectedCategory","quantity","Product","_Consumption","newDate","newMeal","newQuantity","normalizedInput","Consumption","Availability","newMeals","TripService","tripRepository","participantRepository","consumptionRepository","availabilityRepository","__vitePreload","Trip$1","consumptionCount","responses","participantCount","existingTrip","updatedTrip","force","ParticipantService","Participant$1","availableDates","tripDays","percentage","updatedParticipant","availabilityPercentage","ProductService","productRepository","Product$1","searchName","consumptionByProduct","current","stats","updatedProduct","totalQuantityNeeded","ConsumptionService","consumptionDate","Consumption$1","created","byDate","dateKey","entry","mealType","count","byParticipant","updatedConsumption","AvailabilityService","availabilityDate","Availability$1","updated","currentDate","dateEntry","breakfastCount","lunchCount","dinnerCount","dates","matrix","participantMatrix","totalAvailable","totalPossible","averageAvailability","ShoppingService","totalDays","productQuantities","dateIso","dateAvailabilities","aDateIso","items","multiplier","totalQuantity","dateData","item","byCategory","categoryMap","categoryKey","categoryItems","categoryTotalCost","essentialItemsCount","optionalItemsCount","totalEstimatedCost","productData","estimates","mealCounts","totalMealParticipants","estimatedQuantity","totalParticipantMeals","actualByProduct","variances","estimated","actual","variance","variancePercentage","suggestions","priority","shoppingList","includeNotes","includeDailyBreakdown","sortByCategory","includeHeader","lines","headers","sortedItems","row","indent","thresholdPercentage","v","categoryCounts","group","categoryStr","dateSet","isoString","cell","cellStr","tripService","participantService","productService","consumptionService","availabilityService","shoppingService","services","ServiceContext","createContext","ServiceProvider","children","useMemo","jsx","useServices","context","useContext","Header","showNav","onToggleSidebar","location","useLocation","isActive","path","styles","jsxs","Link","Sidebar","isOpen","onClose","useParams","navItems","Fragment","NavLink","MainLayout","showSidebar","isSidebarOpen","setIsSidebarOpen","useState","handleToggleSidebar","useCallback","prev","handleCloseSidebar","Button","variant","size","isLoading","leftIcon","rightIcon","fullWidth","disabled","className","classNames","Modal","title","footer","closeOnOverlayClick","closeOnEscape","modalRef","useRef","previousActiveElement","handleKeyDown","event","handleOverlayClick","useEffect","modalContent","createPortal","Card","subtitle","headerActions","padding","interactive","onClick","hasHeader","Input","forwardRef","label","helperText","leftAddon","rightAddon","required","ref","inputId","hasError","containerClasses","inputWrapperClasses","Select","placeholder","selectId","selectWrapperClasses","option","Table","columns","getRowKey","emptyMessage","sortKey","sortDirection","onSort","onRowClick","selectedKeys","onSelectRow","onSelectAll","selectable","striped","compact","allSelected","someSelected","tableClasses","handleSort","handleSelectAll","handleSelectRow","el","column","index","rowKey","isSelected","Loading","overlay","fullscreen","EmptyState","icon","action","defaultIcon","ErrorDisplay","onRetry","retryText","ConfirmDialog","onConfirm","confirmText","cancelText","defaultIcons","confirmButtonVariant","useModal","initialOpen","onOpen","setIsOpen","open","close","toggle","newState","modalProps","useTrips","setTrips","setIsLoading","setError","clearError","fetchTrips","err","errorObj","createTrip","newTrip","updateTrip","deleteTrip","getTripById","useParticipants","setParticipants","fetchParticipants","createParticipant","newParticipant","updateParticipant","deleteParticipant","getParticipantById","getParticipantCount","INITIAL_FILTERS","useProducts","setProducts","setFiltersState","filteredProducts","result","term","fetchProducts","createProduct","newProduct","updateProduct","deleteProduct","getProductById","setFilters","newFilters","clearFilters","filterByCategory","filterByType","searchByName","DEFAULT_OPTIONS","CSVExporter","mergedOptions","delimiter","quoteChar","includeBOM","fileName","rows","headerRow","col","rowValues","rawValue","formattedValue","content","blob","url","link","escaped","dateFormat","format","s","SHOPPING_LIST_COLUMNS","useShoppingList","setShoppingList","consumptionSummary","setConsumptionSummary","generateShoppingList","list","getConsumptionSummary","transformItemsForExport","exportToCSV","exporter","defaultFileName","downloadCSV","exportToBlob","refresh","HomePage","recentTrips","upcoming","past","renderContent","TripsPage","navigate","useNavigate","createModal","deleteModal","formData","setFormData","formErrors","setFormErrors","isSubmitting","setIsSubmitting","tripToDelete","setTripToDelete","resetForm","validateForm","errors","handleSubmit","handleDeleteClick","handleConfirmDelete","handleOpenCreate","TripDetailPage","tripsLoading","tripsError","participantsLoading","productsLoading","t","totalParticipants","totalProducts","ParticipantsPage","editModal","editingParticipant","setEditingParticipant","participantToDelete","setParticipantToDelete","handleCreate","handleEdit","updateData","handleOpenEdit","handleOpenDelete","renderForm","onSubmit","isEdit","categoryOptions","typeOptions","unitOptions","categoryLabels","ProductsPage","editingProduct","setEditingProduct","productToDelete","setProductToDelete","filterCategory","setFilterCategory","AvailabilityPage","participantsError","productsError","setAvailability","initialMatrix","participantProducts","prod","toggleAvailability","getProductAvailabilityCount","getParticipantAvailabilityCount","activeParticipants","availabilityCount","hasNoAvailability","isAvailable","ShoppingListPage","shoppingLoading","shoppingError","itemsByCategory","acc","categoryOrder","handleExportCSV","totalItems","calculateStats","purchasedProducts","pendingProducts","estimatedTotal","completionPercentage","TripContext","TripProvider","setTripState","setParticipantsState","setProductsState","setAvailabilityState","setErrorState","setTrip","newParticipants","newProducts","newAvailability","existingIndex","newEntry","setLoading","loading","clearTrip","timer","ROUTES","TripRoutes","Routes","Route","Navigate","AppRouter","App","BrowserRouter","rootElement","createRoot","StrictMode"],"ignoreList":[0,1,2,16,17,18,19],"sources":["../../node_modules/react/cjs/react-jsx-runtime.production.min.js","../../node_modules/react/jsx-runtime.js","../../node_modules/react-dom/client.js","../../src/infrastructure/persistence/indexeddb/database.ts","../../src/infrastructure/persistence/mappers/TripMapper.ts","../../src/infrastructure/errors/InfrastructureError.ts","../../src/infrastructure/errors/DatabaseError.ts","../../src/infrastructure/persistence/indexeddb/TripRepository.ts","../../src/infrastructure/persistence/mappers/ParticipantMapper.ts","../../src/infrastructure/persistence/indexeddb/ParticipantRepository.ts","../../src/infrastructure/persistence/mappers/ProductMapper.ts","../../src/infrastructure/persistence/indexeddb/ProductRepository.ts","../../src/infrastructure/persistence/mappers/ConsumptionMapper.ts","../../src/infrastructure/persistence/indexeddb/ConsumptionRepository.ts","../../src/infrastructure/persistence/mappers/AvailabilityMapper.ts","../../src/infrastructure/persistence/indexeddb/AvailabilityRepository.ts","../../node_modules/uuid/dist/esm-browser/stringify.js","../../node_modules/uuid/dist/esm-browser/rng.js","../../node_modules/uuid/dist/esm-browser/native.js","../../node_modules/uuid/dist/esm-browser/v4.js","../../src/domain/errors/DomainError.ts","../../src/domain/errors/ValidationError.ts","../../src/domain/errors/NotFoundError.ts","../../src/domain/errors/DuplicateError.ts","../../src/domain/types/meal.ts","../../src/domain/types/product.ts","../../src/domain/types/common.ts","../../src/domain/entities/Trip.ts","../../src/domain/entities/Participant.ts","../../src/domain/entities/Product.ts","../../src/domain/entities/Consumption.ts","../../src/domain/entities/Availability.ts","../../src/application/services/TripService.ts","../../src/application/services/ParticipantService.ts","../../src/application/services/ProductService.ts","../../src/application/services/ConsumptionService.ts","../../src/application/services/AvailabilityService.ts","../../src/application/services/ShoppingService.ts","../../src/shared/di/container.ts","../../src/presentation/context/ServiceContext.tsx","../../src/presentation/components/layout/Header/Header.tsx","../../src/presentation/components/layout/Sidebar/Sidebar.tsx","../../src/presentation/components/layout/MainLayout/MainLayout.tsx","../../src/presentation/components/common/Button/Button.tsx","../../src/presentation/components/common/Modal/Modal.tsx","../../src/presentation/components/common/Card/Card.tsx","../../src/presentation/components/common/Input/Input.tsx","../../src/presentation/components/common/Select/Select.tsx","../../src/presentation/components/common/Table/Table.tsx","../../src/presentation/components/common/Loading/Loading.tsx","../../src/presentation/components/common/EmptyState/EmptyState.tsx","../../src/presentation/components/common/ErrorDisplay/ErrorDisplay.tsx","../../src/presentation/components/common/ConfirmDialog/ConfirmDialog.tsx","../../src/presentation/hooks/useModal.ts","../../src/presentation/hooks/useTrips.ts","../../src/presentation/hooks/useParticipants.ts","../../src/presentation/hooks/useProducts.ts","../../src/infrastructure/export/CSVExporter.ts","../../src/presentation/hooks/useShoppingList.ts","../../src/presentation/pages/HomePage/HomePage.tsx","../../src/presentation/pages/TripsPage/TripsPage.tsx","../../src/presentation/pages/TripDetailPage/TripDetailPage.tsx","../../src/presentation/pages/ParticipantsPage/ParticipantsPage.tsx","../../src/presentation/pages/ProductsPage/ProductsPage.tsx","../../src/presentation/pages/AvailabilityPage/AvailabilityPage.tsx","../../src/presentation/pages/ShoppingListPage/ShoppingListPage.tsx","../../src/presentation/context/TripContext.tsx","../../src/presentation/routes/AppRouter.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","/**\n * @fileoverview Configuracin de la base de datos IndexedDB usando Dexie.js.\n *\n * Define el esquema de la base de datos, las tablas, ndices y la instancia\n * singleton de la base de datos para toda la aplicacin.\n *\n * @module infrastructure/persistence/indexeddb/database\n * @version 1.0.0\n */\n\nimport Dexie, { type Table } from 'dexie';\n\n/**\n * Registro de Trip almacenado en IndexedDB.\n * Representa la estructura de datos persistida.\n */\nexport interface TripRecord {\n  /** Identificador nico del viaje */\n  id: string;\n  /** Nombre del viaje */\n  name: string;\n  /** Descripcin opcional del viaje */\n  description?: string | undefined;\n  /** Fecha de inicio en formato ISO 8601 */\n  startDate: string;\n  /** Fecha de fin en formato ISO 8601 */\n  endDate: string;\n  /** Timestamp de creacin en formato ISO 8601 */\n  createdAt: string;\n  /** Timestamp de ltima actualizacin en formato ISO 8601 */\n  updatedAt: string;\n}\n\n/**\n * Registro de Participant almacenado en IndexedDB.\n */\nexport interface ParticipantRecord {\n  /** Identificador nico del participante */\n  id: string;\n  /** ID del viaje al que pertenece */\n  tripId: string;\n  /** Nombre del participante */\n  name: string;\n  /** Email del participante (opcional) */\n  email?: string | undefined;\n  /** Notas adicionales (opcional) */\n  notes?: string | undefined;\n  /** Timestamp de creacin en formato ISO 8601 */\n  createdAt: string;\n}\n\n/**\n * Registro de Product almacenado en IndexedDB.\n */\nexport interface ProductRecord {\n  /** Identificador nico del producto */\n  id: string;\n  /** Nombre del producto */\n  name: string;\n  /** Categora del producto (ej: 'carnes', 'lacteos', 'snacks') */\n  category: string;\n  /** Tipo de producto: 'food' | 'beverage' */\n  type: string;\n  /** Unidad de medida (ej: 'kg', 'unidad', 'litro') */\n  unit: string;\n  /** Cantidad por defecto por persona (opcional) */\n  defaultQuantityPerPerson?: number | undefined;\n  /** Notas adicionales (opcional) */\n  notes?: string | undefined;\n  /** Timestamp de creacin en formato ISO 8601 */\n  createdAt: string;\n}\n\n/**\n * Registro de Consumption almacenado en IndexedDB.\n */\nexport interface ConsumptionRecord {\n  /** Identificador nico del consumo */\n  id: string;\n  /** ID del viaje */\n  tripId: string;\n  /** ID del participante que consumi */\n  participantId: string;\n  /** ID del producto consumido */\n  productId: string;\n  /** Fecha del consumo en formato ISO 8601 */\n  date: string;\n  /** Comida del da (ej: 'breakfast', 'lunch', 'dinner') */\n  meal: string;\n  /** Cantidad consumida */\n  quantity: number;\n  /** Timestamp de creacin en formato ISO 8601 */\n  createdAt: string;\n}\n\n/**\n * Registro de Availability almacenado en IndexedDB.\n */\nexport interface AvailabilityRecord {\n  /** Identificador nico de la disponibilidad */\n  id: string;\n  /** ID del participante */\n  participantId: string;\n  /** ID del viaje */\n  tripId: string;\n  /** Fecha de disponibilidad en formato ISO 8601 */\n  date: string;\n  /** Comidas en las que estar presente */\n  meals: string[];\n}\n\n/**\n * Clase principal de la base de datos TripFood.\n *\n * Extiende Dexie para proporcionar tipado fuerte y configuracin\n * de tablas e ndices optimizados para las consultas frecuentes.\n *\n * @class TripFoodDatabase\n * @extends Dexie\n *\n * @example\n * ```typescript\n * import { db } from '@infrastructure/persistence/indexeddb/database';\n *\n * // Usar directamente\n * const trips = await db.trips.toArray();\n *\n * // O inyectar en repositorios\n * const tripRepo = new TripRepository(db);\n * ```\n */\nexport class TripFoodDatabase extends Dexie {\n  /**\n   * Tabla de viajes.\n   * ndices: id (PK), name, startDate, endDate, createdAt\n   */\n  public trips!: Table<TripRecord, string>;\n\n  /**\n   * Tabla de participantes.\n   * ndices: id (PK), tripId, name, createdAt\n   */\n  public participants!: Table<ParticipantRecord, string>;\n\n  /**\n   * Tabla de productos.\n   * ndices: id (PK), name, category, type, createdAt\n   */\n  public products!: Table<ProductRecord, string>;\n\n  /**\n   * Tabla de consumos.\n   * ndices: id (PK), tripId, participantId, productId, date, meal\n   * ndice compuesto: [tripId+date], [tripId+participantId]\n   */\n  public consumptions!: Table<ConsumptionRecord, string>;\n\n  /**\n   * Tabla de disponibilidades.\n   * ndices: id (PK), participantId, tripId, date\n   * ndice compuesto: [tripId+date], [participantId+date]\n   */\n  public availabilities!: Table<AvailabilityRecord, string>;\n\n  /**\n   * Nombre de la base de datos en IndexedDB.\n   */\n  public static readonly DATABASE_NAME = 'tripfood-db';\n\n  /**\n   * Versin actual del esquema de la base de datos.\n   */\n  public static readonly CURRENT_VERSION = 1;\n\n  /**\n   * Crea una nueva instancia de TripFoodDatabase.\n   *\n   * Configura el esquema de la base de datos con todas las tablas\n   * e ndices necesarios para el funcionamiento ptimo de la aplicacin.\n   */\n  constructor() {\n    super(TripFoodDatabase.DATABASE_NAME);\n\n    this.version(TripFoodDatabase.CURRENT_VERSION).stores({\n      // Trips: ndice primario 'id', ndices secundarios para bsquedas y ordenacin\n      trips: 'id, name, startDate, endDate, createdAt',\n\n      // Participants: ndice primario 'id', FK tripId para queries por viaje\n      participants: 'id, tripId, name, createdAt',\n\n      // Products: ndice primario 'id', ndices para filtrado por categora y tipo\n      products: 'id, name, category, type, createdAt',\n\n      // Consumptions: mltiples ndices para queries complejas\n      // ndice compuesto [tripId+date] para obtener consumos de un viaje en una fecha\n      // ndice compuesto [tripId+participantId] para consumos de un participante en un viaje\n      consumptions:\n        'id, tripId, participantId, productId, date, meal, [tripId+date], [tripId+participantId], [tripId+productId]',\n\n      // Availabilities: ndices compuestos para queries de disponibilidad\n      // [tripId+date] para disponibilidad en un viaje/fecha\n      // [participantId+date] para disponibilidad de un participante\n      availabilities:\n        'id, participantId, tripId, date, [tripId+date], [participantId+date], [participantId+tripId]',\n    });\n  }\n\n  /**\n   * Elimina todos los datos de la base de datos.\n   * PRECAUCIN: Esta operacin es irreversible.\n   *\n   * @returns Promise que resuelve cuando se completa la limpieza\n   */\n  public async clearAllData(): Promise<void> {\n    await this.transaction(\n      'rw',\n      [this.trips, this.participants, this.products, this.consumptions, this.availabilities],\n      async () => {\n        await Promise.all([\n          this.trips.clear(),\n          this.participants.clear(),\n          this.products.clear(),\n          this.consumptions.clear(),\n          this.availabilities.clear(),\n        ]);\n      }\n    );\n  }\n\n  /**\n   * Verifica si la base de datos est disponible y funcionando.\n   *\n   * @returns Promise que resuelve a true si la DB est operativa\n   */\n  public async healthCheck(): Promise<boolean> {\n    try {\n      await this.trips.count();\n      return true;\n    } catch {\n      return false;\n    }\n  }\n}\n\n/**\n * Instancia singleton de la base de datos.\n *\n * Se exporta como singleton para garantizar que toda la aplicacin\n * use la misma conexin a IndexedDB.\n *\n * @example\n * ```typescript\n * import { db } from '@infrastructure/persistence/indexeddb/database';\n * const allTrips = await db.trips.toArray();\n * ```\n */\nexport const db = new TripFoodDatabase();\n","/**\n * @fileoverview Mapper bidireccional para Trip (Domain) <-> TripRecord (Persistence).\n *\n * Convierte entre la entidad de dominio Trip y el registro de persistencia\n * TripRecord, manejando la serializacin/deserializacin de fechas y\n * asegurando la integridad de los datos.\n *\n * @module infrastructure/persistence/mappers/TripMapper\n * @version 1.0.0\n */\n\nimport type { Trip } from '@domain/entities/Trip';\nimport type { TripRecord } from '../indexeddb/database';\n\n/**\n * Props necesarias para crear una entidad Trip desde el dominio.\n * Se usa cuando el mapper necesita crear una nueva instancia de Trip.\n */\nexport interface TripProps {\n  id: string;\n  name: string;\n  description?: string | undefined;\n  startDate: Date;\n  endDate: Date;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n/**\n * Mapper esttico para conversin bidireccional Trip <-> TripRecord.\n *\n * Proporciona mtodos para convertir entre la representacin de dominio\n * (Trip entity con objetos Date) y la representacin de persistencia\n * (TripRecord con strings ISO).\n *\n * @class TripMapper\n *\n * @example\n * ```typescript\n * // Domain -> Record (para guardar)\n * const record = TripMapper.toRecord(tripEntity);\n * await db.trips.put(record);\n *\n * // Record -> Domain (para leer)\n * const record = await db.trips.get(id);\n * const trip = TripMapper.toDomain(record);\n * ```\n */\nexport class TripMapper {\n  /**\n   * Constructor privado para prevenir instanciacin.\n   * Esta clase solo contiene mtodos estticos.\n   */\n  private constructor() {\n    // Clase esttica - no instanciar\n  }\n\n  /**\n   * Convierte una entidad de dominio Trip a un registro de persistencia.\n   *\n   * Transforma los objetos Date a strings ISO 8601 para almacenamiento\n   * en IndexedDB, preservando toda la informacin de la entidad.\n   *\n   * @param trip - Entidad de dominio Trip\n   * @returns Registro de persistencia TripRecord\n   *\n   * @example\n   * ```typescript\n   * const trip = Trip.create({ name: 'Beach Trip', ... });\n   * const record = TripMapper.toRecord(trip);\n   * // record.startDate es \"2025-07-15T00:00:00.000Z\"\n   * ```\n   */\n  public static toRecord(trip: Trip): TripRecord {\n    return {\n      id: trip.id,\n      name: trip.name,\n      description: trip.description,\n      startDate: trip.startDate.toISOString(),\n      endDate: trip.endDate.toISOString(),\n      createdAt: trip.createdAt.toISOString(),\n      updatedAt: (trip.updatedAt ?? trip.createdAt).toISOString(),\n    };\n  }\n\n  /**\n   * Convierte un registro de persistencia a las props de dominio.\n   *\n   * Transforma los strings ISO 8601 de vuelta a objetos Date,\n   * preparando los datos para crear una entidad Trip.\n   *\n   * @param record - Registro de persistencia TripRecord\n   * @returns Props para crear una entidad Trip\n   *\n   * @example\n   * ```typescript\n   * const record = await db.trips.get(id);\n   * const props = TripMapper.toDomainProps(record);\n   * // props.startDate es un objeto Date\n   * ```\n   */\n  public static toDomainProps(record: TripRecord): TripProps {\n    return {\n      id: record.id,\n      name: record.name,\n      description: record.description,\n      startDate: new Date(record.startDate),\n      endDate: new Date(record.endDate),\n      createdAt: new Date(record.createdAt),\n      updatedAt: new Date(record.updatedAt),\n    };\n  }\n\n  /**\n   * Convierte un array de registros a array de props de dominio.\n   *\n   * til para operaciones bulk como findAll().\n   *\n   * @param records - Array de registros de persistencia\n   * @returns Array de props para crear entidades Trip\n   */\n  public static toDomainPropsList(records: TripRecord[]): TripProps[] {\n    return records.map((record) => TripMapper.toDomainProps(record));\n  }\n\n  /**\n   * Convierte un array de entidades a array de registros.\n   *\n   * til para operaciones bulk de guardado.\n   *\n   * @param trips - Array de entidades Trip\n   * @returns Array de registros de persistencia\n   */\n  public static toRecordList(trips: Trip[]): TripRecord[] {\n    return trips.map((trip) => TripMapper.toRecord(trip));\n  }\n\n  /**\n   * Crea un registro parcial para actualizaciones.\n   *\n   * Solo incluye los campos que se van a actualizar,\n   * siempre actualizando el timestamp updatedAt.\n   *\n   * @param updates - Campos a actualizar\n   * @returns Registro parcial para update\n   */\n  public static toPartialRecord(\n    updates: Partial<Omit<TripProps, 'id' | 'createdAt'>>\n  ): Partial<TripRecord> {\n    const record: Partial<TripRecord> = {\n      updatedAt: new Date().toISOString(),\n    };\n\n    if (updates.name !== undefined) {\n      record.name = updates.name;\n    }\n\n    if (updates.description !== undefined) {\n      record.description = updates.description;\n    }\n\n    if (updates.startDate !== undefined) {\n      record.startDate = updates.startDate.toISOString();\n    }\n\n    if (updates.endDate !== undefined) {\n      record.endDate = updates.endDate.toISOString();\n    }\n\n    return record;\n  }\n}\n","/**\n * @fileoverview Error base para errores de infraestructura.\n *\n * Esta clase representa errores que ocurren en la capa de infraestructura,\n * como problemas de persistencia, servicios externos, o configuracin.\n *\n * @module infrastructure/errors/InfrastructureError\n * @version 1.0.0\n */\n\n/**\n * Error base para todos los errores de infraestructura.\n *\n * Proporciona wrapping de errores originales para mantener\n * el contexto del error mientras se abstrae la implementacin.\n *\n * @class InfrastructureError\n * @extends Error\n *\n * @example\n * ```typescript\n * try {\n *   await database.connect();\n * } catch (error) {\n *   throw new InfrastructureError(\n *     'Failed to connect to database',\n *     error instanceof Error ? error : undefined\n *   );\n * }\n * ```\n */\nexport class InfrastructureError extends Error {\n  /**\n   * Nombre del tipo de error para identificacin.\n   * @readonly\n   */\n  public override readonly name: string = 'InfrastructureError';\n\n  /**\n   * Error original que caus este error de infraestructura.\n   * til para debugging y logging detallado.\n   * @readonly\n   */\n  public readonly originalError: Error | undefined;\n\n  /**\n   * Timestamp de cuando ocurri el error.\n   * @readonly\n   */\n  public readonly timestamp: Date;\n\n  /**\n   * Crea una nueva instancia de InfrastructureError.\n   *\n   * @param message - Mensaje descriptivo del error\n   * @param originalError - Error original que caus este error (opcional)\n   */\n  constructor(message: string, originalError?: Error) {\n    super(message);\n\n    this.originalError = originalError;\n    this.timestamp = new Date();\n\n    // Mantiene el stack trace correcto en V8 (Chrome, Node.js)\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, InfrastructureError);\n    }\n\n    // Incluir stack del error original si existe\n    if (originalError?.stack) {\n      this.stack = `${this.stack}\\n\\nCaused by: ${originalError.stack}`;\n    }\n  }\n\n  /**\n   * Serializa el error a un objeto plano para logging.\n   *\n   * @returns Objeto con informacin del error serializada\n   */\n  public toJSON(): Record<string, unknown> {\n    return {\n      name: this.name,\n      message: this.message,\n      timestamp: this.timestamp.toISOString(),\n      originalError: this.originalError\n        ? {\n            name: this.originalError.name,\n            message: this.originalError.message,\n          }\n        : undefined,\n      stack: this.stack,\n    };\n  }\n\n  /**\n   * Verifica si un error es una instancia de InfrastructureError.\n   *\n   * @param error - Error a verificar\n   * @returns true si es InfrastructureError o derivado\n   */\n  public static isInfrastructureError(error: unknown): error is InfrastructureError {\n    return error instanceof InfrastructureError;\n  }\n}\n","/**\n * @fileoverview Error especializado para operaciones de base de datos.\n *\n * Esta clase extiende InfrastructureError para proporcionar\n * informacin especfica sobre errores de persistencia en IndexedDB.\n *\n * @module infrastructure/errors/DatabaseError\n * @version 1.0.0\n */\n\nimport { InfrastructureError } from './InfrastructureError';\n\n/**\n * Tipos de operaciones de base de datos que pueden fallar.\n * Permite categorizacin y manejo especfico de errores.\n */\nexport type DatabaseOperation =\n  | 'create'\n  | 'read'\n  | 'update'\n  | 'delete'\n  | 'find'\n  | 'findAll'\n  | 'findById'\n  | 'findByIndex'\n  | 'count'\n  | 'clear'\n  | 'transaction'\n  | 'connection'\n  | 'migration';\n\n/**\n * Error especfico para operaciones de base de datos.\n *\n * Extiende InfrastructureError con informacin adicional sobre\n * la operacin fallida, la tabla afectada y el ID del registro\n * si aplica.\n *\n * @class DatabaseError\n * @extends InfrastructureError\n *\n * @example\n * ```typescript\n * try {\n *   await db.trips.get(tripId);\n * } catch (error) {\n *   throw new DatabaseError(\n *     'findById',\n *     'trips',\n *     error instanceof Error ? error : undefined,\n *     tripId\n *   );\n * }\n * ```\n */\nexport class DatabaseError extends InfrastructureError {\n  /**\n   * Nombre del tipo de error para identificacin.\n   * @readonly\n   */\n  public override readonly name: string = 'DatabaseError';\n\n  /**\n   * Tipo de operacin que fall.\n   * @readonly\n   */\n  public readonly operation: DatabaseOperation;\n\n  /**\n   * Nombre de la tabla/coleccin afectada.\n   * @readonly\n   */\n  public readonly tableName: string;\n\n  /**\n   * ID del registro afectado, si aplica.\n   * @readonly\n   */\n  public readonly recordId: string | undefined;\n\n  /**\n   * Crea una nueva instancia de DatabaseError.\n   *\n   * @param operation - Tipo de operacin que fall\n   * @param tableName - Nombre de la tabla afectada\n   * @param originalError - Error original de Dexie/IndexedDB (opcional)\n   * @param recordId - ID del registro afectado (opcional)\n   */\n  constructor(\n    operation: DatabaseOperation,\n    tableName: string,\n    originalError?: Error,\n    recordId?: string\n  ) {\n    const message = DatabaseError.buildMessage(operation, tableName, recordId);\n    super(message, originalError);\n\n    this.operation = operation;\n    this.tableName = tableName;\n    this.recordId = recordId;\n\n    // Mantiene el stack trace correcto\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, DatabaseError);\n    }\n  }\n\n  /**\n   * Construye un mensaje descriptivo para el error.\n   *\n   * @param operation - Tipo de operacin\n   * @param tableName - Nombre de la tabla\n   * @param recordId - ID del registro (opcional)\n   * @returns Mensaje formateado\n   */\n  private static buildMessage(\n    operation: DatabaseOperation,\n    tableName: string,\n    recordId?: string\n  ): string {\n    const baseMessage = `Database operation '${operation}' failed on table '${tableName}'`;\n    return recordId ? `${baseMessage} for record '${recordId}'` : baseMessage;\n  }\n\n  /**\n   * Serializa el error a un objeto plano para logging.\n   * Extiende la serializacin base con campos especficos de DB.\n   *\n   * @returns Objeto con informacin del error serializada\n   */\n  public override toJSON(): Record<string, unknown> {\n    return {\n      ...super.toJSON(),\n      operation: this.operation,\n      tableName: this.tableName,\n      recordId: this.recordId,\n    };\n  }\n\n  /**\n   * Verifica si un error es una instancia de DatabaseError.\n   *\n   * @param error - Error a verificar\n   * @returns true si es DatabaseError\n   */\n  public static isDatabaseError(error: unknown): error is DatabaseError {\n    return error instanceof DatabaseError;\n  }\n\n  /**\n   * Crea un DatabaseError para errores de conexin.\n   *\n   * @param originalError - Error original\n   * @returns Nueva instancia de DatabaseError\n   */\n  public static connectionError(originalError?: Error): DatabaseError {\n    return new DatabaseError('connection', 'database', originalError);\n  }\n\n  /**\n   * Crea un DatabaseError para errores de migracin.\n   *\n   * @param originalError - Error original\n   * @returns Nueva instancia de DatabaseError\n   */\n  public static migrationError(originalError?: Error): DatabaseError {\n    return new DatabaseError('migration', 'database', originalError);\n  }\n}\n","/**\n * @fileoverview Implementacin del repositorio de Trip usando IndexedDB/Dexie.\n *\n * Este repositorio implementa ITripRepository del dominio, proporcionando\n * persistencia de viajes en IndexedDB a travs de Dexie.js.\n *\n * @module infrastructure/persistence/indexeddb/TripRepository\n * @version 1.0.0\n */\n\nimport type { ITripRepository, ITripQueryFilters } from '@domain/interfaces/repositories/ITripRepository';\nimport type { Trip, ITripUpdateDTO } from '@domain/entities/Trip';\nimport { TripFoodDatabase, type TripRecord } from './database';\nimport { TripMapper, type TripProps } from '../mappers/TripMapper';\nimport { DatabaseError } from '../../errors/DatabaseError';\n\n/**\n * Repositorio de Trip implementado con IndexedDB a travs de Dexie.js.\n *\n * Proporciona operaciones CRUD completas para la entidad Trip,\n * con manejo de errores apropiado y conversin entre formatos\n * de dominio y persistencia.\n *\n * @class IndexedDBTripRepository\n * @implements {ITripRepository}\n *\n * @example\n * ```typescript\n * const tripRepo = new IndexedDBTripRepository(database);\n *\n * // Crear un viaje\n * const trip = Trip.create({ name: 'Beach Trip', ... });\n * await tripRepo.save(trip);\n *\n * // Buscar por ID\n * const found = await tripRepo.findById(trip.id);\n *\n * // Obtener todos\n * const allTrips = await tripRepo.findAll();\n * ```\n */\nexport class IndexedDBTripRepository implements ITripRepository {\n  /**\n   * Instancia de la base de datos Dexie.\n   * @private\n   * @readonly\n   */\n  private readonly db: TripFoodDatabase;\n\n  /**\n   * Factory function para crear entidades Trip desde props.\n   * Se inyecta para mantener la separacin de capas.\n   * @private\n   * @readonly\n   */\n  private readonly tripFactory: (props: TripProps) => Trip;\n\n  /**\n   * Crea una nueva instancia del repositorio.\n   *\n   * @param database - Instancia de TripFoodDatabase\n   * @param tripFactory - Factory function para crear entidades Trip\n   */\n  constructor(database: TripFoodDatabase, tripFactory: (props: TripProps) => Trip) {\n    this.db = database;\n    this.tripFactory = tripFactory;\n  }\n\n  /**\n   * Busca un viaje por su ID.\n   *\n   * @param id - ID nico del viaje\n   * @returns Promise con el Trip encontrado o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findById(id: string): Promise<Trip | null> {\n    try {\n      const record = await this.db.trips.get(id);\n\n      if (!record) {\n        return null;\n      }\n\n      const props = TripMapper.toDomainProps(record);\n      return this.tripFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'findById',\n        'trips',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Obtiene todos los viajes.\n   *\n   * @returns Promise con array de todos los Trip\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findAll(): Promise<Trip[]> {\n    try {\n      const records = await this.db.trips.toArray();\n      const propsList = TripMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.tripFactory(props));\n    } catch (error) {\n      throw new DatabaseError('findAll', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Guarda un viaje (crea nuevo o actualiza existente).\n   *\n   * Utiliza put() de Dexie que hace upsert automtico basado en la PK.\n   *\n   * @param trip - Entidad Trip a guardar\n   * @returns Promise con el Trip guardado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async save(trip: Trip): Promise<Trip> {\n    try {\n      const record = TripMapper.toRecord(trip);\n      await this.db.trips.put(record);\n      return trip;\n    } catch (error) {\n      throw new DatabaseError(\n        'create',\n        'trips',\n        error instanceof Error ? error : undefined,\n        trip.id\n      );\n    }\n  }\n\n  /**\n   * Elimina un viaje por su ID.\n   *\n   * @param id - ID del viaje a eliminar\n   * @returns Promise que resuelve cuando se completa la eliminacin\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async delete(id: string): Promise<void> {\n    try {\n      await this.db.trips.delete(id);\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'trips',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Busca viajes por nombre (bsqueda parcial, case-insensitive).\n   *\n   * @param name - Nombre o parte del nombre a buscar\n   * @returns Promise con array de Trip que coinciden\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByName(name: string): Promise<Trip[]> {\n    try {\n      const searchTerm = name.toLowerCase();\n      const records = await this.db.trips\n        .filter((trip) => trip.name.toLowerCase().includes(searchTerm))\n        .toArray();\n\n      const propsList = TripMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.tripFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Busca viajes activos en una fecha especfica.\n   *\n   * Un viaje est activo si la fecha cae entre startDate y endDate.\n   *\n   * @param date - Fecha a verificar\n   * @returns Promise con array de Trip activos en esa fecha\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByDate(date: Date): Promise<Trip[]> {\n    try {\n      const dateStr = date.toISOString();\n      const records = await this.db.trips\n        .filter((trip) => trip.startDate <= dateStr && trip.endDate >= dateStr)\n        .toArray();\n\n      const propsList = TripMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.tripFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Busca viajes en un rango de fechas.\n   *\n   * Retorna viajes que se solapan con el rango especificado.\n   *\n   * @param startDate - Fecha de inicio del rango\n   * @param endDate - Fecha de fin del rango\n   * @returns Promise con array de Trip en el rango\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByDateRange(startDate: Date, endDate: Date): Promise<Trip[]> {\n    try {\n      const startStr = startDate.toISOString();\n      const endStr = endDate.toISOString();\n\n      const records = await this.db.trips\n        .filter((trip) => trip.startDate <= endStr && trip.endDate >= startStr)\n        .toArray();\n\n      const propsList = TripMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.tripFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Obtiene todos los viajes ordenados por fecha de inicio (descendente).\n   *\n   * til para mostrar viajes recientes primero.\n   *\n   * @returns Promise con array de Trip ordenados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findAllOrderedByStartDate(): Promise<Trip[]> {\n    try {\n      const records = await this.db.trips.orderBy('startDate').reverse().toArray();\n\n      const propsList = TripMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.tripFactory(props));\n    } catch (error) {\n      throw new DatabaseError('findAll', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Cuenta el nmero total de viajes.\n   *\n   * @returns Promise con el conteo de viajes\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async count(): Promise<number> {\n    try {\n      return await this.db.trips.count();\n    } catch (error) {\n      throw new DatabaseError('count', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Verifica si existe un viaje con el ID dado.\n   *\n   * @param id - ID a verificar\n   * @returns Promise que resuelve a true si existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async exists(id: string): Promise<boolean> {\n    try {\n      const count = await this.db.trips.where('id').equals(id).count();\n      return count > 0;\n    } catch (error) {\n      throw new DatabaseError(\n        'find',\n        'trips',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Actualiza un viaje existente.\n   *\n   * @param entity - Entidad Trip con los datos actualizados\n   * @returns Promise con el Trip actualizado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async update(entity: Trip): Promise<Trip> {\n    try {\n      const record = TripMapper.toRecord(entity);\n      await this.db.trips.put(record);\n      return entity;\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'trips',\n        error instanceof Error ? error : undefined,\n        entity.id\n      );\n    }\n  }\n\n  /**\n   * Elimina mltiples viajes por sus IDs.\n   *\n   * @param ids - Array de IDs a eliminar\n   * @returns Promise que resuelve cuando se completa la eliminacin\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteMany(ids: string[]): Promise<void> {\n    try {\n      await this.db.trips.bulkDelete(ids);\n    } catch (error) {\n      throw new DatabaseError('delete', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Guarda mltiples viajes en una sola transaccin.\n   *\n   * @param trips - Array de entidades Trip a guardar\n   * @returns Promise con el array de Trip guardados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async saveMany(trips: Trip[]): Promise<Trip[]> {\n    try {\n      const records = TripMapper.toRecordList(trips);\n      await this.db.trips.bulkPut(records);\n      return trips;\n    } catch (error) {\n      throw new DatabaseError('create', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Encuentra viajes actualmente activos (hoy est dentro del rango de fechas).\n   *\n   * @returns Promise con array de viajes activos\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findActive(): Promise<Trip[]> {\n    try {\n      const today = new Date().toISOString();\n      const records = await this.db.trips\n        .filter((trip) => trip.startDate <= today && trip.endDate >= today)\n        .toArray();\n\n      const propsList = TripMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.tripFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Encuentra viajes que an no han comenzado.\n   *\n   * @returns Promise con array de viajes futuros\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findUpcoming(): Promise<Trip[]> {\n    try {\n      const today = new Date().toISOString();\n      const records = await this.db.trips\n        .filter((trip) => trip.startDate > today)\n        .toArray();\n\n      const propsList = TripMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.tripFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Encuentra viajes que ya terminaron.\n   *\n   * @returns Promise con array de viajes pasados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findPast(): Promise<Trip[]> {\n    try {\n      const today = new Date().toISOString();\n      const records = await this.db.trips\n        .filter((trip) => trip.endDate < today)\n        .toArray();\n\n      const propsList = TripMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.tripFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Actualiza parcialmente un viaje con los campos proporcionados.\n   *\n   * @param id - ID del viaje a actualizar\n   * @param updates - Campos a actualizar\n   * @returns Promise con el viaje actualizado o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async partialUpdate(id: string, updates: ITripUpdateDTO): Promise<Trip | null> {\n    try {\n      const existingRecord = await this.db.trips.get(id);\n\n      if (!existingRecord) {\n        return null;\n      }\n\n      const updatedRecord: TripRecord = {\n        ...existingRecord,\n        ...(updates.name !== undefined && { name: updates.name }),\n        ...(updates.description !== undefined && { description: updates.description === null ? undefined : updates.description }),\n        ...(updates.startDate !== undefined && { startDate: updates.startDate.toISOString() }),\n        ...(updates.endDate !== undefined && { endDate: updates.endDate.toISOString() }),\n        updatedAt: new Date().toISOString(),\n      };\n\n      await this.db.trips.put(updatedRecord);\n\n      const props = TripMapper.toDomainProps(updatedRecord);\n      return this.tripFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'trips',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Verifica si existe un viaje con el nombre dado.\n   *\n   * @param name - Nombre a verificar\n   * @param excludeId - ID opcional a excluir de la bsqueda\n   * @returns Promise que resuelve a true si existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async existsByName(name: string, excludeId?: string): Promise<boolean> {\n    try {\n      const normalizedName = name.toLowerCase().trim();\n      const record = await this.db.trips\n        .filter((trip) => {\n          if (excludeId && trip.id === excludeId) {\n            return false;\n          }\n          return trip.name.toLowerCase().trim() === normalizedName;\n        })\n        .first();\n\n      return record !== undefined;\n    } catch (error) {\n      throw new DatabaseError('find', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Encuentra viajes usando filtros complejos.\n   *\n   * @param filters - Criterios de filtrado\n   * @returns Promise con array de viajes que coinciden\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findWithFilters(filters: ITripQueryFilters): Promise<Trip[]> {\n    try {\n      let records = await this.db.trips.toArray();\n      const today = new Date().toISOString();\n\n      // Filtrar por nombre\n      if (filters.name) {\n        const searchTerm = filters.name.toLowerCase();\n        records = records.filter((trip) => trip.name.toLowerCase().includes(searchTerm));\n      }\n\n      // Filtrar por rango de fechas\n      if (filters.startDate) {\n        const startStr = filters.startDate.toISOString();\n        records = records.filter((trip) => trip.endDate >= startStr);\n      }\n\n      if (filters.endDate) {\n        const endStr = filters.endDate.toISOString();\n        records = records.filter((trip) => trip.startDate <= endStr);\n      }\n\n      // Filtrar por estado\n      if (filters.status && filters.status !== 'all') {\n        switch (filters.status) {\n          case 'active':\n            records = records.filter((trip) => trip.startDate <= today && trip.endDate >= today);\n            break;\n          case 'upcoming':\n            records = records.filter((trip) => trip.startDate > today);\n            break;\n          case 'past':\n            records = records.filter((trip) => trip.endDate < today);\n            break;\n        }\n      }\n\n      const propsList = TripMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.tripFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'trips', error instanceof Error ? error : undefined);\n    }\n  }\n}\n","/**\n * @fileoverview Mapper bidireccional para Participant (Domain) <-> ParticipantRecord (Persistence).\n *\n * Convierte entre la entidad de dominio Participant y el registro de persistencia\n * ParticipantRecord, manejando la serializacin/deserializacin de fechas.\n *\n * @module infrastructure/persistence/mappers/ParticipantMapper\n * @version 1.0.0\n */\n\nimport type { Participant } from '@domain/entities/Participant';\nimport type { ParticipantRecord } from '../indexeddb/database';\n\n/**\n * Props necesarias para crear una entidad Participant desde el dominio.\n */\nexport interface ParticipantProps {\n  id: string;\n  tripId: string;\n  name: string;\n  email?: string | undefined;\n  notes?: string | undefined;\n  createdAt: Date;\n}\n\n/**\n * Mapper esttico para conversin bidireccional Participant <-> ParticipantRecord.\n *\n * @class ParticipantMapper\n *\n * @example\n * ```typescript\n * // Domain -> Record\n * const record = ParticipantMapper.toRecord(participantEntity);\n *\n * // Record -> Domain Props\n * const props = ParticipantMapper.toDomainProps(record);\n * ```\n */\nexport class ParticipantMapper {\n  /**\n   * Constructor privado - clase esttica.\n   */\n  private constructor() {\n    // No instanciar\n  }\n\n  /**\n   * Convierte una entidad de dominio Participant a un registro de persistencia.\n   *\n   * @param participant - Entidad de dominio Participant\n   * @returns Registro de persistencia ParticipantRecord\n   */\n  public static toRecord(participant: Participant): ParticipantRecord {\n    return {\n      id: participant.id,\n      tripId: participant.tripId,\n      name: participant.name,\n      email: participant.email,\n      notes: participant.notes,\n      createdAt: participant.createdAt.toISOString(),\n    };\n  }\n\n  /**\n   * Convierte un registro de persistencia a las props de dominio.\n   *\n   * @param record - Registro de persistencia ParticipantRecord\n   * @returns Props para crear una entidad Participant\n   */\n  public static toDomainProps(record: ParticipantRecord): ParticipantProps {\n    return {\n      id: record.id,\n      tripId: record.tripId,\n      name: record.name,\n      email: record.email,\n      notes: record.notes,\n      createdAt: new Date(record.createdAt),\n    };\n  }\n\n  /**\n   * Convierte un array de registros a array de props de dominio.\n   *\n   * @param records - Array de registros de persistencia\n   * @returns Array de props para crear entidades Participant\n   */\n  public static toDomainPropsList(records: ParticipantRecord[]): ParticipantProps[] {\n    return records.map((record) => ParticipantMapper.toDomainProps(record));\n  }\n\n  /**\n   * Convierte un array de entidades a array de registros.\n   *\n   * @param participants - Array de entidades Participant\n   * @returns Array de registros de persistencia\n   */\n  public static toRecordList(participants: Participant[]): ParticipantRecord[] {\n    return participants.map((participant) => ParticipantMapper.toRecord(participant));\n  }\n\n  /**\n   * Crea un registro parcial para actualizaciones.\n   *\n   * @param updates - Campos a actualizar\n   * @returns Registro parcial para update\n   */\n  public static toPartialRecord(\n    updates: Partial<Omit<ParticipantProps, 'id' | 'tripId' | 'createdAt'>>\n  ): Partial<ParticipantRecord> {\n    const record: Partial<ParticipantRecord> = {};\n\n    if (updates.name !== undefined) {\n      record.name = updates.name;\n    }\n\n    if (updates.email !== undefined) {\n      record.email = updates.email;\n    }\n\n    if (updates.notes !== undefined) {\n      record.notes = updates.notes;\n    }\n\n    return record;\n  }\n}\n","/**\n * @fileoverview Implementacin del repositorio de Participant usando IndexedDB/Dexie.\n *\n * Este repositorio implementa IParticipantRepository del dominio, proporcionando\n * persistencia de participantes en IndexedDB a travs de Dexie.js con manejo\n * robusto de errores y documentacin completa.\n *\n * @module infrastructure/persistence/indexeddb/ParticipantRepository\n * @version 1.0.0\n */\n\nimport type { IParticipantRepository, IParticipantQueryFilters } from '@domain/interfaces/repositories/IParticipantRepository';\nimport type { Participant, IParticipantUpdateDTO } from '@domain/entities/Participant';\nimport { TripFoodDatabase, type ParticipantRecord } from './database';\nimport { ParticipantMapper, type ParticipantProps } from '../mappers/ParticipantMapper';\nimport { DatabaseError } from '../../errors/DatabaseError';\n\n/**\n * Repositorio de Participant implementado con IndexedDB a travs de Dexie.js.\n *\n * Proporciona operaciones CRUD completas para la entidad Participant,\n * con mtodos especficos para consultas por viaje y manejo de errores\n * enterprise-grade.\n *\n * @class IndexedDBParticipantRepository\n * @implements {IParticipantRepository}\n *\n * @example\n * ```typescript\n * const participantRepo = new IndexedDBParticipantRepository(database, participantFactory);\n *\n * // Crear un participante\n * const participant = Participant.create({ name: 'John', tripId: 'trip-1', ... });\n * await participantRepo.save(participant);\n *\n * // Obtener participantes de un viaje\n * const participants = await participantRepo.findByTripId('trip-1');\n * ```\n */\nexport class IndexedDBParticipantRepository implements IParticipantRepository {\n  /**\n   * Instancia de la base de datos Dexie.\n   * @private\n   * @readonly\n   */\n  private readonly db: TripFoodDatabase;\n\n  /**\n   * Factory function para crear entidades Participant desde props.\n   * Se inyecta para mantener la separacin de capas.\n   * @private\n   * @readonly\n   */\n  private readonly participantFactory: (props: ParticipantProps) => Participant;\n\n  /**\n   * Crea una nueva instancia del repositorio.\n   *\n   * @param database - Instancia de TripFoodDatabase\n   * @param participantFactory - Factory function para crear entidades Participant\n   */\n  constructor(\n    database: TripFoodDatabase,\n    participantFactory: (props: ParticipantProps) => Participant\n  ) {\n    this.db = database;\n    this.participantFactory = participantFactory;\n  }\n\n  /**\n   * Busca un participante por su ID.\n   *\n   * @param id - ID nico del participante\n   * @returns Promise con el Participant encontrado o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findById(id: string): Promise<Participant | null> {\n    try {\n      const record = await this.db.participants.get(id);\n\n      if (!record) {\n        return null;\n      }\n\n      const props = ParticipantMapper.toDomainProps(record);\n      return this.participantFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'findById',\n        'participants',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Obtiene todos los participantes.\n   *\n   * @returns Promise con array de todos los Participant\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findAll(): Promise<Participant[]> {\n    try {\n      const records = await this.db.participants.toArray();\n      const propsList = ParticipantMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.participantFactory(props));\n    } catch (error) {\n      throw new DatabaseError('findAll', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Guarda un participante (crea nuevo o actualiza existente).\n   *\n   * Utiliza put() de Dexie que hace upsert automtico basado en la PK.\n   *\n   * @param participant - Entidad Participant a guardar\n   * @returns Promise con el Participant guardado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async save(participant: Participant): Promise<Participant> {\n    try {\n      const record = ParticipantMapper.toRecord(participant);\n      await this.db.participants.put(record);\n      return participant;\n    } catch (error) {\n      throw new DatabaseError(\n        'create',\n        'participants',\n        error instanceof Error ? error : undefined,\n        participant.id\n      );\n    }\n  }\n\n  /**\n   * Elimina un participante por su ID.\n   *\n   * @param id - ID del participante a eliminar\n   * @returns Promise que resuelve cuando se completa la eliminacin\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async delete(id: string): Promise<void> {\n    try {\n      await this.db.participants.delete(id);\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'participants',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Busca todos los participantes de un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con array de Participant del viaje\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripId(tripId: string): Promise<Participant[]> {\n    try {\n      const records = await this.db.participants.where('tripId').equals(tripId).toArray();\n\n      const propsList = ParticipantMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.participantFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'participants',\n        error instanceof Error ? error : undefined,\n        tripId\n      );\n    }\n  }\n\n  /**\n   * Busca participantes por nombre (bsqueda parcial, case-insensitive).\n   *\n   * @param name - Nombre o parte del nombre a buscar\n   * @returns Promise con array de Participant que coinciden\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByName(name: string): Promise<Participant[]> {\n    try {\n      const searchTerm = name.toLowerCase();\n      const records = await this.db.participants\n        .filter((participant) => participant.name.toLowerCase().includes(searchTerm))\n        .toArray();\n\n      const propsList = ParticipantMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.participantFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Busca un participante por nombre exacto en un viaje especfico.\n   *\n   * til para validar duplicados de nombre por viaje.\n   *\n   * @param tripId - ID del viaje\n   * @param name - Nombre exacto a buscar\n   * @returns Promise con el Participant encontrado o null\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripIdAndName(tripId: string, name: string): Promise<Participant | null> {\n    try {\n      const record = await this.db.participants\n        .where('tripId')\n        .equals(tripId)\n        .filter((p) => p.name.toLowerCase() === name.toLowerCase())\n        .first();\n\n      if (!record) {\n        return null;\n      }\n\n      const props = ParticipantMapper.toDomainProps(record);\n      return this.participantFactory(props);\n    } catch (error) {\n      throw new DatabaseError('find', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Busca participantes por email (bsqueda parcial, case-insensitive).\n   *\n   * @param email - Email o parte del email a buscar\n   * @returns Promise con array de Participant que coinciden\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByEmail(email: string): Promise<Participant[]> {\n    try {\n      const searchTerm = email.toLowerCase();\n      const records = await this.db.participants\n        .filter((participant) =>\n          participant.email ? participant.email.toLowerCase().includes(searchTerm) : false\n        )\n        .toArray();\n\n      const propsList = ParticipantMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.participantFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Cuenta el nmero de participantes en un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con el conteo de participantes\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async countByTripId(tripId: string): Promise<number> {\n    try {\n      return await this.db.participants.where('tripId').equals(tripId).count();\n    } catch (error) {\n      throw new DatabaseError('count', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Verifica si existe un participante con el ID dado.\n   *\n   * @param id - ID a verificar\n   * @returns Promise que resuelve a true si existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async exists(id: string): Promise<boolean> {\n    try {\n      const count = await this.db.participants.where('id').equals(id).count();\n      return count > 0;\n    } catch (error) {\n      throw new DatabaseError(\n        'find',\n        'participants',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Actualiza un participante existente.\n   *\n   * @param entity - Entidad Participant con los datos actualizados\n   * @returns Promise con el Participant actualizado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async update(entity: Participant): Promise<Participant> {\n    try {\n      const record = ParticipantMapper.toRecord(entity);\n      await this.db.participants.put(record);\n      return entity;\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'participants',\n        error instanceof Error ? error : undefined,\n        entity.id\n      );\n    }\n  }\n\n  /**\n   * Elimina todos los participantes de un viaje.\n   *\n   * til para limpieza en cascada cuando se elimina un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con el nmero de registros eliminados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteByTripId(tripId: string): Promise<number> {\n    try {\n      return await this.db.participants.where('tripId').equals(tripId).delete();\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'participants',\n        error instanceof Error ? error : undefined,\n        tripId\n      );\n    }\n  }\n\n  /**\n   * Elimina mltiples participantes por sus IDs.\n   *\n   * @param ids - Array de IDs a eliminar\n   * @returns Promise que resuelve cuando se completa la eliminacin\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteMany(ids: string[]): Promise<void> {\n    try {\n      await this.db.participants.bulkDelete(ids);\n    } catch (error) {\n      throw new DatabaseError('delete', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Guarda mltiples participantes en una sola transaccin.\n   *\n   * @param participants - Array de entidades Participant a guardar\n   * @returns Promise con el array de Participant guardados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async saveMany(participants: Participant[]): Promise<Participant[]> {\n    try {\n      const records = ParticipantMapper.toRecordList(participants);\n      await this.db.participants.bulkPut(records);\n      return participants;\n    } catch (error) {\n      throw new DatabaseError('create', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Cuenta el nmero total de participantes.\n   *\n   * @returns Promise con el conteo total\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async count(): Promise<number> {\n    try {\n      return await this.db.participants.count();\n    } catch (error) {\n      throw new DatabaseError('count', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Actualiza parcialmente un participante con los campos proporcionados.\n   *\n   * @param id - ID del participante a actualizar\n   * @param updates - Campos a actualizar\n   * @returns Promise con el participante actualizado o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async partialUpdate(id: string, updates: IParticipantUpdateDTO): Promise<Participant | null> {\n    try {\n      const existingRecord = await this.db.participants.get(id);\n\n      if (!existingRecord) {\n        return null;\n      }\n\n      const updatedRecord: ParticipantRecord = {\n        ...existingRecord,\n        ...(updates.name !== undefined && { name: updates.name }),\n        ...(updates.email !== undefined && { email: updates.email === null ? undefined : updates.email }),\n        ...(updates.notes !== undefined && { notes: updates.notes === null ? undefined : updates.notes }),\n      };\n\n      await this.db.participants.put(updatedRecord);\n\n      const props = ParticipantMapper.toDomainProps(updatedRecord);\n      return this.participantFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'participants',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Verifica si existe un participante con el nombre dado en un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @param name - Nombre a verificar\n   * @param excludeId - ID opcional a excluir de la bsqueda\n   * @returns Promise que resuelve a true si existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async existsInTrip(tripId: string, name: string, excludeId?: string): Promise<boolean> {\n    try {\n      const normalizedName = name.toLowerCase().trim();\n      const record = await this.db.participants\n        .where('tripId')\n        .equals(tripId)\n        .filter((participant) => {\n          if (excludeId && participant.id === excludeId) {\n            return false;\n          }\n          return participant.name.toLowerCase().trim() === normalizedName;\n        })\n        .first();\n\n      return record !== undefined;\n    } catch (error) {\n      throw new DatabaseError('find', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Encuentra participantes usando filtros complejos.\n   *\n   * @param filters - Criterios de filtrado\n   * @returns Promise con array de participantes que coinciden\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findWithFilters(filters: IParticipantQueryFilters): Promise<Participant[]> {\n    try {\n      let records = await this.db.participants.toArray();\n\n      // Filtrar por tripId\n      if (filters.tripId) {\n        records = records.filter((p) => p.tripId === filters.tripId);\n      }\n\n      // Filtrar por nombre\n      if (filters.name) {\n        const searchTerm = filters.name.toLowerCase();\n        records = records.filter((p) => p.name.toLowerCase().includes(searchTerm));\n      }\n\n      // Filtrar por email\n      if (filters.email) {\n        const searchTerm = filters.email.toLowerCase();\n        records = records.filter((p) => p.email?.toLowerCase().includes(searchTerm));\n      }\n\n      const propsList = ParticipantMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.participantFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Obtiene participantes de un viaje ordenados por nombre.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con array de participantes ordenados por nombre\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripIdOrderedByName(tripId: string): Promise<Participant[]> {\n    try {\n      const records = await this.db.participants\n        .where('tripId')\n        .equals(tripId)\n        .toArray();\n\n      // Ordenar por nombre\n      records.sort((a, b) => a.name.localeCompare(b.name));\n\n      const propsList = ParticipantMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.participantFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'participants', error instanceof Error ? error : undefined);\n    }\n  }\n}\n","/**\n * @fileoverview Mapper bidireccional para Product (Domain) <-> ProductRecord (Persistence).\n *\n * Convierte entre la entidad de dominio Product y el registro de persistencia\n * ProductRecord, manejando la serializacin/deserializacin de tipos.\n *\n * @module infrastructure/persistence/mappers/ProductMapper\n * @version 1.0.0\n */\n\nimport type { Product } from '@domain/entities/Product';\nimport type { ProductCategory, ProductType as DomainProductType, ProductUnit } from '@domain/types';\nimport type { ProductRecord } from '../indexeddb/database';\n\n/**\n * Tipo de producto legacy: comida o bebida.\n * @deprecated Use domain ProductType instead\n */\nexport type ProductType = 'food' | 'beverage';\n\n/**\n * Props necesarias para crear una entidad Product desde el dominio.\n * Mirrors IProductProps from domain for compatibility.\n */\nexport interface ProductProps {\n  id: string;\n  name: string;\n  category: ProductCategory;\n  type: DomainProductType;\n  unit: ProductUnit;\n  defaultQuantityPerPerson?: number | undefined;\n  notes?: string | undefined;\n  createdAt: Date;\n  updatedAt?: Date | undefined;\n}\n\n/**\n * Mapper esttico para conversin bidireccional Product <-> ProductRecord.\n *\n * @class ProductMapper\n *\n * @example\n * ```typescript\n * // Domain -> Record\n * const record = ProductMapper.toRecord(productEntity);\n *\n * // Record -> Domain Props\n * const props = ProductMapper.toDomainProps(record);\n * ```\n */\nexport class ProductMapper {\n  /**\n   * Constructor privado - clase esttica.\n   */\n  private constructor() {\n    // No instanciar\n  }\n\n\n  /**\n   * Convierte una entidad de dominio Product a un registro de persistencia.\n   *\n   * @param product - Entidad de dominio Product\n   * @returns Registro de persistencia ProductRecord\n   */\n  public static toRecord(product: Product): ProductRecord {\n    return {\n      id: product.id,\n      name: product.name,\n      category: product.category,\n      type: product.type,\n      unit: product.unit,\n      defaultQuantityPerPerson: product.defaultQuantityPerPerson,\n      notes: product.notes,\n      createdAt: product.createdAt.toISOString(),\n    };\n  }\n\n  /**\n   * Convierte un registro de persistencia a las props de dominio.\n   *\n   * @param record - Registro de persistencia ProductRecord\n   * @returns Props para crear una entidad Product\n   */\n  public static toDomainProps(record: ProductRecord): ProductProps {\n    return {\n      id: record.id,\n      name: record.name,\n      category: record.category as ProductCategory,\n      type: record.type as DomainProductType,\n      unit: record.unit as ProductUnit,\n      defaultQuantityPerPerson: record.defaultQuantityPerPerson,\n      notes: record.notes,\n      createdAt: new Date(record.createdAt),\n      updatedAt: undefined,\n    };\n  }\n\n  /**\n   * Convierte un array de registros a array de props de dominio.\n   *\n   * @param records - Array de registros de persistencia\n   * @returns Array de props para crear entidades Product\n   */\n  public static toDomainPropsList(records: ProductRecord[]): ProductProps[] {\n    return records.map((record) => ProductMapper.toDomainProps(record));\n  }\n\n  /**\n   * Convierte un array de entidades a array de registros.\n   *\n   * @param products - Array de entidades Product\n   * @returns Array de registros de persistencia\n   */\n  public static toRecordList(products: Product[]): ProductRecord[] {\n    return products.map((product) => ProductMapper.toRecord(product));\n  }\n\n  /**\n   * Crea un registro parcial para actualizaciones.\n   *\n   * @param updates - Campos a actualizar\n   * @returns Registro parcial para update\n   */\n  public static toPartialRecord(\n    updates: Partial<Omit<ProductProps, 'id' | 'createdAt'>>\n  ): Partial<ProductRecord> {\n    const record: Partial<ProductRecord> = {};\n\n    if (updates.name !== undefined) {\n      record.name = updates.name;\n    }\n\n    if (updates.category !== undefined) {\n      record.category = updates.category;\n    }\n\n    if (updates.type !== undefined) {\n      record.type = updates.type;\n    }\n\n    if (updates.unit !== undefined) {\n      record.unit = updates.unit;\n    }\n\n    if (updates.defaultQuantityPerPerson !== undefined) {\n      record.defaultQuantityPerPerson = updates.defaultQuantityPerPerson;\n    }\n\n    if (updates.notes !== undefined) {\n      record.notes = updates.notes;\n    }\n\n    return record;\n  }\n}\n","/**\n * @fileoverview Implementacin del repositorio de Product usando IndexedDB/Dexie.\n *\n * Este repositorio implementa IProductRepository del dominio, proporcionando\n * persistencia de productos en IndexedDB a travs de Dexie.js con manejo\n * robusto de errores y documentacin completa.\n *\n * @module infrastructure/persistence/indexeddb/ProductRepository\n * @version 1.0.0\n */\n\nimport type { IProductRepository, IProductQueryFilters } from '@domain/interfaces/repositories/IProductRepository';\nimport type { Product, IProductUpdateDTO } from '@domain/entities/Product';\nimport type { ProductCategory, ProductType, ProductUnit } from '@domain/types';\nimport { TripFoodDatabase, type ProductRecord } from './database';\nimport { ProductMapper, type ProductProps } from '../mappers/ProductMapper';\nimport { DatabaseError } from '../../errors/DatabaseError';\n\n/**\n * Repositorio de Product implementado con IndexedDB a travs de Dexie.js.\n *\n * Proporciona operaciones CRUD completas para la entidad Product,\n * con mtodos especficos para consultas por categora y tipo,\n * y manejo de errores enterprise-grade.\n *\n * @class IndexedDBProductRepository\n * @implements {IProductRepository}\n *\n * @example\n * ```typescript\n * const productRepo = new IndexedDBProductRepository(database, productFactory);\n *\n * // Crear un producto\n * const product = Product.create({ name: 'Coca Cola', type: 'beverage', ... });\n * await productRepo.save(product);\n *\n * // Buscar por categora\n * const beverages = await productRepo.findByType('beverage');\n * ```\n */\nexport class IndexedDBProductRepository implements IProductRepository {\n  /**\n   * Instancia de la base de datos Dexie.\n   * @private\n   * @readonly\n   */\n  private readonly db: TripFoodDatabase;\n\n  /**\n   * Factory function para crear entidades Product desde props.\n   * Se inyecta para mantener la separacin de capas.\n   * @private\n   * @readonly\n   */\n  private readonly productFactory: (props: ProductProps) => Product;\n\n  /**\n   * Crea una nueva instancia del repositorio.\n   *\n   * @param database - Instancia de TripFoodDatabase\n   * @param productFactory - Factory function para crear entidades Product\n   */\n  constructor(\n    database: TripFoodDatabase,\n    productFactory: (props: ProductProps) => Product\n  ) {\n    this.db = database;\n    this.productFactory = productFactory;\n  }\n\n  /**\n   * Busca un producto por su ID.\n   *\n   * @param id - ID nico del producto\n   * @returns Promise con el Product encontrado o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findById(id: string): Promise<Product | null> {\n    try {\n      const record = await this.db.products.get(id);\n\n      if (!record) {\n        return null;\n      }\n\n      const props = ProductMapper.toDomainProps(record);\n      return this.productFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'findById',\n        'products',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Obtiene todos los productos.\n   *\n   * @returns Promise con array de todos los Product\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findAll(): Promise<Product[]> {\n    try {\n      const records = await this.db.products.toArray();\n      const propsList = ProductMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.productFactory(props));\n    } catch (error) {\n      throw new DatabaseError('findAll', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Guarda un producto (crea nuevo o actualiza existente).\n   *\n   * Utiliza put() de Dexie que hace upsert automtico basado en la PK.\n   *\n   * @param product - Entidad Product a guardar\n   * @returns Promise con el Product guardado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async save(product: Product): Promise<Product> {\n    try {\n      const record = ProductMapper.toRecord(product);\n      await this.db.products.put(record);\n      return product;\n    } catch (error) {\n      throw new DatabaseError(\n        'create',\n        'products',\n        error instanceof Error ? error : undefined,\n        product.id\n      );\n    }\n  }\n\n  /**\n   * Elimina un producto por su ID.\n   *\n   * @param id - ID del producto a eliminar\n   * @returns Promise que resuelve cuando se completa la eliminacin\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async delete(id: string): Promise<void> {\n    try {\n      await this.db.products.delete(id);\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'products',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Busca productos por categora.\n   *\n   * @param category - Categora a buscar (ej: 'carnes', 'lacteos')\n   * @returns Promise con array de Product de esa categora\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByCategory(category: string): Promise<Product[]> {\n    try {\n      const records = await this.db.products.where('category').equals(category).toArray();\n\n      const propsList = ProductMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.productFactory(props));\n    } catch (error) {\n      throw new DatabaseError('findByIndex', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Busca productos por tipo (food o beverage).\n   *\n   * @param type - Tipo de producto: 'food' | 'beverage'\n   * @returns Promise con array de Product de ese tipo\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByType(type: ProductType): Promise<Product[]> {\n    try {\n      const records = await this.db.products.where('type').equals(type).toArray();\n\n      const propsList = ProductMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.productFactory(props));\n    } catch (error) {\n      throw new DatabaseError('findByIndex', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Busca productos por nombre (bsqueda parcial, case-insensitive).\n   *\n   * @param name - Nombre o parte del nombre a buscar\n   * @returns Promise con array de Product que coinciden\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByName(name: string): Promise<Product[]> {\n    try {\n      const searchTerm = name.toLowerCase();\n      const records = await this.db.products\n        .filter((product) => product.name.toLowerCase().includes(searchTerm))\n        .toArray();\n\n      const propsList = ProductMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.productFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Busca un producto por nombre exacto.\n   *\n   * til para validar duplicados.\n   *\n   * @param name - Nombre exacto a buscar\n   * @returns Promise con el Product encontrado o null\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByExactName(name: string): Promise<Product | null> {\n    try {\n      const record = await this.db.products\n        .filter((p) => p.name.toLowerCase() === name.toLowerCase())\n        .first();\n\n      if (!record) {\n        return null;\n      }\n\n      const props = ProductMapper.toDomainProps(record);\n      return this.productFactory(props);\n    } catch (error) {\n      throw new DatabaseError('find', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Obtiene todas las categoras distintas de productos.\n   *\n   * @returns Promise con array de strings de categoras nicas\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async getDistinctCategories(): Promise<string[]> {\n    try {\n      const records = await this.db.products.orderBy('category').uniqueKeys();\n      return records as string[];\n    } catch (error) {\n      throw new DatabaseError('find', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Verifica si existe un producto con el ID dado.\n   *\n   * @param id - ID a verificar\n   * @returns Promise que resuelve a true si existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async exists(id: string): Promise<boolean> {\n    try {\n      const count = await this.db.products.where('id').equals(id).count();\n      return count > 0;\n    } catch (error) {\n      throw new DatabaseError(\n        'find',\n        'products',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Actualiza un producto existente.\n   *\n   * @param entity - Entidad Product con los datos actualizados\n   * @returns Promise con el Product actualizado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async update(entity: Product): Promise<Product> {\n    try {\n      const record = ProductMapper.toRecord(entity);\n      await this.db.products.put(record);\n      return entity;\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'products',\n        error instanceof Error ? error : undefined,\n        entity.id\n      );\n    }\n  }\n\n  /**\n   * Cuenta el nmero total de productos.\n   *\n   * @returns Promise con el conteo de productos\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async count(): Promise<number> {\n    try {\n      return await this.db.products.count();\n    } catch (error) {\n      throw new DatabaseError('count', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Cuenta productos por categora.\n   *\n   * @param category - Categora a contar\n   * @returns Promise con el conteo\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async countByCategory(category: string): Promise<number> {\n    try {\n      return await this.db.products.where('category').equals(category).count();\n    } catch (error) {\n      throw new DatabaseError('count', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Cuenta productos por tipo.\n   *\n   * @param type - Tipo a contar: 'food' | 'beverage'\n   * @returns Promise con el conteo\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async countByType(type: ProductType): Promise<number> {\n    try {\n      return await this.db.products.where('type').equals(type).count();\n    } catch (error) {\n      throw new DatabaseError('count', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Elimina mltiples productos por sus IDs.\n   *\n   * @param ids - Array de IDs a eliminar\n   * @returns Promise que resuelve cuando se completa la eliminacin\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteMany(ids: string[]): Promise<void> {\n    try {\n      await this.db.products.bulkDelete(ids);\n    } catch (error) {\n      throw new DatabaseError('delete', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Guarda mltiples productos en una sola transaccin.\n   *\n   * @param products - Array de entidades Product a guardar\n   * @returns Promise con el array de Product guardados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async saveMany(products: Product[]): Promise<Product[]> {\n    try {\n      const records = ProductMapper.toRecordList(products);\n      await this.db.products.bulkPut(records);\n      return products;\n    } catch (error) {\n      throw new DatabaseError('create', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Obtiene todos los productos ordenados por nombre.\n   *\n   * @returns Promise con array de Product ordenados alfabticamente\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findAllOrderedByName(): Promise<Product[]> {\n    try {\n      const records = await this.db.products.orderBy('name').toArray();\n\n      const propsList = ProductMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.productFactory(props));\n    } catch (error) {\n      throw new DatabaseError('findAll', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Obtiene todos los productos agrupados por categora.\n   *\n   * @returns Promise con Map de categora a array de productos\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findAllGroupedByCategory(): Promise<Map<ProductCategory, Product[]>> {\n    try {\n      const records = await this.db.products.toArray();\n      const grouped = new Map<ProductCategory, Product[]>();\n\n      for (const record of records) {\n        const props = ProductMapper.toDomainProps(record);\n        const product = this.productFactory(props);\n        const category = product.category;\n\n        if (!grouped.has(category)) {\n          grouped.set(category, []);\n        }\n        grouped.get(category)!.push(product);\n      }\n\n      // Ordenar productos por nombre dentro de cada categora\n      for (const products of grouped.values()) {\n        products.sort((a, b) => a.name.localeCompare(b.name));\n      }\n\n      return grouped;\n    } catch (error) {\n      throw new DatabaseError('findAll', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Encuentra productos por unidad de medida.\n   *\n   * @param unit - Unidad a buscar\n   * @returns Promise con array de productos con esa unidad\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByUnit(unit: ProductUnit): Promise<Product[]> {\n    try {\n      const records = await this.db.products\n        .filter((product) => product.unit === unit)\n        .toArray();\n\n      const propsList = ProductMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.productFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Encuentra productos que tienen cantidad predeterminada por persona.\n   *\n   * @returns Promise con array de productos con cantidad predeterminada\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findWithDefaultQuantity(): Promise<Product[]> {\n    try {\n      const records = await this.db.products\n        .filter((product) => product.defaultQuantityPerPerson !== undefined && product.defaultQuantityPerPerson > 0)\n        .toArray();\n\n      const propsList = ProductMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.productFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Actualiza parcialmente un producto con los campos proporcionados.\n   *\n   * @param id - ID del producto a actualizar\n   * @param updates - Campos a actualizar\n   * @returns Promise con el producto actualizado o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async partialUpdate(id: string, updates: IProductUpdateDTO): Promise<Product | null> {\n    try {\n      const existingRecord = await this.db.products.get(id);\n\n      if (!existingRecord) {\n        return null;\n      }\n\n      const updatedRecord: ProductRecord = {\n        ...existingRecord,\n        ...(updates.name !== undefined && { name: updates.name }),\n        ...(updates.category !== undefined && { category: updates.category }),\n        ...(updates.type !== undefined && { type: updates.type }),\n        ...(updates.unit !== undefined && { unit: updates.unit }),\n        ...(updates.defaultQuantityPerPerson !== undefined && {\n          defaultQuantityPerPerson: updates.defaultQuantityPerPerson === null ? undefined : updates.defaultQuantityPerPerson,\n        }),\n        ...(updates.notes !== undefined && { notes: updates.notes === null ? undefined : updates.notes }),\n      };\n\n      await this.db.products.put(updatedRecord);\n\n      const props = ProductMapper.toDomainProps(updatedRecord);\n      return this.productFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'products',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Verifica si existe un producto con el nombre dado.\n   *\n   * @param name - Nombre a verificar\n   * @param excludeId - ID opcional a excluir de la bsqueda\n   * @returns Promise que resuelve a true si existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async existsByName(name: string, excludeId?: string): Promise<boolean> {\n    try {\n      const normalizedName = name.toLowerCase().trim();\n      const record = await this.db.products\n        .filter((product) => {\n          if (excludeId && product.id === excludeId) {\n            return false;\n          }\n          return product.name.toLowerCase().trim() === normalizedName;\n        })\n        .first();\n\n      return record !== undefined;\n    } catch (error) {\n      throw new DatabaseError('find', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Encuentra productos usando filtros complejos.\n   *\n   * @param filters - Criterios de filtrado\n   * @returns Promise con array de productos que coinciden\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findWithFilters(filters: IProductQueryFilters): Promise<Product[]> {\n    try {\n      let records = await this.db.products.toArray();\n\n      // Filtrar por categora\n      if (filters.category) {\n        records = records.filter((p) => p.category === filters.category);\n      }\n\n      // Filtrar por tipo\n      if (filters.type) {\n        records = records.filter((p) => p.type === filters.type);\n      }\n\n      // Filtrar por unidad\n      if (filters.unit) {\n        records = records.filter((p) => p.unit === filters.unit);\n      }\n\n      // Filtrar por nombre\n      if (filters.name) {\n        const searchTerm = filters.name.toLowerCase();\n        records = records.filter((p) => p.name.toLowerCase().includes(searchTerm));\n      }\n\n      // Filtrar por tener cantidad predeterminada\n      if (filters.hasDefaultQuantity !== undefined) {\n        if (filters.hasDefaultQuantity) {\n          records = records.filter((p) => p.defaultQuantityPerPerson !== undefined && p.defaultQuantityPerPerson > 0);\n        } else {\n          records = records.filter((p) => p.defaultQuantityPerPerson === undefined || p.defaultQuantityPerPerson <= 0);\n        }\n      }\n\n      const propsList = ProductMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.productFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'products', error instanceof Error ? error : undefined);\n    }\n  }\n}\n","/**\n * @fileoverview Mapper bidireccional para Consumption (Domain) <-> ConsumptionRecord (Persistence).\n *\n * Convierte entre la entidad de dominio Consumption y el registro de persistencia\n * ConsumptionRecord, manejando la serializacin/deserializacin de fechas y tipos.\n *\n * @module infrastructure/persistence/mappers/ConsumptionMapper\n * @version 1.0.0\n */\n\nimport type { Consumption } from '@domain/entities/Consumption';\nimport type { ConsumptionRecord } from '../indexeddb/database';\n\n/**\n * Tipo de comida del da.\n */\nexport type MealType = 'breakfast' | 'lunch' | 'dinner' | 'snack';\n\n/**\n * Props necesarias para crear una entidad Consumption desde el dominio.\n */\nexport interface ConsumptionProps {\n  id: string;\n  tripId: string;\n  participantId: string;\n  productId: string;\n  date: Date;\n  meal: MealType;\n  quantity: number;\n  createdAt: Date;\n}\n\n/**\n * Mapper esttico para conversin bidireccional Consumption <-> ConsumptionRecord.\n *\n * @class ConsumptionMapper\n *\n * @example\n * ```typescript\n * // Domain -> Record\n * const record = ConsumptionMapper.toRecord(consumptionEntity);\n *\n * // Record -> Domain Props\n * const props = ConsumptionMapper.toDomainProps(record);\n * ```\n */\nexport class ConsumptionMapper {\n  /**\n   * Comidas vlidas del da.\n   */\n  private static readonly VALID_MEALS: readonly MealType[] = [\n    'breakfast',\n    'lunch',\n    'dinner',\n    'snack',\n  ];\n\n  /**\n   * Constructor privado - clase esttica.\n   */\n  private constructor() {\n    // No instanciar\n  }\n\n  /**\n   * Valida que el tipo de comida sea vlido.\n   *\n   * @param meal - Tipo de comida a validar\n   * @returns true si es un tipo vlido\n   */\n  private static isValidMealType(meal: string): meal is MealType {\n    return ConsumptionMapper.VALID_MEALS.includes(meal as MealType);\n  }\n\n  /**\n   * Convierte una entidad de dominio Consumption a un registro de persistencia.\n   *\n   * @param consumption - Entidad de dominio Consumption\n   * @returns Registro de persistencia ConsumptionRecord\n   */\n  public static toRecord(consumption: Consumption): ConsumptionRecord {\n    return {\n      id: consumption.id,\n      tripId: consumption.tripId,\n      participantId: consumption.participantId,\n      productId: consumption.productId,\n      date: consumption.date.toISOString(),\n      meal: consumption.meal,\n      quantity: consumption.quantity,\n      createdAt: consumption.createdAt.toISOString(),\n    };\n  }\n\n  /**\n   * Convierte un registro de persistencia a las props de dominio.\n   *\n   * @param record - Registro de persistencia ConsumptionRecord\n   * @returns Props para crear una entidad Consumption\n   * @throws Error si el tipo de comida no es vlido\n   */\n  public static toDomainProps(record: ConsumptionRecord): ConsumptionProps {\n    if (!ConsumptionMapper.isValidMealType(record.meal)) {\n      throw new Error(\n        `Invalid meal type: ${record.meal}. Expected one of: ${ConsumptionMapper.VALID_MEALS.join(', ')}.`\n      );\n    }\n\n    return {\n      id: record.id,\n      tripId: record.tripId,\n      participantId: record.participantId,\n      productId: record.productId,\n      date: new Date(record.date),\n      meal: record.meal,\n      quantity: record.quantity,\n      createdAt: new Date(record.createdAt),\n    };\n  }\n\n  /**\n   * Convierte un array de registros a array de props de dominio.\n   *\n   * @param records - Array de registros de persistencia\n   * @returns Array de props para crear entidades Consumption\n   */\n  public static toDomainPropsList(records: ConsumptionRecord[]): ConsumptionProps[] {\n    return records.map((record) => ConsumptionMapper.toDomainProps(record));\n  }\n\n  /**\n   * Convierte un array de entidades a array de registros.\n   *\n   * @param consumptions - Array de entidades Consumption\n   * @returns Array de registros de persistencia\n   */\n  public static toRecordList(consumptions: Consumption[]): ConsumptionRecord[] {\n    return consumptions.map((consumption) => ConsumptionMapper.toRecord(consumption));\n  }\n\n  /**\n   * Crea un registro parcial para actualizaciones.\n   *\n   * @param updates - Campos a actualizar\n   * @returns Registro parcial para update\n   */\n  public static toPartialRecord(\n    updates: Partial<Omit<ConsumptionProps, 'id' | 'tripId' | 'createdAt'>>\n  ): Partial<ConsumptionRecord> {\n    const record: Partial<ConsumptionRecord> = {};\n\n    if (updates.participantId !== undefined) {\n      record.participantId = updates.participantId;\n    }\n\n    if (updates.productId !== undefined) {\n      record.productId = updates.productId;\n    }\n\n    if (updates.date !== undefined) {\n      record.date = updates.date.toISOString();\n    }\n\n    if (updates.meal !== undefined) {\n      record.meal = updates.meal;\n    }\n\n    if (updates.quantity !== undefined) {\n      record.quantity = updates.quantity;\n    }\n\n    return record;\n  }\n\n  /**\n   * Convierte una fecha a formato de solo fecha (YYYY-MM-DD) para comparaciones.\n   *\n   * @param date - Fecha a convertir\n   * @returns String en formato YYYY-MM-DD\n   */\n  public static toDateOnlyString(date: Date): string {\n    return date.toISOString().split('T')[0] ?? '';\n  }\n}\n","/**\n * @fileoverview Implementacin del repositorio de Consumption usando IndexedDB/Dexie.\n *\n * Este repositorio implementa IConsumptionRepository del dominio, proporcionando\n * persistencia de consumos en IndexedDB a travs de Dexie.js con manejo\n * robusto de errores y documentacin completa.\n *\n * @module infrastructure/persistence/indexeddb/ConsumptionRepository\n * @version 1.0.0\n */\n\nimport type { IConsumptionRepository, IConsumptionQueryFilters, IConsumptionSummary } from '@domain/interfaces/repositories/IConsumptionRepository';\nimport type { Consumption, IConsumptionUpdateDTO } from '@domain/entities/Consumption';\nimport type { IDateRange } from '@domain/types';\nimport { TripFoodDatabase, type ConsumptionRecord } from './database';\nimport { ConsumptionMapper, type ConsumptionProps, type MealType } from '../mappers/ConsumptionMapper';\nimport { DatabaseError } from '../../errors/DatabaseError';\n\n/**\n * Repositorio de Consumption implementado con IndexedDB a travs de Dexie.js.\n *\n * Proporciona operaciones CRUD completas para la entidad Consumption,\n * con mtodos especficos para consultas por viaje, participante, producto,\n * fecha y comida, optimizados con ndices compuestos.\n *\n * @class IndexedDBConsumptionRepository\n * @implements {IConsumptionRepository}\n *\n * @example\n * ```typescript\n * const consumptionRepo = new IndexedDBConsumptionRepository(database, consumptionFactory);\n *\n * // Registrar un consumo\n * const consumption = Consumption.create({\n *   tripId: 'trip-1',\n *   participantId: 'part-1',\n *   productId: 'prod-1',\n *   meal: 'lunch',\n *   quantity: 2\n * });\n * await consumptionRepo.save(consumption);\n *\n * // Obtener consumos de un viaje en una fecha\n * const consumptions = await consumptionRepo.findByTripIdAndDate('trip-1', new Date());\n * ```\n */\nexport class IndexedDBConsumptionRepository implements IConsumptionRepository {\n  /**\n   * Instancia de la base de datos Dexie.\n   * @private\n   * @readonly\n   */\n  private readonly db: TripFoodDatabase;\n\n  /**\n   * Factory function para crear entidades Consumption desde props.\n   * Se inyecta para mantener la separacin de capas.\n   * @private\n   * @readonly\n   */\n  private readonly consumptionFactory: (props: ConsumptionProps) => Consumption;\n\n  /**\n   * Crea una nueva instancia del repositorio.\n   *\n   * @param database - Instancia de TripFoodDatabase\n   * @param consumptionFactory - Factory function para crear entidades Consumption\n   */\n  constructor(\n    database: TripFoodDatabase,\n    consumptionFactory: (props: ConsumptionProps) => Consumption\n  ) {\n    this.db = database;\n    this.consumptionFactory = consumptionFactory;\n  }\n\n  /**\n   * Busca un consumo por su ID.\n   *\n   * @param id - ID nico del consumo\n   * @returns Promise con el Consumption encontrado o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findById(id: string): Promise<Consumption | null> {\n    try {\n      const record = await this.db.consumptions.get(id);\n\n      if (!record) {\n        return null;\n      }\n\n      const props = ConsumptionMapper.toDomainProps(record);\n      return this.consumptionFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'findById',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Obtiene todos los consumos.\n   *\n   * @returns Promise con array de todos los Consumption\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findAll(): Promise<Consumption[]> {\n    try {\n      const records = await this.db.consumptions.toArray();\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError('findAll', 'consumptions', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Guarda un consumo (crea nuevo o actualiza existente).\n   *\n   * Utiliza put() de Dexie que hace upsert automtico basado en la PK.\n   *\n   * @param consumption - Entidad Consumption a guardar\n   * @returns Promise con el Consumption guardado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async save(consumption: Consumption): Promise<Consumption> {\n    try {\n      const record = ConsumptionMapper.toRecord(consumption);\n      await this.db.consumptions.put(record);\n      return consumption;\n    } catch (error) {\n      throw new DatabaseError(\n        'create',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        consumption.id\n      );\n    }\n  }\n\n  /**\n   * Elimina un consumo por su ID.\n   *\n   * @param id - ID del consumo a eliminar\n   * @returns Promise que resuelve cuando se completa la eliminacin\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async delete(id: string): Promise<void> {\n    try {\n      await this.db.consumptions.delete(id);\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Busca todos los consumos de un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con array de Consumption del viaje\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripId(tripId: string): Promise<Consumption[]> {\n    try {\n      const records = await this.db.consumptions.where('tripId').equals(tripId).toArray();\n\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        tripId\n      );\n    }\n  }\n\n  /**\n   * Busca todos los consumos de un participante.\n   *\n   * @param participantId - ID del participante\n   * @returns Promise con array de Consumption del participante\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByParticipantId(participantId: string): Promise<Consumption[]> {\n    try {\n      const records = await this.db.consumptions\n        .where('participantId')\n        .equals(participantId)\n        .toArray();\n\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        participantId\n      );\n    }\n  }\n\n  /**\n   * Busca todos los consumos de un producto.\n   *\n   * til para calcular totales de consumo por producto.\n   *\n   * @param productId - ID del producto\n   * @returns Promise con array de Consumption del producto\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByProductId(productId: string): Promise<Consumption[]> {\n    try {\n      const records = await this.db.consumptions.where('productId').equals(productId).toArray();\n\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        productId\n      );\n    }\n  }\n\n  /**\n   * Busca consumos de un viaje en una fecha especfica.\n   *\n   * Utiliza el ndice compuesto [tripId+date] para bsqueda eficiente.\n   *\n   * @param tripId - ID del viaje\n   * @param date - Fecha a buscar\n   * @returns Promise con array de Consumption en esa fecha\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripIdAndDate(tripId: string, date: Date): Promise<Consumption[]> {\n    try {\n      const dateStr = ConsumptionMapper.toDateOnlyString(date);\n\n      // Usar filtro en lugar de ndice compuesto para mayor flexibilidad con fechas\n      const records = await this.db.consumptions\n        .where('tripId')\n        .equals(tripId)\n        .filter((record) => record.date.startsWith(dateStr))\n        .toArray();\n\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        tripId\n      );\n    }\n  }\n\n  /**\n   * Busca consumos de un participante en un viaje.\n   *\n   * Utiliza el ndice compuesto [tripId+participantId].\n   *\n   * @param tripId - ID del viaje\n   * @param participantId - ID del participante\n   * @returns Promise con array de Consumption del participante en ese viaje\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripIdAndParticipantId(\n    tripId: string,\n    participantId: string\n  ): Promise<Consumption[]> {\n    try {\n      const records = await this.db.consumptions\n        .where('[tripId+participantId]')\n        .equals([tripId, participantId])\n        .toArray();\n\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'consumptions',\n        error instanceof Error ? error : undefined\n      );\n    }\n  }\n\n  /**\n   * Busca consumos de un producto en un viaje.\n   *\n   * Utiliza el ndice compuesto [tripId+productId].\n   *\n   * @param tripId - ID del viaje\n   * @param productId - ID del producto\n   * @returns Promise con array de Consumption del producto en ese viaje\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripIdAndProductId(tripId: string, productId: string): Promise<Consumption[]> {\n    try {\n      const records = await this.db.consumptions\n        .where('[tripId+productId]')\n        .equals([tripId, productId])\n        .toArray();\n\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'consumptions',\n        error instanceof Error ? error : undefined\n      );\n    }\n  }\n\n  /**\n   * Busca consumos por tipo de comida en un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @param meal - Tipo de comida: 'breakfast' | 'lunch' | 'dinner' | 'snack'\n   * @returns Promise con array de Consumption de esa comida\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripIdAndMeal(tripId: string, meal: MealType): Promise<Consumption[]> {\n    try {\n      const records = await this.db.consumptions\n        .where('tripId')\n        .equals(tripId)\n        .filter((record) => record.meal === meal)\n        .toArray();\n\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'consumptions',\n        error instanceof Error ? error : undefined\n      );\n    }\n  }\n\n  /**\n   * Busca consumos en un rango de fechas para un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @param dateRange - Rango de fechas (startDate, endDate)\n   * @returns Promise con array de Consumption en el rango\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripIdAndDateRange(\n    tripId: string,\n    dateRange: IDateRange\n  ): Promise<Consumption[]> {\n    try {\n      const startStr = dateRange.startDate.toISOString();\n      const endStr = dateRange.endDate.toISOString();\n\n      const records = await this.db.consumptions\n        .where('tripId')\n        .equals(tripId)\n        .filter((record) => record.date >= startStr && record.date <= endStr)\n        .toArray();\n\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'consumptions',\n        error instanceof Error ? error : undefined\n      );\n    }\n  }\n\n  /**\n   * Verifica si existe un consumo con el ID dado.\n   *\n   * @param id - ID a verificar\n   * @returns Promise que resuelve a true si existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async exists(id: string): Promise<boolean> {\n    try {\n      const count = await this.db.consumptions.where('id').equals(id).count();\n      return count > 0;\n    } catch (error) {\n      throw new DatabaseError(\n        'find',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Actualiza un consumo existente.\n   *\n   * @param entity - Entidad Consumption con los datos actualizados\n   * @returns Promise con el Consumption actualizado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async update(entity: Consumption): Promise<Consumption> {\n    try {\n      const record = ConsumptionMapper.toRecord(entity);\n      await this.db.consumptions.put(record);\n      return entity;\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        entity.id\n      );\n    }\n  }\n\n  /**\n   * Elimina todos los consumos de un viaje.\n   *\n   * til para limpieza en cascada cuando se elimina un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con el nmero de registros eliminados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteByTripId(tripId: string): Promise<number> {\n    try {\n      return await this.db.consumptions.where('tripId').equals(tripId).delete();\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        tripId\n      );\n    }\n  }\n\n  /**\n   * Elimina todos los consumos de un participante.\n   *\n   * til para limpieza en cascada cuando se elimina un participante.\n   *\n   * @param participantId - ID del participante\n   * @returns Promise con el nmero de registros eliminados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteByParticipantId(participantId: string): Promise<number> {\n    try {\n      return await this.db.consumptions.where('participantId').equals(participantId).delete();\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        participantId\n      );\n    }\n  }\n\n  /**\n   * Elimina todos los consumos de un producto.\n   *\n   * til para limpieza en cascada cuando se elimina un producto.\n   *\n   * @param productId - ID del producto\n   * @returns Promise con el nmero de registros eliminados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteByProductId(productId: string): Promise<number> {\n    try {\n      return await this.db.consumptions.where('productId').equals(productId).delete();\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        productId\n      );\n    }\n  }\n\n  /**\n   * Cuenta el nmero total de consumos.\n   *\n   * @returns Promise con el conteo total\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async count(): Promise<number> {\n    try {\n      return await this.db.consumptions.count();\n    } catch (error) {\n      throw new DatabaseError('count', 'consumptions', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Cuenta consumos por viaje.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con el conteo\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async countByTripId(tripId: string): Promise<number> {\n    try {\n      return await this.db.consumptions.where('tripId').equals(tripId).count();\n    } catch (error) {\n      throw new DatabaseError('count', 'consumptions', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Elimina mltiples consumos por sus IDs.\n   *\n   * @param ids - Array de IDs a eliminar\n   * @returns Promise que resuelve cuando se completa la eliminacin\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteMany(ids: string[]): Promise<void> {\n    try {\n      await this.db.consumptions.bulkDelete(ids);\n    } catch (error) {\n      throw new DatabaseError('delete', 'consumptions', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Guarda mltiples consumos en una sola transaccin.\n   *\n   * @param consumptions - Array de entidades Consumption a guardar\n   * @returns Promise con el array de Consumption guardados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async saveMany(consumptions: Consumption[]): Promise<Consumption[]> {\n    try {\n      const records = ConsumptionMapper.toRecordList(consumptions);\n      await this.db.consumptions.bulkPut(records);\n      return consumptions;\n    } catch (error) {\n      throw new DatabaseError('create', 'consumptions', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Calcula la suma de cantidades de un producto en un viaje.\n   *\n   * til para calcular totales de consumo para la lista de compras.\n   *\n   * @param tripId - ID del viaje\n   * @param productId - ID del producto\n   * @returns Promise con la suma de cantidades\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async sumQuantityByTripIdAndProductId(tripId: string, productId: string): Promise<number> {\n    try {\n      const records = await this.db.consumptions\n        .where('[tripId+productId]')\n        .equals([tripId, productId])\n        .toArray();\n\n      return records.reduce((sum, record) => sum + record.quantity, 0);\n    } catch (error) {\n      throw new DatabaseError('find', 'consumptions', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Busca consumos de un participante en una fecha especfica.\n   *\n   * @param participantId - ID del participante\n   * @param date - Fecha a buscar\n   * @returns Promise con array de consumos del participante en esa fecha\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByParticipantIdAndDate(participantId: string, date: Date): Promise<Consumption[]> {\n    try {\n      const dateStr = ConsumptionMapper.toDateOnlyString(date);\n\n      const records = await this.db.consumptions\n        .where('participantId')\n        .equals(participantId)\n        .filter((record) => record.date.startsWith(dateStr))\n        .toArray();\n\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        participantId\n      );\n    }\n  }\n\n  /**\n   * Actualiza parcialmente un consumo con los campos proporcionados.\n   *\n   * @param id - ID del consumo a actualizar\n   * @param updates - Campos a actualizar\n   * @returns Promise con el consumo actualizado o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async partialUpdate(id: string, updates: IConsumptionUpdateDTO): Promise<Consumption | null> {\n    try {\n      const existingRecord = await this.db.consumptions.get(id);\n\n      if (!existingRecord) {\n        return null;\n      }\n\n      const updatedRecord: ConsumptionRecord = {\n        ...existingRecord,\n        ...(updates.participantId !== undefined && { participantId: updates.participantId }),\n        ...(updates.productId !== undefined && { productId: updates.productId }),\n        ...(updates.date !== undefined && { date: updates.date.toISOString() }),\n        ...(updates.meal !== undefined && { meal: updates.meal }),\n        ...(updates.quantity !== undefined && { quantity: updates.quantity }),\n        ...(updates.notes !== undefined && { notes: updates.notes === null ? undefined : updates.notes }),\n      };\n\n      await this.db.consumptions.put(updatedRecord);\n\n      const props = ConsumptionMapper.toDomainProps(updatedRecord);\n      return this.consumptionFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'consumptions',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Encuentra consumos usando filtros complejos.\n   *\n   * @param filters - Criterios de filtrado\n   * @returns Promise con array de consumos que coinciden\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findWithFilters(filters: IConsumptionQueryFilters): Promise<Consumption[]> {\n    try {\n      let records = await this.db.consumptions.toArray();\n\n      // Filtrar por tripId\n      if (filters.tripId) {\n        records = records.filter((c) => c.tripId === filters.tripId);\n      }\n\n      // Filtrar por participantId\n      if (filters.participantId) {\n        records = records.filter((c) => c.participantId === filters.participantId);\n      }\n\n      // Filtrar por productId\n      if (filters.productId) {\n        records = records.filter((c) => c.productId === filters.productId);\n      }\n\n      // Filtrar por meal\n      if (filters.meal) {\n        records = records.filter((c) => c.meal === filters.meal);\n      }\n\n      // Filtrar por fecha\n      if (filters.date) {\n        const dateStr = ConsumptionMapper.toDateOnlyString(filters.date);\n        records = records.filter((c) => c.date.startsWith(dateStr));\n      }\n\n      // Filtrar por rango de fechas\n      if (filters.dateRange) {\n        const startStr = filters.dateRange.startDate.toISOString();\n        const endStr = filters.dateRange.endDate.toISOString();\n        records = records.filter((c) => c.date >= startStr && c.date <= endStr);\n      }\n\n      const propsList = ConsumptionMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.consumptionFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'consumptions', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Obtiene un resumen de consumo por producto para un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con array de resmenes de consumo por producto\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async getSummaryByProduct(tripId: string): Promise<IConsumptionSummary[]> {\n    try {\n      const records = await this.db.consumptions\n        .where('tripId')\n        .equals(tripId)\n        .toArray();\n\n      // Agrupar por productId\n      const productMap = new Map<string, {\n        totalQuantity: number;\n        consumptionCount: number;\n        participantIds: Set<string>;\n      }>();\n\n      for (const record of records) {\n        if (!productMap.has(record.productId)) {\n          productMap.set(record.productId, {\n            totalQuantity: 0,\n            consumptionCount: 0,\n            participantIds: new Set(),\n          });\n        }\n\n        const summary = productMap.get(record.productId)!;\n        summary.totalQuantity += record.quantity;\n        summary.consumptionCount += 1;\n        summary.participantIds.add(record.participantId);\n      }\n\n      // Convertir a array de IConsumptionSummary\n      const summaries: IConsumptionSummary[] = [];\n      for (const [productId, data] of productMap.entries()) {\n        summaries.push({\n          productId,\n          totalQuantity: data.totalQuantity,\n          consumptionCount: data.consumptionCount,\n          uniqueParticipants: data.participantIds.size,\n        });\n      }\n\n      return summaries;\n    } catch (error) {\n      throw new DatabaseError('find', 'consumptions', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Obtiene la cantidad total consumida de un producto en un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @param productId - ID del producto\n   * @returns Promise con la cantidad total\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async getTotalQuantityByProduct(tripId: string, productId: string): Promise<number> {\n    return this.sumQuantityByTripIdAndProductId(tripId, productId);\n  }\n}\n","/**\n * @fileoverview Mapper bidireccional para Availability (Domain) <-> AvailabilityRecord (Persistence).\n *\n * Convierte entre la entidad de dominio Availability y el registro de persistencia\n * AvailabilityRecord, manejando la serializacin/deserializacin de fechas y arrays.\n *\n * @module infrastructure/persistence/mappers/AvailabilityMapper\n * @version 1.0.0\n */\n\nimport type { Availability } from '@domain/entities/Availability';\nimport type { AvailabilityRecord } from '../indexeddb/database';\nimport type { MealType } from '@domain/types';\n\n/**\n * Props necesarias para crear una entidad Availability desde el dominio.\n * Mirrors IAvailabilityProps for compatibility.\n */\nexport interface AvailabilityProps {\n  id: string;\n  participantId: string;\n  tripId: string;\n  date: Date;\n  meals: MealType[];\n  createdAt: Date;\n  updatedAt?: Date | undefined;\n}\n\n/**\n * Mapper esttico para conversin bidireccional Availability <-> AvailabilityRecord.\n *\n * @class AvailabilityMapper\n *\n * @example\n * ```typescript\n * // Domain -> Record\n * const record = AvailabilityMapper.toRecord(availabilityEntity);\n *\n * // Record -> Domain Props\n * const props = AvailabilityMapper.toDomainProps(record);\n * ```\n */\nexport class AvailabilityMapper {\n  /**\n   * Comidas vlidas del da.\n   */\n  private static readonly VALID_MEALS: readonly MealType[] = [\n    'breakfast',\n    'lunch',\n    'dinner',\n    'snack',\n  ];\n\n  /**\n   * Constructor privado - clase esttica.\n   */\n  private constructor() {\n    // No instanciar\n  }\n\n  /**\n   * Valida que el tipo de comida sea vlido.\n   *\n   * @param meal - Tipo de comida a validar\n   * @returns true si es un tipo vlido\n   */\n  private static isValidMealType(meal: string): meal is MealType {\n    return AvailabilityMapper.VALID_MEALS.includes(meal as MealType);\n  }\n\n  /**\n   * Valida y convierte un array de strings a MealType[].\n   *\n   * @param meals - Array de strings de comidas\n   * @returns Array de MealType validados\n   * @throws Error si alguna comida no es vlida\n   */\n  private static validateMeals(meals: string[]): MealType[] {\n    const validatedMeals: MealType[] = [];\n\n    for (const meal of meals) {\n      if (!AvailabilityMapper.isValidMealType(meal)) {\n        throw new Error(\n          `Invalid meal type: ${meal}. Expected one of: ${AvailabilityMapper.VALID_MEALS.join(', ')}.`\n        );\n      }\n      validatedMeals.push(meal);\n    }\n\n    return validatedMeals;\n  }\n\n  /**\n   * Convierte una entidad de dominio Availability a un registro de persistencia.\n   *\n   * @param availability - Entidad de dominio Availability\n   * @returns Registro de persistencia AvailabilityRecord\n   */\n  public static toRecord(availability: Availability): AvailabilityRecord {\n    return {\n      id: availability.id,\n      participantId: availability.participantId,\n      tripId: availability.tripId,\n      date: availability.date.toISOString(),\n      meals: [...availability.meals], // Copia defensiva del array\n    };\n  }\n\n  /**\n   * Convierte un registro de persistencia a las props de dominio.\n   *\n   * @param record - Registro de persistencia AvailabilityRecord\n   * @returns Props para crear una entidad Availability\n   * @throws Error si alguna comida no es vlida\n   */\n  public static toDomainProps(record: AvailabilityRecord): AvailabilityProps {\n    return {\n      id: record.id,\n      participantId: record.participantId,\n      tripId: record.tripId,\n      date: new Date(record.date),\n      meals: AvailabilityMapper.validateMeals(record.meals),\n      createdAt: new Date(),\n      updatedAt: undefined,\n    };\n  }\n\n  /**\n   * Convierte un array de registros a array de props de dominio.\n   *\n   * @param records - Array de registros de persistencia\n   * @returns Array de props para crear entidades Availability\n   */\n  public static toDomainPropsList(records: AvailabilityRecord[]): AvailabilityProps[] {\n    return records.map((record) => AvailabilityMapper.toDomainProps(record));\n  }\n\n  /**\n   * Convierte un array de entidades a array de registros.\n   *\n   * @param availabilities - Array de entidades Availability\n   * @returns Array de registros de persistencia\n   */\n  public static toRecordList(availabilities: Availability[]): AvailabilityRecord[] {\n    return availabilities.map((availability) => AvailabilityMapper.toRecord(availability));\n  }\n\n  /**\n   * Crea un registro parcial para actualizaciones.\n   *\n   * @param updates - Campos a actualizar\n   * @returns Registro parcial para update\n   */\n  public static toPartialRecord(\n    updates: Partial<Omit<AvailabilityProps, 'id' | 'participantId' | 'tripId'>>\n  ): Partial<AvailabilityRecord> {\n    const record: Partial<AvailabilityRecord> = {};\n\n    if (updates.date !== undefined) {\n      record.date = updates.date.toISOString();\n    }\n\n    if (updates.meals !== undefined) {\n      record.meals = [...updates.meals];\n    }\n\n    return record;\n  }\n\n  /**\n   * Convierte una fecha a formato de solo fecha (YYYY-MM-DD) para comparaciones.\n   *\n   * @param date - Fecha a convertir\n   * @returns String en formato YYYY-MM-DD\n   */\n  public static toDateOnlyString(date: Date): string {\n    return date.toISOString().split('T')[0] ?? '';\n  }\n\n  /**\n   * Crea una clave compuesta para identificar disponibilidad nica.\n   *\n   * @param participantId - ID del participante\n   * @param tripId - ID del viaje\n   * @param date - Fecha de disponibilidad\n   * @returns Clave compuesta nica\n   */\n  public static createCompositeKey(participantId: string, tripId: string, date: Date): string {\n    const dateStr = AvailabilityMapper.toDateOnlyString(date);\n    return `${participantId}:${tripId}:${dateStr}`;\n  }\n}\n","/**\n * @fileoverview Implementacin del repositorio de Availability usando IndexedDB/Dexie.\n *\n * Este repositorio implementa IAvailabilityRepository del dominio, proporcionando\n * persistencia de disponibilidades de participantes en IndexedDB a travs de\n * Dexie.js con manejo robusto de errores y documentacin completa.\n *\n * @module infrastructure/persistence/indexeddb/AvailabilityRepository\n * @version 1.0.0\n */\n\nimport type { IAvailabilityRepository, IAvailabilityQueryFilters, IAvailabilitySummary } from '@domain/interfaces/repositories/IAvailabilityRepository';\nimport type { Availability, IAvailabilityUpdateDTO } from '@domain/entities/Availability';\nimport type { IDateRange, MealType } from '@domain/types';\nimport { TripFoodDatabase, type AvailabilityRecord } from './database';\nimport { AvailabilityMapper, type AvailabilityProps } from '../mappers/AvailabilityMapper';\nimport { DatabaseError } from '../../errors/DatabaseError';\n\n/**\n * Repositorio de Availability implementado con IndexedDB a travs de Dexie.js.\n *\n * Proporciona operaciones CRUD completas para la entidad Availability,\n * con mtodos especficos para consultas por viaje, participante y fecha,\n * optimizados con ndices compuestos.\n *\n * @class IndexedDBAvailabilityRepository\n * @implements {IAvailabilityRepository}\n *\n * @example\n * ```typescript\n * const availabilityRepo = new IndexedDBAvailabilityRepository(database, availabilityFactory);\n *\n * // Registrar disponibilidad\n * const availability = Availability.create({\n *   participantId: 'part-1',\n *   tripId: 'trip-1',\n *   date: new Date('2025-07-15'),\n *   meals: ['breakfast', 'lunch', 'dinner']\n * });\n * await availabilityRepo.save(availability);\n *\n * // Obtener disponibilidad de un viaje en una fecha\n * const availabilities = await availabilityRepo.findByTripIdAndDate('trip-1', new Date());\n * ```\n */\nexport class IndexedDBAvailabilityRepository implements IAvailabilityRepository {\n  /**\n   * Instancia de la base de datos Dexie.\n   * @private\n   * @readonly\n   */\n  private readonly db: TripFoodDatabase;\n\n  /**\n   * Factory function para crear entidades Availability desde props.\n   * Se inyecta para mantener la separacin de capas.\n   * @private\n   * @readonly\n   */\n  private readonly availabilityFactory: (props: AvailabilityProps) => Availability;\n\n  /**\n   * Crea una nueva instancia del repositorio.\n   *\n   * @param database - Instancia de TripFoodDatabase\n   * @param availabilityFactory - Factory function para crear entidades Availability\n   */\n  constructor(\n    database: TripFoodDatabase,\n    availabilityFactory: (props: AvailabilityProps) => Availability\n  ) {\n    this.db = database;\n    this.availabilityFactory = availabilityFactory;\n  }\n\n  /**\n   * Busca una disponibilidad por su ID.\n   *\n   * @param id - ID nico de la disponibilidad\n   * @returns Promise con el Availability encontrado o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findById(id: string): Promise<Availability | null> {\n    try {\n      const record = await this.db.availabilities.get(id);\n\n      if (!record) {\n        return null;\n      }\n\n      const props = AvailabilityMapper.toDomainProps(record);\n      return this.availabilityFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'findById',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Obtiene todas las disponibilidades.\n   *\n   * @returns Promise con array de todas las Availability\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findAll(): Promise<Availability[]> {\n    try {\n      const records = await this.db.availabilities.toArray();\n      const propsList = AvailabilityMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.availabilityFactory(props));\n    } catch (error) {\n      throw new DatabaseError('findAll', 'availabilities', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Guarda una disponibilidad (crea nueva o actualiza existente).\n   *\n   * Utiliza put() de Dexie que hace upsert automtico basado en la PK.\n   *\n   * @param availability - Entidad Availability a guardar\n   * @returns Promise con el Availability guardado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async save(availability: Availability): Promise<Availability> {\n    try {\n      const record = AvailabilityMapper.toRecord(availability);\n      await this.db.availabilities.put(record);\n      return availability;\n    } catch (error) {\n      throw new DatabaseError(\n        'create',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        availability.id\n      );\n    }\n  }\n\n  /**\n   * Elimina una disponibilidad por su ID.\n   *\n   * @param id - ID de la disponibilidad a eliminar\n   * @returns Promise que resuelve cuando se completa la eliminacin\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async delete(id: string): Promise<void> {\n    try {\n      await this.db.availabilities.delete(id);\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Busca todas las disponibilidades de un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con array de Availability del viaje\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripId(tripId: string): Promise<Availability[]> {\n    try {\n      const records = await this.db.availabilities.where('tripId').equals(tripId).toArray();\n\n      const propsList = AvailabilityMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.availabilityFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        tripId\n      );\n    }\n  }\n\n  /**\n   * Busca todas las disponibilidades de un participante.\n   *\n   * @param participantId - ID del participante\n   * @returns Promise con array de Availability del participante\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByParticipantId(participantId: string): Promise<Availability[]> {\n    try {\n      const records = await this.db.availabilities\n        .where('participantId')\n        .equals(participantId)\n        .toArray();\n\n      const propsList = AvailabilityMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.availabilityFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        participantId\n      );\n    }\n  }\n\n  /**\n   * Busca disponibilidades de un viaje en una fecha especfica.\n   *\n   * Utiliza el ndice compuesto [tripId+date] para bsqueda eficiente.\n   *\n   * @param tripId - ID del viaje\n   * @param date - Fecha a buscar\n   * @returns Promise con array de Availability en esa fecha\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripIdAndDate(tripId: string, date: Date): Promise<Availability[]> {\n    try {\n      const dateStr = AvailabilityMapper.toDateOnlyString(date);\n\n      // Usar filtro para bsqueda por fecha (solo parte de fecha, sin hora)\n      const records = await this.db.availabilities\n        .where('tripId')\n        .equals(tripId)\n        .filter((record) => record.date.startsWith(dateStr))\n        .toArray();\n\n      const propsList = AvailabilityMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.availabilityFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        tripId\n      );\n    }\n  }\n\n  /**\n   * Busca la disponibilidad de un participante en una fecha especfica.\n   *\n   * Utiliza el ndice compuesto [participantId+date].\n   *\n   * @param participantId - ID del participante\n   * @param date - Fecha a buscar\n   * @returns Promise con el Availability encontrado o null\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByParticipantIdAndDate(\n    participantId: string,\n    date: Date\n  ): Promise<Availability | null> {\n    try {\n      const dateStr = AvailabilityMapper.toDateOnlyString(date);\n\n      const record = await this.db.availabilities\n        .where('participantId')\n        .equals(participantId)\n        .filter((r) => r.date.startsWith(dateStr))\n        .first();\n\n      if (!record) {\n        return null;\n      }\n\n      const props = AvailabilityMapper.toDomainProps(record);\n      return this.availabilityFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        participantId\n      );\n    }\n  }\n\n  /**\n   * Busca disponibilidad de un participante en un viaje especfico.\n   *\n   * @param participantId - ID del participante\n   * @param tripId - ID del viaje\n   * @returns Promise con array de Availability del participante en ese viaje\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByParticipantIdAndTripId(\n    participantId: string,\n    tripId: string\n  ): Promise<Availability[]> {\n    try {\n      const records = await this.db.availabilities\n        .where('[participantId+tripId]')\n        .equals([participantId, tripId])\n        .toArray();\n\n      const propsList = AvailabilityMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.availabilityFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'availabilities',\n        error instanceof Error ? error : undefined\n      );\n    }\n  }\n\n  /**\n   * Busca disponibilidades en un rango de fechas para un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @param dateRange - Rango de fechas (startDate, endDate)\n   * @returns Promise con array de Availability en el rango\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripIdAndDateRange(\n    tripId: string,\n    dateRange: IDateRange\n  ): Promise<Availability[]> {\n    try {\n      const startStr = dateRange.startDate.toISOString();\n      const endStr = dateRange.endDate.toISOString();\n\n      const records = await this.db.availabilities\n        .where('tripId')\n        .equals(tripId)\n        .filter((record) => record.date >= startStr && record.date <= endStr)\n        .toArray();\n\n      const propsList = AvailabilityMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.availabilityFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'availabilities',\n        error instanceof Error ? error : undefined\n      );\n    }\n  }\n\n  /**\n   * Busca participantes disponibles para una comida especfica en una fecha.\n   *\n   * @param tripId - ID del viaje\n   * @param date - Fecha a buscar\n   * @param meal - Tipo de comida\n   * @returns Promise con array de Availability que incluyen esa comida\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByTripIdDateAndMeal(\n    tripId: string,\n    date: Date,\n    meal: MealType\n  ): Promise<Availability[]> {\n    try {\n      const dateStr = AvailabilityMapper.toDateOnlyString(date);\n\n      const records = await this.db.availabilities\n        .where('tripId')\n        .equals(tripId)\n        .filter((record) => record.date.startsWith(dateStr) && record.meals.includes(meal))\n        .toArray();\n\n      const propsList = AvailabilityMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.availabilityFactory(props));\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'availabilities',\n        error instanceof Error ? error : undefined\n      );\n    }\n  }\n\n  /**\n   * Verifica si existe una disponibilidad con el ID dado.\n   *\n   * @param id - ID a verificar\n   * @returns Promise que resuelve a true si existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async exists(id: string): Promise<boolean> {\n    try {\n      const count = await this.db.availabilities.where('id').equals(id).count();\n      return count > 0;\n    } catch (error) {\n      throw new DatabaseError(\n        'find',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Actualiza una disponibilidad existente.\n   *\n   * @param entity - Entidad Availability con los datos actualizados\n   * @returns Promise con el Availability actualizado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async update(entity: Availability): Promise<Availability> {\n    try {\n      const record = AvailabilityMapper.toRecord(entity);\n      await this.db.availabilities.put(record);\n      return entity;\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        entity.id\n      );\n    }\n  }\n\n  /**\n   * Actualiza las comidas de una disponibilidad existente.\n   *\n   * @param id - ID de la disponibilidad\n   * @param meals - Nuevo array de comidas\n   * @returns Promise con el Availability actualizado o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async updateMeals(id: string, meals: MealType[]): Promise<Availability | null> {\n    try {\n      const existingRecord = await this.db.availabilities.get(id);\n\n      if (!existingRecord) {\n        return null;\n      }\n\n      const updatedRecord: AvailabilityRecord = {\n        ...existingRecord,\n        meals,\n      };\n\n      await this.db.availabilities.put(updatedRecord);\n\n      const props = AvailabilityMapper.toDomainProps(updatedRecord);\n      return this.availabilityFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Elimina todas las disponibilidades de un participante.\n   *\n   * til para limpieza en cascada cuando se elimina un participante.\n   *\n   * @param participantId - ID del participante\n   * @returns Promise con el nmero de registros eliminados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteByParticipantId(participantId: string): Promise<number> {\n    try {\n      return await this.db.availabilities.where('participantId').equals(participantId).delete();\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        participantId\n      );\n    }\n  }\n\n  /**\n   * Elimina todas las disponibilidades de un viaje.\n   *\n   * til para limpieza en cascada cuando se elimina un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con el nmero de registros eliminados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteByTripId(tripId: string): Promise<number> {\n    try {\n      return await this.db.availabilities.where('tripId').equals(tripId).delete();\n    } catch (error) {\n      throw new DatabaseError(\n        'delete',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        tripId\n      );\n    }\n  }\n\n  /**\n   * Cuenta el nmero total de disponibilidades.\n   *\n   * @returns Promise con el conteo total\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async count(): Promise<number> {\n    try {\n      return await this.db.availabilities.count();\n    } catch (error) {\n      throw new DatabaseError('count', 'availabilities', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Cuenta disponibilidades por viaje.\n   *\n   * @param tripId - ID del viaje\n   * @returns Promise con el conteo\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async countByTripId(tripId: string): Promise<number> {\n    try {\n      return await this.db.availabilities.where('tripId').equals(tripId).count();\n    } catch (error) {\n      throw new DatabaseError('count', 'availabilities', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Cuenta disponibilidades por participante.\n   *\n   * @param participantId - ID del participante\n   * @returns Promise con el conteo\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async countByParticipantId(participantId: string): Promise<number> {\n    try {\n      return await this.db.availabilities.where('participantId').equals(participantId).count();\n    } catch (error) {\n      throw new DatabaseError('count', 'availabilities', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Elimina mltiples disponibilidades por sus IDs.\n   *\n   * @param ids - Array de IDs a eliminar\n   * @returns Promise que resuelve cuando se completa la eliminacin\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async deleteMany(ids: string[]): Promise<void> {\n    try {\n      await this.db.availabilities.bulkDelete(ids);\n    } catch (error) {\n      throw new DatabaseError('delete', 'availabilities', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Guarda mltiples disponibilidades en una sola transaccin.\n   *\n   * @param availabilities - Array de entidades Availability a guardar\n   * @returns Promise con el array de Availability guardados\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async saveMany(availabilities: Availability[]): Promise<Availability[]> {\n    try {\n      const records = AvailabilityMapper.toRecordList(availabilities);\n      await this.db.availabilities.bulkPut(records);\n      return availabilities;\n    } catch (error) {\n      throw new DatabaseError('create', 'availabilities', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Crea o actualiza la disponibilidad de un participante para una fecha.\n   *\n   * Si ya existe una disponibilidad para esa combinacin participante+viaje+fecha,\n   * la actualiza. Si no, crea una nueva.\n   *\n   * @param availability - Entidad Availability a guardar/actualizar\n   * @returns Promise con el Availability guardado/actualizado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async upsertByParticipantAndDate(availability: Availability): Promise<Availability> {\n    try {\n      const existing = await this.findByParticipantIdAndDate(\n        availability.participantId,\n        availability.date\n      );\n\n      if (existing) {\n        // Actualizar existente\n        await this.updateMeals(existing.id, [...availability.meals]);\n        return availability;\n      }\n\n      // Crear nuevo\n      return this.save(availability);\n    } catch (error) {\n      throw new DatabaseError(\n        'create',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        availability.id\n      );\n    }\n  }\n\n  /**\n   * Crea o actualiza una disponibilidad (mtodo upsert).\n   *\n   * @param availability - Entidad Availability a guardar/actualizar\n   * @returns Promise con el Availability guardado/actualizado\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async upsert(availability: Availability): Promise<Availability> {\n    return this.upsertByParticipantAndDate(availability);\n  }\n\n  /**\n   * Busca disponibilidad de un participante en un viaje y fecha especficos.\n   *\n   * @param participantId - ID del participante\n   * @param tripId - ID del viaje\n   * @param date - Fecha a buscar\n   * @returns Promise con el Availability encontrado o null\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findByParticipantTripAndDate(\n    participantId: string,\n    tripId: string,\n    date: Date\n  ): Promise<Availability | null> {\n    try {\n      const dateStr = AvailabilityMapper.toDateOnlyString(date);\n\n      const record = await this.db.availabilities\n        .where('[participantId+tripId]')\n        .equals([participantId, tripId])\n        .filter((r) => r.date.startsWith(dateStr))\n        .first();\n\n      if (!record) {\n        return null;\n      }\n\n      const props = AvailabilityMapper.toDomainProps(record);\n      return this.availabilityFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'findByIndex',\n        'availabilities',\n        error instanceof Error ? error : undefined\n      );\n    }\n  }\n\n  /**\n   * Actualiza parcialmente una disponibilidad con los campos proporcionados.\n   *\n   * @param id - ID de la disponibilidad a actualizar\n   * @param updates - Campos a actualizar\n   * @returns Promise con la disponibilidad actualizada o null si no existe\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async partialUpdate(id: string, updates: IAvailabilityUpdateDTO): Promise<Availability | null> {\n    try {\n      const existingRecord = await this.db.availabilities.get(id);\n\n      if (!existingRecord) {\n        return null;\n      }\n\n      const updatedRecord: AvailabilityRecord = {\n        ...existingRecord,\n        ...(updates.date !== undefined && { date: updates.date.toISOString() }),\n        ...(updates.meals !== undefined && { meals: [...updates.meals] }),\n      };\n\n      await this.db.availabilities.put(updatedRecord);\n\n      const props = AvailabilityMapper.toDomainProps(updatedRecord);\n      return this.availabilityFactory(props);\n    } catch (error) {\n      throw new DatabaseError(\n        'update',\n        'availabilities',\n        error instanceof Error ? error : undefined,\n        id\n      );\n    }\n  }\n\n  /**\n   * Encuentra disponibilidades usando filtros complejos.\n   *\n   * @param filters - Criterios de filtrado\n   * @returns Promise con array de disponibilidades que coinciden\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async findWithFilters(filters: IAvailabilityQueryFilters): Promise<Availability[]> {\n    try {\n      let records = await this.db.availabilities.toArray();\n\n      // Filtrar por tripId\n      if (filters.tripId) {\n        records = records.filter((a) => a.tripId === filters.tripId);\n      }\n\n      // Filtrar por participantId\n      if (filters.participantId) {\n        records = records.filter((a) => a.participantId === filters.participantId);\n      }\n\n      // Filtrar por fecha\n      if (filters.date) {\n        const dateStr = AvailabilityMapper.toDateOnlyString(filters.date);\n        records = records.filter((a) => a.date.startsWith(dateStr));\n      }\n\n      // Filtrar por rango de fechas\n      if (filters.dateRange) {\n        const startStr = filters.dateRange.startDate.toISOString();\n        const endStr = filters.dateRange.endDate.toISOString();\n        records = records.filter((a) => a.date >= startStr && a.date <= endStr);\n      }\n\n      // Filtrar por meal disponible\n      if (filters.meal) {\n        records = records.filter((a) => a.meals.includes(filters.meal!));\n      }\n\n      const propsList = AvailabilityMapper.toDomainPropsList(records);\n      return propsList.map((props) => this.availabilityFactory(props));\n    } catch (error) {\n      throw new DatabaseError('find', 'availabilities', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Obtiene un resumen de disponibilidad por fecha para un viaje.\n   *\n   * @param tripId - ID del viaje\n   * @param date - Fecha a consultar\n   * @returns Promise con array de resmenes por comida\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async getSummaryByDate(tripId: string, date: Date): Promise<IAvailabilitySummary[]> {\n    try {\n      const dateStr = AvailabilityMapper.toDateOnlyString(date);\n\n      const records = await this.db.availabilities\n        .where('tripId')\n        .equals(tripId)\n        .filter((r) => r.date.startsWith(dateStr))\n        .toArray();\n\n      // Crear resumen para cada tipo de comida\n      const mealTypes: MealType[] = ['breakfast', 'lunch', 'dinner', 'snack'];\n      const summaries: IAvailabilitySummary[] = [];\n\n      for (const meal of mealTypes) {\n        const availableRecords = records.filter((r) => r.meals.includes(meal));\n        summaries.push({\n          date: new Date(date),\n          meal,\n          availableCount: availableRecords.length,\n          participantIds: availableRecords.map((r) => r.participantId),\n        });\n      }\n\n      return summaries;\n    } catch (error) {\n      throw new DatabaseError('find', 'availabilities', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Cuenta el nmero de participantes disponibles para una comida especfica.\n   *\n   * @param tripId - ID del viaje\n   * @param date - Fecha a consultar\n   * @param meal - Tipo de comida\n   * @returns Promise con el conteo de participantes disponibles\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async countAvailableForMeal(tripId: string, date: Date, meal: MealType): Promise<number> {\n    try {\n      const dateStr = AvailabilityMapper.toDateOnlyString(date);\n\n      const count = await this.db.availabilities\n        .where('tripId')\n        .equals(tripId)\n        .filter((r) => r.date.startsWith(dateStr) && r.meals.includes(meal))\n        .count();\n\n      return count;\n    } catch (error) {\n      throw new DatabaseError('count', 'availabilities', error instanceof Error ? error : undefined);\n    }\n  }\n\n  /**\n   * Obtiene los IDs de participantes disponibles para una comida especfica.\n   *\n   * @param tripId - ID del viaje\n   * @param date - Fecha a consultar\n   * @param meal - Tipo de comida\n   * @returns Promise con array de IDs de participantes\n   * @throws {DatabaseError} Si ocurre un error de base de datos\n   */\n  public async getParticipantsAvailableForMeal(\n    tripId: string,\n    date: Date,\n    meal: MealType\n  ): Promise<string[]> {\n    try {\n      const dateStr = AvailabilityMapper.toDateOnlyString(date);\n\n      const records = await this.db.availabilities\n        .where('tripId')\n        .equals(tripId)\n        .filter((r) => r.date.startsWith(dateStr) && r.meals.includes(meal))\n        .toArray();\n\n      return records.map((r) => r.participantId);\n    } catch (error) {\n      throw new DatabaseError('find', 'availabilities', error instanceof Error ? error : undefined);\n    }\n  }\n}\n","import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n","let getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n    if (!getRandomValues) {\n        if (typeof crypto === 'undefined' || !crypto.getRandomValues) {\n            throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n        }\n        getRandomValues = crypto.getRandomValues.bind(crypto);\n    }\n    return getRandomValues(rnds8);\n}\n","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default { randomUUID };\n","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nexport default v4;\n","/**\n * @fileoverview Base domain error class for TripFood Manager.\n * Provides a foundation for all domain-specific errors with proper\n * error hierarchy and serialization capabilities.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\n/**\n * Error codes for domain errors.\n * These codes help identify the type of error programmatically.\n */\nexport enum DomainErrorCode {\n  /** Generic domain error */\n  DOMAIN_ERROR = 'DOMAIN_ERROR',\n  /** Validation failed */\n  VALIDATION_ERROR = 'VALIDATION_ERROR',\n  /** Entity not found */\n  NOT_FOUND_ERROR = 'NOT_FOUND_ERROR',\n  /** Duplicate entity */\n  DUPLICATE_ERROR = 'DUPLICATE_ERROR',\n  /** Business rule violation */\n  BUSINESS_RULE_ERROR = 'BUSINESS_RULE_ERROR',\n  /** Invalid operation */\n  INVALID_OPERATION_ERROR = 'INVALID_OPERATION_ERROR',\n}\n\n/**\n * Interface for serialized domain error representation.\n * Used for logging, API responses, and error transmission.\n */\nexport interface ISerializedDomainError {\n  /** Error name/type */\n  readonly name: string;\n  /** Error code for programmatic handling */\n  readonly code: DomainErrorCode;\n  /** Human-readable error message */\n  readonly message: string;\n  /** Optional details about the error */\n  readonly details?: Record<string, unknown>;\n  /** Timestamp when the error occurred */\n  readonly timestamp: string;\n  /** Stack trace (only in development) */\n  readonly stack?: string;\n}\n\n/**\n * Base class for all domain-specific errors in TripFood Manager.\n *\n * @description\n * This class extends the native Error class and provides additional\n * functionality specific to domain errors:\n * - Error codes for programmatic handling\n * - Detailed error information\n * - Serialization for logging and API responses\n * - Proper prototype chain maintenance\n *\n * @example\n * ```typescript\n * throw new DomainError('Something went wrong in the domain', DomainErrorCode.DOMAIN_ERROR);\n * ```\n *\n * @extends Error\n */\nexport class DomainError extends Error {\n  /**\n   * Error code identifying the type of domain error.\n   * @readonly\n   */\n  public readonly code: DomainErrorCode;\n\n  /**\n   * Additional details about the error.\n   * Can contain any relevant information for debugging.\n   * @readonly\n   */\n  public readonly details?: Record<string, unknown> | undefined;\n\n  /**\n   * Timestamp when the error was created.\n   * @readonly\n   */\n  public readonly timestamp: Date;\n\n  /**\n   * Creates a new DomainError instance.\n   *\n   * @param message - Human-readable error message\n   * @param code - Error code for programmatic handling (defaults to DOMAIN_ERROR)\n   * @param details - Optional additional details about the error\n   */\n  constructor(\n    message: string,\n    code: DomainErrorCode = DomainErrorCode.DOMAIN_ERROR,\n    details?: Record<string, unknown>\n  ) {\n    super(message);\n\n    // Maintain proper prototype chain for instanceof checks\n    Object.setPrototypeOf(this, new.target.prototype);\n\n    this.name = this.constructor.name;\n    this.code = code;\n    this.details = details;\n    this.timestamp = new Date();\n\n    // Capture stack trace, excluding constructor call from it\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, this.constructor);\n    }\n  }\n\n  /**\n   * Serializes the error to a plain object for logging or API responses.\n   *\n   * @param includeStack - Whether to include the stack trace (default: false)\n   * @returns Serialized error object\n   *\n   * @example\n   * ```typescript\n   * const error = new DomainError('Test error');\n   * console.log(JSON.stringify(error.toJSON()));\n   * ```\n   */\n  public toJSON(includeStack: boolean = false): ISerializedDomainError {\n    const serialized: ISerializedDomainError = {\n      name: this.name,\n      code: this.code,\n      message: this.message,\n      timestamp: this.timestamp.toISOString(),\n    };\n\n    if (this.details !== undefined) {\n      return { ...serialized, details: this.details };\n    }\n\n    if (includeStack && this.stack) {\n      return { ...serialized, stack: this.stack };\n    }\n\n    return serialized;\n  }\n\n  /**\n   * Creates a string representation of the error.\n   *\n   * @returns Formatted error string\n   */\n  public override toString(): string {\n    const baseString = `${this.name} [${this.code}]: ${this.message}`;\n\n    if (this.details) {\n      return `${baseString}\\nDetails: ${JSON.stringify(this.details, null, 2)}`;\n    }\n\n    return baseString;\n  }\n\n  /**\n   * Type guard to check if an error is a DomainError.\n   *\n   * @param error - The error to check\n   * @returns True if the error is a DomainError instance\n   *\n   * @example\n   * ```typescript\n   * try {\n   *   // some operation\n   * } catch (error) {\n   *   if (DomainError.isDomainError(error)) {\n   *     console.log(error.code);\n   *   }\n   * }\n   * ```\n   */\n  public static isDomainError(error: unknown): error is DomainError {\n    return error instanceof DomainError;\n  }\n}\n","/**\n * @fileoverview Validation error class for TripFood Manager.\n * Used when entity or value object validation fails.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\nimport { DomainError, DomainErrorCode } from './DomainError';\n\n/**\n * Represents a single validation failure.\n */\nexport interface IValidationFailure {\n  /** The field or property that failed validation */\n  readonly field: string;\n  /** The validation rule that was violated */\n  readonly rule: string;\n  /** Human-readable message describing the failure */\n  readonly message: string;\n  /** The actual value that failed validation (optional for security) */\n  readonly value?: unknown;\n}\n\n/**\n * Error thrown when validation of domain entities or value objects fails.\n *\n * @description\n * This error is used to communicate validation failures in a structured way.\n * It supports multiple validation failures and provides detailed information\n * about each failure for proper error handling and user feedback.\n *\n * @example\n * ```typescript\n * // Single validation failure\n * throw new ValidationError('Trip name is required', 'name', 'required');\n *\n * // Multiple validation failures\n * throw ValidationError.fromFailures([\n *   { field: 'name', rule: 'required', message: 'Name is required' },\n *   { field: 'startDate', rule: 'future', message: 'Start date must be in the future' }\n * ]);\n * ```\n *\n * @extends DomainError\n */\nexport class ValidationError extends DomainError {\n  /**\n   * The field that failed validation (for single-field errors).\n   * @readonly\n   */\n  public readonly field?: string | undefined;\n\n  /**\n   * The validation rule that was violated.\n   * @readonly\n   */\n  public readonly rule?: string | undefined;\n\n  /**\n   * Array of all validation failures (for multi-field validation).\n   * @readonly\n   */\n  public readonly failures: ReadonlyArray<IValidationFailure>;\n\n  /**\n   * Creates a new ValidationError instance.\n   *\n   * @param message - Human-readable error message\n   * @param field - The field that failed validation (optional)\n   * @param rule - The validation rule that was violated (optional)\n   * @param value - The value that failed validation (optional)\n   */\n  constructor(\n    message: string,\n    field?: string,\n    rule?: string,\n    value?: unknown\n  ) {\n    const details: Record<string, unknown> = {};\n\n    if (field !== undefined) {\n      details['field'] = field;\n    }\n    if (rule !== undefined) {\n      details['rule'] = rule;\n    }\n    if (value !== undefined) {\n      details['value'] = value;\n    }\n\n    super(\n      message,\n      DomainErrorCode.VALIDATION_ERROR,\n      Object.keys(details).length > 0 ? details : undefined\n    );\n\n    this.field = field;\n    this.rule = rule;\n\n    // Create failures array from single field error\n    if (field && rule) {\n      this.failures = [\n        {\n          field,\n          rule,\n          message,\n          value,\n        },\n      ];\n    } else {\n      this.failures = [];\n    }\n  }\n\n  /**\n   * Creates a ValidationError from multiple validation failures.\n   *\n   * @param failures - Array of validation failures\n   * @returns A new ValidationError instance containing all failures\n   *\n   * @example\n   * ```typescript\n   * const errors = ValidationError.fromFailures([\n   *   { field: 'name', rule: 'required', message: 'Name is required' },\n   *   { field: 'email', rule: 'format', message: 'Invalid email format' }\n   * ]);\n   * ```\n   */\n  public static fromFailures(\n    failures: ReadonlyArray<IValidationFailure>\n  ): ValidationError {\n    if (failures.length === 0) {\n      return new ValidationError('Validation failed with no specific errors');\n    }\n\n    if (failures.length === 1) {\n      const failure = failures[0]!;\n      return new ValidationError(\n        failure.message,\n        failure.field,\n        failure.rule,\n        failure.value\n      );\n    }\n\n    const message = `Validation failed with ${failures.length} errors: ${failures\n      .map((f) => f.message)\n      .join('; ')}`;\n\n    const error = new ValidationError(message);\n\n    // Override the readonly failures array using Object.defineProperty\n    Object.defineProperty(error, 'failures', {\n      value: failures,\n      writable: false,\n      enumerable: true,\n      configurable: false,\n    });\n\n    return error;\n  }\n\n  /**\n   * Creates a ValidationError for a required field.\n   *\n   * @param fieldName - Name of the required field\n   * @param entityName - Name of the entity (optional, for context)\n   * @returns A new ValidationError instance\n   *\n   * @example\n   * ```typescript\n   * throw ValidationError.required('name', 'Trip');\n   * // Message: \"Trip name is required\"\n   * ```\n   */\n  public static required(fieldName: string, entityName?: string): ValidationError {\n    const prefix = entityName ? `${entityName} ` : '';\n    return new ValidationError(\n      `${prefix}${fieldName} is required`,\n      fieldName,\n      'required'\n    );\n  }\n\n  /**\n   * Creates a ValidationError for an invalid format.\n   *\n   * @param fieldName - Name of the field with invalid format\n   * @param expectedFormat - Description of the expected format\n   * @param actualValue - The actual value that was provided (optional)\n   * @returns A new ValidationError instance\n   *\n   * @example\n   * ```typescript\n   * throw ValidationError.invalidFormat('email', 'valid email address');\n   * ```\n   */\n  public static invalidFormat(\n    fieldName: string,\n    expectedFormat: string,\n    actualValue?: unknown\n  ): ValidationError {\n    return new ValidationError(\n      `${fieldName} must be a ${expectedFormat}`,\n      fieldName,\n      'format',\n      actualValue\n    );\n  }\n\n  /**\n   * Creates a ValidationError for a value out of range.\n   *\n   * @param fieldName - Name of the field\n   * @param min - Minimum allowed value (optional)\n   * @param max - Maximum allowed value (optional)\n   * @param actualValue - The actual value that was provided (optional)\n   * @returns A new ValidationError instance\n   *\n   * @example\n   * ```typescript\n   * throw ValidationError.outOfRange('quantity', 1, 100, 0);\n   * ```\n   */\n  public static outOfRange(\n    fieldName: string,\n    min?: number,\n    max?: number,\n    actualValue?: unknown\n  ): ValidationError {\n    let message: string;\n\n    if (min !== undefined && max !== undefined) {\n      message = `${fieldName} must be between ${min} and ${max}`;\n    } else if (min !== undefined) {\n      message = `${fieldName} must be at least ${min}`;\n    } else if (max !== undefined) {\n      message = `${fieldName} must be at most ${max}`;\n    } else {\n      message = `${fieldName} is out of range`;\n    }\n\n    return new ValidationError(message, fieldName, 'range', actualValue);\n  }\n\n  /**\n   * Creates a ValidationError for invalid length.\n   *\n   * @param fieldName - Name of the field\n   * @param minLength - Minimum length (optional)\n   * @param maxLength - Maximum length (optional)\n   * @param actualLength - The actual length (optional)\n   * @returns A new ValidationError instance\n   */\n  public static invalidLength(\n    fieldName: string,\n    minLength?: number,\n    maxLength?: number,\n    actualLength?: number\n  ): ValidationError {\n    let message: string;\n\n    if (minLength !== undefined && maxLength !== undefined) {\n      message = `${fieldName} must be between ${minLength} and ${maxLength} characters`;\n    } else if (minLength !== undefined) {\n      message = `${fieldName} must be at least ${minLength} characters`;\n    } else if (maxLength !== undefined) {\n      message = `${fieldName} must be at most ${maxLength} characters`;\n    } else {\n      message = `${fieldName} has invalid length`;\n    }\n\n    return new ValidationError(message, fieldName, 'length', actualLength);\n  }\n\n  /**\n   * Creates a ValidationError for an invalid date range.\n   *\n   * @param startFieldName - Name of the start date field\n   * @param endFieldName - Name of the end date field\n   * @returns A new ValidationError instance\n   */\n  public static invalidDateRange(\n    startFieldName: string,\n    endFieldName: string\n  ): ValidationError {\n    return new ValidationError(\n      `${startFieldName} must be before ${endFieldName}`,\n      `${startFieldName}_${endFieldName}`,\n      'dateRange'\n    );\n  }\n\n  /**\n   * Checks if this error has multiple validation failures.\n   *\n   * @returns True if there are multiple failures\n   */\n  public hasMultipleFailures(): boolean {\n    return this.failures.length > 1;\n  }\n\n  /**\n   * Gets all fields that have validation errors.\n   *\n   * @returns Array of field names with errors\n   */\n  public getFailedFields(): ReadonlyArray<string> {\n    return this.failures.map((f) => f.field);\n  }\n\n  /**\n   * Type guard to check if an error is a ValidationError.\n   *\n   * @param error - The error to check\n   * @returns True if the error is a ValidationError instance\n   */\n  public static isValidationError(error: unknown): error is ValidationError {\n    return error instanceof ValidationError;\n  }\n}\n","/**\n * @fileoverview Not found error class for TripFood Manager.\n * Used when a requested entity cannot be found in the repository.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\nimport { DomainError, DomainErrorCode } from './DomainError';\n\n/**\n * Error thrown when a requested entity cannot be found.\n *\n * @description\n * This error is used when attempting to retrieve, update, or delete\n * an entity that does not exist in the repository. It provides\n * context about which entity type and identifier were requested.\n *\n * @example\n * ```typescript\n * // Basic usage\n * throw new NotFoundError('Trip', 'abc-123');\n *\n * // Using factory method\n * throw NotFoundError.forEntity('Participant', 'participant-456');\n *\n * // For queries\n * throw NotFoundError.forQuery('Trip', { status: 'active', ownerId: 'user-123' });\n * ```\n *\n * @extends DomainError\n */\nexport class NotFoundError extends DomainError {\n  /**\n   * The type of entity that was not found.\n   * @readonly\n   */\n  public readonly entityType: string;\n\n  /**\n   * The identifier used to search for the entity.\n   * @readonly\n   */\n  public readonly entityId?: string | undefined;\n\n  /**\n   * The search criteria used when querying (for multi-criteria searches).\n   * @readonly\n   */\n  public readonly searchCriteria?: Record<string, unknown> | undefined;\n\n  /**\n   * Creates a new NotFoundError instance.\n   *\n   * @param entityType - The type of entity that was not found (e.g., 'Trip', 'Participant')\n   * @param entityId - The identifier of the entity that was searched for (optional)\n   * @param searchCriteria - Search criteria used when querying (optional)\n   */\n  constructor(\n    entityType: string,\n    entityId?: string,\n    searchCriteria?: Record<string, unknown>\n  ) {\n    const message = NotFoundError.buildMessage(entityType, entityId, searchCriteria);\n\n    const details: Record<string, unknown> = {\n      entityType,\n    };\n\n    if (entityId !== undefined) {\n      details['entityId'] = entityId;\n    }\n\n    if (searchCriteria !== undefined) {\n      details['searchCriteria'] = searchCriteria;\n    }\n\n    super(message, DomainErrorCode.NOT_FOUND_ERROR, details);\n\n    this.entityType = entityType;\n    this.entityId = entityId;\n    this.searchCriteria = searchCriteria;\n  }\n\n  /**\n   * Builds the error message based on provided parameters.\n   *\n   * @param entityType - The type of entity\n   * @param entityId - The entity identifier (optional)\n   * @param searchCriteria - Search criteria (optional)\n   * @returns Formatted error message\n   */\n  private static buildMessage(\n    entityType: string,\n    entityId?: string,\n    searchCriteria?: Record<string, unknown>\n  ): string {\n    if (entityId !== undefined) {\n      return `${entityType} with ID '${entityId}' was not found`;\n    }\n\n    if (searchCriteria !== undefined) {\n      const criteriaString = Object.entries(searchCriteria)\n        .map(([key, value]) => `${key}=${JSON.stringify(value)}`)\n        .join(', ');\n      return `${entityType} matching criteria {${criteriaString}} was not found`;\n    }\n\n    return `${entityType} was not found`;\n  }\n\n  /**\n   * Creates a NotFoundError for an entity with a specific ID.\n   *\n   * @param entityType - The type of entity\n   * @param entityId - The entity identifier\n   * @returns A new NotFoundError instance\n   *\n   * @example\n   * ```typescript\n   * throw NotFoundError.forEntity('Trip', 'trip-123');\n   * // Message: \"Trip with ID 'trip-123' was not found\"\n   * ```\n   */\n  public static forEntity(entityType: string, entityId: string): NotFoundError {\n    return new NotFoundError(entityType, entityId);\n  }\n\n  /**\n   * Creates a NotFoundError for an entity with a specific ID.\n   * Alias for forEntity method.\n   *\n   * @param entityType - The type of entity\n   * @param entityId - The entity identifier\n   * @returns A new NotFoundError instance\n   *\n   * @example\n   * ```typescript\n   * throw NotFoundError.withId('Trip', 'trip-123');\n   * // Message: \"Trip with ID 'trip-123' was not found\"\n   * ```\n   */\n  public static withId(entityType: string, entityId: string): NotFoundError {\n    return NotFoundError.forEntity(entityType, entityId);\n  }\n\n  /**\n   * Creates a NotFoundError for a query that returned no results.\n   *\n   * @param entityType - The type of entity\n   * @param searchCriteria - The search criteria used\n   * @returns A new NotFoundError instance\n   *\n   * @example\n   * ```typescript\n   * throw NotFoundError.forQuery('Participant', { tripId: 'trip-123', email: 'test@example.com' });\n   * // Message: \"Participant matching criteria {tripId=\"trip-123\", email=\"test@example.com\"} was not found\"\n   * ```\n   */\n  public static forQuery(\n    entityType: string,\n    searchCriteria: Record<string, unknown>\n  ): NotFoundError {\n    return new NotFoundError(entityType, undefined, searchCriteria);\n  }\n\n  /**\n   * Creates a NotFoundError for a Trip entity.\n   *\n   * @param tripId - The trip identifier\n   * @returns A new NotFoundError instance\n   */\n  public static tripNotFound(tripId: string): NotFoundError {\n    return NotFoundError.forEntity('Trip', tripId);\n  }\n\n  /**\n   * Creates a NotFoundError for a Participant entity.\n   *\n   * @param participantId - The participant identifier\n   * @returns A new NotFoundError instance\n   */\n  public static participantNotFound(participantId: string): NotFoundError {\n    return NotFoundError.forEntity('Participant', participantId);\n  }\n\n  /**\n   * Creates a NotFoundError for a Product entity.\n   *\n   * @param productId - The product identifier\n   * @returns A new NotFoundError instance\n   */\n  public static productNotFound(productId: string): NotFoundError {\n    return NotFoundError.forEntity('Product', productId);\n  }\n\n  /**\n   * Creates a NotFoundError for a Consumption entity.\n   *\n   * @param consumptionId - The consumption identifier\n   * @returns A new NotFoundError instance\n   */\n  public static consumptionNotFound(consumptionId: string): NotFoundError {\n    return NotFoundError.forEntity('Consumption', consumptionId);\n  }\n\n  /**\n   * Creates a NotFoundError for an Availability entity.\n   *\n   * @param availabilityId - The availability identifier\n   * @returns A new NotFoundError instance\n   */\n  public static availabilityNotFound(availabilityId: string): NotFoundError {\n    return NotFoundError.forEntity('Availability', availabilityId);\n  }\n\n  /**\n   * Type guard to check if an error is a NotFoundError.\n   *\n   * @param error - The error to check\n   * @returns True if the error is a NotFoundError instance\n   */\n  public static isNotFoundError(error: unknown): error is NotFoundError {\n    return error instanceof NotFoundError;\n  }\n}\n","/**\n * @fileoverview Duplicate error class for TripFood Manager.\n * Used when attempting to create an entity that already exists.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\nimport { DomainError, DomainErrorCode } from './DomainError';\n\n/**\n * Error thrown when attempting to create a duplicate entity.\n *\n * @description\n * This error is used when trying to create an entity that violates\n * uniqueness constraints, such as:\n * - Same ID already exists\n * - Same natural key (e.g., email, name + tripId combination)\n * - Other business uniqueness rules\n *\n * @example\n * ```typescript\n * // Duplicate by ID\n * throw new DuplicateError('Trip', 'id', 'trip-123');\n *\n * // Duplicate by natural key\n * throw DuplicateError.forField('Participant', 'email', 'john@example.com');\n *\n * // Duplicate by composite key\n * throw DuplicateError.forCompositeKey('Consumption', {\n *   participantId: 'p-1',\n *   productId: 'prod-1',\n *   date: '2024-01-15'\n * });\n * ```\n *\n * @extends DomainError\n */\nexport class DuplicateError extends DomainError {\n  /**\n   * The type of entity that is duplicated.\n   * @readonly\n   */\n  public readonly entityType: string;\n\n  /**\n   * The field that caused the duplication.\n   * @readonly\n   */\n  public readonly field?: string | undefined;\n\n  /**\n   * The value that is duplicated.\n   * @readonly\n   */\n  public readonly duplicateValue?: unknown | undefined;\n\n  /**\n   * Composite key values that caused the duplication.\n   * @readonly\n   */\n  public readonly compositeKey?: Record<string, unknown> | undefined;\n\n  /**\n   * Creates a new DuplicateError instance.\n   *\n   * @param entityType - The type of entity that is duplicated\n   * @param field - The field that caused the duplication (optional)\n   * @param duplicateValue - The duplicated value (optional)\n   * @param compositeKey - Composite key values (optional)\n   */\n  constructor(\n    entityType: string,\n    field?: string,\n    duplicateValue?: unknown,\n    compositeKey?: Record<string, unknown>\n  ) {\n    const message = DuplicateError.buildMessage(\n      entityType,\n      field,\n      duplicateValue,\n      compositeKey\n    );\n\n    const details: Record<string, unknown> = {\n      entityType,\n    };\n\n    if (field !== undefined) {\n      details['field'] = field;\n    }\n\n    if (duplicateValue !== undefined) {\n      details['duplicateValue'] = duplicateValue;\n    }\n\n    if (compositeKey !== undefined) {\n      details['compositeKey'] = compositeKey;\n    }\n\n    super(message, DomainErrorCode.DUPLICATE_ERROR, details);\n\n    this.entityType = entityType;\n    this.field = field;\n    this.duplicateValue = duplicateValue;\n    this.compositeKey = compositeKey;\n  }\n\n  /**\n   * Builds the error message based on provided parameters.\n   *\n   * @param entityType - The type of entity\n   * @param field - The field that caused the duplication (optional)\n   * @param duplicateValue - The duplicated value (optional)\n   * @param compositeKey - Composite key values (optional)\n   * @returns Formatted error message\n   */\n  private static buildMessage(\n    entityType: string,\n    field?: string,\n    duplicateValue?: unknown,\n    compositeKey?: Record<string, unknown>\n  ): string {\n    if (compositeKey !== undefined) {\n      const keyString = Object.entries(compositeKey)\n        .map(([key, value]) => `${key}=${JSON.stringify(value)}`)\n        .join(', ');\n      return `${entityType} with composite key {${keyString}} already exists`;\n    }\n\n    if (field !== undefined && duplicateValue !== undefined) {\n      return `${entityType} with ${field} '${String(duplicateValue)}' already exists`;\n    }\n\n    if (field !== undefined) {\n      return `${entityType} with duplicate ${field} already exists`;\n    }\n\n    return `${entityType} already exists`;\n  }\n\n  /**\n   * Creates a DuplicateError for a specific field value.\n   *\n   * @param entityType - The type of entity\n   * @param field - The field name\n   * @param value - The duplicate value\n   * @returns A new DuplicateError instance\n   *\n   * @example\n   * ```typescript\n   * throw DuplicateError.forField('Participant', 'email', 'john@example.com');\n   * // Message: \"Participant with email 'john@example.com' already exists\"\n   * ```\n   */\n  public static forField(\n    entityType: string,\n    field: string,\n    value: unknown\n  ): DuplicateError {\n    return new DuplicateError(entityType, field, value);\n  }\n\n  /**\n   * Creates a DuplicateError for a specific field value.\n   * Alias for forField method.\n   *\n   * @param entityType - The type of entity\n   * @param field - The field name\n   * @param value - The duplicate value\n   * @returns A new DuplicateError instance\n   *\n   * @example\n   * ```typescript\n   * throw DuplicateError.withField('Participant', 'email', 'john@example.com');\n   * // Message: \"Participant with email 'john@example.com' already exists\"\n   * ```\n   */\n  public static withField(\n    entityType: string,\n    field: string,\n    value: unknown\n  ): DuplicateError {\n    return DuplicateError.forField(entityType, field, value);\n  }\n\n  /**\n   * Creates a DuplicateError for an entity ID.\n   *\n   * @param entityType - The type of entity\n   * @param id - The duplicate ID\n   * @returns A new DuplicateError instance\n   *\n   * @example\n   * ```typescript\n   * throw DuplicateError.forId('Trip', 'trip-123');\n   * // Message: \"Trip with id 'trip-123' already exists\"\n   * ```\n   */\n  public static forId(entityType: string, id: string): DuplicateError {\n    return new DuplicateError(entityType, 'id', id);\n  }\n\n  /**\n   * Creates a DuplicateError for a composite key.\n   *\n   * @param entityType - The type of entity\n   * @param compositeKey - Object containing the composite key fields and values\n   * @returns A new DuplicateError instance\n   *\n   * @example\n   * ```typescript\n   * throw DuplicateError.forCompositeKey('Availability', {\n   *   participantId: 'participant-1',\n   *   tripId: 'trip-1',\n   *   date: '2024-01-15'\n   * });\n   * ```\n   */\n  public static forCompositeKey(\n    entityType: string,\n    compositeKey: Record<string, unknown>\n  ): DuplicateError {\n    return new DuplicateError(entityType, undefined, undefined, compositeKey);\n  }\n\n  /**\n   * Creates a DuplicateError for a Trip name.\n   *\n   * @param tripName - The duplicate trip name\n   * @returns A new DuplicateError instance\n   */\n  public static tripNameExists(tripName: string): DuplicateError {\n    return DuplicateError.forField('Trip', 'name', tripName);\n  }\n\n  /**\n   * Creates a DuplicateError for a Participant in a Trip.\n   *\n   * @param participantName - The participant name\n   * @param tripId - The trip ID\n   * @returns A new DuplicateError instance\n   */\n  public static participantExistsInTrip(\n    participantName: string,\n    tripId: string\n  ): DuplicateError {\n    return DuplicateError.forCompositeKey('Participant', {\n      name: participantName,\n      tripId,\n    });\n  }\n\n  /**\n   * Creates a DuplicateError for a Product name.\n   *\n   * @param productName - The duplicate product name\n   * @returns A new DuplicateError instance\n   */\n  public static productNameExists(productName: string): DuplicateError {\n    return DuplicateError.forField('Product', 'name', productName);\n  }\n\n  /**\n   * Creates a DuplicateError for an Availability entry.\n   *\n   * @param participantId - The participant ID\n   * @param tripId - The trip ID\n   * @param date - The date\n   * @returns A new DuplicateError instance\n   */\n  public static availabilityExists(\n    participantId: string,\n    tripId: string,\n    date: string\n  ): DuplicateError {\n    return DuplicateError.forCompositeKey('Availability', {\n      participantId,\n      tripId,\n      date,\n    });\n  }\n\n  /**\n   * Type guard to check if an error is a DuplicateError.\n   *\n   * @param error - The error to check\n   * @returns True if the error is a DuplicateError instance\n   */\n  public static isDuplicateError(error: unknown): error is DuplicateError {\n    return error instanceof DuplicateError;\n  }\n}\n","/**\n * @fileoverview Meal type definitions for TripFood Manager.\n * Defines the different meal types supported by the application.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\n/**\n * Represents the different meal types in a day.\n *\n * @description\n * This type defines all possible meal types that can be tracked\n * in the application. Each meal represents a different eating\n * occasion during the day.\n *\n * - `breakfast`: Morning meal\n * - `lunch`: Midday meal\n * - `dinner`: Evening meal\n * - `snack`: Between-meal eating occasion\n */\nexport type MealType = 'breakfast' | 'lunch' | 'dinner' | 'snack';\n\n/**\n * Array of all valid meal types.\n * Useful for validation and iteration.\n *\n * @example\n * ```typescript\n * if (MEAL_TYPES.includes(userInput as MealType)) {\n *   // valid meal type\n * }\n * ```\n */\nexport const MEAL_TYPES: ReadonlyArray<MealType> = [\n  'breakfast',\n  'lunch',\n  'dinner',\n  'snack',\n] as const;\n\n/**\n * Display names for each meal type.\n * Useful for UI rendering.\n *\n * @example\n * ```typescript\n * const displayName = MEAL_TYPE_DISPLAY_NAMES['breakfast']; // 'Breakfast'\n * ```\n */\nexport const MEAL_TYPE_DISPLAY_NAMES: Readonly<Record<MealType, string>> = {\n  breakfast: 'Breakfast',\n  lunch: 'Lunch',\n  dinner: 'Dinner',\n  snack: 'Snack',\n} as const;\n\n/**\n * Order of meals in a day.\n * Useful for sorting and displaying meals in chronological order.\n */\nexport const MEAL_TYPE_ORDER: Readonly<Record<MealType, number>> = {\n  breakfast: 1,\n  lunch: 2,\n  snack: 3,\n  dinner: 4,\n} as const;\n\n/**\n * Type guard to check if a value is a valid MealType.\n *\n * @param value - The value to check\n * @returns True if the value is a valid MealType\n *\n * @example\n * ```typescript\n * const input: unknown = 'breakfast';\n * if (isMealType(input)) {\n *   // input is now typed as MealType\n *   console.log(input.toUpperCase());\n * }\n * ```\n */\nexport function isMealType(value: unknown): value is MealType {\n  return typeof value === 'string' && MEAL_TYPES.includes(value as MealType);\n}\n\n/**\n * Validates and returns a MealType or throws an error.\n *\n * @param value - The value to validate\n * @returns The validated MealType\n * @throws Error if the value is not a valid MealType\n *\n * @example\n * ```typescript\n * const meal = parseMealType('lunch'); // MealType\n * const invalid = parseMealType('brunch'); // throws Error\n * ```\n */\nexport function parseMealType(value: unknown): MealType {\n  if (!isMealType(value)) {\n    throw new Error(\n      `Invalid meal type: '${String(value)}'. Valid types are: ${MEAL_TYPES.join(', ')}`\n    );\n  }\n  return value;\n}\n\n/**\n * Sorts meals by their chronological order in a day.\n *\n * @param meals - Array of meal types to sort\n * @returns Sorted array of meal types\n *\n * @example\n * ```typescript\n * const meals: MealType[] = ['dinner', 'breakfast', 'lunch'];\n * const sorted = sortMealsByOrder(meals); // ['breakfast', 'lunch', 'dinner']\n * ```\n */\nexport function sortMealsByOrder(meals: ReadonlyArray<MealType>): MealType[] {\n  return [...meals].sort((a, b) => MEAL_TYPE_ORDER[a] - MEAL_TYPE_ORDER[b]);\n}\n","/**\n * @fileoverview Product type definitions for TripFood Manager.\n * Defines product categories, types, and units for food and beverage items.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\n/**\n * Product categories for high-level classification.\n *\n * @description\n * Categories represent the broad classification of products:\n * - `food`: Edible items including meals, snacks, and ingredients\n * - `beverage`: Drinkable items including water, soft drinks, and alcohol\n * - `other`: Miscellaneous items that don't fit other categories\n */\nexport type ProductCategory = 'food' | 'beverage' | 'other';\n\n/**\n * Array of all valid product categories.\n */\nexport const PRODUCT_CATEGORIES: ReadonlyArray<ProductCategory> = [\n  'food',\n  'beverage',\n  'other',\n] as const;\n\n/**\n * Display names for product categories.\n */\nexport const PRODUCT_CATEGORY_DISPLAY_NAMES: Readonly<Record<ProductCategory, string>> = {\n  food: 'Food',\n  beverage: 'Beverage',\n  other: 'Other',\n} as const;\n\n/**\n * Specific product types within each category.\n *\n * @description\n * Product types provide more granular classification:\n *\n * Food types:\n * - `meat`: Beef, pork, chicken, fish, etc.\n * - `dairy`: Milk, cheese, yogurt, etc.\n * - `vegetables`: Fresh or frozen vegetables\n * - `fruits`: Fresh or canned fruits\n * - `grains`: Bread, rice, pasta, cereals\n * - `snacks`: Chips, cookies, candy, etc.\n * - `condiments`: Sauces, spices, dressings\n * - `prepared_food`: Pre-made meals, deli items\n *\n * Beverage types:\n * - `water`: Plain or flavored water\n * - `soft_drink`: Sodas, juices, energy drinks\n * - `alcohol`: Beer, wine, spirits\n * - `hot_beverage`: Coffee, tea, hot chocolate\n *\n * Other:\n * - `miscellaneous`: Items that don't fit other categories\n */\nexport type ProductType =\n  // Food types\n  | 'meat'\n  | 'dairy'\n  | 'vegetables'\n  | 'fruits'\n  | 'grains'\n  | 'snacks'\n  | 'condiments'\n  | 'prepared_food'\n  // Beverage types\n  | 'water'\n  | 'soft_drink'\n  | 'alcohol'\n  | 'hot_beverage'\n  // Other\n  | 'miscellaneous';\n\n/**\n * Array of all valid product types.\n */\nexport const PRODUCT_TYPES: ReadonlyArray<ProductType> = [\n  'meat',\n  'dairy',\n  'vegetables',\n  'fruits',\n  'grains',\n  'snacks',\n  'condiments',\n  'prepared_food',\n  'water',\n  'soft_drink',\n  'alcohol',\n  'hot_beverage',\n  'miscellaneous',\n] as const;\n\n/**\n * Display names for product types.\n */\nexport const PRODUCT_TYPE_DISPLAY_NAMES: Readonly<Record<ProductType, string>> = {\n  meat: 'Meat & Protein',\n  dairy: 'Dairy Products',\n  vegetables: 'Vegetables',\n  fruits: 'Fruits',\n  grains: 'Grains & Bread',\n  snacks: 'Snacks',\n  condiments: 'Condiments & Sauces',\n  prepared_food: 'Prepared Food',\n  water: 'Water',\n  soft_drink: 'Soft Drinks',\n  alcohol: 'Alcoholic Beverages',\n  hot_beverage: 'Hot Beverages',\n  miscellaneous: 'Miscellaneous',\n} as const;\n\n/**\n * Maps product types to their parent category.\n */\nexport const PRODUCT_TYPE_TO_CATEGORY: Readonly<Record<ProductType, ProductCategory>> = {\n  meat: 'food',\n  dairy: 'food',\n  vegetables: 'food',\n  fruits: 'food',\n  grains: 'food',\n  snacks: 'food',\n  condiments: 'food',\n  prepared_food: 'food',\n  water: 'beverage',\n  soft_drink: 'beverage',\n  alcohol: 'beverage',\n  hot_beverage: 'beverage',\n  miscellaneous: 'other',\n} as const;\n\n/**\n * Maps categories to their available product types.\n */\nexport const CATEGORY_TO_PRODUCT_TYPES: Readonly<Record<ProductCategory, ReadonlyArray<ProductType>>> = {\n  food: ['meat', 'dairy', 'vegetables', 'fruits', 'grains', 'snacks', 'condiments', 'prepared_food'],\n  beverage: ['water', 'soft_drink', 'alcohol', 'hot_beverage'],\n  other: ['miscellaneous'],\n} as const;\n\n/**\n * Units of measurement for products.\n *\n * @description\n * Units represent how products are measured and tracked:\n *\n * Weight:\n * - `kg`: Kilograms\n * - `g`: Grams\n * - `lb`: Pounds\n * - `oz`: Ounces\n *\n * Volume:\n * - `l`: Liters\n * - `ml`: Milliliters\n * - `gal`: Gallons\n *\n * Count:\n * - `unit`: Individual items\n * - `pack`: Packages or packs\n * - `box`: Boxes\n * - `bottle`: Bottles\n * - `can`: Cans\n * - `bag`: Bags\n *\n * Portions:\n * - `serving`: Standard serving size\n * - `portion`: Generic portion\n * - `slice`: Slices (bread, pizza, etc.)\n * - `piece`: Individual pieces\n */\nexport type ProductUnit =\n  // Weight\n  | 'kg'\n  | 'g'\n  | 'lb'\n  | 'oz'\n  // Volume\n  | 'l'\n  | 'ml'\n  | 'gal'\n  // Count\n  | 'unit'\n  | 'pack'\n  | 'box'\n  | 'bottle'\n  | 'can'\n  | 'bag'\n  // Portions\n  | 'serving'\n  | 'portion'\n  | 'slice'\n  | 'piece';\n\n/**\n * Array of all valid product units.\n */\nexport const PRODUCT_UNITS: ReadonlyArray<ProductUnit> = [\n  'kg',\n  'g',\n  'lb',\n  'oz',\n  'l',\n  'ml',\n  'gal',\n  'unit',\n  'pack',\n  'box',\n  'bottle',\n  'can',\n  'bag',\n  'serving',\n  'portion',\n  'slice',\n  'piece',\n] as const;\n\n/**\n * Display names for product units.\n */\nexport const PRODUCT_UNIT_DISPLAY_NAMES: Readonly<Record<ProductUnit, string>> = {\n  kg: 'Kilograms',\n  g: 'Grams',\n  lb: 'Pounds',\n  oz: 'Ounces',\n  l: 'Liters',\n  ml: 'Milliliters',\n  gal: 'Gallons',\n  unit: 'Units',\n  pack: 'Packs',\n  box: 'Boxes',\n  bottle: 'Bottles',\n  can: 'Cans',\n  bag: 'Bags',\n  serving: 'Servings',\n  portion: 'Portions',\n  slice: 'Slices',\n  piece: 'Pieces',\n} as const;\n\n/**\n * Abbreviated display names for product units.\n */\nexport const PRODUCT_UNIT_ABBREVIATIONS: Readonly<Record<ProductUnit, string>> = {\n  kg: 'kg',\n  g: 'g',\n  lb: 'lb',\n  oz: 'oz',\n  l: 'L',\n  ml: 'ml',\n  gal: 'gal',\n  unit: 'u',\n  pack: 'pk',\n  box: 'bx',\n  bottle: 'btl',\n  can: 'can',\n  bag: 'bag',\n  serving: 'srv',\n  portion: 'ptn',\n  slice: 'sl',\n  piece: 'pc',\n} as const;\n\n/**\n * Groups units by their measurement type.\n */\nexport const UNIT_GROUPS: Readonly<Record<string, ReadonlyArray<ProductUnit>>> = {\n  weight: ['kg', 'g', 'lb', 'oz'],\n  volume: ['l', 'ml', 'gal'],\n  count: ['unit', 'pack', 'box', 'bottle', 'can', 'bag'],\n  portion: ['serving', 'portion', 'slice', 'piece'],\n} as const;\n\n/**\n * Type guard to check if a value is a valid ProductCategory.\n *\n * @param value - The value to check\n * @returns True if the value is a valid ProductCategory\n */\nexport function isProductCategory(value: unknown): value is ProductCategory {\n  return typeof value === 'string' && PRODUCT_CATEGORIES.includes(value as ProductCategory);\n}\n\n/**\n * Type guard to check if a value is a valid ProductType.\n *\n * @param value - The value to check\n * @returns True if the value is a valid ProductType\n */\nexport function isProductType(value: unknown): value is ProductType {\n  return typeof value === 'string' && PRODUCT_TYPES.includes(value as ProductType);\n}\n\n/**\n * Type guard to check if a value is a valid ProductUnit.\n *\n * @param value - The value to check\n * @returns True if the value is a valid ProductUnit\n */\nexport function isProductUnit(value: unknown): value is ProductUnit {\n  return typeof value === 'string' && PRODUCT_UNITS.includes(value as ProductUnit);\n}\n\n/**\n * Validates and returns a ProductCategory or throws an error.\n *\n * @param value - The value to validate\n * @returns The validated ProductCategory\n * @throws Error if the value is not a valid ProductCategory\n */\nexport function parseProductCategory(value: unknown): ProductCategory {\n  if (!isProductCategory(value)) {\n    throw new Error(\n      `Invalid product category: '${String(value)}'. Valid categories are: ${PRODUCT_CATEGORIES.join(', ')}`\n    );\n  }\n  return value;\n}\n\n/**\n * Validates and returns a ProductType or throws an error.\n *\n * @param value - The value to validate\n * @returns The validated ProductType\n * @throws Error if the value is not a valid ProductType\n */\nexport function parseProductType(value: unknown): ProductType {\n  if (!isProductType(value)) {\n    throw new Error(\n      `Invalid product type: '${String(value)}'. Valid types are: ${PRODUCT_TYPES.join(', ')}`\n    );\n  }\n  return value;\n}\n\n/**\n * Validates and returns a ProductUnit or throws an error.\n *\n * @param value - The value to validate\n * @returns The validated ProductUnit\n * @throws Error if the value is not a valid ProductUnit\n */\nexport function parseProductUnit(value: unknown): ProductUnit {\n  if (!isProductUnit(value)) {\n    throw new Error(\n      `Invalid product unit: '${String(value)}'. Valid units are: ${PRODUCT_UNITS.join(', ')}`\n    );\n  }\n  return value;\n}\n\n/**\n * Gets the category for a given product type.\n *\n * @param productType - The product type\n * @returns The corresponding product category\n */\nexport function getCategoryForType(productType: ProductType): ProductCategory {\n  return PRODUCT_TYPE_TO_CATEGORY[productType];\n}\n\n/**\n * Gets available product types for a given category.\n *\n * @param category - The product category\n * @returns Array of product types in that category\n */\nexport function getTypesForCategory(category: ProductCategory): ReadonlyArray<ProductType> {\n  return CATEGORY_TO_PRODUCT_TYPES[category];\n}\n\n/**\n * Validates that a product type belongs to the specified category.\n *\n * @param productType - The product type to validate\n * @param expectedCategory - The expected category\n * @returns True if the type belongs to the category\n */\nexport function isTypeInCategory(\n  productType: ProductType,\n  expectedCategory: ProductCategory\n): boolean {\n  return PRODUCT_TYPE_TO_CATEGORY[productType] === expectedCategory;\n}\n","/**\n * @fileoverview Common type definitions for TripFood Manager.\n * Contains shared types, interfaces, and utility types used across the domain.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\n/**\n * Branded type for UUID strings.\n * Provides type safety for ID values.\n *\n * @description\n * This type uses TypeScript's branded types pattern to ensure\n * that UUID strings are explicitly marked and cannot be confused\n * with regular strings.\n *\n * @example\n * ```typescript\n * const id: UUID = 'abc-123' as UUID;\n * const regularString: string = 'abc-123';\n * // These are not interchangeable without explicit casting\n * ```\n */\nexport type UUID = string & { readonly __brand: 'UUID' };\n\n/**\n * Type guard to check if a string is a valid UUID v4 format.\n *\n * @param value - The value to check\n * @returns True if the value matches UUID v4 format\n */\nexport function isUUID(value: unknown): value is UUID {\n  if (typeof value !== 'string') {\n    return false;\n  }\n\n  const uuidV4Regex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n  return uuidV4Regex.test(value);\n}\n\n/**\n * Represents a date range with start and end dates.\n *\n * @description\n * Used for trip duration and date-based queries.\n * Both dates are inclusive.\n */\nexport interface IDateRange {\n  /** Start date of the range (inclusive) */\n  readonly startDate: Date;\n  /** End date of the range (inclusive) */\n  readonly endDate: Date;\n}\n\n/**\n * Creates a date range and validates that startDate is before or equal to endDate.\n *\n * @param startDate - Start date of the range\n * @param endDate - End date of the range\n * @returns A validated IDateRange\n * @throws Error if startDate is after endDate\n */\nexport function createDateRange(startDate: Date, endDate: Date): IDateRange {\n  if (startDate > endDate) {\n    throw new Error('Start date must be before or equal to end date');\n  }\n\n  return {\n    startDate: new Date(startDate),\n    endDate: new Date(endDate),\n  };\n}\n\n/**\n * Checks if a date falls within a date range.\n *\n * @param date - The date to check\n * @param range - The date range to check against\n * @returns True if the date is within the range (inclusive)\n */\nexport function isDateInRange(date: Date, range: IDateRange): boolean {\n  const dateTime = date.getTime();\n  return dateTime >= range.startDate.getTime() && dateTime <= range.endDate.getTime();\n}\n\n/**\n * Gets the number of days in a date range.\n *\n * @param range - The date range\n * @returns Number of days (inclusive)\n */\nexport function getDaysInRange(range: IDateRange): number {\n  const millisecondsPerDay = 24 * 60 * 60 * 1000;\n  const diffInMilliseconds = range.endDate.getTime() - range.startDate.getTime();\n  return Math.floor(diffInMilliseconds / millisecondsPerDay) + 1;\n}\n\n/**\n * Generates an array of dates within a date range.\n *\n * @param range - The date range\n * @returns Array of dates within the range\n */\nexport function getDatesInRange(range: IDateRange): Date[] {\n  const dates: Date[] = [];\n  const currentDate = new Date(range.startDate);\n\n  while (currentDate <= range.endDate) {\n    dates.push(new Date(currentDate));\n    currentDate.setDate(currentDate.getDate() + 1);\n  }\n\n  return dates;\n}\n\n/**\n * Represents pagination parameters for queries.\n */\nexport interface IPaginationParams {\n  /** Page number (1-based) */\n  readonly page: number;\n  /** Number of items per page */\n  readonly pageSize: number;\n}\n\n/**\n * Represents a paginated result set.\n *\n * @typeParam T - The type of items in the result\n */\nexport interface IPaginatedResult<T> {\n  /** Array of items in the current page */\n  readonly items: ReadonlyArray<T>;\n  /** Total number of items across all pages */\n  readonly totalItems: number;\n  /** Total number of pages */\n  readonly totalPages: number;\n  /** Current page number (1-based) */\n  readonly currentPage: number;\n  /** Number of items per page */\n  readonly pageSize: number;\n  /** Whether there are more pages after the current one */\n  readonly hasNextPage: boolean;\n  /** Whether there are pages before the current one */\n  readonly hasPreviousPage: boolean;\n}\n\n/**\n * Creates a paginated result from an array of items.\n *\n * @typeParam T - The type of items\n * @param items - All items to paginate\n * @param params - Pagination parameters\n * @returns Paginated result\n */\nexport function paginateItems<T>(\n  items: ReadonlyArray<T>,\n  params: IPaginationParams\n): IPaginatedResult<T> {\n  const { page, pageSize } = params;\n  const totalItems = items.length;\n  const totalPages = Math.ceil(totalItems / pageSize);\n  const currentPage = Math.min(Math.max(1, page), Math.max(1, totalPages));\n\n  const startIndex = (currentPage - 1) * pageSize;\n  const endIndex = Math.min(startIndex + pageSize, totalItems);\n  const pageItems = items.slice(startIndex, endIndex);\n\n  return {\n    items: pageItems,\n    totalItems,\n    totalPages,\n    currentPage,\n    pageSize,\n    hasNextPage: currentPage < totalPages,\n    hasPreviousPage: currentPage > 1,\n  };\n}\n\n/**\n * Sorting direction for queries.\n */\nexport type SortDirection = 'asc' | 'desc';\n\n/**\n * Represents sorting parameters for queries.\n *\n * @typeParam T - The type being sorted (for type-safe field names)\n */\nexport interface ISortParams<T> {\n  /** Field to sort by */\n  readonly field: keyof T;\n  /** Sort direction */\n  readonly direction: SortDirection;\n}\n\n/**\n * Base interface for entity timestamps.\n * All entities should have these timestamps.\n */\nexport interface ITimestamps {\n  /** When the entity was created */\n  readonly createdAt: Date;\n  /** When the entity was last updated (optional) */\n  readonly updatedAt?: Date | undefined;\n}\n\n/**\n * Base interface for all domain entities.\n * Provides common structure for entities.\n */\nexport interface IEntity extends ITimestamps {\n  /** Unique identifier for the entity */\n  readonly id: string;\n}\n\n/**\n * Type for deep readonly objects.\n * Makes all properties and nested properties readonly.\n */\nexport type DeepReadonly<T> = {\n  readonly [P in keyof T]: T[P] extends object ? DeepReadonly<T[P]> : T[P];\n};\n\n/**\n * Utility type to make specific properties optional.\n *\n * @typeParam T - The base type\n * @typeParam K - Keys to make optional\n */\nexport type PartialBy<T, K extends keyof T> = Omit<T, K> & Partial<Pick<T, K>>;\n\n/**\n * Utility type to make specific properties required.\n *\n * @typeParam T - The base type\n * @typeParam K - Keys to make required\n */\nexport type RequiredBy<T, K extends keyof T> = Omit<T, K> & Required<Pick<T, K>>;\n\n/**\n * Represents the result of an operation that can fail.\n * Provides a functional approach to error handling.\n *\n * @typeParam T - The type of the success value\n * @typeParam E - The type of the error (defaults to Error)\n */\nexport type Result<T, E = Error> =\n  | { readonly success: true; readonly value: T }\n  | { readonly success: false; readonly error: E };\n\n/**\n * Creates a successful result.\n *\n * @typeParam T - The type of the value\n * @param value - The success value\n * @returns A successful Result\n */\nexport function success<T>(value: T): Result<T, never> {\n  return { success: true, value };\n}\n\n/**\n * Creates a failed result.\n *\n * @typeParam E - The type of the error\n * @param error - The error\n * @returns A failed Result\n */\nexport function failure<E>(error: E): Result<never, E> {\n  return { success: false, error };\n}\n\n/**\n * Type guard to check if a result is successful.\n *\n * @typeParam T - The success value type\n * @typeParam E - The error type\n * @param result - The result to check\n * @returns True if the result is successful\n */\nexport function isSuccess<T, E>(\n  result: Result<T, E>\n): result is { readonly success: true; readonly value: T } {\n  return result.success === true;\n}\n\n/**\n * Type guard to check if a result is a failure.\n *\n * @typeParam T - The success value type\n * @typeParam E - The error type\n * @param result - The result to check\n * @returns True if the result is a failure\n */\nexport function isFailure<T, E>(\n  result: Result<T, E>\n): result is { readonly success: false; readonly error: E } {\n  return result.success === false;\n}\n\n/**\n * Email format validation regex.\n * Basic email validation pattern.\n */\nexport const EMAIL_REGEX = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n\n/**\n * Validates an email address format.\n *\n * @param email - The email to validate\n * @returns True if the email format is valid\n */\nexport function isValidEmail(email: string): boolean {\n  return EMAIL_REGEX.test(email);\n}\n\n/**\n * Normalizes a date to the start of the day (00:00:00.000).\n *\n * @param date - The date to normalize\n * @returns A new Date set to the start of the day\n */\nexport function normalizeToStartOfDay(date: Date): Date {\n  const normalized = new Date(date);\n  normalized.setHours(0, 0, 0, 0);\n  return normalized;\n}\n\n/**\n * Normalizes a date to the end of the day (23:59:59.999).\n *\n * @param date - The date to normalize\n * @returns A new Date set to the end of the day\n */\nexport function normalizeToEndOfDay(date: Date): Date {\n  const normalized = new Date(date);\n  normalized.setHours(23, 59, 59, 999);\n  return normalized;\n}\n\n/**\n * Formats a date as ISO date string (YYYY-MM-DD).\n *\n * @param date - The date to format\n * @returns ISO date string\n */\nexport function toISODateString(date: Date): string {\n  return date.toISOString().split('T')[0] ?? '';\n}\n\n/**\n * Parses an ISO date string to a Date object.\n *\n * @param dateString - The ISO date string (YYYY-MM-DD)\n * @returns Parsed Date object\n * @throws Error if the date string is invalid\n */\nexport function parseISODateString(dateString: string): Date {\n  const date = new Date(dateString);\n\n  if (isNaN(date.getTime())) {\n    throw new Error(`Invalid date string: '${dateString}'`);\n  }\n\n  return date;\n}\n","/**\n * @fileoverview Trip entity for TripFood Manager.\n * Represents a group trip with dates, participants, and consumption tracking.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport { ValidationError } from '../errors';\nimport { IDateRange, IEntity, createDateRange, getDaysInRange, isDateInRange } from '../types';\n\n/**\n * Interface representing the data transfer object for creating a Trip.\n * Contains all required and optional fields for trip creation.\n */\nexport interface ITripCreateDTO {\n  /** Name of the trip */\n  readonly name: string;\n  /** Optional description of the trip */\n  readonly description?: string | undefined;\n  /** Start date of the trip */\n  readonly startDate: Date;\n  /** End date of the trip */\n  readonly endDate: Date;\n}\n\n/**\n * Interface representing the data transfer object for updating a Trip.\n * All fields are optional since we may only update specific properties.\n */\nexport interface ITripUpdateDTO {\n  /** New name for the trip */\n  readonly name?: string | undefined;\n  /** New description for the trip (null to remove) */\n  readonly description?: string | null | undefined;\n  /** New start date for the trip */\n  readonly startDate?: Date | undefined;\n  /** New end date for the trip */\n  readonly endDate?: Date | undefined;\n}\n\n/**\n * Interface representing the Trip entity properties.\n */\nexport interface ITripProps extends IEntity {\n  /** Name of the trip */\n  readonly name: string;\n  /** Optional description of the trip */\n  readonly description?: string | undefined;\n  /** Start date of the trip */\n  readonly startDate: Date;\n  /** End date of the trip */\n  readonly endDate: Date;\n}\n\n/**\n * Trip entity representing a group trip.\n *\n * @description\n * The Trip entity is the aggregate root for trip-related operations.\n * It encapsulates all business logic related to trips, including:\n * - Trip date range validation\n * - Name validation\n * - Immutable updates\n *\n * All instances are immutable - updates return new instances.\n *\n * @example\n * ```typescript\n * // Create a new trip\n * const trip = Trip.create({\n *   name: 'Summer Vacation 2024',\n *   description: 'Beach trip with friends',\n *   startDate: new Date('2024-07-01'),\n *   endDate: new Date('2024-07-15'),\n * });\n *\n * // Update the trip (returns new instance)\n * const updatedTrip = trip.update({ name: 'Summer Beach Trip 2024' });\n * ```\n *\n * @implements {ITripProps}\n */\nexport class Trip implements ITripProps {\n  /**\n   * Minimum length for trip name.\n   */\n  public static readonly MIN_NAME_LENGTH = 3;\n\n  /**\n   * Maximum length for trip name.\n   */\n  public static readonly MAX_NAME_LENGTH = 100;\n\n  /**\n   * Maximum length for trip description.\n   */\n  public static readonly MAX_DESCRIPTION_LENGTH = 500;\n\n  /**\n   * Unique identifier for the trip.\n   * @readonly\n   */\n  public readonly id: string;\n\n  /**\n   * Name of the trip.\n   * @readonly\n   */\n  public readonly name: string;\n\n  /**\n   * Optional description of the trip.\n   * @readonly\n   */\n  public readonly description?: string | undefined;\n\n  /**\n   * Start date of the trip.\n   * @readonly\n   */\n  public readonly startDate: Date;\n\n  /**\n   * End date of the trip.\n   * @readonly\n   */\n  public readonly endDate: Date;\n\n  /**\n   * Timestamp when the trip was created.\n   * @readonly\n   */\n  public readonly createdAt: Date;\n\n  /**\n   * Timestamp when the trip was last updated.\n   * @readonly\n   */\n  public readonly updatedAt?: Date | undefined;\n\n  /**\n   * Private constructor to enforce factory method usage.\n   *\n   * @param props - The trip properties\n   */\n  private constructor(props: ITripProps) {\n    this.id = props.id;\n    this.name = props.name;\n    this.description = props.description;\n    this.startDate = new Date(props.startDate);\n    this.endDate = new Date(props.endDate);\n    this.createdAt = new Date(props.createdAt);\n    this.updatedAt = props.updatedAt ? new Date(props.updatedAt) : undefined;\n\n    // Freeze the object to ensure immutability\n    Object.freeze(this);\n  }\n\n  /**\n   * Creates a new Trip entity with validation.\n   *\n   * @param dto - The data transfer object containing trip data\n   * @returns A new Trip instance\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const trip = Trip.create({\n   *   name: 'Mountain Hiking',\n   *   startDate: new Date('2024-08-01'),\n   *   endDate: new Date('2024-08-07'),\n   * });\n   * ```\n   */\n  public static create(dto: ITripCreateDTO): Trip {\n    // Validate name\n    Trip.validateName(dto.name);\n\n    // Validate description if provided\n    if (dto.description !== undefined) {\n      Trip.validateDescription(dto.description);\n    }\n\n    // Validate date range\n    Trip.validateDateRange(dto.startDate, dto.endDate);\n\n    const now = new Date();\n\n    return new Trip({\n      id: uuidv4(),\n      name: dto.name.trim(),\n      description: dto.description?.trim(),\n      startDate: dto.startDate,\n      endDate: dto.endDate,\n      createdAt: now,\n    });\n  }\n\n  /**\n   * Reconstructs a Trip entity from persistence data.\n   *\n   * @param props - The trip properties from persistence\n   * @returns A Trip instance\n   *\n   * @description\n   * This method is used by repositories to reconstruct entities\n   * from storage. It performs minimal validation since data is\n   * assumed to come from a trusted source.\n   */\n  public static fromPersistence(props: ITripProps): Trip {\n    return new Trip(props);\n  }\n\n  /**\n   * Updates the trip with new values, returning a new instance.\n   *\n   * @param dto - The update data transfer object\n   * @returns A new Trip instance with updated values\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const updatedTrip = trip.update({\n   *   name: 'New Trip Name',\n   *   description: 'Updated description',\n   * });\n   * ```\n   */\n  public update(dto: ITripUpdateDTO): Trip {\n    const newName = dto.name !== undefined ? dto.name : this.name;\n    const newDescription = dto.description === null\n      ? undefined\n      : dto.description !== undefined\n        ? dto.description\n        : this.description;\n    const newStartDate = dto.startDate !== undefined ? dto.startDate : this.startDate;\n    const newEndDate = dto.endDate !== undefined ? dto.endDate : this.endDate;\n\n    // Validate updated values\n    if (dto.name !== undefined) {\n      Trip.validateName(dto.name);\n    }\n\n    if (dto.description !== undefined && dto.description !== null) {\n      Trip.validateDescription(dto.description);\n    }\n\n    if (dto.startDate !== undefined || dto.endDate !== undefined) {\n      Trip.validateDateRange(newStartDate, newEndDate);\n    }\n\n    return new Trip({\n      id: this.id,\n      name: newName.trim(),\n      description: newDescription?.trim(),\n      startDate: newStartDate,\n      endDate: newEndDate,\n      createdAt: this.createdAt,\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Gets the date range of the trip.\n   *\n   * @returns The trip's date range\n   */\n  public getDateRange(): IDateRange {\n    return createDateRange(this.startDate, this.endDate);\n  }\n\n  /**\n   * Gets the duration of the trip in days.\n   *\n   * @returns Number of days (inclusive)\n   */\n  public getDurationInDays(): number {\n    return getDaysInRange(this.getDateRange());\n  }\n\n  /**\n   * Checks if a given date falls within the trip's date range.\n   *\n   * @param date - The date to check\n   * @returns True if the date is within the trip dates\n   */\n  public isDateWithinTrip(date: Date): boolean {\n    return isDateInRange(date, this.getDateRange());\n  }\n\n  /**\n   * Checks if the trip is currently active (today is within trip dates).\n   *\n   * @returns True if the trip is active\n   */\n  public isActive(): boolean {\n    return this.isDateWithinTrip(new Date());\n  }\n\n  /**\n   * Checks if the trip has started.\n   *\n   * @returns True if the trip has started\n   */\n  public hasStarted(): boolean {\n    return new Date() >= this.startDate;\n  }\n\n  /**\n   * Checks if the trip has ended.\n   *\n   * @returns True if the trip has ended\n   */\n  public hasEnded(): boolean {\n    return new Date() > this.endDate;\n  }\n\n  /**\n   * Checks if the trip is upcoming (hasn't started yet).\n   *\n   * @returns True if the trip is upcoming\n   */\n  public isUpcoming(): boolean {\n    return new Date() < this.startDate;\n  }\n\n  /**\n   * Converts the entity to a plain object for serialization.\n   *\n   * @returns Plain object representation of the trip\n   */\n  public toJSON(): ITripProps {\n    return {\n      id: this.id,\n      name: this.name,\n      description: this.description,\n      startDate: this.startDate,\n      endDate: this.endDate,\n      createdAt: this.createdAt,\n      updatedAt: this.updatedAt,\n    };\n  }\n\n  /**\n   * Validates the trip name.\n   *\n   * @param name - The name to validate\n   * @throws {ValidationError} If name is invalid\n   */\n  private static validateName(name: string): void {\n    if (!name || typeof name !== 'string') {\n      throw ValidationError.required('name', 'Trip');\n    }\n\n    const trimmedName = name.trim();\n\n    if (trimmedName.length < Trip.MIN_NAME_LENGTH) {\n      throw ValidationError.invalidLength(\n        'name',\n        Trip.MIN_NAME_LENGTH,\n        Trip.MAX_NAME_LENGTH,\n        trimmedName.length\n      );\n    }\n\n    if (trimmedName.length > Trip.MAX_NAME_LENGTH) {\n      throw ValidationError.invalidLength(\n        'name',\n        Trip.MIN_NAME_LENGTH,\n        Trip.MAX_NAME_LENGTH,\n        trimmedName.length\n      );\n    }\n  }\n\n  /**\n   * Validates the trip description.\n   *\n   * @param description - The description to validate\n   * @throws {ValidationError} If description is invalid\n   */\n  private static validateDescription(description: string): void {\n    if (description.length > Trip.MAX_DESCRIPTION_LENGTH) {\n      throw ValidationError.invalidLength(\n        'description',\n        undefined,\n        Trip.MAX_DESCRIPTION_LENGTH,\n        description.length\n      );\n    }\n  }\n\n  /**\n   * Validates the trip date range.\n   *\n   * @param startDate - The start date\n   * @param endDate - The end date\n   * @throws {ValidationError} If date range is invalid\n   */\n  private static validateDateRange(startDate: Date, endDate: Date): void {\n    if (!startDate || !(startDate instanceof Date) || isNaN(startDate.getTime())) {\n      throw ValidationError.required('startDate', 'Trip');\n    }\n\n    if (!endDate || !(endDate instanceof Date) || isNaN(endDate.getTime())) {\n      throw ValidationError.required('endDate', 'Trip');\n    }\n\n    if (startDate > endDate) {\n      throw ValidationError.invalidDateRange('startDate', 'endDate');\n    }\n  }\n\n  /**\n   * Compares this trip with another for equality.\n   *\n   * @param other - The other trip to compare\n   * @returns True if the trips are equal (same ID)\n   */\n  public equals(other: Trip): boolean {\n    if (!(other instanceof Trip)) {\n      return false;\n    }\n    return this.id === other.id;\n  }\n}\n\n/**\n * Type alias for backward compatibility with existing code.\n * @deprecated Use Trip class directly\n */\nexport type TripEntity = Trip;\n\n/**\n * Type alias for create props - backward compatibility.\n * @deprecated Use ITripCreateDTO instead\n */\nexport type CreateTripProps = ITripCreateDTO & { id?: string };\n\n/**\n * Factory function for backward compatibility.\n * @deprecated Use Trip.create() instead\n *\n * @param props - The trip creation properties\n * @returns A new Trip instance\n */\nexport function createTrip(props: CreateTripProps): Trip {\n  return Trip.create({\n    name: props.name,\n    description: props.description,\n    startDate: props.startDate,\n    endDate: props.endDate,\n  });\n}\n","/**\n * @fileoverview Participant entity for TripFood Manager.\n * Represents a person participating in a trip.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport { ValidationError } from '../errors';\nimport { isValidEmail } from '../types';\n\n/**\n * Interface representing the data transfer object for creating a Participant.\n */\nexport interface IParticipantCreateDTO {\n  /** ID of the trip this participant belongs to */\n  readonly tripId: string;\n  /** Name of the participant */\n  readonly name: string;\n  /** Optional email address */\n  readonly email?: string | undefined;\n  /** Optional notes about the participant */\n  readonly notes?: string | undefined;\n}\n\n/**\n * Interface representing the data transfer object for updating a Participant.\n */\nexport interface IParticipantUpdateDTO {\n  /** New name for the participant */\n  readonly name?: string | undefined;\n  /** New email for the participant (null to remove) */\n  readonly email?: string | null | undefined;\n  /** New notes for the participant (null to remove) */\n  readonly notes?: string | null | undefined;\n}\n\n/**\n * Interface representing the Participant entity properties.\n */\nexport interface IParticipantProps {\n  /** Unique identifier */\n  readonly id: string;\n  /** ID of the trip this participant belongs to */\n  readonly tripId: string;\n  /** Name of the participant */\n  readonly name: string;\n  /** Optional email address */\n  readonly email?: string | undefined;\n  /** Optional notes about the participant */\n  readonly notes?: string | undefined;\n  /** Timestamp when the participant was created */\n  readonly createdAt: Date;\n  /** Timestamp when the participant was last updated */\n  readonly updatedAt?: Date | undefined;\n}\n\n/**\n * Participant entity representing a person in a trip.\n *\n * @description\n * The Participant entity represents an individual who participates\n * in a trip. Participants can have consumption records and availability\n * settings associated with them.\n *\n * All instances are immutable - updates return new instances.\n *\n * @example\n * ```typescript\n * // Create a new participant\n * const participant = Participant.create({\n *   tripId: 'trip-123',\n *   name: 'John Doe',\n *   email: 'john@example.com',\n * });\n *\n * // Update the participant\n * const updated = participant.update({ notes: 'Vegetarian' });\n * ```\n *\n * @implements {IParticipantProps}\n */\nexport class Participant implements IParticipantProps {\n  /**\n   * Minimum length for participant name.\n   */\n  public static readonly MIN_NAME_LENGTH = 2;\n\n  /**\n   * Maximum length for participant name.\n   */\n  public static readonly MAX_NAME_LENGTH = 100;\n\n  /**\n   * Maximum length for participant notes.\n   */\n  public static readonly MAX_NOTES_LENGTH = 500;\n\n  /**\n   * Unique identifier for the participant.\n   * @readonly\n   */\n  public readonly id: string;\n\n  /**\n   * ID of the trip this participant belongs to.\n   * @readonly\n   */\n  public readonly tripId: string;\n\n  /**\n   * Name of the participant.\n   * @readonly\n   */\n  public readonly name: string;\n\n  /**\n   * Optional email address of the participant.\n   * @readonly\n   */\n  public readonly email?: string | undefined;\n\n  /**\n   * Optional notes about the participant.\n   * @readonly\n   */\n  public readonly notes?: string | undefined;\n\n  /**\n   * Timestamp when the participant was created.\n   * @readonly\n   */\n  public readonly createdAt: Date;\n\n  /**\n   * Timestamp when the participant was last updated.\n   * @readonly\n   */\n  public readonly updatedAt?: Date | undefined;\n\n  /**\n   * Private constructor to enforce factory method usage.\n   *\n   * @param props - The participant properties\n   */\n  private constructor(props: IParticipantProps) {\n    this.id = props.id;\n    this.tripId = props.tripId;\n    this.name = props.name;\n    this.email = props.email;\n    this.notes = props.notes;\n    this.createdAt = new Date(props.createdAt);\n    this.updatedAt = props.updatedAt ? new Date(props.updatedAt) : undefined;\n\n    // Freeze the object to ensure immutability\n    Object.freeze(this);\n  }\n\n  /**\n   * Creates a new Participant entity with validation.\n   *\n   * @param dto - The data transfer object containing participant data\n   * @returns A new Participant instance\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const participant = Participant.create({\n   *   tripId: 'trip-123',\n   *   name: 'Jane Smith',\n   *   email: 'jane@example.com',\n   * });\n   * ```\n   */\n  public static create(dto: IParticipantCreateDTO): Participant {\n    // Validate tripId\n    Participant.validateTripId(dto.tripId);\n\n    // Validate name\n    Participant.validateName(dto.name);\n\n    // Validate email if provided\n    if (dto.email !== undefined) {\n      Participant.validateEmail(dto.email);\n    }\n\n    // Validate notes if provided\n    if (dto.notes !== undefined) {\n      Participant.validateNotes(dto.notes);\n    }\n\n    const now = new Date();\n\n    return new Participant({\n      id: uuidv4(),\n      tripId: dto.tripId,\n      name: dto.name.trim(),\n      email: dto.email?.trim().toLowerCase(),\n      notes: dto.notes?.trim(),\n      createdAt: now,\n    });\n  }\n\n  /**\n   * Reconstructs a Participant entity from persistence data.\n   *\n   * @param props - The participant properties from persistence\n   * @returns A Participant instance\n   */\n  public static fromPersistence(props: IParticipantProps): Participant {\n    return new Participant(props);\n  }\n\n  /**\n   * Updates the participant with new values, returning a new instance.\n   *\n   * @param dto - The update data transfer object\n   * @returns A new Participant instance with updated values\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const updated = participant.update({\n   *   name: 'Jane Doe',\n   *   notes: 'Allergic to nuts',\n   * });\n   * ```\n   */\n  public update(dto: IParticipantUpdateDTO): Participant {\n    const newName = dto.name !== undefined ? dto.name : this.name;\n    const newEmail = dto.email === null\n      ? undefined\n      : dto.email !== undefined\n        ? dto.email\n        : this.email;\n    const newNotes = dto.notes === null\n      ? undefined\n      : dto.notes !== undefined\n        ? dto.notes\n        : this.notes;\n\n    // Validate updated values\n    if (dto.name !== undefined) {\n      Participant.validateName(dto.name);\n    }\n\n    if (dto.email !== undefined && dto.email !== null) {\n      Participant.validateEmail(dto.email);\n    }\n\n    if (dto.notes !== undefined && dto.notes !== null) {\n      Participant.validateNotes(dto.notes);\n    }\n\n    return new Participant({\n      id: this.id,\n      tripId: this.tripId,\n      name: newName.trim(),\n      email: newEmail?.trim().toLowerCase(),\n      notes: newNotes?.trim(),\n      createdAt: this.createdAt,\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Checks if the participant has an email address.\n   *\n   * @returns True if the participant has an email\n   */\n  public hasEmail(): boolean {\n    return this.email !== undefined && this.email.length > 0;\n  }\n\n  /**\n   * Checks if the participant has notes.\n   *\n   * @returns True if the participant has notes\n   */\n  public hasNotes(): boolean {\n    return this.notes !== undefined && this.notes.length > 0;\n  }\n\n  /**\n   * Checks if this participant belongs to a specific trip.\n   *\n   * @param tripId - The trip ID to check\n   * @returns True if the participant belongs to the trip\n   */\n  public belongsToTrip(tripId: string): boolean {\n    return this.tripId === tripId;\n  }\n\n  /**\n   * Converts the entity to a plain object for serialization.\n   *\n   * @returns Plain object representation of the participant\n   */\n  public toJSON(): IParticipantProps {\n    return {\n      id: this.id,\n      tripId: this.tripId,\n      name: this.name,\n      email: this.email,\n      notes: this.notes,\n      createdAt: this.createdAt,\n      updatedAt: this.updatedAt,\n    };\n  }\n\n  /**\n   * Validates the trip ID.\n   *\n   * @param tripId - The trip ID to validate\n   * @throws {ValidationError} If tripId is invalid\n   */\n  private static validateTripId(tripId: string): void {\n    if (!tripId || typeof tripId !== 'string' || tripId.trim().length === 0) {\n      throw ValidationError.required('tripId', 'Participant');\n    }\n  }\n\n  /**\n   * Validates the participant name.\n   *\n   * @param name - The name to validate\n   * @throws {ValidationError} If name is invalid\n   */\n  private static validateName(name: string): void {\n    if (!name || typeof name !== 'string') {\n      throw ValidationError.required('name', 'Participant');\n    }\n\n    const trimmedName = name.trim();\n\n    if (trimmedName.length < Participant.MIN_NAME_LENGTH) {\n      throw ValidationError.invalidLength(\n        'name',\n        Participant.MIN_NAME_LENGTH,\n        Participant.MAX_NAME_LENGTH,\n        trimmedName.length\n      );\n    }\n\n    if (trimmedName.length > Participant.MAX_NAME_LENGTH) {\n      throw ValidationError.invalidLength(\n        'name',\n        Participant.MIN_NAME_LENGTH,\n        Participant.MAX_NAME_LENGTH,\n        trimmedName.length\n      );\n    }\n  }\n\n  /**\n   * Validates the email address.\n   *\n   * @param email - The email to validate\n   * @throws {ValidationError} If email is invalid\n   */\n  private static validateEmail(email: string): void {\n    const trimmedEmail = email.trim();\n\n    if (trimmedEmail.length > 0 && !isValidEmail(trimmedEmail)) {\n      throw ValidationError.invalidFormat('email', 'valid email address', email);\n    }\n  }\n\n  /**\n   * Validates the notes.\n   *\n   * @param notes - The notes to validate\n   * @throws {ValidationError} If notes are invalid\n   */\n  private static validateNotes(notes: string): void {\n    if (notes.length > Participant.MAX_NOTES_LENGTH) {\n      throw ValidationError.invalidLength(\n        'notes',\n        undefined,\n        Participant.MAX_NOTES_LENGTH,\n        notes.length\n      );\n    }\n  }\n\n  /**\n   * Compares this participant with another for equality.\n   *\n   * @param other - The other participant to compare\n   * @returns True if the participants are equal (same ID)\n   */\n  public equals(other: Participant): boolean {\n    if (!(other instanceof Participant)) {\n      return false;\n    }\n    return this.id === other.id;\n  }\n}\n\n/**\n * Type alias for backward compatibility.\n * @deprecated Use Participant class directly\n */\nexport type ParticipantEntity = Participant;\n\n/**\n * Type alias for create props - backward compatibility.\n * @deprecated Use IParticipantCreateDTO instead\n */\nexport type CreateParticipantProps = IParticipantCreateDTO & { id?: string };\n\n/**\n * Factory function for backward compatibility.\n * @deprecated Use Participant.create() instead\n *\n * @param props - The participant creation properties\n * @returns A new Participant instance\n */\nexport function createParticipant(props: CreateParticipantProps): Participant {\n  return Participant.create({\n    tripId: props.tripId,\n    name: props.name,\n    email: props.email,\n    notes: props.notes,\n  });\n}\n","/**\n * @fileoverview Product entity for TripFood Manager.\n * Represents a food or beverage product that can be consumed during trips.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport { ValidationError } from '../errors';\nimport {\n  ProductCategory,\n  ProductType,\n  ProductUnit,\n  isProductCategory,\n  isProductType,\n  isProductUnit,\n  getCategoryForType,\n  PRODUCT_CATEGORIES,\n  PRODUCT_TYPES,\n  PRODUCT_UNITS,\n} from '../types';\n\n/**\n * Interface representing the data transfer object for creating a Product.\n */\nexport interface IProductCreateDTO {\n  /** Name of the product */\n  readonly name: string;\n  /** Category of the product (food, beverage, other) */\n  readonly category: ProductCategory;\n  /** Specific type of the product */\n  readonly type: ProductType;\n  /** Unit of measurement */\n  readonly unit: ProductUnit;\n  /** Default quantity per person (optional) */\n  readonly defaultQuantityPerPerson?: number | undefined;\n  /** Optional notes about the product */\n  readonly notes?: string | undefined;\n}\n\n/**\n * Interface representing the data transfer object for updating a Product.\n */\nexport interface IProductUpdateDTO {\n  /** New name for the product */\n  readonly name?: string;\n  /** New category for the product */\n  readonly category?: ProductCategory;\n  /** New type for the product */\n  readonly type?: ProductType;\n  /** New unit for the product */\n  readonly unit?: ProductUnit;\n  /** New default quantity per person (null to remove) */\n  readonly defaultQuantityPerPerson?: number | null;\n  /** New notes for the product (null to remove) */\n  readonly notes?: string | null;\n}\n\n/**\n * Interface representing the Product entity properties.\n */\nexport interface IProductProps {\n  /** Unique identifier */\n  readonly id: string;\n  /** Name of the product */\n  readonly name: string;\n  /** Category of the product */\n  readonly category: ProductCategory;\n  /** Specific type of the product */\n  readonly type: ProductType;\n  /** Unit of measurement */\n  readonly unit: ProductUnit;\n  /** Default quantity per person */\n  readonly defaultQuantityPerPerson?: number | undefined;\n  /** Optional notes about the product */\n  readonly notes?: string | undefined;\n  /** Timestamp when the product was created */\n  readonly createdAt: Date;\n  /** Timestamp when the product was last updated */\n  readonly updatedAt?: Date | undefined;\n}\n\n/**\n * Product entity representing a food or beverage item.\n *\n * @description\n * The Product entity represents items that can be consumed during trips.\n * Products are categorized by type (food/beverage) and have units of\n * measurement for tracking consumption quantities.\n *\n * All instances are immutable - updates return new instances.\n *\n * @example\n * ```typescript\n * // Create a new product\n * const product = Product.create({\n *   name: 'Bottled Water',\n *   category: 'beverage',\n *   type: 'water',\n *   unit: 'bottle',\n *   defaultQuantityPerPerson: 2,\n * });\n *\n * // Update the product\n * const updated = product.update({ defaultQuantityPerPerson: 3 });\n * ```\n *\n * @implements {IProductProps}\n */\nexport class Product implements IProductProps {\n  /**\n   * Minimum length for product name.\n   */\n  public static readonly MIN_NAME_LENGTH = 2;\n\n  /**\n   * Maximum length for product name.\n   */\n  public static readonly MAX_NAME_LENGTH = 100;\n\n  /**\n   * Maximum length for product notes.\n   */\n  public static readonly MAX_NOTES_LENGTH = 500;\n\n  /**\n   * Minimum default quantity per person.\n   */\n  public static readonly MIN_QUANTITY = 0.01;\n\n  /**\n   * Maximum default quantity per person.\n   */\n  public static readonly MAX_QUANTITY = 1000;\n\n  /**\n   * Unique identifier for the product.\n   * @readonly\n   */\n  public readonly id: string;\n\n  /**\n   * Name of the product.\n   * @readonly\n   */\n  public readonly name: string;\n\n  /**\n   * Category of the product (food, beverage, other).\n   * @readonly\n   */\n  public readonly category: ProductCategory;\n\n  /**\n   * Specific type of the product.\n   * @readonly\n   */\n  public readonly type: ProductType;\n\n  /**\n   * Unit of measurement for the product.\n   * @readonly\n   */\n  public readonly unit: ProductUnit;\n\n  /**\n   * Default quantity per person.\n   * @readonly\n   */\n  public readonly defaultQuantityPerPerson?: number | undefined;\n\n  /**\n   * Optional notes about the product.\n   * @readonly\n   */\n  public readonly notes?: string | undefined;\n\n  /**\n   * Timestamp when the product was created.\n   * @readonly\n   */\n  public readonly createdAt: Date;\n\n  /**\n   * Timestamp when the product was last updated.\n   * @readonly\n   */\n  public readonly updatedAt?: Date | undefined;\n\n  /**\n   * Private constructor to enforce factory method usage.\n   *\n   * @param props - The product properties\n   */\n  private constructor(props: IProductProps) {\n    this.id = props.id;\n    this.name = props.name;\n    this.category = props.category;\n    this.type = props.type;\n    this.unit = props.unit;\n    this.defaultQuantityPerPerson = props.defaultQuantityPerPerson;\n    this.notes = props.notes;\n    this.createdAt = new Date(props.createdAt);\n    this.updatedAt = props.updatedAt ? new Date(props.updatedAt) : undefined;\n\n    // Freeze the object to ensure immutability\n    Object.freeze(this);\n  }\n\n  /**\n   * Creates a new Product entity with validation.\n   *\n   * @param dto - The data transfer object containing product data\n   * @returns A new Product instance\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const product = Product.create({\n   *   name: 'Fresh Bread',\n   *   category: 'food',\n   *   type: 'grains',\n   *   unit: 'unit',\n   *   defaultQuantityPerPerson: 2,\n   * });\n   * ```\n   */\n  public static create(dto: IProductCreateDTO): Product {\n    // Validate name\n    Product.validateName(dto.name);\n\n    // Validate category\n    Product.validateCategory(dto.category);\n\n    // Validate type\n    Product.validateType(dto.type);\n\n    // Validate type matches category\n    Product.validateTypeMatchesCategory(dto.type, dto.category);\n\n    // Validate unit\n    Product.validateUnit(dto.unit);\n\n    // Validate default quantity if provided\n    if (dto.defaultQuantityPerPerson !== undefined) {\n      Product.validateQuantity(dto.defaultQuantityPerPerson);\n    }\n\n    // Validate notes if provided\n    if (dto.notes !== undefined) {\n      Product.validateNotes(dto.notes);\n    }\n\n    const now = new Date();\n\n    return new Product({\n      id: uuidv4(),\n      name: dto.name.trim(),\n      category: dto.category,\n      type: dto.type,\n      unit: dto.unit,\n      defaultQuantityPerPerson: dto.defaultQuantityPerPerson,\n      notes: dto.notes?.trim(),\n      createdAt: now,\n    });\n  }\n\n  /**\n   * Reconstructs a Product entity from persistence data.\n   *\n   * @param props - The product properties from persistence\n   * @returns A Product instance\n   */\n  public static fromPersistence(props: IProductProps): Product {\n    return new Product(props);\n  }\n\n  /**\n   * Updates the product with new values, returning a new instance.\n   *\n   * @param dto - The update data transfer object\n   * @returns A new Product instance with updated values\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const updated = product.update({\n   *   name: 'Whole Grain Bread',\n   *   defaultQuantityPerPerson: 3,\n   * });\n   * ```\n   */\n  public update(dto: IProductUpdateDTO): Product {\n    const newName = dto.name !== undefined ? dto.name : this.name;\n    const newCategory = dto.category !== undefined ? dto.category : this.category;\n    const newType = dto.type !== undefined ? dto.type : this.type;\n    const newUnit = dto.unit !== undefined ? dto.unit : this.unit;\n    const newDefaultQuantity = dto.defaultQuantityPerPerson === null\n      ? undefined\n      : dto.defaultQuantityPerPerson !== undefined\n        ? dto.defaultQuantityPerPerson\n        : this.defaultQuantityPerPerson;\n    const newNotes = dto.notes === null\n      ? undefined\n      : dto.notes !== undefined\n        ? dto.notes\n        : this.notes;\n\n    // Validate updated values\n    if (dto.name !== undefined) {\n      Product.validateName(dto.name);\n    }\n\n    if (dto.category !== undefined) {\n      Product.validateCategory(dto.category);\n    }\n\n    if (dto.type !== undefined) {\n      Product.validateType(dto.type);\n    }\n\n    // Validate type matches category if either changed\n    if (dto.type !== undefined || dto.category !== undefined) {\n      Product.validateTypeMatchesCategory(newType, newCategory);\n    }\n\n    if (dto.unit !== undefined) {\n      Product.validateUnit(dto.unit);\n    }\n\n    if (dto.defaultQuantityPerPerson !== undefined && dto.defaultQuantityPerPerson !== null) {\n      Product.validateQuantity(dto.defaultQuantityPerPerson);\n    }\n\n    if (dto.notes !== undefined && dto.notes !== null) {\n      Product.validateNotes(dto.notes);\n    }\n\n    return new Product({\n      id: this.id,\n      name: newName.trim(),\n      category: newCategory,\n      type: newType,\n      unit: newUnit,\n      defaultQuantityPerPerson: newDefaultQuantity,\n      notes: newNotes?.trim(),\n      createdAt: this.createdAt,\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Checks if the product is a food item.\n   *\n   * @returns True if the product is food\n   */\n  public isFood(): boolean {\n    return this.category === 'food';\n  }\n\n  /**\n   * Checks if the product is a beverage.\n   *\n   * @returns True if the product is a beverage\n   */\n  public isBeverage(): boolean {\n    return this.category === 'beverage';\n  }\n\n  /**\n   * Checks if the product has a default quantity per person.\n   *\n   * @returns True if the product has a default quantity\n   */\n  public hasDefaultQuantity(): boolean {\n    return this.defaultQuantityPerPerson !== undefined && this.defaultQuantityPerPerson > 0;\n  }\n\n  /**\n   * Calculates the total quantity needed for a given number of people.\n   *\n   * @param numberOfPeople - The number of people\n   * @returns The total quantity needed, or undefined if no default quantity\n   */\n  public calculateQuantityForPeople(numberOfPeople: number): number | undefined {\n    if (!this.hasDefaultQuantity() || this.defaultQuantityPerPerson === undefined) {\n      return undefined;\n    }\n\n    if (numberOfPeople <= 0) {\n      return 0;\n    }\n\n    return this.defaultQuantityPerPerson * numberOfPeople;\n  }\n\n  /**\n   * Converts the entity to a plain object for serialization.\n   *\n   * @returns Plain object representation of the product\n   */\n  public toJSON(): IProductProps {\n    return {\n      id: this.id,\n      name: this.name,\n      category: this.category,\n      type: this.type,\n      unit: this.unit,\n      defaultQuantityPerPerson: this.defaultQuantityPerPerson,\n      notes: this.notes,\n      createdAt: this.createdAt,\n      updatedAt: this.updatedAt,\n    };\n  }\n\n  /**\n   * Validates the product name.\n   *\n   * @param name - The name to validate\n   * @throws {ValidationError} If name is invalid\n   */\n  private static validateName(name: string): void {\n    if (!name || typeof name !== 'string') {\n      throw ValidationError.required('name', 'Product');\n    }\n\n    const trimmedName = name.trim();\n\n    if (trimmedName.length < Product.MIN_NAME_LENGTH) {\n      throw ValidationError.invalidLength(\n        'name',\n        Product.MIN_NAME_LENGTH,\n        Product.MAX_NAME_LENGTH,\n        trimmedName.length\n      );\n    }\n\n    if (trimmedName.length > Product.MAX_NAME_LENGTH) {\n      throw ValidationError.invalidLength(\n        'name',\n        Product.MIN_NAME_LENGTH,\n        Product.MAX_NAME_LENGTH,\n        trimmedName.length\n      );\n    }\n  }\n\n  /**\n   * Validates the product category.\n   *\n   * @param category - The category to validate\n   * @throws {ValidationError} If category is invalid\n   */\n  private static validateCategory(category: ProductCategory): void {\n    if (!isProductCategory(category)) {\n      throw new ValidationError(\n        `Invalid product category: '${String(category)}'. Valid categories are: ${PRODUCT_CATEGORIES.join(', ')}`,\n        'category',\n        'enum'\n      );\n    }\n  }\n\n  /**\n   * Validates the product type.\n   *\n   * @param type - The type to validate\n   * @throws {ValidationError} If type is invalid\n   */\n  private static validateType(type: ProductType): void {\n    if (!isProductType(type)) {\n      throw new ValidationError(\n        `Invalid product type: '${String(type)}'. Valid types are: ${PRODUCT_TYPES.join(', ')}`,\n        'type',\n        'enum'\n      );\n    }\n  }\n\n  /**\n   * Validates that product type matches the category.\n   *\n   * @param type - The product type\n   * @param category - The product category\n   * @throws {ValidationError} If type doesn't match category\n   */\n  private static validateTypeMatchesCategory(\n    type: ProductType,\n    category: ProductCategory\n  ): void {\n    const expectedCategory = getCategoryForType(type);\n\n    if (expectedCategory !== category) {\n      throw new ValidationError(\n        `Product type '${type}' does not belong to category '${category}'. ` +\n        `Expected category: '${expectedCategory}'`,\n        'type',\n        'categoryMismatch'\n      );\n    }\n  }\n\n  /**\n   * Validates the product unit.\n   *\n   * @param unit - The unit to validate\n   * @throws {ValidationError} If unit is invalid\n   */\n  private static validateUnit(unit: ProductUnit): void {\n    if (!isProductUnit(unit)) {\n      throw new ValidationError(\n        `Invalid product unit: '${String(unit)}'. Valid units are: ${PRODUCT_UNITS.join(', ')}`,\n        'unit',\n        'enum'\n      );\n    }\n  }\n\n  /**\n   * Validates the quantity.\n   *\n   * @param quantity - The quantity to validate\n   * @throws {ValidationError} If quantity is invalid\n   */\n  private static validateQuantity(quantity: number): void {\n    if (typeof quantity !== 'number' || isNaN(quantity)) {\n      throw ValidationError.invalidFormat('defaultQuantityPerPerson', 'number');\n    }\n\n    if (quantity < Product.MIN_QUANTITY || quantity > Product.MAX_QUANTITY) {\n      throw ValidationError.outOfRange(\n        'defaultQuantityPerPerson',\n        Product.MIN_QUANTITY,\n        Product.MAX_QUANTITY,\n        quantity\n      );\n    }\n  }\n\n  /**\n   * Validates the notes.\n   *\n   * @param notes - The notes to validate\n   * @throws {ValidationError} If notes are invalid\n   */\n  private static validateNotes(notes: string): void {\n    if (notes.length > Product.MAX_NOTES_LENGTH) {\n      throw ValidationError.invalidLength(\n        'notes',\n        undefined,\n        Product.MAX_NOTES_LENGTH,\n        notes.length\n      );\n    }\n  }\n\n  /**\n   * Compares this product with another for equality.\n   *\n   * @param other - The other product to compare\n   * @returns True if the products are equal (same ID)\n   */\n  public equals(other: Product): boolean {\n    if (!(other instanceof Product)) {\n      return false;\n    }\n    return this.id === other.id;\n  }\n}\n\n/**\n * Type alias for backward compatibility.\n * @deprecated Use Product class directly\n */\nexport type ProductEntity = Product;\n\n/**\n * Re-export ProductType from types for backward compatibility.\n * @deprecated Import from '../types' instead\n */\nexport type { ProductType } from '../types';\n\n/**\n * Type alias for create props - backward compatibility.\n * @deprecated Use IProductCreateDTO instead\n */\nexport interface CreateProductProps {\n  id?: string;\n  name: string;\n  category: string;\n  type: 'food' | 'beverage';\n  unit: string;\n  defaultQuantityPerPerson?: number;\n  notes?: string;\n}\n\n/**\n * Factory function for backward compatibility.\n * @deprecated Use Product.create() instead\n *\n * @param props - The product creation properties\n * @returns A new Product instance\n */\nexport function createProduct(props: CreateProductProps): Product {\n  // Map old 'food'/'beverage' type to new category and infer a default type\n  let category: ProductCategory;\n  let type: ProductType;\n\n  if (props.type === 'food') {\n    category = 'food';\n    type = 'prepared_food'; // Default type for food\n  } else {\n    category = 'beverage';\n    type = 'soft_drink'; // Default type for beverage\n  }\n\n  // Map unit string to ProductUnit, defaulting to 'unit' if not recognized\n  const unit = isProductUnit(props.unit) ? props.unit : 'unit';\n\n  return Product.create({\n    name: props.name,\n    category,\n    type,\n    unit,\n    defaultQuantityPerPerson: props.defaultQuantityPerPerson,\n    notes: props.notes,\n  });\n}\n","/**\n * @fileoverview Consumption entity for TripFood Manager.\n * Represents a record of product consumption by a participant.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport { ValidationError } from '../errors';\nimport { MealType, isMealType, MEAL_TYPES, normalizeToStartOfDay } from '../types';\n\n/**\n * Interface representing the data transfer object for creating a Consumption.\n */\nexport interface IConsumptionCreateDTO {\n  /** ID of the trip */\n  readonly tripId: string;\n  /** ID of the participant who consumed */\n  readonly participantId: string;\n  /** ID of the product consumed */\n  readonly productId: string;\n  /** Date of consumption */\n  readonly date: Date;\n  /** Meal type */\n  readonly meal: MealType;\n  /** Quantity consumed */\n  readonly quantity: number;\n}\n\n/**\n * Interface representing the data transfer object for updating a Consumption.\n */\nexport interface IConsumptionUpdateDTO {\n  /** New participant ID */\n  readonly participantId?: string;\n  /** New product ID */\n  readonly productId?: string;\n  /** New date for the consumption */\n  readonly date?: Date;\n  /** New meal type */\n  readonly meal?: MealType;\n  /** New quantity */\n  readonly quantity?: number;\n  /** New notes (null to remove) */\n  readonly notes?: string | null;\n}\n\n/**\n * Interface representing the Consumption entity properties.\n */\nexport interface IConsumptionProps {\n  /** Unique identifier */\n  readonly id: string;\n  /** ID of the trip */\n  readonly tripId: string;\n  /** ID of the participant who consumed */\n  readonly participantId: string;\n  /** ID of the product consumed */\n  readonly productId: string;\n  /** Date of consumption */\n  readonly date: Date;\n  /** Meal type */\n  readonly meal: MealType;\n  /** Quantity consumed */\n  readonly quantity: number;\n  /** Timestamp when the record was created */\n  readonly createdAt: Date;\n  /** Timestamp when the record was last updated */\n  readonly updatedAt?: Date | undefined;\n}\n\n/**\n * Consumption entity representing a consumption record.\n *\n * @description\n * The Consumption entity tracks when a participant consumes a product\n * during a trip. It records the date, meal type, and quantity consumed.\n *\n * All instances are immutable - updates return new instances.\n *\n * @example\n * ```typescript\n * // Create a new consumption record\n * const consumption = Consumption.create({\n *   tripId: 'trip-123',\n *   participantId: 'participant-456',\n *   productId: 'product-789',\n *   date: new Date('2024-07-15'),\n *   meal: 'lunch',\n *   quantity: 2,\n * });\n *\n * // Update the consumption\n * const updated = consumption.update({ quantity: 3 });\n * ```\n *\n * @implements {IConsumptionProps}\n */\nexport class Consumption implements IConsumptionProps {\n  /**\n   * Minimum quantity that can be consumed.\n   */\n  public static readonly MIN_QUANTITY = 0.01;\n\n  /**\n   * Maximum quantity that can be consumed.\n   */\n  public static readonly MAX_QUANTITY = 10000;\n\n  /**\n   * Unique identifier for the consumption record.\n   * @readonly\n   */\n  public readonly id: string;\n\n  /**\n   * ID of the trip this consumption belongs to.\n   * @readonly\n   */\n  public readonly tripId: string;\n\n  /**\n   * ID of the participant who consumed.\n   * @readonly\n   */\n  public readonly participantId: string;\n\n  /**\n   * ID of the product consumed.\n   * @readonly\n   */\n  public readonly productId: string;\n\n  /**\n   * Date of consumption.\n   * @readonly\n   */\n  public readonly date: Date;\n\n  /**\n   * Meal type (breakfast, lunch, dinner, snack).\n   * @readonly\n   */\n  public readonly meal: MealType;\n\n  /**\n   * Quantity consumed.\n   * @readonly\n   */\n  public readonly quantity: number;\n\n  /**\n   * Timestamp when the record was created.\n   * @readonly\n   */\n  public readonly createdAt: Date;\n\n  /**\n   * Timestamp when the record was last updated.\n   * @readonly\n   */\n  public readonly updatedAt?: Date | undefined;\n\n  /**\n   * Private constructor to enforce factory method usage.\n   *\n   * @param props - The consumption properties\n   */\n  private constructor(props: IConsumptionProps) {\n    this.id = props.id;\n    this.tripId = props.tripId;\n    this.participantId = props.participantId;\n    this.productId = props.productId;\n    this.date = normalizeToStartOfDay(new Date(props.date));\n    this.meal = props.meal;\n    this.quantity = props.quantity;\n    this.createdAt = new Date(props.createdAt);\n    this.updatedAt = props.updatedAt ? new Date(props.updatedAt) : undefined;\n\n    // Freeze the object to ensure immutability\n    Object.freeze(this);\n  }\n\n  /**\n   * Creates a new Consumption entity with validation.\n   *\n   * @param dto - The data transfer object containing consumption data\n   * @returns A new Consumption instance\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const consumption = Consumption.create({\n   *   tripId: 'trip-123',\n   *   participantId: 'participant-456',\n   *   productId: 'product-789',\n   *   date: new Date('2024-07-15'),\n   *   meal: 'dinner',\n   *   quantity: 1,\n   * });\n   * ```\n   */\n  public static create(dto: IConsumptionCreateDTO): Consumption {\n    // Validate tripId\n    Consumption.validateTripId(dto.tripId);\n\n    // Validate participantId\n    Consumption.validateParticipantId(dto.participantId);\n\n    // Validate productId\n    Consumption.validateProductId(dto.productId);\n\n    // Validate date\n    Consumption.validateDate(dto.date);\n\n    // Validate meal\n    Consumption.validateMeal(dto.meal);\n\n    // Validate quantity\n    Consumption.validateQuantity(dto.quantity);\n\n    const now = new Date();\n\n    return new Consumption({\n      id: uuidv4(),\n      tripId: dto.tripId,\n      participantId: dto.participantId,\n      productId: dto.productId,\n      date: dto.date,\n      meal: dto.meal,\n      quantity: dto.quantity,\n      createdAt: now,\n    });\n  }\n\n  /**\n   * Reconstructs a Consumption entity from persistence data.\n   *\n   * @param props - The consumption properties from persistence\n   * @returns A Consumption instance\n   */\n  public static fromPersistence(props: IConsumptionProps): Consumption {\n    return new Consumption(props);\n  }\n\n  /**\n   * Updates the consumption with new values, returning a new instance.\n   *\n   * @param dto - The update data transfer object\n   * @returns A new Consumption instance with updated values\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const updated = consumption.update({\n   *   meal: 'dinner',\n   *   quantity: 2.5,\n   * });\n   * ```\n   */\n  public update(dto: IConsumptionUpdateDTO): Consumption {\n    const newDate = dto.date !== undefined ? dto.date : this.date;\n    const newMeal = dto.meal !== undefined ? dto.meal : this.meal;\n    const newQuantity = dto.quantity !== undefined ? dto.quantity : this.quantity;\n\n    // Validate updated values\n    if (dto.date !== undefined) {\n      Consumption.validateDate(dto.date);\n    }\n\n    if (dto.meal !== undefined) {\n      Consumption.validateMeal(dto.meal);\n    }\n\n    if (dto.quantity !== undefined) {\n      Consumption.validateQuantity(dto.quantity);\n    }\n\n    return new Consumption({\n      id: this.id,\n      tripId: this.tripId,\n      participantId: this.participantId,\n      productId: this.productId,\n      date: newDate,\n      meal: newMeal,\n      quantity: newQuantity,\n      createdAt: this.createdAt,\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Checks if this consumption belongs to a specific trip.\n   *\n   * @param tripId - The trip ID to check\n   * @returns True if the consumption belongs to the trip\n   */\n  public belongsToTrip(tripId: string): boolean {\n    return this.tripId === tripId;\n  }\n\n  /**\n   * Checks if this consumption was made by a specific participant.\n   *\n   * @param participantId - The participant ID to check\n   * @returns True if the consumption was made by the participant\n   */\n  public isFromParticipant(participantId: string): boolean {\n    return this.participantId === participantId;\n  }\n\n  /**\n   * Checks if this consumption is for a specific product.\n   *\n   * @param productId - The product ID to check\n   * @returns True if the consumption is for the product\n   */\n  public isForProduct(productId: string): boolean {\n    return this.productId === productId;\n  }\n\n  /**\n   * Checks if this consumption occurred on a specific date.\n   *\n   * @param date - The date to check\n   * @returns True if the consumption occurred on the date\n   */\n  public isOnDate(date: Date): boolean {\n    const normalizedInput = normalizeToStartOfDay(date);\n    return this.date.getTime() === normalizedInput.getTime();\n  }\n\n  /**\n   * Checks if this consumption was for a specific meal.\n   *\n   * @param meal - The meal type to check\n   * @returns True if the consumption was for the meal\n   */\n  public isForMeal(meal: MealType): boolean {\n    return this.meal === meal;\n  }\n\n  /**\n   * Gets a formatted string representation of the date.\n   *\n   * @returns ISO date string (YYYY-MM-DD)\n   */\n  public getDateString(): string {\n    return this.date.toISOString().split('T')[0] ?? '';\n  }\n\n  /**\n   * Converts the entity to a plain object for serialization.\n   *\n   * @returns Plain object representation of the consumption\n   */\n  public toJSON(): IConsumptionProps {\n    return {\n      id: this.id,\n      tripId: this.tripId,\n      participantId: this.participantId,\n      productId: this.productId,\n      date: this.date,\n      meal: this.meal,\n      quantity: this.quantity,\n      createdAt: this.createdAt,\n      updatedAt: this.updatedAt,\n    };\n  }\n\n  /**\n   * Validates the trip ID.\n   *\n   * @param tripId - The trip ID to validate\n   * @throws {ValidationError} If tripId is invalid\n   */\n  private static validateTripId(tripId: string): void {\n    if (!tripId || typeof tripId !== 'string' || tripId.trim().length === 0) {\n      throw ValidationError.required('tripId', 'Consumption');\n    }\n  }\n\n  /**\n   * Validates the participant ID.\n   *\n   * @param participantId - The participant ID to validate\n   * @throws {ValidationError} If participantId is invalid\n   */\n  private static validateParticipantId(participantId: string): void {\n    if (!participantId || typeof participantId !== 'string' || participantId.trim().length === 0) {\n      throw ValidationError.required('participantId', 'Consumption');\n    }\n  }\n\n  /**\n   * Validates the product ID.\n   *\n   * @param productId - The product ID to validate\n   * @throws {ValidationError} If productId is invalid\n   */\n  private static validateProductId(productId: string): void {\n    if (!productId || typeof productId !== 'string' || productId.trim().length === 0) {\n      throw ValidationError.required('productId', 'Consumption');\n    }\n  }\n\n  /**\n   * Validates the date.\n   *\n   * @param date - The date to validate\n   * @throws {ValidationError} If date is invalid\n   */\n  private static validateDate(date: Date): void {\n    if (!date || !(date instanceof Date) || isNaN(date.getTime())) {\n      throw ValidationError.required('date', 'Consumption');\n    }\n  }\n\n  /**\n   * Validates the meal type.\n   *\n   * @param meal - The meal to validate\n   * @throws {ValidationError} If meal is invalid\n   */\n  private static validateMeal(meal: MealType): void {\n    if (!isMealType(meal)) {\n      throw new ValidationError(\n        `Invalid meal type: '${String(meal)}'. Valid types are: ${MEAL_TYPES.join(', ')}`,\n        'meal',\n        'enum'\n      );\n    }\n  }\n\n  /**\n   * Validates the quantity.\n   *\n   * @param quantity - The quantity to validate\n   * @throws {ValidationError} If quantity is invalid\n   */\n  private static validateQuantity(quantity: number): void {\n    if (typeof quantity !== 'number' || isNaN(quantity)) {\n      throw ValidationError.invalidFormat('quantity', 'number');\n    }\n\n    if (quantity < Consumption.MIN_QUANTITY || quantity > Consumption.MAX_QUANTITY) {\n      throw ValidationError.outOfRange(\n        'quantity',\n        Consumption.MIN_QUANTITY,\n        Consumption.MAX_QUANTITY,\n        quantity\n      );\n    }\n  }\n\n  /**\n   * Compares this consumption with another for equality.\n   *\n   * @param other - The other consumption to compare\n   * @returns True if the consumptions are equal (same ID)\n   */\n  public equals(other: Consumption): boolean {\n    if (!(other instanceof Consumption)) {\n      return false;\n    }\n    return this.id === other.id;\n  }\n}\n\n/**\n * Type alias for backward compatibility.\n * @deprecated Use Consumption class directly\n */\nexport type ConsumptionEntity = Consumption;\n\n/**\n * Re-export MealType from types for backward compatibility.\n * @deprecated Import from '../types' instead\n */\nexport type { MealType } from '../types';\n\n/**\n * Type alias for create props - backward compatibility.\n * @deprecated Use IConsumptionCreateDTO instead\n */\nexport interface CreateConsumptionProps {\n  id?: string;\n  tripId: string;\n  participantId: string;\n  productId: string;\n  date: Date;\n  meal: MealType;\n  quantity: number;\n}\n\n/**\n * Factory function for backward compatibility.\n * @deprecated Use Consumption.create() instead\n *\n * @param props - The consumption creation properties\n * @returns A new Consumption instance\n */\nexport function createConsumption(props: CreateConsumptionProps): Consumption {\n  return Consumption.create({\n    tripId: props.tripId,\n    participantId: props.participantId,\n    productId: props.productId,\n    date: props.date,\n    meal: props.meal,\n    quantity: props.quantity,\n  });\n}\n","/**\n * @fileoverview Availability entity for TripFood Manager.\n * Represents a participant's availability for meals on a specific date.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport { ValidationError } from '../errors';\nimport { MealType, isMealType, MEAL_TYPES, normalizeToStartOfDay, sortMealsByOrder } from '../types';\n\n/**\n * Interface representing the data transfer object for creating an Availability.\n */\nexport interface IAvailabilityCreateDTO {\n  /** ID of the participant */\n  readonly participantId: string;\n  /** ID of the trip */\n  readonly tripId: string;\n  /** Date of availability */\n  readonly date: Date;\n  /** Array of meals the participant will be present for */\n  readonly meals: ReadonlyArray<MealType>;\n}\n\n/**\n * Interface representing the data transfer object for updating an Availability.\n */\nexport interface IAvailabilityUpdateDTO {\n  /** New date for the availability */\n  readonly date?: Date;\n  /** New meals array */\n  readonly meals?: ReadonlyArray<MealType>;\n}\n\n/**\n * Interface representing the Availability entity properties.\n */\nexport interface IAvailabilityProps {\n  /** Unique identifier */\n  readonly id: string;\n  /** ID of the participant */\n  readonly participantId: string;\n  /** ID of the trip */\n  readonly tripId: string;\n  /** Date of availability */\n  readonly date: Date;\n  /** Array of meals the participant will be present for */\n  readonly meals: ReadonlyArray<MealType>;\n  /** Timestamp when the availability was created */\n  readonly createdAt: Date;\n  /** Timestamp when the availability was last updated */\n  readonly updatedAt?: Date | undefined;\n}\n\n/**\n * Availability entity representing when a participant is available for meals.\n *\n * @description\n * The Availability entity tracks which meals a participant will attend\n * on a specific date during a trip. This information is used to calculate\n * how much food/beverages are needed.\n *\n * All instances are immutable - updates return new instances.\n *\n * @example\n * ```typescript\n * // Create a new availability record\n * const availability = Availability.create({\n *   participantId: 'participant-123',\n *   tripId: 'trip-456',\n *   date: new Date('2024-07-15'),\n *   meals: ['breakfast', 'lunch', 'dinner'],\n * });\n *\n * // Update the availability\n * const updated = availability.update({ meals: ['lunch', 'dinner'] });\n * ```\n *\n * @implements {IAvailabilityProps}\n */\nexport class Availability implements IAvailabilityProps {\n  /**\n   * Unique identifier for the availability record.\n   * @readonly\n   */\n  public readonly id: string;\n\n  /**\n   * ID of the participant.\n   * @readonly\n   */\n  public readonly participantId: string;\n\n  /**\n   * ID of the trip.\n   * @readonly\n   */\n  public readonly tripId: string;\n\n  /**\n   * Date of availability.\n   * @readonly\n   */\n  public readonly date: Date;\n\n  /**\n   * Array of meals the participant will be present for.\n   * @readonly\n   */\n  public readonly meals: ReadonlyArray<MealType>;\n\n  /**\n   * Timestamp when the availability was created.\n   * @readonly\n   */\n  public readonly createdAt: Date;\n\n  /**\n   * Timestamp when the availability was last updated.\n   * @readonly\n   */\n  public readonly updatedAt?: Date | undefined;\n\n  /**\n   * Private constructor to enforce factory method usage.\n   *\n   * @param props - The availability properties\n   */\n  private constructor(props: IAvailabilityProps) {\n    this.id = props.id;\n    this.participantId = props.participantId;\n    this.tripId = props.tripId;\n    this.date = normalizeToStartOfDay(new Date(props.date));\n    // Sort and deduplicate meals\n    this.meals = Object.freeze(\n      sortMealsByOrder([...new Set(props.meals)])\n    );\n    this.createdAt = new Date(props.createdAt);\n    this.updatedAt = props.updatedAt ? new Date(props.updatedAt) : undefined;\n\n    // Freeze the object to ensure immutability\n    Object.freeze(this);\n  }\n\n  /**\n   * Creates a new Availability entity with validation.\n   *\n   * @param dto - The data transfer object containing availability data\n   * @returns A new Availability instance\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const availability = Availability.create({\n   *   participantId: 'participant-123',\n   *   tripId: 'trip-456',\n   *   date: new Date('2024-07-15'),\n   *   meals: ['breakfast', 'dinner'],\n   * });\n   * ```\n   */\n  public static create(dto: IAvailabilityCreateDTO): Availability {\n    // Validate participantId\n    Availability.validateParticipantId(dto.participantId);\n\n    // Validate tripId\n    Availability.validateTripId(dto.tripId);\n\n    // Validate date\n    Availability.validateDate(dto.date);\n\n    // Validate meals\n    Availability.validateMeals(dto.meals);\n\n    const now = new Date();\n\n    return new Availability({\n      id: uuidv4(),\n      participantId: dto.participantId,\n      tripId: dto.tripId,\n      date: dto.date,\n      meals: dto.meals,\n      createdAt: now,\n    });\n  }\n\n  /**\n   * Reconstructs an Availability entity from persistence data.\n   *\n   * @param props - The availability properties from persistence\n   * @returns An Availability instance\n   */\n  public static fromPersistence(props: IAvailabilityProps): Availability {\n    return new Availability(props);\n  }\n\n  /**\n   * Updates the availability with new values, returning a new instance.\n   *\n   * @param dto - The update data transfer object\n   * @returns A new Availability instance with updated values\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const updated = availability.update({\n   *   meals: ['breakfast', 'lunch'],\n   * });\n   * ```\n   */\n  public update(dto: IAvailabilityUpdateDTO): Availability {\n    const newDate = dto.date !== undefined ? dto.date : this.date;\n    const newMeals = dto.meals !== undefined ? dto.meals : this.meals;\n\n    // Validate updated values\n    if (dto.date !== undefined) {\n      Availability.validateDate(dto.date);\n    }\n\n    if (dto.meals !== undefined) {\n      Availability.validateMeals(dto.meals);\n    }\n\n    return new Availability({\n      id: this.id,\n      participantId: this.participantId,\n      tripId: this.tripId,\n      date: newDate,\n      meals: newMeals,\n      createdAt: this.createdAt,\n      updatedAt: new Date(),\n    });\n  }\n\n  /**\n   * Checks if the participant is available for a specific meal.\n   *\n   * @param meal - The meal to check\n   * @returns True if the participant is available for the meal\n   */\n  public isAvailableForMeal(meal: MealType): boolean {\n    return this.meals.includes(meal);\n  }\n\n  /**\n   * Checks if the participant is available for all meals.\n   *\n   * @returns True if the participant is available for all meals\n   */\n  public isAvailableForAllMeals(): boolean {\n    return MEAL_TYPES.every((meal) => this.meals.includes(meal));\n  }\n\n  /**\n   * Checks if the participant is not available for any meals.\n   *\n   * @returns True if the participant is not available for any meals\n   */\n  public isNotAvailable(): boolean {\n    return this.meals.length === 0;\n  }\n\n  /**\n   * Gets the number of meals the participant is available for.\n   *\n   * @returns The count of meals\n   */\n  public getMealCount(): number {\n    return this.meals.length;\n  }\n\n  /**\n   * Adds a meal to the availability, returning a new instance.\n   *\n   * @param meal - The meal to add\n   * @returns A new Availability instance with the meal added\n   */\n  public addMeal(meal: MealType): Availability {\n    if (this.isAvailableForMeal(meal)) {\n      return this; // Already available for this meal\n    }\n\n    return this.update({\n      meals: [...this.meals, meal],\n    });\n  }\n\n  /**\n   * Removes a meal from the availability, returning a new instance.\n   *\n   * @param meal - The meal to remove\n   * @returns A new Availability instance with the meal removed\n   */\n  public removeMeal(meal: MealType): Availability {\n    if (!this.isAvailableForMeal(meal)) {\n      return this; // Not available for this meal anyway\n    }\n\n    return this.update({\n      meals: this.meals.filter((m) => m !== meal),\n    });\n  }\n\n  /**\n   * Sets availability for all meals.\n   *\n   * @returns A new Availability instance with all meals\n   */\n  public setAvailableForAllMeals(): Availability {\n    return this.update({\n      meals: [...MEAL_TYPES],\n    });\n  }\n\n  /**\n   * Clears all meal availability.\n   *\n   * @returns A new Availability instance with no meals\n   */\n  public clearAllMeals(): Availability {\n    return this.update({\n      meals: [],\n    });\n  }\n\n  /**\n   * Checks if this availability belongs to a specific trip.\n   *\n   * @param tripId - The trip ID to check\n   * @returns True if the availability belongs to the trip\n   */\n  public belongsToTrip(tripId: string): boolean {\n    return this.tripId === tripId;\n  }\n\n  /**\n   * Checks if this availability is for a specific participant.\n   *\n   * @param participantId - The participant ID to check\n   * @returns True if the availability is for the participant\n   */\n  public isForParticipant(participantId: string): boolean {\n    return this.participantId === participantId;\n  }\n\n  /**\n   * Checks if this availability is for a specific date.\n   *\n   * @param date - The date to check\n   * @returns True if the availability is for the date\n   */\n  public isOnDate(date: Date): boolean {\n    const normalizedInput = normalizeToStartOfDay(date);\n    return this.date.getTime() === normalizedInput.getTime();\n  }\n\n  /**\n   * Gets a formatted string representation of the date.\n   *\n   * @returns ISO date string (YYYY-MM-DD)\n   */\n  public getDateString(): string {\n    return this.date.toISOString().split('T')[0] ?? '';\n  }\n\n  /**\n   * Converts the entity to a plain object for serialization.\n   *\n   * @returns Plain object representation of the availability\n   */\n  public toJSON(): IAvailabilityProps {\n    return {\n      id: this.id,\n      participantId: this.participantId,\n      tripId: this.tripId,\n      date: this.date,\n      meals: [...this.meals],\n      createdAt: this.createdAt,\n      updatedAt: this.updatedAt,\n    };\n  }\n\n  /**\n   * Validates the participant ID.\n   *\n   * @param participantId - The participant ID to validate\n   * @throws {ValidationError} If participantId is invalid\n   */\n  private static validateParticipantId(participantId: string): void {\n    if (!participantId || typeof participantId !== 'string' || participantId.trim().length === 0) {\n      throw ValidationError.required('participantId', 'Availability');\n    }\n  }\n\n  /**\n   * Validates the trip ID.\n   *\n   * @param tripId - The trip ID to validate\n   * @throws {ValidationError} If tripId is invalid\n   */\n  private static validateTripId(tripId: string): void {\n    if (!tripId || typeof tripId !== 'string' || tripId.trim().length === 0) {\n      throw ValidationError.required('tripId', 'Availability');\n    }\n  }\n\n  /**\n   * Validates the date.\n   *\n   * @param date - The date to validate\n   * @throws {ValidationError} If date is invalid\n   */\n  private static validateDate(date: Date): void {\n    if (!date || !(date instanceof Date) || isNaN(date.getTime())) {\n      throw ValidationError.required('date', 'Availability');\n    }\n  }\n\n  /**\n   * Validates the meals array.\n   *\n   * @param meals - The meals to validate\n   * @throws {ValidationError} If meals are invalid\n   */\n  private static validateMeals(meals: ReadonlyArray<MealType>): void {\n    if (!Array.isArray(meals)) {\n      throw new ValidationError(\n        'meals must be an array',\n        'meals',\n        'type'\n      );\n    }\n\n    for (const meal of meals) {\n      if (!isMealType(meal)) {\n        throw new ValidationError(\n          `Invalid meal type: '${String(meal)}'. Valid types are: ${MEAL_TYPES.join(', ')}`,\n          'meals',\n          'enum'\n        );\n      }\n    }\n  }\n\n  /**\n   * Compares this availability with another for equality.\n   *\n   * @param other - The other availability to compare\n   * @returns True if the availabilities are equal (same ID)\n   */\n  public equals(other: Availability): boolean {\n    if (!(other instanceof Availability)) {\n      return false;\n    }\n    return this.id === other.id;\n  }\n}\n\n/**\n * Type alias for backward compatibility.\n * @deprecated Use Availability class directly\n */\nexport type AvailabilityEntity = Availability;\n\n/**\n * Type alias for create props - backward compatibility.\n * @deprecated Use IAvailabilityCreateDTO instead\n */\nexport interface CreateAvailabilityProps {\n  id?: string;\n  participantId: string;\n  tripId: string;\n  date: Date;\n  meals: MealType[];\n}\n\n/**\n * Factory function for backward compatibility.\n * @deprecated Use Availability.create() instead\n *\n * @param props - The availability creation properties\n * @returns A new Availability instance\n */\nexport function createAvailability(props: CreateAvailabilityProps): Availability {\n  return Availability.create({\n    participantId: props.participantId,\n    tripId: props.tripId,\n    date: props.date,\n    meals: props.meals,\n  });\n}\n","/**\n * @fileoverview Trip Application Service.\n * Handles business logic and orchestration for Trip operations.\n * Follows SOLID principles with single responsibility and dependency injection.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n * @module application/services/TripService\n */\n\nimport type { Trip, ITripCreateDTO, ITripUpdateDTO } from '@domain/entities/Trip';\nimport type { ITripRepository } from '@domain/interfaces/repositories/ITripRepository';\nimport type { IParticipantRepository } from '@domain/interfaces/repositories/IParticipantRepository';\nimport type { IConsumptionRepository } from '@domain/interfaces/repositories/IConsumptionRepository';\nimport type { IAvailabilityRepository } from '@domain/interfaces/repositories/IAvailabilityRepository';\nimport { NotFoundError, ValidationError, DomainError, DomainErrorCode } from '@domain/errors';\nimport type { CreateTripDTO, UpdateTripDTO, TripResponseDTO, TripDetailResponseDTO } from '../dtos/trip';\n\n/**\n * Application service for Trip operations.\n *\n * @description\n * This service provides the application layer interface for Trip operations.\n * It handles:\n * - CRUD operations for trips\n * - Business rule validation\n * - Data transformation between DTOs and domain entities\n * - Orchestration of repository operations\n * - Cascade operations for related entities\n *\n * @example\n * ```typescript\n * const tripService = new TripService(\n *   tripRepository,\n *   participantRepository,\n *   consumptionRepository,\n *   availabilityRepository\n * );\n *\n * const trip = await tripService.create({\n *   name: 'Summer Vacation',\n *   startDate: new Date('2024-07-01'),\n *   endDate: new Date('2024-07-15'),\n * });\n * ```\n */\nexport class TripService {\n  /**\n   * Creates a new TripService instance.\n   *\n   * @param tripRepository - Repository for Trip persistence operations\n   * @param participantRepository - Repository for Participant operations (optional, for dependency checks)\n   * @param consumptionRepository - Repository for Consumption operations (optional, for cascade deletes)\n   * @param availabilityRepository - Repository for Availability operations (optional, for cascade deletes)\n   */\n  constructor(\n    private readonly tripRepository: ITripRepository,\n    private readonly participantRepository?: IParticipantRepository,\n    private readonly consumptionRepository?: IConsumptionRepository,\n    private readonly availabilityRepository?: IAvailabilityRepository\n  ) {}\n\n  /**\n   * Creates a new trip.\n   *\n   * @param dto - The trip creation data\n   * @returns Promise resolving to the created trip\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const trip = await tripService.create({\n   *   name: 'Beach Trip 2024',\n   *   description: 'Annual beach trip with friends',\n   *   startDate: new Date('2024-07-01'),\n   *   endDate: new Date('2024-07-07'),\n   * });\n   * ```\n   */\n  public async create(dto: CreateTripDTO): Promise<Trip> {\n    // Validate business rules\n    this.validateCreateDTO(dto);\n\n    // Create domain entity (entity performs its own validation)\n    const { Trip } = await import('@domain/entities/Trip');\n    const trip = Trip.create({\n      name: dto.name,\n      description: dto.description,\n      startDate: dto.startDate,\n      endDate: dto.endDate,\n    });\n\n    // Persist the entity\n    return this.tripRepository.save(trip);\n  }\n\n  /**\n   * Creates a new trip (alias for create using domain DTO).\n   *\n   * @param dto - The trip creation data using domain DTO\n   * @returns Promise resolving to the created trip\n   */\n  public async createTrip(dto: ITripCreateDTO): Promise<Trip> {\n    const { Trip } = await import('@domain/entities/Trip');\n    const trip = Trip.create(dto);\n    return this.tripRepository.save(trip);\n  }\n\n  /**\n   * Retrieves a trip by its ID.\n   *\n   * @param id - The trip's unique identifier\n   * @returns Promise resolving to the trip if found, null otherwise\n   *\n   * @example\n   * ```typescript\n   * const trip = await tripService.getById('trip-123');\n   * if (trip) {\n   *   console.log(trip.name);\n   * }\n   * ```\n   */\n  public async getById(id: string): Promise<Trip | null> {\n    return this.tripRepository.findById(id);\n  }\n\n  /**\n   * Retrieves a trip by ID, throwing if not found.\n   *\n   * @param id - The trip's unique identifier\n   * @returns Promise resolving to the trip\n   * @throws {NotFoundError} If the trip is not found\n   *\n   * @example\n   * ```typescript\n   * try {\n   *   const trip = await tripService.getTripById('trip-123');\n   *   console.log(trip.name);\n   * } catch (error) {\n   *   if (error instanceof NotFoundError) {\n   *     console.log('Trip not found');\n   *   }\n   * }\n   * ```\n   */\n  public async getTripById(id: string): Promise<Trip> {\n    const trip = await this.tripRepository.findById(id);\n    if (!trip) {\n      throw NotFoundError.withId('Trip', id);\n    }\n    return trip;\n  }\n\n  /**\n   * Retrieves detailed trip information including related entity counts.\n   *\n   * @param id - The trip's unique identifier\n   * @returns Promise resolving to the detailed trip response\n   * @throws {NotFoundError} If the trip is not found\n   *\n   * @example\n   * ```typescript\n   * const tripDetails = await tripService.getDetails('trip-123');\n   * console.log(`Participants: ${tripDetails.participantCount}`);\n   * ```\n   */\n  public async getDetails(id: string): Promise<TripDetailResponseDTO> {\n    const trip = await this.tripRepository.findById(id);\n\n    if (!trip) {\n      throw NotFoundError.withId('Trip', id);\n    }\n\n    const participants = this.participantRepository\n      ? await this.participantRepository.findByTripId(id)\n      : [];\n    const consumptionCount = this.consumptionRepository\n      ? (await this.consumptionRepository.findByTripId(id)).length\n      : 0;\n\n    return this.toDetailResponseDTO(trip, participants, consumptionCount);\n  }\n\n  /**\n   * Retrieves all trips.\n   *\n   * @returns Promise resolving to array of trips\n   *\n   * @example\n   * ```typescript\n   * const trips = await tripService.getAll();\n   * console.log(`Total trips: ${trips.length}`);\n   * ```\n   */\n  public async getAll(): Promise<Trip[]> {\n    return this.tripRepository.findAll();\n  }\n\n  /**\n   * Retrieves all trips (alias for getAll).\n   *\n   * @returns Promise resolving to array of trips\n   */\n  public async getAllTrips(): Promise<Trip[]> {\n    return this.tripRepository.findAll();\n  }\n\n  /**\n   * Retrieves all trips ordered by start date (most recent first).\n   *\n   * @returns Promise resolving to array of trips\n   */\n  public async getAllTripsOrderedByStartDate(): Promise<Trip[]> {\n    return this.tripRepository.findAllOrderedByStartDate();\n  }\n\n  /**\n   * Retrieves all trips as response DTOs with participant counts.\n   *\n   * @returns Promise resolving to array of trip response DTOs\n   */\n  public async getAllAsResponseDTO(): Promise<TripResponseDTO[]> {\n    const trips = await this.tripRepository.findAll();\n\n    const responses: TripResponseDTO[] = [];\n    for (const trip of trips) {\n      const participantCount = this.participantRepository\n        ? await this.participantRepository.countByTripId(trip.id)\n        : 0;\n      responses.push(this.toResponseDTO(trip, participantCount));\n    }\n\n    return responses;\n  }\n\n  /**\n   * Searches trips by name.\n   *\n   * @param name - The name or partial name to search\n   * @returns Promise resolving to array of matching trips\n   *\n   * @example\n   * ```typescript\n   * const beachTrips = await tripService.searchByName('beach');\n   * ```\n   */\n  public async searchByName(name: string): Promise<Trip[]> {\n    return this.tripRepository.findByName(name);\n  }\n\n  /**\n   * Searches trips by name (alias for searchByName).\n   *\n   * @param name - The name or partial name to search\n   * @returns Promise resolving to array of matching trips\n   */\n  public async searchTripsByName(name: string): Promise<Trip[]> {\n    return this.tripRepository.findByName(name);\n  }\n\n  /**\n   * Finds trips active on a specific date.\n   *\n   * @param date - The date to check\n   * @returns Promise resolving to array of trips active on that date\n   */\n  public async findTripsByDate(date: Date): Promise<Trip[]> {\n    return this.tripRepository.findByDate(date);\n  }\n\n  /**\n   * Retrieves trips within a date range.\n   *\n   * @param startDate - Start of the date range\n   * @param endDate - End of the date range\n   * @returns Promise resolving to array of trips\n   * @throws {ValidationError} If date range is invalid\n   *\n   * @example\n   * ```typescript\n   * const julyTrips = await tripService.findTripsByDateRange(\n   *   new Date('2024-07-01'),\n   *   new Date('2024-07-31')\n   * );\n   * ```\n   */\n  public async findTripsByDateRange(startDate: Date, endDate: Date): Promise<Trip[]> {\n    if (startDate > endDate) {\n      throw ValidationError.invalidDateRange('startDate', 'endDate');\n    }\n\n    return this.tripRepository.findByDateRange(startDate, endDate);\n  }\n\n  /**\n   * Updates an existing trip.\n   *\n   * @param id - The trip's unique identifier\n   * @param dto - The update data\n   * @returns Promise resolving to the updated trip\n   * @throws {NotFoundError} If the trip is not found\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const updatedTrip = await tripService.update('trip-123', {\n   *   name: 'Updated Trip Name',\n   *   endDate: new Date('2024-07-20'),\n   * });\n   * ```\n   */\n  public async update(id: string, dto: UpdateTripDTO): Promise<Trip> {\n    // Find existing trip\n    const existingTrip = await this.tripRepository.findById(id);\n\n    if (!existingTrip) {\n      throw NotFoundError.withId('Trip', id);\n    }\n\n    // Validate business rules\n    this.validateUpdateDTO(dto, existingTrip);\n\n    // Update the domain entity\n    const updatedTrip = existingTrip.update({\n      name: dto.name,\n      description: dto.description,\n      startDate: dto.startDate,\n      endDate: dto.endDate,\n    });\n\n    // Persist the updated entity\n    return this.tripRepository.save(updatedTrip);\n  }\n\n  /**\n   * Updates an existing trip using domain DTO.\n   *\n   * @param id - The trip's unique identifier\n   * @param dto - The update data using domain DTO\n   * @returns Promise resolving to the updated trip\n   * @throws {NotFoundError} If the trip is not found\n   */\n  public async updateTrip(id: string, dto: ITripUpdateDTO): Promise<Trip> {\n    const trip = await this.getTripById(id);\n    const updatedTrip = trip.update(dto);\n    return this.tripRepository.save(updatedTrip);\n  }\n\n  /**\n   * Deletes a trip by ID.\n   *\n   * @param id - The trip's unique identifier\n   * @param force - If true, deletes even if trip has dependencies\n   * @returns Promise resolving when deletion is complete\n   * @throws {NotFoundError} If the trip is not found\n   * @throws {DomainError} If trip has dependencies and force is false\n   *\n   * @example\n   * ```typescript\n   * // Safe delete (fails if trip has participants)\n   * await tripService.delete('trip-123');\n   *\n   * // Force delete (removes all related data)\n   * await tripService.delete('trip-123', true);\n   * ```\n   */\n  public async delete(id: string, force: boolean = false): Promise<void> {\n    // Verify trip exists\n    const exists = await this.tripRepository.exists(id);\n\n    if (!exists) {\n      throw NotFoundError.withId('Trip', id);\n    }\n\n    // Check for dependencies if we have participant repository\n    if (this.participantRepository && !force) {\n      const participantCount = await this.participantRepository.countByTripId(id);\n\n      if (participantCount > 0) {\n        throw new DomainError(\n          `Cannot delete trip with ${participantCount} participant(s). Use force=true to delete all related data.`,\n          DomainErrorCode.BUSINESS_RULE_ERROR,\n          { tripId: id, participantCount }\n        );\n      }\n    }\n\n    // If force delete, remove all related data\n    if (force) {\n      if (this.consumptionRepository) {\n        await this.consumptionRepository.deleteByTripId(id);\n      }\n      if (this.availabilityRepository) {\n        await this.availabilityRepository.deleteByTripId(id);\n      }\n      if (this.participantRepository) {\n        await this.participantRepository.deleteByTripId(id);\n      }\n    }\n\n    // Delete the trip\n    await this.tripRepository.delete(id);\n  }\n\n  /**\n   * Deletes a trip by ID (simple version without force option).\n   *\n   * @param id - The trip's unique identifier\n   * @returns Promise resolving when deletion is complete\n   * @throws {NotFoundError} If the trip is not found\n   */\n  public async deleteTrip(id: string): Promise<void> {\n    const exists = await this.tripRepository.exists(id);\n    if (!exists) {\n      throw NotFoundError.withId('Trip', id);\n    }\n    await this.tripRepository.delete(id);\n  }\n\n  /**\n   * Checks if a trip exists.\n   *\n   * @param id - The trip's unique identifier\n   * @returns Promise resolving to true if the trip exists\n   */\n  public async exists(id: string): Promise<boolean> {\n    return this.tripRepository.exists(id);\n  }\n\n  /**\n   * Checks if a trip exists (alias for exists).\n   *\n   * @param id - The trip's unique identifier\n   * @returns Promise resolving to true if the trip exists\n   */\n  public async tripExists(id: string): Promise<boolean> {\n    return this.tripRepository.exists(id);\n  }\n\n  /**\n   * Gets the total count of trips.\n   *\n   * @returns Promise resolving to the count\n   */\n  public async count(): Promise<number> {\n    return this.tripRepository.count();\n  }\n\n  /**\n   * Gets the total count of trips (alias for count).\n   *\n   * @returns Promise resolving to the count\n   */\n  public async getTripCount(): Promise<number> {\n    return this.tripRepository.count();\n  }\n\n  /**\n   * Validates the create DTO.\n   *\n   * @param dto - The DTO to validate\n   * @throws {ValidationError} If validation fails\n   */\n  private validateCreateDTO(dto: CreateTripDTO): void {\n    if (!dto.name || dto.name.trim().length === 0) {\n      throw ValidationError.required('name', 'Trip');\n    }\n\n    if (!dto.startDate) {\n      throw ValidationError.required('startDate', 'Trip');\n    }\n\n    if (!dto.endDate) {\n      throw ValidationError.required('endDate', 'Trip');\n    }\n\n    if (!(dto.startDate instanceof Date) || isNaN(dto.startDate.getTime())) {\n      throw ValidationError.invalidFormat('startDate', 'valid Date');\n    }\n\n    if (!(dto.endDate instanceof Date) || isNaN(dto.endDate.getTime())) {\n      throw ValidationError.invalidFormat('endDate', 'valid Date');\n    }\n\n    if (dto.startDate > dto.endDate) {\n      throw ValidationError.invalidDateRange('startDate', 'endDate');\n    }\n  }\n\n  /**\n   * Validates the update DTO.\n   *\n   * @param dto - The DTO to validate\n   * @param existingTrip - The existing trip being updated\n   * @throws {ValidationError} If validation fails\n   */\n  private validateUpdateDTO(dto: UpdateTripDTO, existingTrip: Trip): void {\n    if (dto.name !== undefined && dto.name.trim().length === 0) {\n      throw ValidationError.invalidLength('name', 1, undefined, 0);\n    }\n\n    // Validate date consistency\n    const newStartDate = dto.startDate ?? existingTrip.startDate;\n    const newEndDate = dto.endDate ?? existingTrip.endDate;\n\n    if (newStartDate > newEndDate) {\n      throw ValidationError.invalidDateRange('startDate', 'endDate');\n    }\n  }\n\n  /**\n   * Transforms a Trip entity to a response DTO.\n   *\n   * @param trip - The trip entity\n   * @param participantCount - Number of participants in the trip\n   * @returns The response DTO\n   */\n  private toResponseDTO(trip: Trip, participantCount: number): TripResponseDTO {\n    return {\n      id: trip.id,\n      name: trip.name,\n      description: trip.description,\n      startDate: trip.startDate,\n      endDate: trip.endDate,\n      durationDays: trip.getDurationInDays(),\n      participantCount,\n      createdAt: trip.createdAt,\n      updatedAt: trip.updatedAt ?? trip.createdAt,\n    };\n  }\n\n  /**\n   * Transforms a Trip entity to a detailed response DTO.\n   *\n   * @param trip - The trip entity\n   * @param participants - Array of participants\n   * @param consumptionCount - Number of consumption records\n   * @returns The detailed response DTO\n   */\n  private toDetailResponseDTO(\n    trip: Trip,\n    participants: Array<{ id: string; name: string }>,\n    consumptionCount: number\n  ): TripDetailResponseDTO {\n    return {\n      ...this.toResponseDTO(trip, participants.length),\n      participants: participants.map((p) => ({\n        id: p.id,\n        name: p.name,\n      })),\n      productCount: 0, // Products are global, not trip-specific\n      consumptionCount,\n    };\n  }\n}\n","/**\n * @fileoverview Participant Application Service.\n * Handles business logic and orchestration for Participant operations.\n * Follows SOLID principles with single responsibility and dependency injection.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n * @module application/services/ParticipantService\n */\n\nimport type { Participant, IParticipantCreateDTO, IParticipantUpdateDTO } from '@domain/entities/Participant';\nimport type { IParticipantRepository } from '@domain/interfaces/repositories/IParticipantRepository';\nimport type { ITripRepository } from '@domain/interfaces/repositories/ITripRepository';\nimport type { IConsumptionRepository } from '@domain/interfaces/repositories/IConsumptionRepository';\nimport type { IAvailabilityRepository } from '@domain/interfaces/repositories/IAvailabilityRepository';\nimport { NotFoundError, DuplicateError, ValidationError, DomainError, DomainErrorCode } from '@domain/errors';\nimport type {\n  CreateParticipantDTO,\n  UpdateParticipantDTO,\n  ParticipantResponseDTO,\n  ParticipantWithAvailabilityDTO,\n} from '../dtos/participant';\n\n/**\n * Application service for Participant operations.\n *\n * @description\n * This service provides the application layer interface for Participant operations.\n * It handles:\n * - CRUD operations for participants\n * - Business rule validation (duplicate names, trip existence)\n * - Data transformation between DTOs and domain entities\n * - Cascade operations for related entities\n *\n * @example\n * ```typescript\n * const participantService = new ParticipantService(\n *   participantRepository,\n *   tripRepository,\n *   consumptionRepository,\n *   availabilityRepository\n * );\n *\n * const participant = await participantService.create({\n *   tripId: 'trip-123',\n *   name: 'John Doe',\n *   email: 'john@example.com',\n * });\n * ```\n */\nexport class ParticipantService {\n  /**\n   * Creates a new ParticipantService instance.\n   *\n   * @param participantRepository - Repository for Participant persistence operations\n   * @param tripRepository - Repository for Trip operations (for existence validation)\n   * @param consumptionRepository - Repository for Consumption operations (optional, for cascade deletes)\n   * @param availabilityRepository - Repository for Availability operations (optional, for cascade deletes)\n   */\n  constructor(\n    private readonly participantRepository: IParticipantRepository,\n    private readonly tripRepository: ITripRepository,\n    private readonly consumptionRepository?: IConsumptionRepository,\n    private readonly availabilityRepository?: IAvailabilityRepository\n  ) {}\n\n  /**\n   * Creates a new participant.\n   *\n   * @param dto - The participant creation data\n   * @returns Promise resolving to the created participant\n   * @throws {NotFoundError} If the trip is not found\n   * @throws {DuplicateError} If participant name already exists in trip\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const participant = await participantService.create({\n   *   tripId: 'trip-123',\n   *   name: 'John Doe',\n   *   email: 'john@example.com',\n   * });\n   * ```\n   */\n  public async create(dto: CreateParticipantDTO): Promise<Participant> {\n    // Validate input\n    this.validateCreateDTO(dto);\n\n    // Verify trip exists\n    const tripExists = await this.tripRepository.exists(dto.tripId);\n    if (!tripExists) {\n      throw NotFoundError.withId('Trip', dto.tripId);\n    }\n\n    // Check for duplicate name in trip\n    const existing = await this.participantRepository.findByTripIdAndName(dto.tripId, dto.name);\n    if (existing) {\n      throw DuplicateError.withField('Participant', 'name', dto.name);\n    }\n\n    // Create domain entity\n    const { Participant } = await import('@domain/entities/Participant');\n    const participant = Participant.create({\n      tripId: dto.tripId,\n      name: dto.name,\n      email: dto.email,\n      notes: dto.notes,\n    });\n\n    return this.participantRepository.save(participant);\n  }\n\n  /**\n   * Creates a new participant using domain DTO.\n   *\n   * @param dto - The participant creation data using domain DTO\n   * @returns Promise resolving to the created participant\n   * @throws {NotFoundError} If trip is not found\n   * @throws {DuplicateError} If participant name already exists in trip\n   */\n  public async createParticipant(dto: IParticipantCreateDTO): Promise<Participant> {\n    // Verify trip exists\n    const tripExists = await this.tripRepository.exists(dto.tripId);\n    if (!tripExists) {\n      throw NotFoundError.withId('Trip', dto.tripId);\n    }\n\n    // Check for duplicate name in trip\n    const existing = await this.participantRepository.findByTripIdAndName(dto.tripId, dto.name);\n    if (existing) {\n      throw DuplicateError.withField('Participant', 'name', dto.name);\n    }\n\n    const { Participant } = await import('@domain/entities/Participant');\n    const participant = Participant.create(dto);\n    return this.participantRepository.save(participant);\n  }\n\n  /**\n   * Retrieves a participant by its ID.\n   *\n   * @param id - The participant's unique identifier\n   * @returns Promise resolving to the participant if found, null otherwise\n   */\n  public async getById(id: string): Promise<Participant | null> {\n    return this.participantRepository.findById(id);\n  }\n\n  /**\n   * Retrieves a participant by ID, throwing if not found.\n   *\n   * @param id - The participant's unique identifier\n   * @returns Promise resolving to the participant\n   * @throws {NotFoundError} If the participant is not found\n   */\n  public async getParticipantById(id: string): Promise<Participant> {\n    const participant = await this.participantRepository.findById(id);\n    if (!participant) {\n      throw NotFoundError.withId('Participant', id);\n    }\n    return participant;\n  }\n\n  /**\n   * Retrieves all participants for a trip.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to array of participants\n   * @throws {NotFoundError} If the trip is not found\n   *\n   * @example\n   * ```typescript\n   * const participants = await participantService.getByTripId('trip-123');\n   * console.log(`${participants.length} participants in trip`);\n   * ```\n   */\n  public async getByTripId(tripId: string): Promise<Participant[]> {\n    const tripExists = await this.tripRepository.exists(tripId);\n    if (!tripExists) {\n      throw NotFoundError.withId('Trip', tripId);\n    }\n    return this.participantRepository.findByTripId(tripId);\n  }\n\n  /**\n   * Retrieves all participants for a trip (alias for getByTripId).\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to array of participants\n   * @throws {NotFoundError} If the trip is not found\n   */\n  public async getParticipantsByTripId(tripId: string): Promise<Participant[]> {\n    const tripExists = await this.tripRepository.exists(tripId);\n    if (!tripExists) {\n      throw NotFoundError.withId('Trip', tripId);\n    }\n    return this.participantRepository.findByTripId(tripId);\n  }\n\n  /**\n   * Retrieves participants with availability information.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to array of participants with availability\n   * @throws {NotFoundError} If the trip is not found\n   */\n  public async getParticipantsWithAvailability(tripId: string): Promise<ParticipantWithAvailabilityDTO[]> {\n    const participants = await this.getByTripId(tripId);\n\n    if (!this.availabilityRepository) {\n      return participants.map((p) => this.toWithAvailabilityDTO(p, [], 0));\n    }\n\n    const responses: ParticipantWithAvailabilityDTO[] = [];\n\n    for (const participant of participants) {\n      const availabilities = await this.availabilityRepository.findByParticipantId(participant.id);\n      const availableDates = availabilities.map((a) => a.date);\n\n      // Calculate percentage (assuming trip duration would be needed)\n      const trip = await this.tripRepository.findById(tripId);\n      const tripDays = trip ? trip.getDurationInDays() : 1;\n      const percentage = (availableDates.length / tripDays) * 100;\n\n      responses.push(this.toWithAvailabilityDTO(participant, availableDates, percentage));\n    }\n\n    return responses;\n  }\n\n  /**\n   * Updates an existing participant.\n   *\n   * @param id - The participant's unique identifier\n   * @param dto - The update data\n   * @returns Promise resolving to the updated participant\n   * @throws {NotFoundError} If the participant is not found\n   * @throws {DuplicateError} If new name already exists in trip\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const updated = await participantService.update('participant-123', {\n   *   name: 'Jane Doe',\n   *   email: 'jane@example.com',\n   * });\n   * ```\n   */\n  public async update(id: string, dto: UpdateParticipantDTO): Promise<Participant> {\n    const participant = await this.getParticipantById(id);\n\n    // Validate update\n    this.validateUpdateDTO(dto);\n\n    // Check for duplicate name if name is being changed\n    if (dto.name && dto.name !== participant.name) {\n      const existing = await this.participantRepository.findByTripIdAndName(participant.tripId, dto.name);\n      if (existing && existing.id !== id) {\n        throw DuplicateError.withField('Participant', 'name', dto.name);\n      }\n    }\n\n    const updatedParticipant = participant.update({\n      name: dto.name,\n      email: dto.email,\n      notes: dto.notes,\n    });\n\n    return this.participantRepository.save(updatedParticipant);\n  }\n\n  /**\n   * Updates an existing participant using domain DTO.\n   *\n   * @param id - The participant's unique identifier\n   * @param dto - The update data using domain DTO\n   * @returns Promise resolving to the updated participant\n   * @throws {NotFoundError} If participant is not found\n   * @throws {DuplicateError} If new name already exists in trip\n   */\n  public async updateParticipant(id: string, dto: IParticipantUpdateDTO): Promise<Participant> {\n    const participant = await this.getParticipantById(id);\n\n    // Check for duplicate name if name is being changed\n    if (dto.name && dto.name !== participant.name) {\n      const existing = await this.participantRepository.findByTripIdAndName(participant.tripId, dto.name);\n      if (existing && existing.id !== id) {\n        throw DuplicateError.withField('Participant', 'name', dto.name);\n      }\n    }\n\n    const updatedParticipant = participant.update(dto);\n    return this.participantRepository.save(updatedParticipant);\n  }\n\n  /**\n   * Deletes a participant by ID.\n   *\n   * @param id - The participant's unique identifier\n   * @param force - If true, deletes even if participant has consumptions\n   * @returns Promise resolving when deletion is complete\n   * @throws {NotFoundError} If the participant is not found\n   * @throws {DomainError} If participant has consumptions and force is false\n   *\n   * @example\n   * ```typescript\n   * // Safe delete\n   * await participantService.delete('participant-123');\n   *\n   * // Force delete (removes all related data)\n   * await participantService.delete('participant-123', true);\n   * ```\n   */\n  public async delete(id: string, force: boolean = false): Promise<void> {\n    const exists = await this.participantRepository.exists(id);\n    if (!exists) {\n      throw NotFoundError.withId('Participant', id);\n    }\n\n    // Check for dependencies if we have consumption repository\n    if (this.consumptionRepository && !force) {\n      const consumptions = await this.consumptionRepository.findByParticipantId(id);\n      if (consumptions.length > 0) {\n        throw new DomainError(\n          `Cannot delete participant with ${consumptions.length} consumption record(s). Use force=true to delete all related data.`,\n          DomainErrorCode.BUSINESS_RULE_ERROR,\n          { participantId: id, consumptionCount: consumptions.length }\n        );\n      }\n    }\n\n    // If force delete, remove all related data\n    if (force) {\n      if (this.consumptionRepository) {\n        await this.consumptionRepository.deleteByParticipantId(id);\n      }\n      if (this.availabilityRepository) {\n        await this.availabilityRepository.deleteByParticipantId(id);\n      }\n    }\n\n    await this.participantRepository.delete(id);\n  }\n\n  /**\n   * Deletes a participant by ID (simple version without force option).\n   *\n   * @param id - The participant's unique identifier\n   * @returns Promise resolving when deletion is complete\n   * @throws {NotFoundError} If participant is not found\n   */\n  public async deleteParticipant(id: string): Promise<void> {\n    const exists = await this.participantRepository.exists(id);\n    if (!exists) {\n      throw NotFoundError.withId('Participant', id);\n    }\n    await this.participantRepository.delete(id);\n  }\n\n  /**\n   * Deletes all participants for a trip.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to the number of participants deleted\n   */\n  public async deleteByTripId(tripId: string): Promise<number> {\n    return this.participantRepository.deleteByTripId(tripId);\n  }\n\n  /**\n   * Deletes all participants for a trip (alias for deleteByTripId).\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to the number of participants deleted\n   */\n  public async deleteParticipantsByTripId(tripId: string): Promise<number> {\n    return this.participantRepository.deleteByTripId(tripId);\n  }\n\n  /**\n   * Gets the count of participants in a trip.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to the count\n   */\n  public async countByTripId(tripId: string): Promise<number> {\n    return this.participantRepository.countByTripId(tripId);\n  }\n\n  /**\n   * Gets the count of participants in a trip (alias for countByTripId).\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to the count\n   */\n  public async getParticipantCountByTripId(tripId: string): Promise<number> {\n    return this.participantRepository.countByTripId(tripId);\n  }\n\n  /**\n   * Searches participants by name.\n   *\n   * @param name - The name or partial name to search\n   * @returns Promise resolving to array of matching participants\n   */\n  public async searchByName(name: string): Promise<Participant[]> {\n    return this.participantRepository.findByName(name);\n  }\n\n  /**\n   * Searches participants by name (alias for searchByName).\n   *\n   * @param name - The name or partial name to search\n   * @returns Promise resolving to array of matching participants\n   */\n  public async searchParticipantsByName(name: string): Promise<Participant[]> {\n    return this.participantRepository.findByName(name);\n  }\n\n  /**\n   * Searches participants by email.\n   *\n   * @param email - The email or partial email to search\n   * @returns Promise resolving to array of matching participants\n   */\n  public async searchByEmail(email: string): Promise<Participant[]> {\n    return this.participantRepository.findByEmail(email);\n  }\n\n  /**\n   * Checks if a participant exists.\n   *\n   * @param id - The participant's unique identifier\n   * @returns Promise resolving to true if the participant exists\n   */\n  public async exists(id: string): Promise<boolean> {\n    return this.participantRepository.exists(id);\n  }\n\n  /**\n   * Validates the create DTO.\n   *\n   * @param dto - The DTO to validate\n   * @throws {ValidationError} If validation fails\n   */\n  private validateCreateDTO(dto: CreateParticipantDTO): void {\n    if (!dto.tripId || dto.tripId.trim().length === 0) {\n      throw ValidationError.required('tripId', 'Participant');\n    }\n\n    if (!dto.name || dto.name.trim().length === 0) {\n      throw ValidationError.required('name', 'Participant');\n    }\n\n    if (dto.email && !this.isValidEmail(dto.email)) {\n      throw ValidationError.invalidFormat('email', 'valid email address', dto.email);\n    }\n  }\n\n  /**\n   * Validates the update DTO.\n   *\n   * @param dto - The DTO to validate\n   * @throws {ValidationError} If validation fails\n   */\n  private validateUpdateDTO(dto: UpdateParticipantDTO): void {\n    if (dto.name !== undefined && dto.name.trim().length === 0) {\n      throw ValidationError.invalidLength('name', 1, undefined, 0);\n    }\n\n    if (dto.email !== undefined && dto.email !== null && !this.isValidEmail(dto.email)) {\n      throw ValidationError.invalidFormat('email', 'valid email address', dto.email);\n    }\n  }\n\n  /**\n   * Validates email format.\n   *\n   * @param email - The email to validate\n   * @returns True if valid email format\n   */\n  private isValidEmail(email: string): boolean {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  }\n\n  /**\n   * Transforms a Participant entity to a response DTO.\n   *\n   * @param participant - The participant entity\n   * @returns The response DTO\n   */\n  private toResponseDTO(participant: Participant): ParticipantResponseDTO {\n    return {\n      id: participant.id,\n      tripId: participant.tripId,\n      name: participant.name,\n      email: participant.email,\n      notes: participant.notes,\n      dietaryRestrictions: [],\n      createdAt: participant.createdAt,\n      updatedAt: participant.updatedAt ?? participant.createdAt,\n    };\n  }\n\n  /**\n   * Transforms a Participant entity to a response DTO with availability.\n   *\n   * @param participant - The participant entity\n   * @param availableDates - Array of available dates\n   * @param availabilityPercentage - Percentage of trip days available\n   * @returns The response DTO with availability\n   */\n  private toWithAvailabilityDTO(\n    participant: Participant,\n    availableDates: Date[],\n    availabilityPercentage: number\n  ): ParticipantWithAvailabilityDTO {\n    return {\n      ...this.toResponseDTO(participant),\n      availableDates,\n      availabilityPercentage,\n    };\n  }\n}\n","/**\n * @fileoverview Product Application Service.\n * Handles business logic and orchestration for Product operations.\n * Follows SOLID principles with single responsibility and dependency injection.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n * @module application/services/ProductService\n */\n\nimport type { Product, IProductCreateDTO, IProductUpdateDTO } from '@domain/entities/Product';\nimport type { IProductRepository } from '@domain/interfaces/repositories/IProductRepository';\nimport type { IConsumptionRepository } from '@domain/interfaces/repositories/IConsumptionRepository';\nimport { NotFoundError, ValidationError, DomainError, DomainErrorCode } from '@domain/errors';\nimport { isProductCategory, isProductType, type ProductCategory, type ProductType, type ProductUnit } from '@domain/types';\nimport type {\n  ProductResponseDTO,\n  ProductWithConsumptionDTO,\n} from '../dtos/product';\n\n/**\n * Filter options for product queries.\n */\nexport interface ProductFilterOptions {\n  /** Filter by category */\n  readonly category?: ProductCategory;\n  /** Filter by type */\n  readonly type?: ProductType;\n  /** Filter by name (partial match) */\n  readonly name?: string;\n  /** Filter by whether product has default quantity */\n  readonly hasDefaultQuantity?: boolean;\n}\n\n/**\n * Application service for Product operations.\n *\n * @description\n * This service provides the application layer interface for Product operations.\n * It handles:\n * - CRUD operations for products\n * - Filtering by category and type\n * - Business rule validation\n * - Data transformation between DTOs and domain entities\n *\n * @example\n * ```typescript\n * const productService = new ProductService(productRepository, consumptionRepository);\n *\n * const product = await productService.create({\n *   name: 'Bottled Water',\n *   category: 'beverage',\n *   type: 'water',\n *   unit: 'bottle',\n *   defaultQuantityPerPerson: 2,\n * });\n * ```\n */\nexport class ProductService {\n  /**\n   * Creates a new ProductService instance.\n   *\n   * @param productRepository - Repository for Product persistence operations\n   * @param consumptionRepository - Repository for Consumption operations (optional, for dependency checks)\n   */\n  constructor(\n    private readonly productRepository: IProductRepository,\n    private readonly consumptionRepository?: IConsumptionRepository\n  ) {}\n\n  /**\n   * Creates a new product.\n   *\n   * @param dto - The product creation data\n   * @returns Promise resolving to the created product\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const product = await productService.create({\n   *   name: 'Fresh Bread',\n   *   category: 'food',\n   *   type: 'grains',\n   *   unit: 'unit',\n   *   defaultQuantityPerPerson: 2,\n   * });\n   * ```\n   */\n  public async create(dto: IProductCreateDTO): Promise<Product> {\n    // Validate input\n    this.validateCreateDTO(dto);\n\n    // Create domain entity (entity performs its own validation)\n    const { Product } = await import('@domain/entities/Product');\n    const product = Product.create(dto);\n\n    return this.productRepository.save(product);\n  }\n\n  /**\n   * Creates a new product using domain DTO.\n   *\n   * @param dto - The product creation data using domain DTO\n   * @returns Promise resolving to the created product\n   */\n  public async createProduct(dto: IProductCreateDTO): Promise<Product> {\n    const { Product } = await import('@domain/entities/Product');\n    const product = Product.create(dto);\n    return this.productRepository.save(product);\n  }\n\n  /**\n   * Retrieves a product by its ID.\n   *\n   * @param id - The product's unique identifier\n   * @returns Promise resolving to the product if found, null otherwise\n   */\n  public async getById(id: string): Promise<Product | null> {\n    return this.productRepository.findById(id);\n  }\n\n  /**\n   * Retrieves a product by ID, throwing if not found.\n   *\n   * @param id - The product's unique identifier\n   * @returns Promise resolving to the product\n   * @throws {NotFoundError} If the product is not found\n   */\n  public async getProductById(id: string): Promise<Product> {\n    const product = await this.productRepository.findById(id);\n    if (!product) {\n      throw NotFoundError.withId('Product', id);\n    }\n    return product;\n  }\n\n  /**\n   * Retrieves all products.\n   *\n   * @returns Promise resolving to array of products\n   */\n  public async getAll(): Promise<Product[]> {\n    return this.productRepository.findAll();\n  }\n\n  /**\n   * Retrieves all products (alias for getAll).\n   *\n   * @returns Promise resolving to array of products\n   */\n  public async getAllProducts(): Promise<Product[]> {\n    return this.productRepository.findAll();\n  }\n\n  /**\n   * Retrieves products with optional filters.\n   *\n   * @param filters - Filter options for the query\n   * @returns Promise resolving to array of filtered products\n   *\n   * @example\n   * ```typescript\n   * const beverages = await productService.getFiltered({ category: 'beverage' });\n   * const waterProducts = await productService.getFiltered({ type: 'water' });\n   * ```\n   */\n  public async getFiltered(filters: ProductFilterOptions): Promise<Product[]> {\n    let products = await this.productRepository.findAll();\n\n    if (filters.category) {\n      products = products.filter((p) => p.category === filters.category);\n    }\n\n    if (filters.type) {\n      products = products.filter((p) => p.type === filters.type);\n    }\n\n    if (filters.name) {\n      const searchName = filters.name.toLowerCase();\n      products = products.filter((p) => p.name.toLowerCase().includes(searchName));\n    }\n\n    if (filters.hasDefaultQuantity !== undefined) {\n      products = products.filter((p) =>\n        filters.hasDefaultQuantity\n          ? p.defaultQuantityPerPerson !== undefined && p.defaultQuantityPerPerson > 0\n          : p.defaultQuantityPerPerson === undefined || p.defaultQuantityPerPerson === 0\n      );\n    }\n\n    return products;\n  }\n\n  /**\n   * Retrieves products by category.\n   *\n   * @param category - The category to filter by\n   * @returns Promise resolving to array of products in the category\n   *\n   * @example\n   * ```typescript\n   * const beverages = await productService.getByCategory('beverage');\n   * ```\n   */\n  public async getByCategory(category: string): Promise<Product[]> {\n    if (!isProductCategory(category)) {\n      throw new ValidationError(`Invalid product category: ${category}`, 'category', 'enum');\n    }\n    return this.productRepository.findByCategory(category);\n  }\n\n  /**\n   * Retrieves products by category (alias for getByCategory).\n   *\n   * @param category - The category to filter by\n   * @returns Promise resolving to array of products\n   */\n  public async getProductsByCategory(category: string): Promise<Product[]> {\n    if (!isProductCategory(category)) {\n      throw new ValidationError(`Invalid product category: ${category}`, 'category', 'enum');\n    }\n    return this.productRepository.findByCategory(category);\n  }\n\n  /**\n   * Retrieves products by type.\n   *\n   * @param type - The type to filter by\n   * @returns Promise resolving to array of products of the type\n   *\n   * @example\n   * ```typescript\n   * const waterProducts = await productService.getByType('water');\n   * ```\n   */\n  public async getByType(type: string): Promise<Product[]> {\n    if (!isProductType(type)) {\n      throw new ValidationError(`Invalid product type: ${type}`, 'type', 'enum');\n    }\n    return this.productRepository.findByType(type);\n  }\n\n  /**\n   * Retrieves products by type (alias for getByType).\n   *\n   * @param type - The type to filter by\n   * @returns Promise resolving to array of products\n   */\n  public async getProductsByType(type: string): Promise<Product[]> {\n    if (!isProductType(type)) {\n      throw new ValidationError(`Invalid product type: ${type}`, 'type', 'enum');\n    }\n    return this.productRepository.findByType(type);\n  }\n\n  /**\n   * Retrieves products grouped by category.\n   *\n   * @returns Promise resolving to products grouped by category\n   */\n  public async getGroupedByCategory(): Promise<Map<ProductCategory, Product[]>> {\n    const products = await this.productRepository.findAll();\n    const grouped = new Map<ProductCategory, Product[]>();\n\n    for (const product of products) {\n      const category = product.category;\n      if (!grouped.has(category)) {\n        grouped.set(category, []);\n      }\n      grouped.get(category)!.push(product);\n    }\n\n    return grouped;\n  }\n\n  /**\n   * Retrieves products with consumption statistics.\n   *\n   * @param tripId - The trip ID to get consumption stats for\n   * @returns Promise resolving to products with consumption data\n   */\n  public async getProductsWithConsumption(tripId: string): Promise<ProductWithConsumptionDTO[]> {\n    const products = await this.productRepository.findAll();\n\n    if (!this.consumptionRepository) {\n      return products.map((p) => this.toWithConsumptionDTO(p, 0, 0));\n    }\n\n    const consumptions = await this.consumptionRepository.findByTripId(tripId);\n    const consumptionByProduct = new Map<string, { totalQuantity: number; count: number }>();\n\n    for (const consumption of consumptions) {\n      const current = consumptionByProduct.get(consumption.productId) || { totalQuantity: 0, count: 0 };\n      consumptionByProduct.set(consumption.productId, {\n        totalQuantity: current.totalQuantity + consumption.quantity,\n        count: current.count + 1,\n      });\n    }\n\n    return products.map((product) => {\n      const stats = consumptionByProduct.get(product.id) || { totalQuantity: 0, count: 0 };\n      return this.toWithConsumptionDTO(product, stats.totalQuantity, stats.count);\n    });\n  }\n\n  /**\n   * Searches products by name.\n   *\n   * @param name - The name or partial name to search\n   * @returns Promise resolving to array of matching products\n   */\n  public async searchByName(name: string): Promise<Product[]> {\n    return this.productRepository.findByName(name);\n  }\n\n  /**\n   * Searches products by name (alias for searchByName).\n   *\n   * @param name - The name or partial name to search\n   * @returns Promise resolving to array of matching products\n   */\n  public async searchProductsByName(name: string): Promise<Product[]> {\n    return this.productRepository.findByName(name);\n  }\n\n  /**\n   * Updates an existing product.\n   *\n   * @param id - The product's unique identifier\n   * @param dto - The update data\n   * @returns Promise resolving to the updated product\n   * @throws {NotFoundError} If the product is not found\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const updated = await productService.update('product-123', {\n   *   name: 'Mineral Water',\n   *   defaultQuantityPerPerson: 3,\n   * });\n   * ```\n   */\n  public async update(id: string, dto: IProductUpdateDTO): Promise<Product> {\n    const product = await this.getProductById(id);\n\n    // Validate update\n    this.validateUpdateDTO(dto);\n\n    const updatedProduct = product.update(dto);\n    return this.productRepository.save(updatedProduct);\n  }\n\n  /**\n   * Updates an existing product using domain DTO.\n   *\n   * @param id - The product's unique identifier\n   * @param dto - The update data using domain DTO\n   * @returns Promise resolving to the updated product\n   * @throws {NotFoundError} If product is not found\n   */\n  public async updateProduct(id: string, dto: IProductUpdateDTO): Promise<Product> {\n    const product = await this.getProductById(id);\n    const updatedProduct = product.update(dto);\n    return this.productRepository.save(updatedProduct);\n  }\n\n  /**\n   * Deletes a product by ID.\n   *\n   * @param id - The product's unique identifier\n   * @param force - If true, deletes even if product has consumptions\n   * @returns Promise resolving when deletion is complete\n   * @throws {NotFoundError} If the product is not found\n   * @throws {DomainError} If product has consumptions and force is false\n   *\n   * @example\n   * ```typescript\n   * // Safe delete\n   * await productService.delete('product-123');\n   *\n   * // Force delete\n   * await productService.delete('product-123', true);\n   * ```\n   */\n  public async delete(id: string, force: boolean = false): Promise<void> {\n    const exists = await this.productRepository.exists(id);\n    if (!exists) {\n      throw NotFoundError.withId('Product', id);\n    }\n\n    // Check for dependencies if we have consumption repository\n    if (this.consumptionRepository && !force) {\n      const consumptions = await this.consumptionRepository.findByProductId(id);\n      if (consumptions.length > 0) {\n        throw new DomainError(\n          `Cannot delete product with ${consumptions.length} consumption record(s). Use force=true to delete.`,\n          DomainErrorCode.BUSINESS_RULE_ERROR,\n          { productId: id, consumptionCount: consumptions.length }\n        );\n      }\n    }\n\n    await this.productRepository.delete(id);\n  }\n\n  /**\n   * Deletes a product by ID (simple version without force option).\n   *\n   * @param id - The product's unique identifier\n   * @returns Promise resolving when deletion is complete\n   * @throws {NotFoundError} If product is not found\n   */\n  public async deleteProduct(id: string): Promise<void> {\n    const exists = await this.productRepository.exists(id);\n    if (!exists) {\n      throw NotFoundError.withId('Product', id);\n    }\n    await this.productRepository.delete(id);\n  }\n\n  /**\n   * Checks if a product exists.\n   *\n   * @param id - The product's unique identifier\n   * @returns Promise resolving to true if the product exists\n   */\n  public async exists(id: string): Promise<boolean> {\n    return this.productRepository.exists(id);\n  }\n\n  /**\n   * Gets the total count of products.\n   *\n   * @returns Promise resolving to the count\n   */\n  public async count(): Promise<number> {\n    return this.productRepository.count();\n  }\n\n  /**\n   * Gets the total count of products (alias for count).\n   *\n   * @returns Promise resolving to the count\n   */\n  public async getProductCount(): Promise<number> {\n    return this.productRepository.count();\n  }\n\n  /**\n   * Validates the create DTO.\n   *\n   * @param dto - The DTO to validate\n   * @throws {ValidationError} If validation fails\n   */\n  private validateCreateDTO(dto: IProductCreateDTO): void {\n    if (!dto.name || dto.name.trim().length === 0) {\n      throw ValidationError.required('name', 'Product');\n    }\n\n    if (!dto.category) {\n      throw ValidationError.required('category', 'Product');\n    }\n\n    if (!dto.type) {\n      throw ValidationError.required('type', 'Product');\n    }\n\n    if (!dto.unit) {\n      throw ValidationError.required('unit', 'Product');\n    }\n\n    if (dto.defaultQuantityPerPerson !== undefined && dto.defaultQuantityPerPerson < 0) {\n      throw ValidationError.outOfRange('defaultQuantityPerPerson', 0, undefined, dto.defaultQuantityPerPerson);\n    }\n  }\n\n  /**\n   * Validates the update DTO.\n   *\n   * @param dto - The DTO to validate\n   * @throws {ValidationError} If validation fails\n   */\n  private validateUpdateDTO(dto: IProductUpdateDTO): void {\n    if (dto.name !== undefined && dto.name.trim().length === 0) {\n      throw ValidationError.invalidLength('name', 1, undefined, 0);\n    }\n\n    if (dto.defaultQuantityPerPerson !== undefined && dto.defaultQuantityPerPerson !== null && dto.defaultQuantityPerPerson < 0) {\n      throw ValidationError.outOfRange('defaultQuantityPerPerson', 0, undefined, dto.defaultQuantityPerPerson);\n    }\n  }\n\n  /**\n   * Transforms a Product entity to a response DTO.\n   *\n   * @param product - The product entity\n   * @returns The response DTO\n   */\n  private toResponseDTO(product: Product): ProductResponseDTO {\n    return {\n      id: product.id,\n      tripId: '', // Products are global, not trip-specific\n      name: product.name,\n      category: product.category as ProductCategory,\n      unit: product.unit as ProductUnit,\n      defaultQuantityPerPerson: product.defaultQuantityPerPerson ?? 0,\n      notes: product.notes,\n      isEssential: true,\n      createdAt: product.createdAt,\n      updatedAt: product.updatedAt ?? product.createdAt,\n    };\n  }\n\n  /**\n   * Transforms a Product entity to a response DTO with consumption stats.\n   *\n   * @param product - The product entity\n   * @param totalQuantityNeeded - Total quantity consumed\n   * @param consumptionCount - Number of consumption records\n   * @returns The response DTO with consumption stats\n   */\n  private toWithConsumptionDTO(\n    product: Product,\n    totalQuantityNeeded: number,\n    consumptionCount: number\n  ): ProductWithConsumptionDTO {\n    return {\n      ...this.toResponseDTO(product),\n      totalQuantityNeeded,\n      totalEstimatedCost: 0, // Price calculation would require price data\n      consumptionCount,\n    };\n  }\n}\n","/**\n * @fileoverview Consumption Application Service.\n * Handles business logic and orchestration for Consumption operations.\n * Follows SOLID principles with single responsibility and dependency injection.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n * @module application/services/ConsumptionService\n */\n\nimport type { Consumption } from '@domain/entities/Consumption';\nimport type { IConsumptionRepository } from '@domain/interfaces/repositories/IConsumptionRepository';\nimport type { IParticipantRepository } from '@domain/interfaces/repositories/IParticipantRepository';\nimport type { IProductRepository } from '@domain/interfaces/repositories/IProductRepository';\nimport type { ITripRepository } from '@domain/interfaces/repositories/ITripRepository';\nimport { NotFoundError, ValidationError } from '@domain/errors';\nimport type { MealType } from '@domain/types';\nimport type {\n  ConsumptionResponseDTO,\n  ConsumptionByDateDTO,\n  ConsumptionByParticipantDTO,\n} from '../dtos/consumption';\n\n/**\n * DTO for creating a consumption (legacy compatibility).\n */\nexport interface CreateConsumptionDTO {\n  /** Trip ID */\n  readonly tripId: string;\n  /** Participant ID */\n  readonly participantId: string;\n  /** Product ID */\n  readonly productId: string;\n  /** Date of consumption */\n  readonly date: Date;\n  /** Meal type */\n  readonly meal: MealType;\n  /** Quantity consumed */\n  readonly quantity: number;\n}\n\n/**\n * DTO for updating a consumption (legacy compatibility).\n */\nexport interface UpdateConsumptionDTO {\n  /** Updated date */\n  readonly date?: Date;\n  /** Updated meal type */\n  readonly meal?: MealType;\n  /** Updated quantity */\n  readonly quantity?: number;\n}\n\n/**\n * Application service for Consumption operations.\n *\n * @description\n * This service provides the application layer interface for Consumption operations.\n * It handles:\n * - CRUD operations for consumption records\n * - Validation of participant and product existence\n * - Aggregation of consumption data by date and participant\n * - Business rule validation\n *\n * @example\n * ```typescript\n * const consumptionService = new ConsumptionService(\n *   consumptionRepository,\n *   participantRepository,\n *   productRepository,\n *   tripRepository\n * );\n *\n * const consumption = await consumptionService.create({\n *   tripId: 'trip-123',\n *   participantId: 'participant-456',\n *   productId: 'product-789',\n *   date: new Date('2024-07-15'),\n *   meal: 'lunch',\n *   quantity: 2,\n * });\n * ```\n */\nexport class ConsumptionService {\n  /**\n   * Creates a new ConsumptionService instance.\n   *\n   * @param consumptionRepository - Repository for Consumption persistence operations\n   * @param participantRepository - Repository for Participant operations (for existence validation)\n   * @param productRepository - Repository for Product operations (for existence validation)\n   * @param tripRepository - Repository for Trip operations (optional, for date validation)\n   */\n  constructor(\n    private readonly consumptionRepository: IConsumptionRepository,\n    private readonly participantRepository: IParticipantRepository,\n    private readonly productRepository: IProductRepository,\n    private readonly tripRepository?: ITripRepository\n  ) {\n    // Mark private methods as intentionally kept for future use\n    void this._toResponseDTO;\n  }\n\n  /**\n   * Creates a new consumption record.\n   *\n   * @param dto - The consumption creation data\n   * @returns Promise resolving to the created consumption\n   * @throws {NotFoundError} If participant or product is not found\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const consumption = await consumptionService.create({\n   *   tripId: 'trip-123',\n   *   participantId: 'participant-456',\n   *   productId: 'product-789',\n   *   date: new Date('2024-07-15'),\n   *   meal: 'lunch',\n   *   quantity: 2,\n   * });\n   * ```\n   */\n  public async create(dto: CreateConsumptionDTO): Promise<Consumption> {\n    // Validate input\n    this.validateCreateDTO(dto);\n\n    // Verify participant exists\n    const participantExists = await this.participantRepository.exists(dto.participantId);\n    if (!participantExists) {\n      throw NotFoundError.withId('Participant', dto.participantId);\n    }\n\n    // Verify product exists\n    const productExists = await this.productRepository.exists(dto.productId);\n    if (!productExists) {\n      throw NotFoundError.withId('Product', dto.productId);\n    }\n\n    // Validate date is within trip range if we have trip repository\n    if (this.tripRepository) {\n      const trip = await this.tripRepository.findById(dto.tripId);\n      if (trip) {\n        const consumptionDate = new Date(dto.date);\n        if (consumptionDate < trip.startDate || consumptionDate > trip.endDate) {\n          throw ValidationError.invalidDateRange('date', 'trip dates');\n        }\n      }\n    }\n\n    // Create domain entity\n    const { Consumption } = await import('@domain/entities/Consumption');\n    const consumption = Consumption.create({\n      tripId: dto.tripId,\n      participantId: dto.participantId,\n      productId: dto.productId,\n      date: dto.date,\n      meal: dto.meal,\n      quantity: dto.quantity,\n    });\n\n    return this.consumptionRepository.save(consumption);\n  }\n\n  /**\n   * Creates a new consumption using the legacy DTO interface.\n   *\n   * @param dto - The consumption creation data\n   * @returns Promise resolving to the created consumption\n   * @throws {NotFoundError} If participant or product is not found\n   */\n  public async createConsumption(dto: CreateConsumptionDTO): Promise<Consumption> {\n    // Verify participant exists\n    const participantExists = await this.participantRepository.exists(dto.participantId);\n    if (!participantExists) {\n      throw NotFoundError.withId('Participant', dto.participantId);\n    }\n\n    // Verify product exists\n    const productExists = await this.productRepository.exists(dto.productId);\n    if (!productExists) {\n      throw NotFoundError.withId('Product', dto.productId);\n    }\n\n    const { Consumption } = await import('@domain/entities/Consumption');\n    const consumption = Consumption.create({\n      tripId: dto.tripId,\n      participantId: dto.participantId,\n      productId: dto.productId,\n      date: dto.date,\n      meal: dto.meal,\n      quantity: dto.quantity,\n    });\n    return this.consumptionRepository.save(consumption);\n  }\n\n  /**\n   * Creates multiple consumption records in bulk.\n   *\n   * @param tripId - The trip ID for all consumptions\n   * @param consumptions - Array of consumption data\n   * @returns Promise resolving to array of created consumptions\n   */\n  public async createBulk(\n    tripId: string,\n    consumptions: ReadonlyArray<Omit<CreateConsumptionDTO, 'tripId'>>\n  ): Promise<Consumption[]> {\n    const { Consumption } = await import('@domain/entities/Consumption');\n    const created: Consumption[] = [];\n\n    for (const dto of consumptions) {\n      const consumption = Consumption.create({\n        tripId,\n        participantId: dto.participantId,\n        productId: dto.productId,\n        date: dto.date,\n        meal: dto.meal,\n        quantity: dto.quantity,\n      });\n      created.push(consumption);\n    }\n\n    return this.consumptionRepository.saveMany(created);\n  }\n\n  /**\n   * Retrieves a consumption by its ID.\n   *\n   * @param id - The consumption's unique identifier\n   * @returns Promise resolving to the consumption if found, null otherwise\n   */\n  public async getById(id: string): Promise<Consumption | null> {\n    return this.consumptionRepository.findById(id);\n  }\n\n  /**\n   * Retrieves a consumption by ID, throwing if not found.\n   *\n   * @param id - The consumption's unique identifier\n   * @returns Promise resolving to the consumption\n   * @throws {NotFoundError} If the consumption is not found\n   */\n  public async getConsumptionById(id: string): Promise<Consumption> {\n    const consumption = await this.consumptionRepository.findById(id);\n    if (!consumption) {\n      throw NotFoundError.withId('Consumption', id);\n    }\n    return consumption;\n  }\n\n  /**\n   * Retrieves all consumptions for a trip.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to array of consumptions\n   */\n  public async getByTripId(tripId: string): Promise<Consumption[]> {\n    return this.consumptionRepository.findByTripId(tripId);\n  }\n\n  /**\n   * Retrieves all consumptions for a trip (alias for getByTripId).\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to array of consumptions\n   */\n  public async getConsumptionsByTripId(tripId: string): Promise<Consumption[]> {\n    return this.consumptionRepository.findByTripId(tripId);\n  }\n\n  /**\n   * Retrieves consumptions for a trip on a specific date.\n   *\n   * @param tripId - The trip's unique identifier\n   * @param date - The date to filter by\n   * @returns Promise resolving to array of consumptions\n   */\n  public async getByTripIdAndDate(tripId: string, date: Date): Promise<Consumption[]> {\n    return this.consumptionRepository.findByTripIdAndDate(tripId, date);\n  }\n\n  /**\n   * Retrieves consumptions for a trip on a specific date (alias).\n   *\n   * @param tripId - The trip's unique identifier\n   * @param date - The date to filter by\n   * @returns Promise resolving to array of consumptions\n   */\n  public async getConsumptionsByTripIdAndDate(tripId: string, date: Date): Promise<Consumption[]> {\n    return this.consumptionRepository.findByTripIdAndDate(tripId, date);\n  }\n\n  /**\n   * Retrieves consumptions for a participant.\n   *\n   * @param participantId - The participant's unique identifier\n   * @returns Promise resolving to array of consumptions\n   */\n  public async getByParticipantId(participantId: string): Promise<Consumption[]> {\n    return this.consumptionRepository.findByParticipantId(participantId);\n  }\n\n  /**\n   * Retrieves consumptions for a participant (alias).\n   *\n   * @param participantId - The participant's unique identifier\n   * @returns Promise resolving to array of consumptions\n   */\n  public async getConsumptionsByParticipantId(participantId: string): Promise<Consumption[]> {\n    return this.consumptionRepository.findByParticipantId(participantId);\n  }\n\n  /**\n   * Retrieves consumptions for a product.\n   *\n   * @param productId - The product's unique identifier\n   * @returns Promise resolving to array of consumptions\n   */\n  public async getByProductId(productId: string): Promise<Consumption[]> {\n    return this.consumptionRepository.findByProductId(productId);\n  }\n\n  /**\n   * Retrieves consumptions for a product (alias).\n   *\n   * @param productId - The product's unique identifier\n   * @returns Promise resolving to array of consumptions\n   */\n  public async getConsumptionsByProductId(productId: string): Promise<Consumption[]> {\n    return this.consumptionRepository.findByProductId(productId);\n  }\n\n  /**\n   * Gets consumption summary grouped by date.\n   *\n   * @param tripId - The trip ID to get summary for\n   * @returns Promise resolving to array of consumption summaries by date\n   */\n  public async getSummaryByDate(tripId: string): Promise<ConsumptionByDateDTO[]> {\n    const consumptions = await this.consumptionRepository.findByTripId(tripId);\n\n    const byDate = new Map<string, {\n      date: Date;\n      participants: Set<string>;\n      count: number;\n      byMeal: Map<MealType, number>;\n    }>();\n\n    for (const consumption of consumptions) {\n      const dateKey = consumption.date.toISOString().split('T')[0] ?? '';\n\n      if (!byDate.has(dateKey)) {\n        byDate.set(dateKey, {\n          date: consumption.date,\n          participants: new Set(),\n          count: 0,\n          byMeal: new Map(),\n        });\n      }\n\n      const entry = byDate.get(dateKey);\n      if (entry) {\n        entry.participants.add(consumption.participantId);\n        entry.count++;\n        entry.byMeal.set(consumption.meal, (entry.byMeal.get(consumption.meal) ?? 0) + 1);\n      }\n    }\n\n    const summaries: ConsumptionByDateDTO[] = [];\n    for (const [, data] of byDate) {\n      summaries.push({\n        date: data.date,\n        participantCount: data.participants.size,\n        totalConsumptions: data.count,\n        byMealType: Array.from(data.byMeal.entries()).map(([mealType, count]) => ({\n          mealType: mealType as MealType,\n          count,\n        })),\n      });\n    }\n\n    return summaries.sort((a, b) => a.date.getTime() - b.date.getTime());\n  }\n\n  /**\n   * Gets consumption summary grouped by participant.\n   *\n   * @param tripId - The trip ID to get summary for\n   * @returns Promise resolving to array of consumption summaries by participant\n   */\n  public async getSummaryByParticipant(tripId: string): Promise<ConsumptionByParticipantDTO[]> {\n    const consumptions = await this.consumptionRepository.findByTripId(tripId);\n\n    const byParticipant = new Map<string, {\n      count: number;\n      products: Map<string, number>;\n    }>();\n\n    for (const consumption of consumptions) {\n      if (!byParticipant.has(consumption.participantId)) {\n        byParticipant.set(consumption.participantId, {\n          count: 0,\n          products: new Map(),\n        });\n      }\n\n      const entry = byParticipant.get(consumption.participantId)!;\n      entry.count++;\n      entry.products.set(\n        consumption.productId,\n        (entry.products.get(consumption.productId) || 0) + consumption.quantity\n      );\n    }\n\n    const summaries: ConsumptionByParticipantDTO[] = [];\n    for (const [participantId, data] of byParticipant) {\n      const participant = await this.participantRepository.findById(participantId);\n\n      const products: Array<{ productId: string; productName: string; totalQuantity: number }> = [];\n      for (const [productId, quantity] of data.products) {\n        const product = await this.productRepository.findById(productId);\n        products.push({\n          productId,\n          productName: product?.name || 'Unknown',\n          totalQuantity: quantity,\n        });\n      }\n\n      summaries.push({\n        participantId,\n        participantName: participant?.name || 'Unknown',\n        totalConsumptions: data.count,\n        products,\n      });\n    }\n\n    return summaries;\n  }\n\n  /**\n   * Updates an existing consumption.\n   *\n   * @param id - The consumption's unique identifier\n   * @param dto - The update data\n   * @returns Promise resolving to the updated consumption\n   * @throws {NotFoundError} If the consumption is not found\n   * @throws {ValidationError} If validation fails\n   */\n  public async update(id: string, dto: UpdateConsumptionDTO): Promise<Consumption> {\n    const consumption = await this.getConsumptionById(id);\n\n    // Validate update\n    this.validateUpdateDTO(dto);\n\n    const updatedConsumption = consumption.update(dto);\n    return this.consumptionRepository.save(updatedConsumption);\n  }\n\n  /**\n   * Updates an existing consumption using domain DTO.\n   *\n   * @param id - The consumption's unique identifier\n   * @param dto - The update data\n   * @returns Promise resolving to the updated consumption\n   * @throws {NotFoundError} If consumption is not found\n   */\n  public async updateConsumption(id: string, dto: UpdateConsumptionDTO): Promise<Consumption> {\n    const consumption = await this.getConsumptionById(id);\n    const updatedConsumption = consumption.update(dto);\n    return this.consumptionRepository.save(updatedConsumption);\n  }\n\n  /**\n   * Deletes a consumption by ID.\n   *\n   * @param id - The consumption's unique identifier\n   * @returns Promise resolving when deletion is complete\n   * @throws {NotFoundError} If the consumption is not found\n   */\n  public async delete(id: string): Promise<void> {\n    const exists = await this.consumptionRepository.exists(id);\n    if (!exists) {\n      throw NotFoundError.withId('Consumption', id);\n    }\n    await this.consumptionRepository.delete(id);\n  }\n\n  /**\n   * Deletes a consumption by ID (alias for delete).\n   *\n   * @param id - The consumption's unique identifier\n   * @returns Promise resolving when deletion is complete\n   * @throws {NotFoundError} If consumption is not found\n   */\n  public async deleteConsumption(id: string): Promise<void> {\n    const exists = await this.consumptionRepository.exists(id);\n    if (!exists) {\n      throw NotFoundError.withId('Consumption', id);\n    }\n    await this.consumptionRepository.delete(id);\n  }\n\n  /**\n   * Deletes all consumptions for a trip.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to the number of consumptions deleted\n   */\n  public async deleteByTripId(tripId: string): Promise<number> {\n    return this.consumptionRepository.deleteByTripId(tripId);\n  }\n\n  /**\n   * Deletes all consumptions for a trip (alias for deleteByTripId).\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to the number of consumptions deleted\n   */\n  public async deleteConsumptionsByTripId(tripId: string): Promise<number> {\n    return this.consumptionRepository.deleteByTripId(tripId);\n  }\n\n  /**\n   * Deletes all consumptions for a participant.\n   *\n   * @param participantId - The participant's unique identifier\n   * @returns Promise resolving to the number of consumptions deleted\n   */\n  public async deleteByParticipantId(participantId: string): Promise<number> {\n    return this.consumptionRepository.deleteByParticipantId(participantId);\n  }\n\n  /**\n   * Deletes all consumptions for a participant (alias).\n   *\n   * @param participantId - The participant's unique identifier\n   * @returns Promise resolving to the number of consumptions deleted\n   */\n  public async deleteConsumptionsByParticipantId(participantId: string): Promise<number> {\n    return this.consumptionRepository.deleteByParticipantId(participantId);\n  }\n\n  /**\n   * Checks if a consumption exists.\n   *\n   * @param id - The consumption's unique identifier\n   * @returns Promise resolving to true if the consumption exists\n   */\n  public async exists(id: string): Promise<boolean> {\n    return this.consumptionRepository.exists(id);\n  }\n\n  /**\n   * Gets the total count of consumptions.\n   *\n   * @returns Promise resolving to the count\n   */\n  public async count(): Promise<number> {\n    return this.consumptionRepository.count();\n  }\n\n  /**\n   * Gets the total count of consumptions (alias for count).\n   *\n   * @returns Promise resolving to the count\n   */\n  public async getConsumptionCount(): Promise<number> {\n    return this.consumptionRepository.count();\n  }\n\n  /**\n   * Validates the create DTO.\n   *\n   * @param dto - The DTO to validate\n   * @throws {ValidationError} If validation fails\n   */\n  private validateCreateDTO(dto: CreateConsumptionDTO): void {\n    if (!dto.tripId || dto.tripId.trim().length === 0) {\n      throw ValidationError.required('tripId', 'Consumption');\n    }\n\n    if (!dto.participantId || dto.participantId.trim().length === 0) {\n      throw ValidationError.required('participantId', 'Consumption');\n    }\n\n    if (!dto.productId || dto.productId.trim().length === 0) {\n      throw ValidationError.required('productId', 'Consumption');\n    }\n\n    if (!dto.date) {\n      throw ValidationError.required('date', 'Consumption');\n    }\n\n    if (!dto.meal) {\n      throw ValidationError.required('meal', 'Consumption');\n    }\n\n    if (dto.quantity === undefined || dto.quantity < 0) {\n      throw ValidationError.outOfRange('quantity', 0, undefined, dto.quantity);\n    }\n  }\n\n  /**\n   * Validates the update DTO.\n   *\n   * @param dto - The DTO to validate\n   * @throws {ValidationError} If validation fails\n   */\n  private validateUpdateDTO(dto: UpdateConsumptionDTO): void {\n    if (dto.quantity !== undefined && dto.quantity < 0) {\n      throw ValidationError.outOfRange('quantity', 0, undefined, dto.quantity);\n    }\n  }\n\n  /**\n   * Transforms a Consumption entity to a response DTO.\n   *\n   * @param consumption - The consumption entity\n   * @param participantName - Name of the participant\n   * @param productName - Name of the product\n   * @returns The response DTO\n   */\n  private _toResponseDTO(\n    consumption: Consumption,\n    participantName: string,\n    productName: string\n  ): ConsumptionResponseDTO {\n    return {\n      id: consumption.id,\n      tripId: consumption.tripId,\n      participantId: consumption.participantId,\n      participantName,\n      productId: consumption.productId,\n      productName,\n      date: consumption.date,\n      quantity: consumption.quantity,\n      mealType: consumption.meal,\n      createdAt: consumption.createdAt,\n      updatedAt: consumption.updatedAt ?? consumption.createdAt,\n    };\n  }\n}\n","/**\n * @fileoverview Availability Application Service.\n * Handles business logic and orchestration for Availability operations.\n * Follows SOLID principles with single responsibility and dependency injection.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n * @module application/services/AvailabilityService\n */\n\nimport type { Availability } from '@domain/entities/Availability';\nimport type { IAvailabilityRepository } from '@domain/interfaces/repositories/IAvailabilityRepository';\nimport type { IParticipantRepository } from '@domain/interfaces/repositories/IParticipantRepository';\nimport type { ITripRepository } from '@domain/interfaces/repositories/ITripRepository';\nimport { NotFoundError, ValidationError } from '@domain/errors';\nimport type { MealType } from '@domain/types';\nimport type {\n  AvailabilityResponseDTO,\n  AvailabilityByDateDTO,\n  AvailabilityByParticipantDTO,\n  AvailabilityMatrixDTO,\n  MealAvailabilityDTO,\n} from '../dtos/availability';\n\n/**\n * DTO for creating/updating availability (legacy compatibility).\n */\nexport interface SetAvailabilityDTO {\n  /** Participant ID */\n  readonly participantId: string;\n  /** Trip ID */\n  readonly tripId: string;\n  /** Date of availability */\n  readonly date: Date;\n  /** Meals available for */\n  readonly meals: MealType[];\n}\n\n/**\n * Application service for Availability operations.\n *\n * @description\n * This service provides the application layer interface for Availability operations.\n * It handles:\n * - CRUD operations for availability records\n * - Setting availability for participants on specific dates\n * - Generating availability matrices and summaries\n * - Business rule validation\n *\n * @example\n * ```typescript\n * const availabilityService = new AvailabilityService(\n *   availabilityRepository,\n *   participantRepository,\n *   tripRepository\n * );\n *\n * const availability = await availabilityService.setAvailability({\n *   tripId: 'trip-123',\n *   participantId: 'participant-456',\n *   date: new Date('2024-07-15'),\n *   meals: ['breakfast', 'lunch', 'dinner'],\n * });\n * ```\n */\nexport class AvailabilityService {\n  /**\n   * Creates a new AvailabilityService instance.\n   *\n   * @param availabilityRepository - Repository for Availability persistence operations\n   * @param participantRepository - Repository for Participant operations (for existence validation)\n   * @param tripRepository - Repository for Trip operations (optional, for date validation)\n   */\n  constructor(\n    private readonly availabilityRepository: IAvailabilityRepository,\n    private readonly participantRepository: IParticipantRepository,\n    private readonly tripRepository?: ITripRepository\n  ) {\n    // Mark private methods as intentionally kept for future use\n    void this._toResponseDTO;\n  }\n\n  /**\n   * Sets availability for a participant on a specific date.\n   * Creates new availability if not exists, updates if exists.\n   *\n   * @param dto - The availability data\n   * @returns Promise resolving to the created/updated availability\n   * @throws {NotFoundError} If participant is not found\n   * @throws {ValidationError} If validation fails\n   *\n   * @example\n   * ```typescript\n   * const availability = await availabilityService.setAvailability({\n   *   tripId: 'trip-123',\n   *   participantId: 'participant-456',\n   *   date: new Date('2024-07-15'),\n   *   meals: ['breakfast', 'lunch', 'dinner'],\n   * });\n   * ```\n   */\n  public async setAvailability(dto: SetAvailabilityDTO): Promise<Availability> {\n    // Validate input\n    this.validateSetAvailabilityDTO(dto);\n\n    // Verify participant exists\n    const participantExists = await this.participantRepository.exists(dto.participantId);\n    if (!participantExists) {\n      throw NotFoundError.withId('Participant', dto.participantId);\n    }\n\n    // Validate date is within trip range if we have trip repository\n    if (this.tripRepository) {\n      const trip = await this.tripRepository.findById(dto.tripId);\n      if (trip) {\n        const availabilityDate = new Date(dto.date);\n        if (availabilityDate < trip.startDate || availabilityDate > trip.endDate) {\n          throw ValidationError.invalidDateRange('date', 'trip dates');\n        }\n      }\n    }\n\n    // Check if availability already exists for this participant and date\n    const existing = await this.availabilityRepository.findByParticipantIdAndDate(\n      dto.participantId,\n      dto.date\n    );\n\n    const { Availability } = await import('@domain/entities/Availability');\n\n    if (existing) {\n      // Update existing availability\n      const updated = existing.update({ meals: dto.meals });\n      return this.availabilityRepository.save(updated);\n    } else {\n      // Create new availability\n      const availability = Availability.create({\n        participantId: dto.participantId,\n        tripId: dto.tripId,\n        date: dto.date,\n        meals: dto.meals,\n      });\n      return this.availabilityRepository.save(availability);\n    }\n  }\n\n  /**\n   * Sets availability for a participant for a date range.\n   *\n   * @param tripId - The trip ID\n   * @param participantId - The participant ID\n   * @param startDate - Start of the date range\n   * @param endDate - End of the date range\n   * @param meals - Meals available for\n   * @returns Promise resolving to array of created availabilities\n   */\n  public async setAvailabilityRange(\n    tripId: string,\n    participantId: string,\n    startDate: Date,\n    endDate: Date,\n    meals: MealType[]\n  ): Promise<Availability[]> {\n    const availabilities: Availability[] = [];\n    const currentDate = new Date(startDate);\n\n    while (currentDate <= endDate) {\n      const availability = await this.setAvailability({\n        tripId,\n        participantId,\n        date: new Date(currentDate),\n        meals,\n      });\n      availabilities.push(availability);\n      currentDate.setDate(currentDate.getDate() + 1);\n    }\n\n    return availabilities;\n  }\n\n  /**\n   * Sets availability for all participants in a trip for a specific date.\n   *\n   * @param tripId - The trip ID\n   * @param date - The date\n   * @param meals - Meals available for\n   * @returns Promise resolving to array of created availabilities\n   */\n  public async setAvailabilityForAllParticipants(\n    tripId: string,\n    date: Date,\n    meals: MealType[]\n  ): Promise<Availability[]> {\n    const participants = await this.participantRepository.findByTripId(tripId);\n    const availabilities: Availability[] = [];\n\n    for (const participant of participants) {\n      const availability = await this.setAvailability({\n        tripId,\n        participantId: participant.id,\n        date,\n        meals,\n      });\n      availabilities.push(availability);\n    }\n\n    return availabilities;\n  }\n\n  /**\n   * Retrieves an availability by its ID.\n   *\n   * @param id - The availability's unique identifier\n   * @returns Promise resolving to the availability if found, null otherwise\n   */\n  public async getById(id: string): Promise<Availability | null> {\n    return this.availabilityRepository.findById(id);\n  }\n\n  /**\n   * Retrieves an availability by ID, throwing if not found.\n   *\n   * @param id - The availability's unique identifier\n   * @returns Promise resolving to the availability\n   * @throws {NotFoundError} If the availability is not found\n   */\n  public async getAvailabilityById(id: string): Promise<Availability> {\n    const availability = await this.availabilityRepository.findById(id);\n    if (!availability) {\n      throw NotFoundError.withId('Availability', id);\n    }\n    return availability;\n  }\n\n  /**\n   * Retrieves all availabilities for a trip.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to array of availabilities\n   */\n  public async getByTripId(tripId: string): Promise<Availability[]> {\n    return this.availabilityRepository.findByTripId(tripId);\n  }\n\n  /**\n   * Retrieves all availabilities for a trip (alias for getByTripId).\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to array of availabilities\n   */\n  public async getAvailabilitiesByTripId(tripId: string): Promise<Availability[]> {\n    return this.availabilityRepository.findByTripId(tripId);\n  }\n\n  /**\n   * Retrieves availabilities for a trip on a specific date.\n   *\n   * @param tripId - The trip's unique identifier\n   * @param date - The date to filter by\n   * @returns Promise resolving to array of availabilities\n   */\n  public async getByTripIdAndDate(tripId: string, date: Date): Promise<Availability[]> {\n    return this.availabilityRepository.findByTripIdAndDate(tripId, date);\n  }\n\n  /**\n   * Retrieves availabilities for a trip on a specific date (alias).\n   *\n   * @param tripId - The trip's unique identifier\n   * @param date - The date to filter by\n   * @returns Promise resolving to array of availabilities\n   */\n  public async getAvailabilitiesByTripIdAndDate(tripId: string, date: Date): Promise<Availability[]> {\n    return this.availabilityRepository.findByTripIdAndDate(tripId, date);\n  }\n\n  /**\n   * Retrieves availabilities for a participant.\n   *\n   * @param participantId - The participant's unique identifier\n   * @returns Promise resolving to array of availabilities\n   */\n  public async getByParticipantId(participantId: string): Promise<Availability[]> {\n    return this.availabilityRepository.findByParticipantId(participantId);\n  }\n\n  /**\n   * Retrieves availabilities for a participant (alias).\n   *\n   * @param participantId - The participant's unique identifier\n   * @returns Promise resolving to array of availabilities\n   */\n  public async getAvailabilitiesByParticipantId(participantId: string): Promise<Availability[]> {\n    return this.availabilityRepository.findByParticipantId(participantId);\n  }\n\n  /**\n   * Retrieves availability for a participant on a specific date.\n   *\n   * @param participantId - The participant's unique identifier\n   * @param date - The date to filter by\n   * @returns Promise resolving to the availability if found, null otherwise\n   */\n  public async getByParticipantIdAndDate(\n    participantId: string,\n    date: Date\n  ): Promise<Availability | null> {\n    return this.availabilityRepository.findByParticipantIdAndDate(participantId, date);\n  }\n\n  /**\n   * Retrieves availability for a participant on a specific date (alias).\n   *\n   * @param participantId - The participant's unique identifier\n   * @param date - The date to filter by\n   * @returns Promise resolving to the availability if found, null otherwise\n   */\n  public async getAvailabilityByParticipantIdAndDate(\n    participantId: string,\n    date: Date\n  ): Promise<Availability | null> {\n    return this.availabilityRepository.findByParticipantIdAndDate(participantId, date);\n  }\n\n  /**\n   * Gets availability summary grouped by date.\n   *\n   * @param tripId - The trip ID to get summary for\n   * @returns Promise resolving to array of availability summaries by date\n   */\n  public async getSummaryByDate(tripId: string): Promise<AvailabilityByDateDTO[]> {\n    const availabilities = await this.availabilityRepository.findByTripId(tripId);\n\n    const byDate = new Map<string, {\n      date: Date;\n      participants: Array<{\n        participantId: string;\n        participantName: string;\n        meals: MealAvailabilityDTO;\n      }>;\n    }>();\n\n    for (const availability of availabilities) {\n      const dateKey = availability.date.toISOString().split('T')[0] ?? '';\n\n      if (!byDate.has(dateKey)) {\n        byDate.set(dateKey, {\n          date: availability.date,\n          participants: [],\n        });\n      }\n\n      const participant = await this.participantRepository.findById(availability.participantId);\n      const dateEntry = byDate.get(dateKey);\n      if (dateEntry) {\n        dateEntry.participants.push({\n          participantId: availability.participantId,\n          participantName: participant?.name ?? 'Unknown',\n          meals: this.toMealAvailabilityDTO(availability.meals),\n        });\n      }\n    }\n\n    const summaries: AvailabilityByDateDTO[] = [];\n    for (const [, data] of byDate) {\n      const breakfastCount = data.participants.filter((p) => p.meals.breakfast).length;\n      const lunchCount = data.participants.filter((p) => p.meals.lunch).length;\n      const dinnerCount = data.participants.filter((p) => p.meals.dinner).length;\n\n      summaries.push({\n        date: data.date,\n        totalAvailable: data.participants.length,\n        breakfastCount,\n        lunchCount,\n        dinnerCount,\n        participants: data.participants,\n      });\n    }\n\n    return summaries.sort((a, b) => a.date.getTime() - b.date.getTime());\n  }\n\n  /**\n   * Gets availability summary grouped by participant.\n   *\n   * @param tripId - The trip ID to get summary for\n   * @returns Promise resolving to array of availability summaries by participant\n   */\n  public async getSummaryByParticipant(tripId: string): Promise<AvailabilityByParticipantDTO[]> {\n    const availabilities = await this.availabilityRepository.findByTripId(tripId);\n    const participants = await this.participantRepository.findByTripId(tripId);\n\n    // Get trip duration for percentage calculation\n    let tripDays = 1;\n    if (this.tripRepository) {\n      const trip = await this.tripRepository.findById(tripId);\n      if (trip) {\n        tripDays = trip.getDurationInDays();\n      }\n    }\n\n    const byParticipant = new Map<string, {\n      name: string;\n      dates: Array<{ date: Date; meals: MealAvailabilityDTO }>;\n    }>();\n\n    // Initialize all participants\n    for (const participant of participants) {\n      byParticipant.set(participant.id, {\n        name: participant.name,\n        dates: [],\n      });\n    }\n\n    // Add availability data\n    for (const availability of availabilities) {\n      const entry = byParticipant.get(availability.participantId);\n      if (entry) {\n        entry.dates.push({\n          date: availability.date,\n          meals: this.toMealAvailabilityDTO(availability.meals),\n        });\n      }\n    }\n\n    const summaries: AvailabilityByParticipantDTO[] = [];\n    for (const [participantId, data] of byParticipant) {\n      const percentage = (data.dates.length / tripDays) * 100;\n\n      summaries.push({\n        participantId,\n        participantName: data.name,\n        totalDaysAvailable: data.dates.length,\n        availabilityPercentage: Math.round(percentage * 100) / 100,\n        dates: data.dates,\n      });\n    }\n\n    return summaries;\n  }\n\n  /**\n   * Generates an availability matrix for a trip.\n   *\n   * @param tripId - The trip ID to generate matrix for\n   * @returns Promise resolving to the availability matrix\n   */\n  public async getAvailabilityMatrix(tripId: string): Promise<AvailabilityMatrixDTO> {\n    const availabilities = await this.availabilityRepository.findByTripId(tripId);\n    const participants = await this.participantRepository.findByTripId(tripId);\n\n    // Get all dates from trip\n    let dates: Date[] = [];\n    if (this.tripRepository) {\n      const trip = await this.tripRepository.findById(tripId);\n      if (trip) {\n        const currentDate = new Date(trip.startDate);\n        while (currentDate <= trip.endDate) {\n          dates.push(new Date(currentDate));\n          currentDate.setDate(currentDate.getDate() + 1);\n        }\n      }\n    }\n\n    // Build matrix\n    const matrix: Record<string, Record<string, MealAvailabilityDTO | null>> = {};\n\n    for (const participant of participants) {\n      matrix[participant.id] = {};\n      const participantMatrix = matrix[participant.id];\n      if (participantMatrix) {\n        for (const date of dates) {\n          const dateKey = date.toISOString().split('T')[0] ?? '';\n          participantMatrix[dateKey] = null;\n        }\n      }\n    }\n\n    // Fill in availability data\n    for (const availability of availabilities) {\n      const dateKey = availability.date.toISOString().split('T')[0] ?? '';\n      const participantMatrix = matrix[availability.participantId];\n      if (participantMatrix) {\n        participantMatrix[dateKey] = this.toMealAvailabilityDTO(availability.meals);\n      }\n    }\n\n    // Calculate summary\n    let totalAvailable = 0;\n    for (const availability of availabilities) {\n      if (availability.meals.length > 0) {\n        totalAvailable++;\n      }\n    }\n\n    const totalPossible = participants.length * dates.length;\n    const averageAvailability = totalPossible > 0\n      ? Math.round((totalAvailable / totalPossible) * 100 * 100) / 100\n      : 0;\n\n    return {\n      tripId,\n      dates,\n      participants: participants.map((p) => ({ id: p.id, name: p.name })),\n      matrix,\n      summary: {\n        totalParticipants: participants.length,\n        totalDays: dates.length,\n        averageAvailability,\n      },\n    };\n  }\n\n  /**\n   * Gets participants available for a specific meal on a date.\n   *\n   * @param tripId - The trip ID\n   * @param date - The date\n   * @param meal - The meal type\n   * @returns Promise resolving to array of participant IDs\n   */\n  public async getParticipantsAvailableForMeal(\n    tripId: string,\n    date: Date,\n    meal: MealType\n  ): Promise<string[]> {\n    const availabilities = await this.getByTripIdAndDate(tripId, date);\n    return availabilities\n      .filter((a) => a.meals.includes(meal))\n      .map((a) => a.participantId);\n  }\n\n  /**\n   * Counts participants available for each meal on a date.\n   *\n   * @param tripId - The trip ID\n   * @param date - The date\n   * @returns Promise resolving to counts by meal type\n   */\n  public async countAvailableByMeal(\n    tripId: string,\n    date: Date\n  ): Promise<{ breakfast: number; lunch: number; dinner: number; snack: number }> {\n    const availabilities = await this.getByTripIdAndDate(tripId, date);\n\n    return {\n      breakfast: availabilities.filter((a) => a.meals.includes('breakfast')).length,\n      lunch: availabilities.filter((a) => a.meals.includes('lunch')).length,\n      dinner: availabilities.filter((a) => a.meals.includes('dinner')).length,\n      snack: availabilities.filter((a) => a.meals.includes('snack')).length,\n    };\n  }\n\n  /**\n   * Deletes an availability by ID.\n   *\n   * @param id - The availability's unique identifier\n   * @returns Promise resolving when deletion is complete\n   * @throws {NotFoundError} If the availability is not found\n   */\n  public async delete(id: string): Promise<void> {\n    const exists = await this.availabilityRepository.exists(id);\n    if (!exists) {\n      throw NotFoundError.withId('Availability', id);\n    }\n    await this.availabilityRepository.delete(id);\n  }\n\n  /**\n   * Deletes an availability by ID (alias for delete).\n   *\n   * @param id - The availability's unique identifier\n   * @returns Promise resolving when deletion is complete\n   * @throws {NotFoundError} If availability is not found\n   */\n  public async deleteAvailability(id: string): Promise<void> {\n    const exists = await this.availabilityRepository.exists(id);\n    if (!exists) {\n      throw NotFoundError.withId('Availability', id);\n    }\n    await this.availabilityRepository.delete(id);\n  }\n\n  /**\n   * Deletes all availabilities for a participant.\n   *\n   * @param participantId - The participant's unique identifier\n   * @returns Promise resolving to the number of availabilities deleted\n   */\n  public async deleteByParticipantId(participantId: string): Promise<number> {\n    return this.availabilityRepository.deleteByParticipantId(participantId);\n  }\n\n  /**\n   * Deletes all availabilities for a participant (alias).\n   *\n   * @param participantId - The participant's unique identifier\n   * @returns Promise resolving to the number of availabilities deleted\n   */\n  public async deleteAvailabilitiesByParticipantId(participantId: string): Promise<number> {\n    return this.availabilityRepository.deleteByParticipantId(participantId);\n  }\n\n  /**\n   * Deletes all availabilities for a trip.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to the number of availabilities deleted\n   */\n  public async deleteByTripId(tripId: string): Promise<number> {\n    return this.availabilityRepository.deleteByTripId(tripId);\n  }\n\n  /**\n   * Deletes all availabilities for a trip (alias).\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to the number of availabilities deleted\n   */\n  public async deleteAvailabilitiesByTripId(tripId: string): Promise<number> {\n    return this.availabilityRepository.deleteByTripId(tripId);\n  }\n\n  /**\n   * Checks if an availability exists.\n   *\n   * @param id - The availability's unique identifier\n   * @returns Promise resolving to true if the availability exists\n   */\n  public async exists(id: string): Promise<boolean> {\n    return this.availabilityRepository.exists(id);\n  }\n\n  /**\n   * Gets the total count of availabilities.\n   *\n   * @returns Promise resolving to the count\n   */\n  public async count(): Promise<number> {\n    return this.availabilityRepository.count();\n  }\n\n  /**\n   * Validates the set availability DTO.\n   *\n   * @param dto - The DTO to validate\n   * @throws {ValidationError} If validation fails\n   */\n  private validateSetAvailabilityDTO(dto: SetAvailabilityDTO): void {\n    if (!dto.tripId || dto.tripId.trim().length === 0) {\n      throw ValidationError.required('tripId', 'Availability');\n    }\n\n    if (!dto.participantId || dto.participantId.trim().length === 0) {\n      throw ValidationError.required('participantId', 'Availability');\n    }\n\n    if (!dto.date) {\n      throw ValidationError.required('date', 'Availability');\n    }\n\n    if (!Array.isArray(dto.meals)) {\n      throw ValidationError.invalidFormat('meals', 'array of meal types');\n    }\n  }\n\n  /**\n   * Converts meal array to MealAvailabilityDTO.\n   *\n   * @param meals - Array of meal types\n   * @returns The meal availability DTO\n   */\n  private toMealAvailabilityDTO(meals: ReadonlyArray<MealType>): MealAvailabilityDTO {\n    return {\n      breakfast: meals.includes('breakfast'),\n      lunch: meals.includes('lunch'),\n      dinner: meals.includes('dinner'),\n    };\n  }\n\n  /**\n   * Transforms an Availability entity to a response DTO.\n   *\n   * @param availability - The availability entity\n   * @param participantName - Name of the participant\n   * @returns The response DTO\n   */\n  private _toResponseDTO(\n    availability: Availability,\n    participantName: string\n  ): AvailabilityResponseDTO {\n    return {\n      id: availability.id,\n      tripId: availability.tripId,\n      participantId: availability.participantId,\n      participantName,\n      date: availability.date,\n      meals: this.toMealAvailabilityDTO(availability.meals),\n      createdAt: availability.createdAt,\n      updatedAt: availability.updatedAt ?? availability.createdAt,\n    };\n  }\n}\n","/**\n * @fileoverview Shopping Application Service.\n * Calculates shopping lists based on consumptions and availability.\n * Follows SOLID principles with single responsibility and dependency injection.\n *\n * @author TripFood Manager Team\n * @version 1.0.0\n * @module application/services/ShoppingService\n */\n\nimport type { IConsumptionRepository } from '@domain/interfaces/repositories/IConsumptionRepository';\nimport type { IProductRepository } from '@domain/interfaces/repositories/IProductRepository';\nimport type { IAvailabilityRepository } from '@domain/interfaces/repositories/IAvailabilityRepository';\nimport type { ITripRepository } from '@domain/interfaces/repositories/ITripRepository';\nimport type { IParticipantRepository } from '@domain/interfaces/repositories/IParticipantRepository';\nimport type { Product } from '@domain/entities/Product';\nimport { NotFoundError } from '@domain/errors';\nimport type {\n  ShoppingListDTO,\n  ShoppingListItemDTO,\n  ShoppingListByCategoryDTO,\n  QuantityByDateDTO,\n  GenerateShoppingListOptionsDTO,\n} from '../dtos/shopping';\nimport type { ProductCategory, ProductUnit } from '../dtos/product';\n\n/**\n * Shopping list item (legacy compatibility).\n */\nexport interface ShoppingListItem {\n  /** The product entity */\n  readonly product: Product;\n  /** Total quantity needed */\n  readonly totalQuantity: number;\n  /** Unit of measurement */\n  readonly unit: string;\n}\n\n/**\n * Complete shopping list (legacy compatibility).\n */\nexport interface ShoppingList {\n  /** Trip ID */\n  readonly tripId: string;\n  /** List items */\n  readonly items: ShoppingListItem[];\n  /** Generation timestamp */\n  readonly generatedAt: Date;\n}\n\n/**\n * Consumption summary by product.\n */\nexport interface ProductConsumptionSummary {\n  /** Product ID */\n  readonly productId: string;\n  /** Product name */\n  readonly productName: string;\n  /** Total quantity */\n  readonly totalQuantity: number;\n  /** Unit of measurement */\n  readonly unit: string;\n  /** Number of consumption records */\n  readonly consumptionCount: number;\n}\n\n/**\n * Application service for Shopping operations.\n *\n * @description\n * This service provides shopping list generation and analysis for trips.\n * It handles:\n * - Generating comprehensive shopping lists based on consumptions\n * - Calculating quantities by date and participant availability\n * - Grouping products by category\n * - Estimating costs and quantities\n * - Comparing estimated vs actual consumption\n *\n * @example\n * ```typescript\n * const shoppingService = new ShoppingService(\n *   consumptionRepository,\n *   productRepository,\n *   availabilityRepository,\n *   tripRepository,\n *   participantRepository\n * );\n *\n * const shoppingList = await shoppingService.generateShoppingList('trip-123');\n * console.log(`Total items: ${shoppingList.totalItems}`);\n * console.log(`Estimated cost: $${shoppingList.totalEstimatedCost}`);\n * ```\n */\nexport class ShoppingService {\n  /**\n   * Creates a new ShoppingService instance.\n   *\n   * @param consumptionRepository - Repository for Consumption operations\n   * @param productRepository - Repository for Product operations\n   * @param availabilityRepository - Repository for Availability operations\n   * @param tripRepository - Repository for Trip operations (optional)\n   * @param participantRepository - Repository for Participant operations (optional)\n   */\n  constructor(\n    private readonly consumptionRepository: IConsumptionRepository,\n    private readonly productRepository: IProductRepository,\n    private readonly availabilityRepository: IAvailabilityRepository,\n    private readonly tripRepository?: ITripRepository,\n    private readonly participantRepository?: IParticipantRepository\n  ) {}\n\n  /**\n   * Generates a comprehensive shopping list for a trip.\n   *\n   * @param tripId - The trip ID to generate shopping list for\n   * @param options - Optional generation options\n   * @returns Promise resolving to the complete shopping list DTO\n   * @throws {NotFoundError} If the trip is not found\n   *\n   * @example\n   * ```typescript\n   * const shoppingList = await shoppingService.generate('trip-123', {\n   *   essentialOnly: false,\n   *   groupByCategory: true,\n   *   quantityMultiplier: 1.1, // 10% buffer\n   * });\n   * ```\n   */\n  public async generate(\n    tripId: string,\n    options?: Partial<GenerateShoppingListOptionsDTO>\n  ): Promise<ShoppingListDTO> {\n    // Verify trip exists if we have trip repository\n    let trip = null;\n    let tripName = 'Unknown Trip';\n    let startDate = new Date();\n    let endDate = new Date();\n    let totalDays = 1;\n\n    if (this.tripRepository) {\n      trip = await this.tripRepository.findById(tripId);\n      if (!trip) {\n        throw NotFoundError.withId('Trip', tripId);\n      }\n      tripName = trip.name;\n      startDate = trip.startDate;\n      endDate = trip.endDate;\n      totalDays = trip.getDurationInDays();\n    }\n\n    // Get participant count\n    let participantCount = 0;\n    if (this.participantRepository) {\n      participantCount = await this.participantRepository.countByTripId(tripId);\n    }\n\n    // Get all consumptions and availabilities for the trip\n    const consumptions = await this.consumptionRepository.findByTripId(tripId);\n    const availabilities = await this.availabilityRepository.findByTripId(tripId);\n\n    // Calculate quantities by product\n    const productQuantities = new Map<string, {\n      quantity: number;\n      byDate: Map<string, { quantity: number; participantCount: number }>;\n    }>();\n\n    for (const consumption of consumptions) {\n      const dateIso = consumption.date.toISOString();\n      const dateKey = dateIso.split('T')[0] ?? dateIso.substring(0, 10);\n\n      if (!productQuantities.has(consumption.productId)) {\n        productQuantities.set(consumption.productId, {\n          quantity: 0,\n          byDate: new Map(),\n        });\n      }\n\n      const entry = productQuantities.get(consumption.productId)!;\n      entry.quantity += consumption.quantity;\n\n      if (!entry.byDate.has(dateKey)) {\n        // Count participants available on this date\n        const dateAvailabilities = availabilities.filter((a) => {\n          const aDateIso = a.date.toISOString();\n          const aDateKey = aDateIso.split('T')[0] ?? aDateIso.substring(0, 10);\n          return aDateKey === dateKey;\n        });\n        entry.byDate.set(dateKey, {\n          quantity: 0,\n          participantCount: dateAvailabilities.length,\n        });\n      }\n\n      const dateEntry = entry.byDate.get(dateKey)!;\n      dateEntry.quantity += consumption.quantity;\n    }\n\n    // Build shopping list items\n    const items: ShoppingListItemDTO[] = [];\n    const products = await this.productRepository.findAll();\n    const productMap = new Map(products.map((p) => [p.id, p]));\n\n    for (const [productId, data] of productQuantities) {\n      const product = productMap.get(productId);\n      if (!product) continue;\n\n      // Apply filters\n      if (options?.essentialOnly && !product.defaultQuantityPerPerson) continue;\n\n      // Check category filter - compare as strings to avoid type mismatch\n      if (options?.categories) {\n        const categoryStrings = options.categories.map((c) => String(c));\n        if (!categoryStrings.includes(String(product.category))) continue;\n      }\n\n      // Apply quantity multiplier\n      const multiplier = options?.quantityMultiplier ?? 1.0;\n      const totalQuantity = Math.ceil(data.quantity * multiplier);\n\n      // Build byDate array\n      const byDate: QuantityByDateDTO[] = [];\n      for (const [dateKey, dateData] of data.byDate) {\n        byDate.push({\n          date: new Date(dateKey),\n          quantity: Math.ceil(dateData.quantity * multiplier),\n          participantCount: dateData.participantCount,\n        });\n      }\n\n      // Create item - handle optional notes properly\n      const item: ShoppingListItemDTO = {\n        productId: product.id,\n        productName: product.name,\n        category: product.category as unknown as ProductCategory,\n        totalQuantity,\n        unit: product.unit as unknown as ProductUnit,\n        isEssential: !!product.defaultQuantityPerPerson,\n        byDate: byDate.sort((a, b) => a.date.getTime() - b.date.getTime()),\n      };\n\n      // Add optional notes if present\n      if (product.notes !== undefined) {\n        (item as { notes?: string }).notes = product.notes;\n      }\n\n      items.push(item);\n    }\n\n    // Sort items by category and name\n    items.sort((a, b) => {\n      if (a.category !== b.category) {\n        return String(a.category).localeCompare(String(b.category));\n      }\n      return a.productName.localeCompare(b.productName);\n    });\n\n    // Group by category\n    const byCategory: ShoppingListByCategoryDTO[] = [];\n    const categoryMap = new Map<string, ShoppingListItemDTO[]>();\n\n    for (const item of items) {\n      const categoryKey = String(item.category);\n      if (!categoryMap.has(categoryKey)) {\n        categoryMap.set(categoryKey, []);\n      }\n      categoryMap.get(categoryKey)!.push(item);\n    }\n\n    for (const [categoryKey, categoryItems] of categoryMap) {\n      const categoryTotalCost = categoryItems.reduce(\n        (sum, item) => sum + (item.totalEstimatedCost ?? 0),\n        0\n      );\n\n      byCategory.push({\n        category: categoryKey as unknown as ProductCategory,\n        categoryDisplayName: this.getCategoryDisplayName(categoryKey),\n        items: categoryItems,\n        categoryTotalCost,\n        itemCount: categoryItems.length,\n      });\n    }\n\n    // Calculate totals\n    const essentialItemsCount = items.filter((i) => i.isEssential).length;\n    const optionalItemsCount = items.filter((i) => !i.isEssential).length;\n    const totalEstimatedCost = items.reduce(\n      (sum, item) => sum + (item.totalEstimatedCost ?? 0),\n      0\n    );\n\n    return {\n      tripId,\n      tripName,\n      startDate,\n      endDate,\n      totalDays,\n      participantCount,\n      items,\n      byCategory,\n      totalItems: items.length,\n      totalEstimatedCost,\n      essentialItemsCount,\n      optionalItemsCount,\n      generatedAt: new Date(),\n    };\n  }\n\n  /**\n   * Generates a shopping list for a trip (legacy method).\n   *\n   * @param tripId - The trip ID\n   * @returns Promise resolving to the shopping list\n   */\n  public async generateShoppingList(tripId: string): Promise<ShoppingList> {\n    const consumptions = await this.consumptionRepository.findByTripId(tripId);\n\n    // Group consumptions by product and sum quantities\n    const productQuantities = new Map<string, number>();\n\n    for (const consumption of consumptions) {\n      const current = productQuantities.get(consumption.productId) || 0;\n      productQuantities.set(consumption.productId, current + consumption.quantity);\n    }\n\n    // Fetch product details and build shopping list items\n    const items: ShoppingListItem[] = [];\n\n    for (const [productId, totalQuantity] of productQuantities) {\n      const product = await this.productRepository.findById(productId);\n      if (product) {\n        items.push({\n          product,\n          totalQuantity,\n          unit: product.unit,\n        });\n      }\n    }\n\n    // Sort items by category and name\n    items.sort((a, b) => {\n      if (a.product.category !== b.product.category) {\n        return a.product.category.localeCompare(b.product.category);\n      }\n      return a.product.name.localeCompare(b.product.name);\n    });\n\n    return {\n      tripId,\n      items,\n      generatedAt: new Date(),\n    };\n  }\n\n  /**\n   * Gets consumption summary grouped by product for a trip.\n   *\n   * @param tripId - The trip ID\n   * @returns Promise resolving to array of product consumption summaries\n   */\n  public async getConsumptionSummaryByProduct(tripId: string): Promise<ProductConsumptionSummary[]> {\n    const consumptions = await this.consumptionRepository.findByTripId(tripId);\n\n    // Group by product\n    const productData = new Map<string, { quantity: number; count: number }>();\n\n    for (const consumption of consumptions) {\n      const current = productData.get(consumption.productId) || { quantity: 0, count: 0 };\n      productData.set(consumption.productId, {\n        quantity: current.quantity + consumption.quantity,\n        count: current.count + 1,\n      });\n    }\n\n    // Build summary with product details\n    const summaries: ProductConsumptionSummary[] = [];\n\n    for (const [productId, data] of productData) {\n      const product = await this.productRepository.findById(productId);\n      if (product) {\n        summaries.push({\n          productId,\n          productName: product.name,\n          totalQuantity: data.quantity,\n          unit: product.unit,\n          consumptionCount: data.count,\n        });\n      }\n    }\n\n    // Sort by total quantity descending\n    summaries.sort((a, b) => b.totalQuantity - a.totalQuantity);\n\n    return summaries;\n  }\n\n  /**\n   * Calculates estimated quantities based on participants and availability.\n   *\n   * @param tripId - The trip ID\n   * @param date - The date to calculate for\n   * @returns Promise resolving to map of product ID to estimated quantity\n   */\n  public async calculateEstimatedQuantities(\n    tripId: string,\n    date: Date\n  ): Promise<Map<string, number>> {\n    const availabilities = await this.availabilityRepository.findByTripIdAndDate(tripId, date);\n    const products = await this.productRepository.findAll();\n\n    const estimates = new Map<string, number>();\n\n    // Count participants per meal\n    const mealCounts = new Map<string, number>();\n    for (const availability of availabilities) {\n      for (const meal of availability.meals) {\n        const current = mealCounts.get(meal) || 0;\n        mealCounts.set(meal, current + 1);\n      }\n    }\n\n    // Calculate total expected participants across all meals\n    let totalMealParticipants = 0;\n    for (const count of mealCounts.values()) {\n      totalMealParticipants += count;\n    }\n\n    // Estimate quantities per product based on default quantities\n    for (const product of products) {\n      if (product.defaultQuantityPerPerson) {\n        const estimatedQuantity = product.defaultQuantityPerPerson * totalMealParticipants;\n        estimates.set(product.id, estimatedQuantity);\n      }\n    }\n\n    return estimates;\n  }\n\n  /**\n   * Calculates estimated quantities for the entire trip.\n   *\n   * @param tripId - The trip ID\n   * @returns Promise resolving to map of product ID to estimated quantity\n   */\n  public async calculateTotalEstimatedQuantities(tripId: string): Promise<Map<string, number>> {\n    const availabilities = await this.availabilityRepository.findByTripId(tripId);\n    const products = await this.productRepository.findAll();\n\n    const estimates = new Map<string, number>();\n\n    // Calculate total participant-meals across entire trip\n    let totalParticipantMeals = 0;\n    for (const availability of availabilities) {\n      totalParticipantMeals += availability.meals.length;\n    }\n\n    // Estimate quantities per product based on default quantities\n    for (const product of products) {\n      if (product.defaultQuantityPerPerson) {\n        const estimatedQuantity = product.defaultQuantityPerPerson * totalParticipantMeals;\n        estimates.set(product.id, estimatedQuantity);\n      }\n    }\n\n    return estimates;\n  }\n\n  /**\n   * Gets the difference between estimated and actual consumption.\n   *\n   * @param tripId - The trip ID\n   * @returns Promise resolving to array of variance data\n   */\n  public async getConsumptionVariance(tripId: string): Promise<\n    Array<{\n      productId: string;\n      productName: string;\n      estimated: number;\n      actual: number;\n      variance: number;\n      variancePercentage: number;\n      unit: string;\n    }>\n  > {\n    const consumptions = await this.consumptionRepository.findByTripId(tripId);\n    const products = await this.productRepository.findAll();\n    const availabilities = await this.availabilityRepository.findByTripId(tripId);\n\n    // Calculate total participants across all availability records\n    const totalParticipantMeals = availabilities.reduce(\n      (sum, a) => sum + a.meals.length,\n      0\n    );\n\n    // Group actual consumption by product\n    const actualByProduct = new Map<string, number>();\n    for (const consumption of consumptions) {\n      const current = actualByProduct.get(consumption.productId) || 0;\n      actualByProduct.set(consumption.productId, current + consumption.quantity);\n    }\n\n    // Calculate variance for each product with default quantity\n    const variances: Array<{\n      productId: string;\n      productName: string;\n      estimated: number;\n      actual: number;\n      variance: number;\n      variancePercentage: number;\n      unit: string;\n    }> = [];\n\n    for (const product of products) {\n      if (product.defaultQuantityPerPerson) {\n        const estimated = product.defaultQuantityPerPerson * totalParticipantMeals;\n        const actual = actualByProduct.get(product.id) || 0;\n        const variance = actual - estimated;\n        const variancePercentage = estimated > 0\n          ? Math.round((variance / estimated) * 100 * 100) / 100\n          : 0;\n\n        variances.push({\n          productId: product.id,\n          productName: product.name,\n          estimated,\n          actual,\n          variance,\n          variancePercentage,\n          unit: product.unit,\n        });\n      }\n    }\n\n    // Sort by absolute variance descending\n    variances.sort((a, b) => Math.abs(b.variance) - Math.abs(a.variance));\n\n    return variances;\n  }\n\n  /**\n   * Gets shopping suggestions based on consumption patterns.\n   *\n   * @param tripId - The trip ID\n   * @returns Promise resolving to array of suggestions\n   */\n  public async getShoppingSuggestions(tripId: string): Promise<\n    Array<{\n      productId: string;\n      productName: string;\n      suggestion: string;\n      priority: 'high' | 'medium' | 'low';\n      suggestedQuantity: number;\n      unit: string;\n    }>\n  > {\n    const variances = await this.getConsumptionVariance(tripId);\n    const suggestions: Array<{\n      productId: string;\n      productName: string;\n      suggestion: string;\n      priority: 'high' | 'medium' | 'low';\n      suggestedQuantity: number;\n      unit: string;\n    }> = [];\n\n    for (const variance of variances) {\n      if (variance.variance > 0) {\n        // Over consumption\n        const priority = variance.variancePercentage > 50 ? 'high' : variance.variancePercentage > 20 ? 'medium' : 'low';\n        suggestions.push({\n          productId: variance.productId,\n          productName: variance.productName,\n          suggestion: `Consider increasing stock by ${Math.ceil(variance.variance)} ${variance.unit}`,\n          priority,\n          suggestedQuantity: Math.ceil(variance.estimated * 1.2),\n          unit: variance.unit,\n        });\n      } else if (variance.variance < -variance.estimated * 0.3) {\n        // Significant under consumption\n        suggestions.push({\n          productId: variance.productId,\n          productName: variance.productName,\n          suggestion: `Consider reducing stock - ${Math.abs(variance.variance)} ${variance.unit} unused`,\n          priority: 'low',\n          suggestedQuantity: Math.ceil(variance.actual * 1.1),\n          unit: variance.unit,\n        });\n      }\n    }\n\n    return suggestions;\n  }\n\n  /**\n   * Gets a complete shopping list for a trip.\n   * Alias for generate() method for API consistency.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to the complete shopping list DTO\n   * @throws {NotFoundError} If the trip is not found\n   *\n   * @example\n   * ```typescript\n   * const shoppingList = await shoppingService.getShoppingList('trip-123');\n   * console.log(`Total items: ${shoppingList.totalItems}`);\n   * ```\n   */\n  public async getShoppingList(tripId: string): Promise<ShoppingListDTO> {\n    return this.generate(tripId);\n  }\n\n  /**\n   * Exports the shopping list to CSV format.\n   *\n   * @description\n   * Generates a CSV string containing the shopping list with columns:\n   * - Category\n   * - Product Name\n   * - Quantity\n   * - Unit\n   * - Notes (optional)\n   * - Daily breakdown (optional)\n   *\n   * @param tripId - The trip's unique identifier\n   * @param options - Export configuration options\n   * @returns Promise resolving to CSV string\n   * @throws {NotFoundError} If trip is not found\n   *\n   * @example\n   * ```typescript\n   * const csv = await shoppingService.exportToCSV('trip-123', {\n   *   includeDailyBreakdown: true,\n   *   includeNotes: true,\n   *   sortByCategory: true,\n   * });\n   *\n   * // Save to file\n   * fs.writeFileSync('shopping-list.csv', csv);\n   * ```\n   */\n  public async exportToCSV(\n    tripId: string,\n    options?: {\n      includeDailyBreakdown?: boolean;\n      includeNotes?: boolean;\n      sortByCategory?: boolean;\n      includeHeader?: boolean;\n    }\n  ): Promise<string> {\n    const shoppingList = await this.generate(tripId);\n\n    const includeNotes = options?.includeNotes ?? true;\n    const includeDailyBreakdown = options?.includeDailyBreakdown ?? false;\n    const sortByCategory = options?.sortByCategory ?? true;\n    const includeHeader = options?.includeHeader ?? true;\n\n    const lines: string[] = [];\n\n    // Build header row\n    if (includeHeader) {\n      const headers = ['Categoria', 'Producto', 'Cantidad', 'Unidad'];\n      if (includeNotes) {\n        headers.push('Notas');\n      }\n      if (includeDailyBreakdown) {\n        const dates = this.extractUniqueDates(shoppingList.items);\n        for (const date of dates) {\n          headers.push(this.formatDateForCSV(date));\n        }\n      }\n      lines.push(this.escapeCSVRow(headers));\n    }\n\n    // Sort items\n    let sortedItems = [...shoppingList.items];\n    if (sortByCategory) {\n      sortedItems.sort((a, b) => {\n        if (a.category !== b.category) {\n          return String(a.category).localeCompare(String(b.category));\n        }\n        return a.productName.localeCompare(b.productName);\n      });\n    }\n\n    // Build data rows\n    for (const item of sortedItems) {\n      const categoryName = this.getCategoryDisplayName(item.category);\n      const row: string[] = [\n        categoryName,\n        item.productName,\n        item.totalQuantity.toString(),\n        String(item.unit),\n      ];\n\n      if (includeNotes) {\n        row.push(item.notes || '');\n      }\n\n      if (includeDailyBreakdown) {\n        const dates = this.extractUniqueDates(shoppingList.items);\n        for (const date of dates) {\n          const dateData = item.byDate.find(\n            (d) => this.normalizeDate(d.date) === this.normalizeDate(date)\n          );\n          row.push(dateData ? dateData.quantity.toString() : '0');\n        }\n      }\n\n      lines.push(this.escapeCSVRow(row));\n    }\n\n    // Add summary section\n    lines.push('');\n    lines.push(this.escapeCSVRow(['--- RESUMEN ---']));\n    lines.push(this.escapeCSVRow(['Viaje', shoppingList.tripName]));\n    lines.push(this.escapeCSVRow(['Fecha inicio', this.formatDateForCSV(shoppingList.startDate)]));\n    lines.push(this.escapeCSVRow(['Fecha fin', this.formatDateForCSV(shoppingList.endDate)]));\n    lines.push(this.escapeCSVRow(['Total dias', shoppingList.totalDays.toString()]));\n    lines.push(this.escapeCSVRow(['Participantes', shoppingList.participantCount.toString()]));\n    lines.push(this.escapeCSVRow(['Total productos', shoppingList.totalItems.toString()]));\n    lines.push(this.escapeCSVRow(['Productos esenciales', shoppingList.essentialItemsCount.toString()]));\n    lines.push(this.escapeCSVRow(['Productos opcionales', shoppingList.optionalItemsCount.toString()]));\n    lines.push(this.escapeCSVRow(['Generado', shoppingList.generatedAt.toISOString()]));\n\n    return lines.join('\\n');\n  }\n\n  /**\n   * Exports the shopping list to JSON format.\n   *\n   * @param tripId - The trip's unique identifier\n   * @param options - Export configuration options\n   * @returns Promise resolving to JSON string\n   * @throws {NotFoundError} If trip is not found\n   *\n   * @example\n   * ```typescript\n   * const json = await shoppingService.exportToJSON('trip-123');\n   * fs.writeFileSync('shopping-list.json', json);\n   * ```\n   */\n  public async exportToJSON(\n    tripId: string,\n    options?: {\n      prettyPrint?: boolean;\n    }\n  ): Promise<string> {\n    const shoppingList = await this.generate(tripId);\n    const indent = options?.prettyPrint !== false ? 2 : 0;\n    return JSON.stringify(shoppingList, null, indent);\n  }\n\n  /**\n   * Gets products grouped by category for a trip's shopping list.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to array of category groups\n   * @throws {NotFoundError} If trip is not found\n   *\n   * @example\n   * ```typescript\n   * const byCategory = await shoppingService.getShoppingListByCategory('trip-123');\n   * byCategory.forEach(group => {\n   *   console.log(`${group.categoryDisplayName}: ${group.itemCount} items`);\n   * });\n   * ```\n   */\n  public async getShoppingListByCategory(tripId: string): Promise<ShoppingListByCategoryDTO[]> {\n    const shoppingList = await this.generate(tripId, { groupByCategory: true });\n    return [...shoppingList.byCategory];\n  }\n\n  /**\n   * Gets products that are running low based on consumption vs estimates.\n   *\n   * @param tripId - The trip's unique identifier\n   * @param thresholdPercentage - Percentage threshold for low stock (default: 20)\n   * @returns Promise resolving to array of low stock products\n   *\n   * @example\n   * ```typescript\n   * const lowStock = await shoppingService.getLowStockProducts('trip-123', 25);\n   * lowStock.forEach(p => {\n   *   console.log(`${p.productName}: ${p.remainingPercentage}% remaining`);\n   * });\n   * ```\n   */\n  public async getLowStockProducts(\n    tripId: string,\n    thresholdPercentage: number = 20\n  ): Promise<\n    Array<{\n      productId: string;\n      productName: string;\n      remainingPercentage: number;\n      currentQuantity: number;\n      estimatedNeed: number;\n      unit: string;\n    }>\n  > {\n    const variances = await this.getConsumptionVariance(tripId);\n\n    const lowStock = variances\n      .filter((v) => {\n        const remainingPercentage = v.estimated > 0\n          ? ((v.estimated - v.actual) / v.estimated) * 100\n          : 100;\n        return remainingPercentage <= thresholdPercentage;\n      })\n      .map((v) => ({\n        productId: v.productId,\n        productName: v.productName,\n        remainingPercentage: v.estimated > 0\n          ? Math.round(((v.estimated - v.actual) / v.estimated) * 100 * 100) / 100\n          : 100,\n        currentQuantity: Math.max(0, v.estimated - v.actual),\n        estimatedNeed: v.estimated,\n        unit: v.unit,\n      }));\n\n    return lowStock.sort((a, b) => a.remainingPercentage - b.remainingPercentage);\n  }\n\n  /**\n   * Gets a quick summary of the shopping list for dashboard display.\n   *\n   * @param tripId - The trip's unique identifier\n   * @returns Promise resolving to summary data\n   * @throws {NotFoundError} If trip is not found\n   *\n   * @example\n   * ```typescript\n   * const summary = await shoppingService.getShoppingListSummary('trip-123');\n   * console.log(`Total products: ${summary.totalProducts}`);\n   * ```\n   */\n  public async getShoppingListSummary(tripId: string): Promise<{\n    tripId: string;\n    tripName: string;\n    totalProducts: number;\n    essentialProducts: number;\n    optionalProducts: number;\n    totalEstimatedCost: number;\n    categoryCounts: Array<{ category: string; count: number }>;\n    generatedAt: Date;\n  }> {\n    const shoppingList = await this.generate(tripId);\n\n    const categoryCounts = shoppingList.byCategory.map((group) => ({\n      category: group.categoryDisplayName,\n      count: group.itemCount,\n    }));\n\n    return {\n      tripId: shoppingList.tripId,\n      tripName: shoppingList.tripName,\n      totalProducts: shoppingList.totalItems,\n      essentialProducts: shoppingList.essentialItemsCount,\n      optionalProducts: shoppingList.optionalItemsCount,\n      totalEstimatedCost: shoppingList.totalEstimatedCost,\n      categoryCounts,\n      generatedAt: shoppingList.generatedAt,\n    };\n  }\n\n  /**\n   * Gets display name for a category.\n   *\n   * @param category - The category (string or enum)\n   * @returns The display name\n   */\n  private getCategoryDisplayName(category: string | ProductCategory): string {\n    const categoryStr = String(category);\n    const displayNames: Record<string, string> = {\n      food: 'Comida',\n      beverage: 'Bebidas',\n      alcohol: 'Alcohol',\n      snack: 'Snacks',\n      other: 'Otros',\n      FOOD: 'Comida',\n      BEVERAGE: 'Bebidas',\n      BEVERAGES: 'Bebidas',\n      ALCOHOL: 'Alcohol',\n      SNACK: 'Snacks',\n      SNACKS: 'Snacks',\n      OTHER: 'Otros',\n      MEAT: 'Carnes',\n      SEAFOOD: 'Mariscos',\n      DAIRY: 'Lacteos',\n      PRODUCE: 'Frutas y Verduras',\n      BAKERY: 'Panaderia',\n      CONDIMENTS: 'Condimentos',\n      FROZEN: 'Congelados',\n      CANNED: 'Enlatados',\n      DRY_GOODS: 'Secos',\n    };\n    return displayNames[categoryStr] || categoryStr;\n  }\n\n  /**\n   * Extracts unique dates from shopping list items.\n   *\n   * @param items - Array of shopping list items (can be readonly)\n   * @returns Array of unique dates sorted chronologically\n   */\n  private extractUniqueDates(items: ReadonlyArray<ShoppingListItemDTO>): Date[] {\n    const dateSet = new Set<string>();\n\n    for (const item of items) {\n      for (const dateData of item.byDate) {\n        dateSet.add(this.normalizeDate(dateData.date));\n      }\n    }\n\n    return Array.from(dateSet)\n      .map((d) => new Date(d))\n      .sort((a, b) => a.getTime() - b.getTime());\n  }\n\n  /**\n   * Normalizes a date to ISO date string (YYYY-MM-DD).\n   *\n   * @param date - The date to normalize\n   * @returns Normalized date string\n   */\n  private normalizeDate(date: Date): string {\n    const isoString = date.toISOString();\n    const datePart = isoString.split('T')[0];\n    return datePart ?? isoString.substring(0, 10);\n  }\n\n  /**\n   * Formats a date for CSV export (YYYY-MM-DD).\n   *\n   * @param date - The date to format\n   * @returns Formatted date string\n   */\n  private formatDateForCSV(date: Date): string {\n    const isoString = date.toISOString();\n    const datePart = isoString.split('T')[0];\n    return datePart ?? isoString.substring(0, 10);\n  }\n\n  /**\n   * Escapes a CSV row properly, handling special characters.\n   *\n   * @param row - Array of cell values\n   * @returns Properly escaped CSV row string\n   */\n  private escapeCSVRow(row: string[]): string {\n    return row\n      .map((cell) => {\n        const cellStr = String(cell);\n        // If cell contains comma, quote, newline, or semicolon, wrap in quotes\n        if (cellStr.includes(',') || cellStr.includes('\"') || cellStr.includes('\\n') || cellStr.includes(';')) {\n          return `\"${cellStr.replace(/\"/g, '\"\"')}\"`;\n        }\n        return cellStr;\n      })\n      .join(',');\n  }\n}\n","/**\n * Dependency Injection Container\n * Instantiates and wires all dependencies\n * @module shared/di/container\n */\n\nimport { TripFoodDatabase } from '@infrastructure/persistence/indexeddb/database';\n\n// Import repositories\nimport { IndexedDBTripRepository } from '@infrastructure/persistence/indexeddb/TripRepository';\nimport { IndexedDBParticipantRepository } from '@infrastructure/persistence/indexeddb/ParticipantRepository';\nimport { IndexedDBProductRepository } from '@infrastructure/persistence/indexeddb/ProductRepository';\nimport { IndexedDBConsumptionRepository } from '@infrastructure/persistence/indexeddb/ConsumptionRepository';\nimport { IndexedDBAvailabilityRepository } from '@infrastructure/persistence/indexeddb/AvailabilityRepository';\n\n// Import entity classes for factory functions\nimport { Trip } from '@domain/entities/Trip';\nimport { Participant } from '@domain/entities/Participant';\nimport { Product } from '@domain/entities/Product';\nimport { Consumption } from '@domain/entities/Consumption';\nimport { Availability } from '@domain/entities/Availability';\n\n// Import services\nimport { TripService } from '@application/services/TripService';\nimport { ParticipantService } from '@application/services/ParticipantService';\nimport { ProductService } from '@application/services/ProductService';\nimport { ConsumptionService } from '@application/services/ConsumptionService';\nimport { AvailabilityService } from '@application/services/AvailabilityService';\nimport { ShoppingService } from '@application/services/ShoppingService';\n\n// Database instance (singleton)\nconst database = new TripFoodDatabase();\n\n// Factory functions for creating domain entities from persistence props\nconst tripFactory = (props: Parameters<typeof Trip.fromPersistence>[0]) => Trip.fromPersistence(props);\nconst participantFactory = (props: Parameters<typeof Participant.fromPersistence>[0]) => Participant.fromPersistence(props);\nconst productFactory = (props: Parameters<typeof Product.fromPersistence>[0]) => Product.fromPersistence(props);\nconst consumptionFactory = (props: Parameters<typeof Consumption.fromPersistence>[0]) => Consumption.fromPersistence(props);\nconst availabilityFactory = (props: Parameters<typeof Availability.fromPersistence>[0]) => Availability.fromPersistence(props);\n\n// Repositories\nconst tripRepository = new IndexedDBTripRepository(database, tripFactory);\nconst participantRepository = new IndexedDBParticipantRepository(database, participantFactory);\nconst productRepository = new IndexedDBProductRepository(database, productFactory);\nconst consumptionRepository = new IndexedDBConsumptionRepository(database, consumptionFactory);\nconst availabilityRepository = new IndexedDBAvailabilityRepository(database, availabilityFactory);\n\n// Services\nexport const tripService = new TripService(tripRepository);\nexport const participantService = new ParticipantService(participantRepository, tripRepository);\nexport const productService = new ProductService(productRepository);\nexport const consumptionService = new ConsumptionService(consumptionRepository, participantRepository, productRepository);\nexport const availabilityService = new AvailabilityService(availabilityRepository, participantRepository);\nexport const shoppingService = new ShoppingService(consumptionRepository, productRepository, availabilityRepository);\n\n// Container object for Context\nexport const services = {\n  tripService,\n  participantService,\n  productService,\n  consumptionService,\n  availabilityService,\n  shoppingService,\n};\n\nexport type ServiceContainer = typeof services;\n\n// Export database for direct access if needed\nexport { database };\n","/**\n * Service Context - Provides dependency injection for application services\n * @module presentation/context/ServiceContext\n */\nimport { createContext, useContext, useMemo } from 'react';\nimport type { FC, ReactNode } from 'react';\nimport { services, type ServiceContainer } from '@shared/di/container';\n\nconst ServiceContext = createContext<ServiceContainer | null>(null);\n\ninterface ServiceProviderProps {\n  children: ReactNode;\n}\n\n/**\n * Provider component that makes services available throughout the app\n */\nexport const ServiceProvider: FC<ServiceProviderProps> = ({ children }) => {\n  // Memoize to prevent unnecessary re-renders\n  const value = useMemo(() => services, []);\n\n  return (\n    <ServiceContext.Provider value={value}>\n      {children}\n    </ServiceContext.Provider>\n  );\n};\n\n/**\n * Hook to access application services\n * @throws Error if used outside of ServiceProvider\n */\nexport const useServices = (): ServiceContainer => {\n  const context = useContext(ServiceContext);\n  if (!context) {\n    throw new Error('useServices must be used within a ServiceProvider');\n  }\n  return context;\n};\n\n// Export individual service hooks for convenience\nexport const useTripService = () => useServices().tripService;\nexport const useParticipantService = () => useServices().participantService;\nexport const useProductService = () => useServices().productService;\nexport const useConsumptionService = () => useServices().consumptionService;\nexport const useAvailabilityService = () => useServices().availabilityService;\nexport const useShoppingService = () => useServices().shoppingService;\n\n// Re-export ServiceContainer type\nexport type { ServiceContainer };\n","/**\n * Header Component - Main application header with navigation\n */\nimport type { FC } from 'react';\nimport { Link, useLocation } from 'react-router-dom';\nimport styles from './Header.module.css';\n\nexport interface HeaderProps {\n  /** Current trip name (if in trip context) */\n  tripName?: string | undefined;\n  /** Whether to show navigation */\n  showNav?: boolean | undefined;\n  /** Callback to toggle sidebar */\n  onToggleSidebar?: (() => void) | undefined;\n}\n\nexport const Header: FC<HeaderProps> = ({\n  tripName,\n  showNav = true,\n  onToggleSidebar,\n}) => {\n  const location = useLocation();\n\n  const isActive = (path: string) => location.pathname === path;\n\n  return (\n    <header className={styles.header}>\n      <div className={styles.container}>\n        <div className={styles.left}>\n          {onToggleSidebar && (\n            <button\n              type=\"button\"\n              className={styles.menuButton}\n              onClick={onToggleSidebar}\n              aria-label=\"Abrir menu\"\n            >\n              <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                <path d=\"M3 12h18M3 6h18M3 18h18\" />\n              </svg>\n            </button>\n          )}\n          <Link to=\"/\" className={styles.logo}>\n            <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <path d=\"M3 3h18v18H3zM12 8v8m-4-4h8\" />\n            </svg>\n            <span className={styles.logoText}>TripFood</span>\n          </Link>\n          {tripName && (\n            <div className={styles.tripBadge}>\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                <path d=\"M9 18l6-6-6-6\" />\n              </svg>\n              <span>{tripName}</span>\n            </div>\n          )}\n        </div>\n\n        {showNav && (\n          <nav className={styles.nav} aria-label=\"Navegacion principal\">\n            <Link\n              to=\"/\"\n              className={`${styles.navLink} ${isActive('/') ? styles.active : ''}`}\n            >\n              Inicio\n            </Link>\n            <Link\n              to=\"/trips\"\n              className={`${styles.navLink} ${location.pathname.startsWith('/trips') ? styles.active : ''}`}\n            >\n              Viajes\n            </Link>\n          </nav>\n        )}\n\n        <div className={styles.right}>\n          <button\n            type=\"button\"\n            className={styles.iconButton}\n            aria-label=\"Configuracion\"\n          >\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <circle cx=\"12\" cy=\"12\" r=\"3\" />\n              <path d=\"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z\" />\n            </svg>\n          </button>\n        </div>\n      </div>\n    </header>\n  );\n};\n","/**\n * Sidebar Component - Navigation sidebar for trip-specific pages\n */\nimport type { FC } from 'react';\nimport { NavLink, useParams } from 'react-router-dom';\nimport styles from './Sidebar.module.css';\n\nexport interface SidebarProps {\n  /** Whether the sidebar is open (mobile) */\n  isOpen: boolean;\n  /** Callback to close sidebar */\n  onClose: () => void;\n}\n\ninterface NavItem {\n  path: string;\n  label: string;\n  icon: JSX.Element;\n}\n\nexport const Sidebar: FC<SidebarProps> = ({ isOpen, onClose }) => {\n  const { tripId } = useParams<{ tripId: string }>();\n\n  const navItems: NavItem[] = [\n    {\n      path: `/trips/${tripId}`,\n      label: 'Dashboard',\n      icon: (\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n          <rect x=\"3\" y=\"3\" width=\"7\" height=\"7\" />\n          <rect x=\"14\" y=\"3\" width=\"7\" height=\"7\" />\n          <rect x=\"14\" y=\"14\" width=\"7\" height=\"7\" />\n          <rect x=\"3\" y=\"14\" width=\"7\" height=\"7\" />\n        </svg>\n      ),\n    },\n    {\n      path: `/trips/${tripId}/participants`,\n      label: 'Participantes',\n      icon: (\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n          <path d=\"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2\" />\n          <circle cx=\"9\" cy=\"7\" r=\"4\" />\n          <path d=\"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75\" />\n        </svg>\n      ),\n    },\n    {\n      path: `/trips/${tripId}/products`,\n      label: 'Productos',\n      icon: (\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n          <path d=\"M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0\" />\n        </svg>\n      ),\n    },\n    {\n      path: `/trips/${tripId}/availability`,\n      label: 'Disponibilidad',\n      icon: (\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n          <path d=\"M9 11l3 3L22 4\" />\n          <path d=\"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11\" />\n        </svg>\n      ),\n    },\n    {\n      path: `/trips/${tripId}/shopping`,\n      label: 'Lista de Compras',\n      icon: (\n        <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n          <circle cx=\"9\" cy=\"21\" r=\"1\" />\n          <circle cx=\"20\" cy=\"21\" r=\"1\" />\n          <path d=\"M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6\" />\n        </svg>\n      ),\n    },\n  ];\n\n  return (\n    <>\n      {/* Overlay for mobile */}\n      {isOpen && (\n        <div\n          className={styles.overlay}\n          onClick={onClose}\n          aria-hidden=\"true\"\n        />\n      )}\n\n      <aside\n        className={`${styles.sidebar} ${isOpen ? styles.open : ''}`}\n        aria-label=\"Menu de navegacion del viaje\"\n      >\n        <div className={styles.header}>\n          <h2 className={styles.title}>Menu</h2>\n          <button\n            type=\"button\"\n            className={styles.closeButton}\n            onClick={onClose}\n            aria-label=\"Cerrar menu\"\n          >\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <path d=\"M18 6L6 18M6 6l12 12\" />\n            </svg>\n          </button>\n        </div>\n\n        <nav className={styles.nav}>\n          {navItems.map((item) => (\n            <NavLink\n              key={item.path}\n              to={item.path}\n              end={item.path === `/trips/${tripId}`}\n              className={({ isActive }) =>\n                `${styles.navItem} ${isActive ? styles.active : ''}`\n              }\n              onClick={onClose}\n            >\n              <span className={styles.navIcon}>{item.icon}</span>\n              <span className={styles.navLabel}>{item.label}</span>\n            </NavLink>\n          ))}\n        </nav>\n\n        <div className={styles.footer}>\n          <NavLink\n            to=\"/trips\"\n            className={styles.backLink ?? ''}\n            onClick={onClose}\n          >\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <path d=\"M19 12H5M12 19l-7-7 7-7\" />\n            </svg>\n            Volver a Viajes\n          </NavLink>\n        </div>\n      </aside>\n    </>\n  );\n};\n","/**\n * MainLayout Component - Main application layout with header and optional sidebar\n */\nimport { useState, useCallback, type FC, type ReactNode } from 'react';\nimport { Header } from '../Header/Header';\nimport { Sidebar } from '../Sidebar/Sidebar';\nimport styles from './MainLayout.module.css';\n\nexport interface MainLayoutProps {\n  /** Page content */\n  children: ReactNode;\n  /** Current trip name (shows in header) */\n  tripName?: string;\n  /** Whether to show the sidebar */\n  showSidebar?: boolean;\n  /** Whether to show header navigation */\n  showNav?: boolean;\n}\n\nexport const MainLayout: FC<MainLayoutProps> = ({\n  children,\n  tripName,\n  showSidebar = false,\n  showNav = true,\n}) => {\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n\n  const handleToggleSidebar = useCallback(() => {\n    setIsSidebarOpen((prev) => !prev);\n  }, []);\n\n  const handleCloseSidebar = useCallback(() => {\n    setIsSidebarOpen(false);\n  }, []);\n\n  return (\n    <div className={styles.layout}>\n      <Header\n        tripName={tripName}\n        showNav={showNav}\n        onToggleSidebar={showSidebar ? handleToggleSidebar : undefined}\n      />\n      <div className={styles.body}>\n        {showSidebar && (\n          <Sidebar\n            isOpen={isSidebarOpen}\n            onClose={handleCloseSidebar}\n          />\n        )}\n        <main className={`${styles.main} ${showSidebar ? styles.withSidebar : ''}`}>\n          <div className={styles.content}>\n            {children}\n          </div>\n        </main>\n      </div>\n    </div>\n  );\n};\n","/**\n * Button Component - Reusable button with multiple variants and states\n */\nimport type { FC, ButtonHTMLAttributes, ReactNode } from 'react';\nimport styles from './Button.module.css';\n\nexport interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\n  /** Visual variant of the button */\n  variant?: 'primary' | 'secondary' | 'danger' | 'ghost';\n  /** Size of the button */\n  size?: 'sm' | 'md' | 'lg';\n  /** Shows loading spinner and disables button */\n  isLoading?: boolean;\n  /** Icon to display before the text */\n  leftIcon?: ReactNode;\n  /** Icon to display after the text */\n  rightIcon?: ReactNode;\n  /** Makes the button full width */\n  fullWidth?: boolean;\n}\n\nexport const Button: FC<ButtonProps> = ({\n  children,\n  variant = 'primary',\n  size = 'md',\n  isLoading = false,\n  leftIcon,\n  rightIcon,\n  fullWidth = false,\n  disabled,\n  className,\n  type = 'button',\n  ...props\n}) => {\n  const classNames = [\n    styles.button,\n    styles[variant],\n    styles[size],\n    fullWidth ? styles.fullWidth : '',\n    isLoading ? styles.loading : '',\n    className ?? '',\n  ].filter(Boolean).join(' ');\n\n  return (\n    <button\n      type={type}\n      className={classNames}\n      disabled={disabled || isLoading}\n      aria-busy={isLoading}\n      {...props}\n    >\n      {isLoading && (\n        <span className={styles.spinner} aria-hidden=\"true\" />\n      )}\n      {!isLoading && leftIcon && (\n        <span className={styles.icon} aria-hidden=\"true\">{leftIcon}</span>\n      )}\n      <span className={styles.content}>{children}</span>\n      {!isLoading && rightIcon && (\n        <span className={styles.icon} aria-hidden=\"true\">{rightIcon}</span>\n      )}\n    </button>\n  );\n};\n","/**\n * Modal Component - Accessible dialog/modal component\n */\nimport { useEffect, useRef, useCallback, type FC, type ReactNode, type KeyboardEvent } from 'react';\nimport { createPortal } from 'react-dom';\nimport styles from './Modal.module.css';\n\nexport interface ModalProps {\n  /** Whether the modal is open */\n  isOpen: boolean;\n  /** Callback when the modal should close */\n  onClose: () => void;\n  /** Title of the modal */\n  title: string;\n  /** Content of the modal */\n  children: ReactNode;\n  /** Footer content (usually buttons) */\n  footer?: ReactNode;\n  /** Size of the modal */\n  size?: 'sm' | 'md' | 'lg' | 'xl';\n  /** Whether clicking overlay closes the modal */\n  closeOnOverlayClick?: boolean;\n  /** Whether pressing Escape closes the modal */\n  closeOnEscape?: boolean;\n}\n\nexport const Modal: FC<ModalProps> = ({\n  isOpen,\n  onClose,\n  title,\n  children,\n  footer,\n  size = 'md',\n  closeOnOverlayClick = true,\n  closeOnEscape = true,\n}) => {\n  const modalRef = useRef<HTMLDivElement>(null);\n  const previousActiveElement = useRef<HTMLElement | null>(null);\n\n  // Handle escape key\n  const handleKeyDown = useCallback((event: KeyboardEvent<HTMLDivElement>) => {\n    if (closeOnEscape && event.key === 'Escape') {\n      onClose();\n    }\n  }, [closeOnEscape, onClose]);\n\n  // Handle overlay click\n  const handleOverlayClick = useCallback((event: React.MouseEvent<HTMLDivElement>) => {\n    if (closeOnOverlayClick && event.target === event.currentTarget) {\n      onClose();\n    }\n  }, [closeOnOverlayClick, onClose]);\n\n  // Focus management and body scroll lock\n  useEffect(() => {\n    if (isOpen) {\n      previousActiveElement.current = document.activeElement as HTMLElement;\n      modalRef.current?.focus();\n      document.body.style.overflow = 'hidden';\n    } else {\n      document.body.style.overflow = '';\n      previousActiveElement.current?.focus();\n    }\n\n    return () => {\n      document.body.style.overflow = '';\n    };\n  }, [isOpen]);\n\n  if (!isOpen) return null;\n\n  const modalContent = (\n    <div\n      className={styles.overlay}\n      onClick={handleOverlayClick}\n      onKeyDown={handleKeyDown}\n      role=\"presentation\"\n    >\n      <div\n        ref={modalRef}\n        className={`${styles.modal} ${styles[size]}`}\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-labelledby=\"modal-title\"\n        tabIndex={-1}\n      >\n        <div className={styles.header}>\n          <h2 id=\"modal-title\" className={styles.title}>{title}</h2>\n          <button\n            type=\"button\"\n            className={styles.closeButton}\n            onClick={onClose}\n            aria-label=\"Cerrar modal\"\n          >\n            <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <path d=\"M18 6L6 18M6 6l12 12\" />\n            </svg>\n          </button>\n        </div>\n        <div className={styles.body}>\n          {children}\n        </div>\n        {footer && (\n          <div className={styles.footer}>\n            {footer}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n\n  return createPortal(modalContent, document.body);\n};\n","/**\n * Card Component - Container component for displaying content in a card format\n */\nimport type { FC, ReactNode, HTMLAttributes } from 'react';\nimport styles from './Card.module.css';\n\nexport interface CardProps extends HTMLAttributes<HTMLDivElement> {\n  /** Card title */\n  title?: string | undefined;\n  /** Card subtitle */\n  subtitle?: string | undefined;\n  /** Card header actions (buttons, etc.) */\n  headerActions?: ReactNode | undefined;\n  /** Card footer content */\n  footer?: ReactNode | undefined;\n  /** Visual variant */\n  variant?: 'default' | 'outlined' | 'elevated' | undefined;\n  /** Padding size */\n  padding?: 'none' | 'sm' | 'md' | 'lg' | undefined;\n  /** Whether the card is interactive (clickable) */\n  interactive?: boolean | undefined;\n  /** Children content */\n  children: ReactNode;\n}\n\nexport const Card: FC<CardProps> = ({\n  title,\n  subtitle,\n  headerActions,\n  footer,\n  variant = 'default',\n  padding = 'md',\n  interactive = false,\n  children,\n  className,\n  onClick,\n  ...props\n}) => {\n  const classNames = [\n    styles.card,\n    styles[variant],\n    styles[`padding-${padding}`],\n    interactive ? styles.interactive : '',\n    className ?? '',\n  ].filter(Boolean).join(' ');\n\n  const hasHeader = title || subtitle || headerActions;\n\n  return (\n    <div\n      className={classNames}\n      onClick={onClick}\n      role={interactive ? 'button' : undefined}\n      tabIndex={interactive ? 0 : undefined}\n      onKeyDown={interactive ? (e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          onClick?.(e as unknown as React.MouseEvent<HTMLDivElement>);\n        }\n      } : undefined}\n      {...props}\n    >\n      {hasHeader && (\n        <div className={styles.header}>\n          <div className={styles.headerText}>\n            {title && <h3 className={styles.title}>{title}</h3>}\n            {subtitle && <p className={styles.subtitle}>{subtitle}</p>}\n          </div>\n          {headerActions && (\n            <div className={styles.headerActions}>\n              {headerActions}\n            </div>\n          )}\n        </div>\n      )}\n      <div className={styles.body}>\n        {children}\n      </div>\n      {footer && (\n        <div className={styles.footer}>\n          {footer}\n        </div>\n      )}\n    </div>\n  );\n};\n","/**\n * Input Component - Reusable form input with label and validation states\n */\nimport { forwardRef, type InputHTMLAttributes, type ReactNode } from 'react';\nimport styles from './Input.module.css';\n\nexport interface InputProps extends Omit<InputHTMLAttributes<HTMLInputElement>, 'size'> {\n  /** Label for the input */\n  label?: string | undefined;\n  /** Helper text displayed below the input */\n  helperText?: string | undefined;\n  /** Error message (shows error state when present) */\n  error?: string | undefined;\n  /** Size variant */\n  size?: 'sm' | 'md' | 'lg' | undefined;\n  /** Left icon/addon */\n  leftAddon?: ReactNode | undefined;\n  /** Right icon/addon */\n  rightAddon?: ReactNode | undefined;\n  /** Whether the field is required */\n  required?: boolean | undefined;\n  /** Full width */\n  fullWidth?: boolean | undefined;\n}\n\nexport const Input = forwardRef<HTMLInputElement, InputProps>(({\n  label,\n  helperText,\n  error,\n  size = 'md',\n  leftAddon,\n  rightAddon,\n  required = false,\n  fullWidth = false,\n  className,\n  id,\n  disabled,\n  ...props\n}, ref) => {\n  const inputId = id || `input-${Math.random().toString(36).substr(2, 9)}`;\n  const hasError = Boolean(error);\n\n  const containerClasses = [\n    styles.container,\n    fullWidth ? styles.fullWidth : '',\n    className ?? '',\n  ].filter(Boolean).join(' ');\n\n  const inputWrapperClasses = [\n    styles.inputWrapper,\n    styles[size],\n    hasError ? styles.error : '',\n    disabled ? styles.disabled : '',\n    leftAddon ? styles.hasLeftAddon : '',\n    rightAddon ? styles.hasRightAddon : '',\n  ].filter(Boolean).join(' ');\n\n  return (\n    <div className={containerClasses}>\n      {label && (\n        <label htmlFor={inputId} className={styles.label}>\n          {label}\n          {required && <span className={styles.required} aria-hidden=\"true\"> *</span>}\n        </label>\n      )}\n      <div className={inputWrapperClasses}>\n        {leftAddon && (\n          <span className={styles.addon} aria-hidden=\"true\">\n            {leftAddon}\n          </span>\n        )}\n        <input\n          ref={ref}\n          id={inputId}\n          className={styles.input}\n          disabled={disabled}\n          aria-invalid={hasError}\n          aria-describedby={error ? `${inputId}-error` : helperText ? `${inputId}-helper` : undefined}\n          required={required}\n          {...props}\n        />\n        {rightAddon && (\n          <span className={styles.addon} aria-hidden=\"true\">\n            {rightAddon}\n          </span>\n        )}\n      </div>\n      {error && (\n        <p id={`${inputId}-error`} className={styles.errorText} role=\"alert\">\n          {error}\n        </p>\n      )}\n      {!error && helperText && (\n        <p id={`${inputId}-helper`} className={styles.helperText}>\n          {helperText}\n        </p>\n      )}\n    </div>\n  );\n});\n\nInput.displayName = 'Input';\n","/**\n * Select Component - Reusable dropdown select with label and validation states\n */\nimport { forwardRef, type SelectHTMLAttributes, type ReactNode } from 'react';\nimport styles from './Select.module.css';\n\nexport interface SelectOption {\n  value: string;\n  label: string;\n  disabled?: boolean;\n}\n\nexport interface SelectProps extends Omit<SelectHTMLAttributes<HTMLSelectElement>, 'size'> {\n  /** Label for the select */\n  label?: string;\n  /** Options to display */\n  options: SelectOption[];\n  /** Placeholder text */\n  placeholder?: string;\n  /** Helper text displayed below the select */\n  helperText?: string;\n  /** Error message (shows error state when present) */\n  error?: string;\n  /** Size variant */\n  size?: 'sm' | 'md' | 'lg';\n  /** Whether the field is required */\n  required?: boolean;\n  /** Full width */\n  fullWidth?: boolean;\n  /** Left icon */\n  leftIcon?: ReactNode;\n}\n\nexport const Select = forwardRef<HTMLSelectElement, SelectProps>(({\n  label,\n  options,\n  placeholder,\n  helperText,\n  error,\n  size = 'md',\n  required = false,\n  fullWidth = false,\n  leftIcon,\n  className,\n  id,\n  disabled,\n  ...props\n}, ref) => {\n  const selectId = id || `select-${Math.random().toString(36).substr(2, 9)}`;\n  const hasError = Boolean(error);\n\n  const containerClasses = [\n    styles.container,\n    fullWidth ? styles.fullWidth : '',\n    className ?? '',\n  ].filter(Boolean).join(' ');\n\n  const selectWrapperClasses = [\n    styles.selectWrapper,\n    styles[size],\n    hasError ? styles.error : '',\n    disabled ? styles.disabled : '',\n    leftIcon ? styles.hasLeftIcon : '',\n  ].filter(Boolean).join(' ');\n\n  return (\n    <div className={containerClasses}>\n      {label && (\n        <label htmlFor={selectId} className={styles.label}>\n          {label}\n          {required && <span className={styles.required} aria-hidden=\"true\"> *</span>}\n        </label>\n      )}\n      <div className={selectWrapperClasses}>\n        {leftIcon && (\n          <span className={styles.icon} aria-hidden=\"true\">\n            {leftIcon}\n          </span>\n        )}\n        <select\n          ref={ref}\n          id={selectId}\n          className={styles.select}\n          disabled={disabled}\n          aria-invalid={hasError}\n          aria-describedby={error ? `${selectId}-error` : helperText ? `${selectId}-helper` : undefined}\n          required={required}\n          {...props}\n        >\n          {placeholder && (\n            <option value=\"\" disabled>\n              {placeholder}\n            </option>\n          )}\n          {options.map((option) => (\n            <option\n              key={option.value}\n              value={option.value}\n              disabled={option.disabled}\n            >\n              {option.label}\n            </option>\n          ))}\n        </select>\n        <span className={styles.chevron} aria-hidden=\"true\">\n          <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n            <path d=\"M6 9l6 6 6-6\" />\n          </svg>\n        </span>\n      </div>\n      {error && (\n        <p id={`${selectId}-error`} className={styles.errorText} role=\"alert\">\n          {error}\n        </p>\n      )}\n      {!error && helperText && (\n        <p id={`${selectId}-helper`} className={styles.helperText}>\n          {helperText}\n        </p>\n      )}\n    </div>\n  );\n});\n\nSelect.displayName = 'Select';\n","/**\n * Table Component - Reusable data table with sorting and selection support\n */\nimport type { FC, ReactNode } from 'react';\nimport styles from './Table.module.css';\n\nexport interface TableColumn<T> {\n  /** Unique key for the column */\n  key: string;\n  /** Header text */\n  header: string;\n  /** Render function for cell content */\n  render: (item: T, index: number) => ReactNode;\n  /** Column width */\n  width?: string;\n  /** Alignment */\n  align?: 'left' | 'center' | 'right';\n  /** Whether the column is sortable */\n  sortable?: boolean;\n}\n\nexport interface TableProps<T> {\n  /** Data to display */\n  data: T[];\n  /** Column definitions */\n  columns: TableColumn<T>[];\n  /** Key extractor for rows */\n  getRowKey: (item: T, index: number) => string;\n  /** Loading state */\n  isLoading?: boolean;\n  /** Empty state message */\n  emptyMessage?: string;\n  /** Current sort key */\n  sortKey?: string;\n  /** Sort direction */\n  sortDirection?: 'asc' | 'desc';\n  /** Sort change handler */\n  onSort?: (key: string) => void;\n  /** Row click handler */\n  onRowClick?: (item: T, index: number) => void;\n  /** Selected row keys */\n  selectedKeys?: Set<string>;\n  /** Row selection handler */\n  onSelectRow?: (key: string, selected: boolean) => void;\n  /** Select all handler */\n  onSelectAll?: (selected: boolean) => void;\n  /** Whether to show row selection */\n  selectable?: boolean;\n  /** Striped rows */\n  striped?: boolean;\n  /** Compact mode */\n  compact?: boolean;\n}\n\nexport function Table<T>({\n  data,\n  columns,\n  getRowKey,\n  isLoading = false,\n  emptyMessage = 'No hay datos disponibles',\n  sortKey,\n  sortDirection,\n  onSort,\n  onRowClick,\n  selectedKeys,\n  onSelectRow,\n  onSelectAll,\n  selectable = false,\n  striped = false,\n  compact = false,\n}: TableProps<T>): ReturnType<FC> {\n  const allSelected = data.length > 0 && selectedKeys?.size === data.length;\n  const someSelected = selectedKeys && selectedKeys.size > 0 && selectedKeys.size < data.length;\n\n  const tableClasses = [\n    styles.table,\n    striped ? styles.striped : '',\n    compact ? styles.compact : '',\n  ].filter(Boolean).join(' ');\n\n  const handleSort = (key: string) => {\n    if (onSort) {\n      onSort(key);\n    }\n  };\n\n  const handleSelectAll = () => {\n    if (onSelectAll) {\n      onSelectAll(!allSelected);\n    }\n  };\n\n  const handleSelectRow = (key: string) => {\n    if (onSelectRow && selectedKeys) {\n      onSelectRow(key, !selectedKeys.has(key));\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className={styles.loadingContainer}>\n        <div className={styles.loadingSpinner} />\n        <p>Cargando datos...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className={styles.wrapper}>\n      <table className={tableClasses}>\n        <thead className={styles.thead}>\n          <tr>\n            {selectable && (\n              <th className={styles.checkboxCell}>\n                <input\n                  type=\"checkbox\"\n                  checked={allSelected}\n                  ref={(el) => {\n                    if (el) el.indeterminate = someSelected ?? false;\n                  }}\n                  onChange={handleSelectAll}\n                  aria-label=\"Seleccionar todos\"\n                />\n              </th>\n            )}\n            {columns.map((column) => (\n              <th\n                key={column.key}\n                className={`${styles.th} ${styles[`align-${column.align || 'left'}`]}`}\n                style={{ width: column.width }}\n              >\n                {column.sortable && onSort ? (\n                  <button\n                    type=\"button\"\n                    className={styles.sortButton}\n                    onClick={() => handleSort(column.key)}\n                    aria-label={`Ordenar por ${column.header}`}\n                  >\n                    {column.header}\n                    <span className={styles.sortIcon}>\n                      {sortKey === column.key ? (\n                        sortDirection === 'asc' ? (\n                          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                            <path d=\"M18 15l-6-6-6 6\" />\n                          </svg>\n                        ) : (\n                          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                            <path d=\"M6 9l6 6 6-6\" />\n                          </svg>\n                        )\n                      ) : (\n                        <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" opacity=\"0.3\">\n                          <path d=\"M7 15l5 5 5-5M7 9l5-5 5 5\" />\n                        </svg>\n                      )}\n                    </span>\n                  </button>\n                ) : (\n                  column.header\n                )}\n              </th>\n            ))}\n          </tr>\n        </thead>\n        <tbody className={styles.tbody}>\n          {data.length === 0 ? (\n            <tr>\n              <td\n                colSpan={columns.length + (selectable ? 1 : 0)}\n                className={styles.emptyCell}\n              >\n                {emptyMessage}\n              </td>\n            </tr>\n          ) : (\n            data.map((item, index) => {\n              const rowKey = getRowKey(item, index);\n              const isSelected = selectedKeys?.has(rowKey);\n\n              return (\n                <tr\n                  key={rowKey}\n                  className={`${styles.tr} ${isSelected ? styles.selected : ''} ${onRowClick ? styles.clickable : ''}`}\n                  onClick={onRowClick ? () => onRowClick(item, index) : undefined}\n                >\n                  {selectable && (\n                    <td className={styles.checkboxCell}>\n                      <input\n                        type=\"checkbox\"\n                        checked={isSelected}\n                        onChange={() => handleSelectRow(rowKey)}\n                        onClick={(e) => e.stopPropagation()}\n                        aria-label={`Seleccionar fila ${index + 1}`}\n                      />\n                    </td>\n                  )}\n                  {columns.map((column) => (\n                    <td\n                      key={column.key}\n                      className={`${styles.td} ${styles[`align-${column.align || 'left'}`]}`}\n                    >\n                      {column.render(item, index)}\n                    </td>\n                  ))}\n                </tr>\n              );\n            })\n          )}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n","/**\n * Loading Component - Displays loading state with spinner\n */\nimport type { FC } from 'react';\nimport styles from './Loading.module.css';\n\nexport interface LoadingProps {\n  /** Size of the spinner */\n  size?: 'sm' | 'md' | 'lg';\n  /** Loading message */\n  message?: string;\n  /** Whether to display as overlay */\n  overlay?: boolean;\n  /** Whether to display as fullscreen */\n  fullscreen?: boolean;\n}\n\nexport const Loading: FC<LoadingProps> = ({\n  size = 'md',\n  message = 'Cargando...',\n  overlay = false,\n  fullscreen = false,\n}) => {\n  const containerClasses = [\n    styles.container,\n    overlay ? styles.overlay : '',\n    fullscreen ? styles.fullscreen : '',\n  ].filter(Boolean).join(' ');\n\n  return (\n    <div className={containerClasses} role=\"status\" aria-live=\"polite\">\n      <div className={`${styles.spinner} ${styles[size]}`} aria-hidden=\"true\">\n        <svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n          <circle\n            className={styles.track}\n            cx=\"12\"\n            cy=\"12\"\n            r=\"10\"\n            stroke=\"currentColor\"\n            strokeWidth=\"3\"\n          />\n          <circle\n            className={styles.progress}\n            cx=\"12\"\n            cy=\"12\"\n            r=\"10\"\n            stroke=\"currentColor\"\n            strokeWidth=\"3\"\n            strokeLinecap=\"round\"\n          />\n        </svg>\n      </div>\n      {message && <p className={styles.message}>{message}</p>}\n      <span className=\"sr-only\">{message}</span>\n    </div>\n  );\n};\n","/**\n * EmptyState Component - Displays when there's no data to show\n */\nimport type { FC, ReactNode } from 'react';\nimport styles from './EmptyState.module.css';\n\nexport interface EmptyStateProps {\n  /** Icon to display */\n  icon?: ReactNode;\n  /** Title of the empty state */\n  title: string;\n  /** Description text */\n  description?: string;\n  /** Action button or content */\n  action?: ReactNode;\n  /** Size variant */\n  size?: 'sm' | 'md' | 'lg';\n}\n\nexport const EmptyState: FC<EmptyStateProps> = ({\n  icon,\n  title,\n  description,\n  action,\n  size = 'md',\n}) => {\n  const defaultIcon = (\n    <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\n      <path d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\" />\n    </svg>\n  );\n\n  return (\n    <div className={`${styles.container} ${styles[size]}`} role=\"status\">\n      <div className={styles.iconWrapper} aria-hidden=\"true\">\n        {icon || defaultIcon}\n      </div>\n      <h3 className={styles.title}>{title}</h3>\n      {description && (\n        <p className={styles.description}>{description}</p>\n      )}\n      {action && (\n        <div className={styles.action}>\n          {action}\n        </div>\n      )}\n    </div>\n  );\n};\n","/**\n * ErrorDisplay Component - Shows error messages with retry option\n */\nimport type { FC, ReactNode } from 'react';\nimport styles from './ErrorDisplay.module.css';\n\nexport interface ErrorDisplayProps {\n  /** Error title */\n  title?: string;\n  /** Error message */\n  message: string;\n  /** Retry handler */\n  onRetry?: () => void;\n  /** Retry button text */\n  retryText?: string;\n  /** Custom icon */\n  icon?: ReactNode;\n  /** Additional action */\n  action?: ReactNode;\n  /** Variant style */\n  variant?: 'inline' | 'card' | 'fullpage';\n}\n\nexport const ErrorDisplay: FC<ErrorDisplayProps> = ({\n  title = 'Error',\n  message,\n  onRetry,\n  retryText = 'Reintentar',\n  icon,\n  action,\n  variant = 'card',\n}) => {\n  const defaultIcon = (\n    <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\n      <circle cx=\"12\" cy=\"12\" r=\"10\" />\n      <path d=\"M12 8v4m0 4h.01\" />\n    </svg>\n  );\n\n  if (variant === 'inline') {\n    return (\n      <div className={styles.inline} role=\"alert\">\n        <span className={styles.inlineIcon} aria-hidden=\"true\">\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"10\" />\n            <path d=\"M12 8v4m0 4h.01\" />\n          </svg>\n        </span>\n        <span className={styles.inlineMessage}>{message}</span>\n        {onRetry && (\n          <button\n            type=\"button\"\n            className={styles.inlineRetry}\n            onClick={onRetry}\n          >\n            {retryText}\n          </button>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className={`${styles.container} ${styles[variant]}`} role=\"alert\">\n      <div className={styles.iconWrapper} aria-hidden=\"true\">\n        {icon || defaultIcon}\n      </div>\n      <h3 className={styles.title}>{title}</h3>\n      <p className={styles.message}>{message}</p>\n      <div className={styles.actions}>\n        {onRetry && (\n          <button\n            type=\"button\"\n            className={styles.retryButton}\n            onClick={onRetry}\n          >\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <path d=\"M1 4v6h6M23 20v-6h-6\" />\n              <path d=\"M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15\" />\n            </svg>\n            {retryText}\n          </button>\n        )}\n        {action}\n      </div>\n    </div>\n  );\n};\n","/**\n * ConfirmDialog Component - Confirmation dialog for destructive actions\n */\nimport type { FC, ReactNode } from 'react';\nimport { Modal } from '../Modal/Modal';\nimport { Button } from '../Button/Button';\nimport styles from './ConfirmDialog.module.css';\n\nexport interface ConfirmDialogProps {\n  /** Whether the dialog is open */\n  isOpen: boolean;\n  /** Callback when dialog should close */\n  onClose: () => void;\n  /** Callback when confirmed */\n  onConfirm: () => void;\n  /** Dialog title */\n  title: string;\n  /** Dialog message */\n  message: string | ReactNode;\n  /** Confirm button text */\n  confirmText?: string;\n  /** Cancel button text */\n  cancelText?: string;\n  /** Variant affects button styling */\n  variant?: 'danger' | 'warning' | 'info';\n  /** Loading state for confirm action */\n  isLoading?: boolean;\n  /** Custom icon */\n  icon?: ReactNode;\n}\n\nexport const ConfirmDialog: FC<ConfirmDialogProps> = ({\n  isOpen,\n  onClose,\n  onConfirm,\n  title,\n  message,\n  confirmText = 'Confirmar',\n  cancelText = 'Cancelar',\n  variant = 'danger',\n  isLoading = false,\n  icon,\n}) => {\n  const defaultIcons: Record<string, ReactNode> = {\n    danger: (\n      <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n        <path d=\"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0zM12 9v4m0 4h.01\" />\n      </svg>\n    ),\n    warning: (\n      <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\" />\n        <path d=\"M12 8v4m0 4h.01\" />\n      </svg>\n    ),\n    info: (\n      <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n        <circle cx=\"12\" cy=\"12\" r=\"10\" />\n        <path d=\"M12 16v-4m0-4h.01\" />\n      </svg>\n    ),\n  };\n\n  const confirmButtonVariant = variant === 'danger' ? 'danger' : 'primary';\n\n  const footer = (\n    <>\n      <Button\n        variant=\"secondary\"\n        onClick={onClose}\n        disabled={isLoading}\n      >\n        {cancelText}\n      </Button>\n      <Button\n        variant={confirmButtonVariant}\n        onClick={onConfirm}\n        isLoading={isLoading}\n      >\n        {confirmText}\n      </Button>\n    </>\n  );\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onClose={onClose}\n      title={title}\n      footer={footer}\n      size=\"sm\"\n      closeOnOverlayClick={!isLoading}\n      closeOnEscape={!isLoading}\n    >\n      <div className={styles.content}>\n        <div className={`${styles.iconWrapper} ${styles[variant]}`} aria-hidden=\"true\">\n          {icon || defaultIcons[variant]}\n        </div>\n        <div className={styles.message}>\n          {typeof message === 'string' ? <p>{message}</p> : message}\n        </div>\n      </div>\n    </Modal>\n  );\n};\n","/**\n * useModal Hook - Manages modal state and actions\n * Provides a simple interface for controlling modal visibility\n *\n * @module presentation/hooks/useModal\n */\nimport { useState, useCallback, useMemo } from 'react';\n\n/**\n * Configuration options for the useModal hook\n */\nexport interface UseModalOptions {\n  /** Initial open state (default: false) */\n  initialOpen?: boolean;\n  /** Callback when modal opens */\n  onOpen?: () => void;\n  /** Callback when modal closes */\n  onClose?: () => void;\n}\n\n/**\n * Return type for the useModal hook\n */\nexport interface UseModalReturn {\n  /** Whether the modal is open */\n  isOpen: boolean;\n  /** Open the modal */\n  open: () => void;\n  /** Close the modal */\n  close: () => void;\n  /** Toggle the modal state */\n  toggle: () => void;\n  /** Props to spread on the modal component */\n  modalProps: {\n    isOpen: boolean;\n    onClose: () => void;\n  };\n}\n\n/**\n * Hook for managing modal visibility state\n *\n * @description\n * This hook provides a simple and consistent interface for controlling\n * modal visibility across the application. It includes callbacks for\n * open/close events and convenient props to spread on modal components.\n *\n * @param options - Configuration options (optional)\n * @returns {UseModalReturn} Modal state and actions\n *\n * @example\n * ```tsx\n * // Basic usage\n * function MyComponent() {\n *   const { isOpen, open, close, modalProps } = useModal();\n *\n *   return (\n *     <div>\n *       <button onClick={open}>Abrir Modal</button>\n *       <Modal {...modalProps}>\n *         <h2>Contenido del Modal</h2>\n *         <button onClick={close}>Cerrar</button>\n *       </Modal>\n *     </div>\n *   );\n * }\n *\n * // With options\n * function MyComponentWithCallbacks() {\n *   const { isOpen, open, close } = useModal({\n *     initialOpen: false,\n *     onOpen: () => console.log('Modal abierto'),\n *     onClose: () => console.log('Modal cerrado'),\n *   });\n *\n *   return (\n *     <div>\n *       <button onClick={open}>Abrir</button>\n *       {isOpen && <Modal onClose={close}>...</Modal>}\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useModal(options: UseModalOptions = {}): UseModalReturn {\n  const { initialOpen = false, onOpen, onClose } = options;\n\n  const [isOpen, setIsOpen] = useState(initialOpen);\n\n  /**\n   * Opens the modal\n   */\n  const open = useCallback(() => {\n    setIsOpen(true);\n    onOpen?.();\n  }, [onOpen]);\n\n  /**\n   * Closes the modal\n   */\n  const close = useCallback(() => {\n    setIsOpen(false);\n    onClose?.();\n  }, [onClose]);\n\n  /**\n   * Toggles the modal state\n   */\n  const toggle = useCallback(() => {\n    setIsOpen((prev) => {\n      const newState = !prev;\n      if (newState) {\n        onOpen?.();\n      } else {\n        onClose?.();\n      }\n      return newState;\n    });\n  }, [onOpen, onClose]);\n\n  /**\n   * Memoized props to spread on modal component\n   */\n  const modalProps = useMemo(() => ({\n    isOpen,\n    onClose: close,\n  }), [isOpen, close]);\n\n  return {\n    isOpen,\n    open,\n    close,\n    toggle,\n    modalProps,\n  };\n}\n\n/**\n * Hook for managing multiple modals by key\n *\n * @description\n * This hook is useful when you need to manage multiple modals in a single\n * component. Each modal is identified by a unique key.\n *\n * @returns Functions for managing multiple modals\n *\n * @example\n * ```tsx\n * function MyComponent() {\n *   const { isOpen, open, close } = useModals();\n *\n *   return (\n *     <div>\n *       <button onClick={() => open('create')}>Crear</button>\n *       <button onClick={() => open('edit')}>Editar</button>\n *\n *       <Modal isOpen={isOpen('create')} onClose={() => close('create')}>\n *         <CreateForm />\n *       </Modal>\n *\n *       <Modal isOpen={isOpen('edit')} onClose={() => close('edit')}>\n *         <EditForm />\n *       </Modal>\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useModals(): {\n  /** Check if a modal is open */\n  isOpen: (key: string) => boolean;\n  /** Open a modal by key */\n  open: (key: string) => void;\n  /** Close a modal by key */\n  close: (key: string) => void;\n  /** Toggle a modal by key */\n  toggle: (key: string) => void;\n  /** Close all modals */\n  closeAll: () => void;\n  /** Get the currently open modal key (if any) */\n  currentModal: string | null;\n} {\n  const [openModals, setOpenModals] = useState<Set<string>>(new Set());\n\n  const isOpen = useCallback((key: string): boolean => {\n    return openModals.has(key);\n  }, [openModals]);\n\n  const open = useCallback((key: string) => {\n    setOpenModals((prev) => new Set(prev).add(key));\n  }, []);\n\n  const close = useCallback((key: string) => {\n    setOpenModals((prev) => {\n      const newSet = new Set(prev);\n      newSet.delete(key);\n      return newSet;\n    });\n  }, []);\n\n  const toggle = useCallback((key: string) => {\n    setOpenModals((prev) => {\n      const newSet = new Set(prev);\n      if (newSet.has(key)) {\n        newSet.delete(key);\n      } else {\n        newSet.add(key);\n      }\n      return newSet;\n    });\n  }, []);\n\n  const closeAll = useCallback(() => {\n    setOpenModals(new Set());\n  }, []);\n\n  const currentModal = useMemo((): string | null => {\n    const modals = Array.from(openModals);\n    return modals.length > 0 ? (modals[modals.length - 1] ?? null) : null;\n  }, [openModals]);\n\n  return {\n    isOpen,\n    open,\n    close,\n    toggle,\n    closeAll,\n    currentModal,\n  };\n}\n\n/**\n * Hook for managing a confirmation modal with data\n *\n * @description\n * This hook is useful for confirmation dialogs where you need to pass\n * data along with the modal state (e.g., the item to delete).\n *\n * @returns Functions for managing confirmation modal with data\n *\n * @example\n * ```tsx\n * function UserList() {\n *   const { isOpen, data, openWith, close, confirm } = useConfirmModal<User>();\n *\n *   const handleDelete = async (user: User) => {\n *     await deleteUser(user.id);\n *     close();\n *   };\n *\n *   return (\n *     <div>\n *       {users.map(user => (\n *         <button key={user.id} onClick={() => openWith(user)}>\n *           Eliminar {user.name}\n *         </button>\n *       ))}\n *\n *       <ConfirmDialog\n *         isOpen={isOpen}\n *         onClose={close}\n *         onConfirm={() => data && handleDelete(data)}\n *         title=\"Eliminar usuario\"\n *         message={`Estas seguro de eliminar a ${data?.name}?`}\n *       />\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useConfirmModal<T>(): {\n  /** Whether the modal is open */\n  isOpen: boolean;\n  /** The data passed to the modal */\n  data: T | null;\n  /** Open the modal with data */\n  openWith: (data: T) => void;\n  /** Close the modal and clear data */\n  close: () => void;\n  /** Execute confirmation action */\n  confirm: (action: (data: T) => void | Promise<void>) => Promise<void>;\n} {\n  const [isOpen, setIsOpen] = useState(false);\n  const [data, setData] = useState<T | null>(null);\n\n  const openWith = useCallback((newData: T) => {\n    setData(newData);\n    setIsOpen(true);\n  }, []);\n\n  const close = useCallback(() => {\n    setIsOpen(false);\n    // Delay clearing data to allow for exit animations\n    setTimeout(() => setData(null), 300);\n  }, []);\n\n  const confirm = useCallback(async (action: (data: T) => void | Promise<void>) => {\n    if (data) {\n      await action(data);\n      close();\n    }\n  }, [data, close]);\n\n  return {\n    isOpen,\n    data,\n    openWith,\n    close,\n    confirm,\n  };\n}\n","/**\n * useTrips Hook - Manages trips data and CRUD operations\n * Provides a complete interface for trip management with service integration\n *\n * @module presentation/hooks/useTrips\n */\nimport { useState, useCallback, useEffect } from 'react';\nimport { useServices } from '../context/ServiceContext';\nimport type { Trip, ITripCreateDTO, ITripUpdateDTO } from '@domain/entities/Trip';\n\n/**\n * State interface for the useTrips hook\n */\nexport interface UseTripsState {\n  /** List of all trips */\n  trips: Trip[];\n  /** Loading state indicator */\n  isLoading: boolean;\n  /** Error object if an operation failed */\n  error: Error | null;\n}\n\n/**\n * Actions interface for the useTrips hook\n */\nexport interface UseTripsActions {\n  /** Fetches all trips from the service */\n  fetchTrips: () => Promise<void>;\n  /** Creates a new trip */\n  createTrip: (dto: ITripCreateDTO) => Promise<Trip>;\n  /** Updates an existing trip */\n  updateTrip: (id: string, dto: ITripUpdateDTO) => Promise<Trip>;\n  /** Deletes a trip by ID */\n  deleteTrip: (id: string) => Promise<void>;\n  /** Gets a single trip by ID */\n  getTripById: (id: string) => Promise<Trip>;\n  /** Clears the current error */\n  clearError: () => void;\n  /** Refetches trips (alias for fetchTrips) */\n  refetch: () => Promise<void>;\n}\n\n/**\n * Combined return type for the useTrips hook\n */\nexport type UseTripsReturn = UseTripsState & UseTripsActions;\n\n/**\n * Hook for managing trips with full CRUD operations\n *\n * @description\n * This hook provides a complete interface for managing trips in the application.\n * It handles loading states, error management, and automatic data fetching.\n * Uses the TripService from the ServiceContext for all operations.\n *\n * @returns {UseTripsReturn} State and actions for trip management\n *\n * @example\n * ```tsx\n * function TripsPage() {\n *   const { trips, isLoading, error, createTrip, deleteTrip } = useTrips();\n *\n *   if (isLoading) return <Loading />;\n *   if (error) return <Error message={error.message} />;\n *\n *   return (\n *     <div>\n *       {trips.map(trip => (\n *         <TripCard key={trip.id} trip={trip} onDelete={deleteTrip} />\n *       ))}\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useTrips(): UseTripsReturn {\n  const [trips, setTrips] = useState<Trip[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  const { tripService } = useServices();\n\n  /**\n   * Clears the current error state\n   */\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  /**\n   * Fetches all trips from the service\n   */\n  const fetchTrips = useCallback(async (): Promise<void> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const data = await tripService.getAllTripsOrderedByStartDate();\n      setTrips(data);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al cargar los viajes');\n      setError(errorObj);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [tripService]);\n\n  /**\n   * Creates a new trip\n   */\n  const createTrip = useCallback(async (dto: ITripCreateDTO): Promise<Trip> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const newTrip = await tripService.createTrip(dto);\n      setTrips((prev) => [...prev, newTrip]);\n      return newTrip;\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al crear el viaje');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [tripService]);\n\n  /**\n   * Updates an existing trip\n   */\n  const updateTrip = useCallback(async (id: string, dto: ITripUpdateDTO): Promise<Trip> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const updatedTrip = await tripService.updateTrip(id, dto);\n      setTrips((prev) =>\n        prev.map((trip) => (trip.id === id ? updatedTrip : trip))\n      );\n      return updatedTrip;\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al actualizar el viaje');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [tripService]);\n\n  /**\n   * Deletes a trip by ID\n   */\n  const deleteTrip = useCallback(async (id: string): Promise<void> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      await tripService.deleteTrip(id);\n      setTrips((prev) => prev.filter((trip) => trip.id !== id));\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al eliminar el viaje');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [tripService]);\n\n  /**\n   * Gets a single trip by ID\n   */\n  const getTripById = useCallback(async (id: string): Promise<Trip> => {\n    try {\n      setError(null);\n      return await tripService.getTripById(id);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al obtener el viaje');\n      setError(errorObj);\n      throw errorObj;\n    }\n  }, [tripService]);\n\n  // Fetch trips on mount\n  useEffect(() => {\n    fetchTrips();\n  }, [fetchTrips]);\n\n  return {\n    // State\n    trips,\n    isLoading,\n    error,\n    // Actions\n    fetchTrips,\n    createTrip,\n    updateTrip,\n    deleteTrip,\n    getTripById,\n    clearError,\n    refetch: fetchTrips,\n  };\n}\n\n// Re-export types for convenience\nexport type { Trip, ITripCreateDTO, ITripUpdateDTO } from '@domain/entities/Trip';\n","/**\n * useParticipants Hook - Manages participants data and CRUD operations for a trip\n * Provides a complete interface for participant management with service integration\n *\n * @module presentation/hooks/useParticipants\n */\nimport { useState, useCallback, useEffect } from 'react';\nimport { useServices } from '../context/ServiceContext';\nimport type { Participant, IParticipantCreateDTO, IParticipantUpdateDTO } from '@domain/entities/Participant';\n\n/**\n * State interface for the useParticipants hook\n */\nexport interface UseParticipantsState {\n  /** List of participants for the current trip */\n  participants: Participant[];\n  /** Loading state indicator */\n  isLoading: boolean;\n  /** Error object if an operation failed */\n  error: Error | null;\n}\n\n/**\n * Actions interface for the useParticipants hook\n */\nexport interface UseParticipantsActions {\n  /** Fetches all participants for the trip */\n  fetchParticipants: () => Promise<void>;\n  /** Creates a new participant */\n  createParticipant: (dto: Omit<IParticipantCreateDTO, 'tripId'>) => Promise<Participant>;\n  /** Updates an existing participant */\n  updateParticipant: (id: string, dto: IParticipantUpdateDTO) => Promise<Participant>;\n  /** Deletes a participant by ID */\n  deleteParticipant: (id: string) => Promise<void>;\n  /** Gets a single participant by ID */\n  getParticipantById: (id: string) => Promise<Participant>;\n  /** Gets the count of participants */\n  getParticipantCount: () => Promise<number>;\n  /** Clears the current error */\n  clearError: () => void;\n  /** Refetches participants (alias for fetchParticipants) */\n  refetch: () => Promise<void>;\n}\n\n/**\n * Combined return type for the useParticipants hook\n */\nexport type UseParticipantsReturn = UseParticipantsState & UseParticipantsActions;\n\n/**\n * Hook for managing participants within a specific trip\n *\n * @description\n * This hook provides a complete interface for managing participants in a trip.\n * It handles loading states, error management, and automatic data fetching.\n * Uses the ParticipantService from the ServiceContext for all operations.\n *\n * @param tripId - The ID of the trip to manage participants for\n * @returns {UseParticipantsReturn} State and actions for participant management\n *\n * @example\n * ```tsx\n * function ParticipantsPage({ tripId }: { tripId: string }) {\n *   const {\n *     participants,\n *     isLoading,\n *     error,\n *     createParticipant,\n *     deleteParticipant\n *   } = useParticipants(tripId);\n *\n *   if (isLoading) return <Loading />;\n *   if (error) return <Error message={error.message} />;\n *\n *   const handleAdd = async (name: string) => {\n *     await createParticipant({ name });\n *   };\n *\n *   return (\n *     <div>\n *       {participants.map(p => (\n *         <ParticipantCard\n *           key={p.id}\n *           participant={p}\n *           onDelete={() => deleteParticipant(p.id)}\n *         />\n *       ))}\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useParticipants(tripId: string): UseParticipantsReturn {\n  const [participants, setParticipants] = useState<Participant[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  const { participantService } = useServices();\n\n  /**\n   * Clears the current error state\n   */\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  /**\n   * Fetches all participants for the trip\n   */\n  const fetchParticipants = useCallback(async (): Promise<void> => {\n    if (!tripId) {\n      setParticipants([]);\n      setIsLoading(false);\n      return;\n    }\n\n    try {\n      setIsLoading(true);\n      setError(null);\n      const data = await participantService.getParticipantsByTripId(tripId);\n      setParticipants(data);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al cargar los participantes');\n      setError(errorObj);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [tripId, participantService]);\n\n  /**\n   * Creates a new participant in the trip\n   */\n  const createParticipant = useCallback(async (\n    dto: Omit<IParticipantCreateDTO, 'tripId'>\n  ): Promise<Participant> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const newParticipant = await participantService.createParticipant({\n        ...dto,\n        tripId,\n      });\n      setParticipants((prev) => [...prev, newParticipant]);\n      return newParticipant;\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al crear el participante');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [tripId, participantService]);\n\n  /**\n   * Updates an existing participant\n   */\n  const updateParticipant = useCallback(async (\n    id: string,\n    dto: IParticipantUpdateDTO\n  ): Promise<Participant> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const updatedParticipant = await participantService.updateParticipant(id, dto);\n      setParticipants((prev) =>\n        prev.map((p) => (p.id === id ? updatedParticipant : p))\n      );\n      return updatedParticipant;\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al actualizar el participante');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [participantService]);\n\n  /**\n   * Deletes a participant by ID\n   */\n  const deleteParticipant = useCallback(async (id: string): Promise<void> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      await participantService.deleteParticipant(id);\n      setParticipants((prev) => prev.filter((p) => p.id !== id));\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al eliminar el participante');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [participantService]);\n\n  /**\n   * Gets a single participant by ID\n   */\n  const getParticipantById = useCallback(async (id: string): Promise<Participant> => {\n    try {\n      setError(null);\n      return await participantService.getParticipantById(id);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al obtener el participante');\n      setError(errorObj);\n      throw errorObj;\n    }\n  }, [participantService]);\n\n  /**\n   * Gets the count of participants in the trip\n   */\n  const getParticipantCount = useCallback(async (): Promise<number> => {\n    try {\n      return await participantService.getParticipantCountByTripId(tripId);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al obtener el conteo de participantes');\n      setError(errorObj);\n      throw errorObj;\n    }\n  }, [tripId, participantService]);\n\n  // Fetch participants on mount and when tripId changes\n  useEffect(() => {\n    fetchParticipants();\n  }, [fetchParticipants]);\n\n  return {\n    // State\n    participants,\n    isLoading,\n    error,\n    // Actions\n    fetchParticipants,\n    createParticipant,\n    updateParticipant,\n    deleteParticipant,\n    getParticipantById,\n    getParticipantCount,\n    clearError,\n    refetch: fetchParticipants,\n  };\n}\n\n// Re-export types for convenience\nexport type { Participant, IParticipantCreateDTO, IParticipantUpdateDTO } from '@domain/entities/Participant';\n","/**\n * useProducts Hook - Manages global products data with filtering and CRUD operations\n * Provides a complete interface for product management with service integration\n *\n * @module presentation/hooks/useProducts\n */\nimport { useState, useCallback, useEffect, useMemo } from 'react';\nimport { useServices } from '../context/ServiceContext';\nimport type { Product, IProductCreateDTO, IProductUpdateDTO } from '@domain/entities/Product';\nimport type { ProductCategory, ProductType } from '@domain/types';\n\n/**\n * Filter options for products\n */\nexport interface ProductFilters {\n  /** Filter by product category */\n  category?: ProductCategory | undefined;\n  /** Filter by product type */\n  type?: ProductType | undefined;\n  /** Filter by search term (name) */\n  searchTerm?: string | undefined;\n}\n\n/**\n * State interface for the useProducts hook\n */\nexport interface UseProductsState {\n  /** List of all products (before filtering) */\n  products: Product[];\n  /** List of filtered products */\n  filteredProducts: Product[];\n  /** Current filter settings */\n  filters: ProductFilters;\n  /** Loading state indicator */\n  isLoading: boolean;\n  /** Error object if an operation failed */\n  error: Error | null;\n}\n\n/**\n * Actions interface for the useProducts hook\n */\nexport interface UseProductsActions {\n  /** Fetches all products from the service */\n  fetchProducts: () => Promise<void>;\n  /** Creates a new product */\n  createProduct: (dto: IProductCreateDTO) => Promise<Product>;\n  /** Updates an existing product */\n  updateProduct: (id: string, dto: IProductUpdateDTO) => Promise<Product>;\n  /** Deletes a product by ID */\n  deleteProduct: (id: string) => Promise<void>;\n  /** Gets a single product by ID */\n  getProductById: (id: string) => Promise<Product>;\n  /** Sets the filter options */\n  setFilters: (filters: ProductFilters) => void;\n  /** Clears all filters */\n  clearFilters: () => void;\n  /** Filters products by category */\n  filterByCategory: (category: ProductCategory | undefined) => void;\n  /** Filters products by type */\n  filterByType: (type: ProductType | undefined) => void;\n  /** Searches products by name */\n  searchByName: (term: string) => void;\n  /** Clears the current error */\n  clearError: () => void;\n  /** Refetches products (alias for fetchProducts) */\n  refetch: () => Promise<void>;\n}\n\n/**\n * Combined return type for the useProducts hook\n */\nexport type UseProductsReturn = UseProductsState & UseProductsActions;\n\n/**\n * Initial empty filter state\n */\nconst INITIAL_FILTERS: ProductFilters = {};\n\n/**\n * Hook for managing global products with filtering capabilities\n *\n * @description\n * This hook provides a complete interface for managing products in the application.\n * It includes filtering by category, type, and search term.\n * Uses the ProductService from the ServiceContext for all operations.\n *\n * @returns {UseProductsReturn} State and actions for product management\n *\n * @example\n * ```tsx\n * function ProductsPage() {\n *   const {\n *     filteredProducts,\n *     isLoading,\n *     error,\n *     filterByCategory,\n *     searchByName,\n *     createProduct,\n *   } = useProducts();\n *\n *   if (isLoading) return <Loading />;\n *   if (error) return <Error message={error.message} />;\n *\n *   return (\n *     <div>\n *       <input\n *         type=\"text\"\n *         placeholder=\"Buscar productos...\"\n *         onChange={(e) => searchByName(e.target.value)}\n *       />\n *       <select onChange={(e) => filterByCategory(e.target.value as ProductCategory)}>\n *         <option value=\"\">Todas las categorias</option>\n *         <option value=\"food\">Comida</option>\n *         <option value=\"beverage\">Bebida</option>\n *       </select>\n *       {filteredProducts.map(product => (\n *         <ProductCard key={product.id} product={product} />\n *       ))}\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useProducts(): UseProductsReturn {\n  const [products, setProducts] = useState<Product[]>([]);\n  const [filters, setFiltersState] = useState<ProductFilters>(INITIAL_FILTERS);\n  const [isLoading, setIsLoading] = useState<boolean>(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  const { productService } = useServices();\n\n  /**\n   * Memoized filtered products based on current filters\n   */\n  const filteredProducts = useMemo(() => {\n    let result = [...products];\n\n    // Filter by category\n    if (filters.category) {\n      result = result.filter((p) => p.category === filters.category);\n    }\n\n    // Filter by type\n    if (filters.type) {\n      result = result.filter((p) => p.type === filters.type);\n    }\n\n    // Filter by search term (name)\n    if (filters.searchTerm && filters.searchTerm.trim() !== '') {\n      const term = filters.searchTerm.toLowerCase().trim();\n      result = result.filter((p) =>\n        p.name.toLowerCase().includes(term) ||\n        (p.notes && p.notes.toLowerCase().includes(term))\n      );\n    }\n\n    return result;\n  }, [products, filters]);\n\n  /**\n   * Clears the current error state\n   */\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  /**\n   * Fetches all products from the service\n   */\n  const fetchProducts = useCallback(async (): Promise<void> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const data = await productService.getAllProducts();\n      setProducts(data);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al cargar los productos');\n      setError(errorObj);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [productService]);\n\n  /**\n   * Creates a new product\n   */\n  const createProduct = useCallback(async (dto: IProductCreateDTO): Promise<Product> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const newProduct = await productService.createProduct(dto);\n      setProducts((prev) => [...prev, newProduct]);\n      return newProduct;\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al crear el producto');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [productService]);\n\n  /**\n   * Updates an existing product\n   */\n  const updateProduct = useCallback(async (\n    id: string,\n    dto: IProductUpdateDTO\n  ): Promise<Product> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      const updatedProduct = await productService.updateProduct(id, dto);\n      setProducts((prev) =>\n        prev.map((p) => (p.id === id ? updatedProduct : p))\n      );\n      return updatedProduct;\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al actualizar el producto');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [productService]);\n\n  /**\n   * Deletes a product by ID\n   */\n  const deleteProduct = useCallback(async (id: string): Promise<void> => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      await productService.deleteProduct(id);\n      setProducts((prev) => prev.filter((p) => p.id !== id));\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al eliminar el producto');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [productService]);\n\n  /**\n   * Gets a single product by ID\n   */\n  const getProductById = useCallback(async (id: string): Promise<Product> => {\n    try {\n      setError(null);\n      return await productService.getProductById(id);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al obtener el producto');\n      setError(errorObj);\n      throw errorObj;\n    }\n  }, [productService]);\n\n  /**\n   * Sets filter options\n   */\n  const setFilters = useCallback((newFilters: ProductFilters) => {\n    setFiltersState(newFilters);\n  }, []);\n\n  /**\n   * Clears all filters\n   */\n  const clearFilters = useCallback(() => {\n    setFiltersState(INITIAL_FILTERS);\n  }, []);\n\n  /**\n   * Filters products by category\n   */\n  const filterByCategory = useCallback((category: ProductCategory | undefined) => {\n    setFiltersState((prev) => ({\n      ...prev,\n      category,\n      // Clear type filter if category changes, as types are category-specific\n      type: category !== prev.category ? undefined : prev.type,\n    }));\n  }, []);\n\n  /**\n   * Filters products by type\n   */\n  const filterByType = useCallback((type: ProductType | undefined) => {\n    setFiltersState((prev) => ({\n      ...prev,\n      type,\n    }));\n  }, []);\n\n  /**\n   * Searches products by name\n   */\n  const searchByName = useCallback((term: string) => {\n    setFiltersState((prev) => ({\n      ...prev,\n      searchTerm: term,\n    }));\n  }, []);\n\n  // Fetch products on mount\n  useEffect(() => {\n    fetchProducts();\n  }, [fetchProducts]);\n\n  return {\n    // State\n    products,\n    filteredProducts,\n    filters,\n    isLoading,\n    error,\n    // Actions\n    fetchProducts,\n    createProduct,\n    updateProduct,\n    deleteProduct,\n    getProductById,\n    setFilters,\n    clearFilters,\n    filterByCategory,\n    filterByType,\n    searchByName,\n    clearError,\n    refetch: fetchProducts,\n  };\n}\n\n// Re-export types for convenience\nexport type { Product, IProductCreateDTO, IProductUpdateDTO } from '@domain/entities/Product';\nexport type { ProductCategory, ProductType } from '@domain/types';\n","/**\n * @fileoverview Servicio de exportacin a CSV.\n *\n * Proporciona funcionalidad para exportar datos del sistema a formato CSV,\n * con soporte para diferentes tipos de datos y configuracin de columnas.\n *\n * @module infrastructure/export/CSVExporter\n * @version 1.0.0\n */\n\nimport type { IExportService } from '@domain/interfaces/services/IExportService';\nimport { InfrastructureError } from '../errors/InfrastructureError';\n\n/**\n * Opciones de configuracin para la exportacin CSV.\n */\nexport interface CSVExportOptions {\n  /** Delimitador de campos (por defecto: ',') */\n  delimiter?: string;\n  /** Carcter para encerrar campos (por defecto: '\"') */\n  quoteChar?: string;\n  /** Incluir cabecera con nombres de columnas (por defecto: true) */\n  includeHeader?: boolean;\n  /** Formato de fecha para serializacin (por defecto: ISO) */\n  dateFormat?: 'iso' | 'locale' | 'short';\n  /** Nombre del archivo para descarga */\n  fileName?: string;\n  /** BOM para compatibilidad con Excel (por defecto: true) */\n  includeBOM?: boolean;\n}\n\n/**\n * Definicin de columna para exportacin CSV.\n */\nexport interface CSVColumn<T> {\n  /** Nombre de la cabecera de la columna */\n  header: string;\n  /** Funcin para extraer el valor del objeto */\n  accessor: (item: T) => string | number | boolean | Date | null | undefined;\n  /** Funcin opcional para formatear el valor */\n  formatter?: (value: unknown) => string;\n}\n\n/**\n * Resultado de una exportacin CSV.\n */\nexport interface CSVExportResult {\n  /** Contenido CSV generado */\n  content: string;\n  /** Nombre del archivo sugerido */\n  fileName: string;\n  /** Tipo MIME */\n  mimeType: string;\n  /** Tamao en bytes */\n  size: number;\n  /** Nmero de filas exportadas (sin cabecera) */\n  rowCount: number;\n}\n\n/**\n * Opciones por defecto para exportacin CSV.\n */\nconst DEFAULT_OPTIONS: Required<CSVExportOptions> = {\n  delimiter: ',',\n  quoteChar: '\"',\n  includeHeader: true,\n  dateFormat: 'iso',\n  fileName: 'export.csv',\n  includeBOM: true,\n};\n\n/**\n * Servicio para exportacin de datos a formato CSV.\n *\n * Implementa la interfaz IExportService del dominio y proporciona\n * funcionalidad completa para generar archivos CSV a partir de\n * arrays de objetos, con configuracin flexible de columnas y formato.\n *\n * @class CSVExporter\n * @implements {IExportService}\n *\n * @example\n * ```typescript\n * const exporter = new CSVExporter();\n *\n * // Exportar viajes\n * const columns: CSVColumn<Trip>[] = [\n *   { header: 'ID', accessor: (t) => t.id },\n *   { header: 'Nombre', accessor: (t) => t.name },\n *   { header: 'Fecha Inicio', accessor: (t) => t.startDate },\n * ];\n *\n * const result = await exporter.exportToCSV(trips, columns, {\n *   fileName: 'viajes.csv'\n * });\n *\n * // Descargar el archivo\n * exporter.download(result);\n * ```\n */\nexport class CSVExporter implements IExportService {\n  /**\n   * Opciones de configuracin del exportador.\n   * @private\n   * @readonly\n   */\n  private readonly options: Required<CSVExportOptions>;\n\n  /**\n   * Crea una nueva instancia del exportador CSV.\n   *\n   * @param options - Opciones de configuracin (opcionales)\n   */\n  constructor(options?: CSVExportOptions) {\n    this.options = { ...DEFAULT_OPTIONS, ...options };\n  }\n\n  /**\n   * Exporta un array de datos a formato CSV.\n   *\n   * @template T - Tipo de los objetos a exportar\n   * @param data - Array de objetos a exportar\n   * @param columns - Definicin de columnas para la exportacin\n   * @param options - Opciones especficas para esta exportacin (opcionales)\n   * @returns Promise con el resultado de la exportacin\n   * @throws {InfrastructureError} Si ocurre un error durante la exportacin\n   */\n  public async exportToCSV<T>(\n    data: T[],\n    columns: CSVColumn<T>[],\n    options?: CSVExportOptions\n  ): Promise<CSVExportResult> {\n    try {\n      const mergedOptions = { ...this.options, ...options };\n      const { delimiter, quoteChar, includeHeader, includeBOM, fileName } = mergedOptions;\n\n      const rows: string[] = [];\n\n      // Agregar cabecera si est habilitada\n      if (includeHeader) {\n        const headerRow = columns.map((col) => this.escapeField(col.header, quoteChar, delimiter));\n        rows.push(headerRow.join(delimiter));\n      }\n\n      // Procesar cada fila de datos\n      for (const item of data) {\n        const rowValues = columns.map((col) => {\n          const rawValue = col.accessor(item);\n          const formattedValue = col.formatter\n            ? col.formatter(rawValue)\n            : this.formatValue(rawValue, mergedOptions.dateFormat);\n          return this.escapeField(formattedValue, quoteChar, delimiter);\n        });\n        rows.push(rowValues.join(delimiter));\n      }\n\n      // Construir contenido CSV\n      let content = rows.join('\\r\\n');\n\n      // Agregar BOM para compatibilidad con Excel\n      if (includeBOM) {\n        content = '\\uFEFF' + content;\n      }\n\n      const encoder = new TextEncoder();\n      const size = encoder.encode(content).length;\n\n      return {\n        content,\n        fileName,\n        mimeType: 'text/csv;charset=utf-8',\n        size,\n        rowCount: data.length,\n      };\n    } catch (error) {\n      throw new InfrastructureError(\n        'Failed to export data to CSV',\n        error instanceof Error ? error : undefined\n      );\n    }\n  }\n\n  /**\n   * Exporta datos directamente a un Blob para descarga.\n   *\n   * @template T - Tipo de los objetos a exportar\n   * @param data - Array de objetos a exportar\n   * @param columns - Definicin de columnas\n   * @param options - Opciones de exportacin\n   * @returns Promise con el Blob generado\n   */\n  public async exportToBlob<T>(\n    data: T[],\n    columns: CSVColumn<T>[],\n    options?: CSVExportOptions\n  ): Promise<Blob> {\n    const result = await this.exportToCSV(data, columns, options);\n    return new Blob([result.content], { type: result.mimeType });\n  }\n\n  /**\n   * Inicia la descarga de un resultado de exportacin.\n   *\n   * Este mtodo crea un enlace temporal y dispara la descarga\n   * automticamente en el navegador.\n   *\n   * @param result - Resultado de exportacin CSV\n   */\n  public download(result: CSVExportResult): void {\n    try {\n      const blob = new Blob([result.content], { type: result.mimeType });\n      const url = URL.createObjectURL(blob);\n\n      const link = document.createElement('a');\n      link.href = url;\n      link.download = result.fileName;\n      link.style.display = 'none';\n\n      document.body.appendChild(link);\n      link.click();\n\n      // Limpiar despus de un breve delay\n      setTimeout(() => {\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n      }, 100);\n    } catch (error) {\n      throw new InfrastructureError(\n        'Failed to download CSV file',\n        error instanceof Error ? error : undefined\n      );\n    }\n  }\n\n  /**\n   * Escapa un campo para CSV segn las reglas estndar.\n   *\n   * - Si contiene el delimitador, comillas o saltos de lnea, se encierra en comillas\n   * - Las comillas dentro del campo se duplican\n   *\n   * @param value - Valor a escapar\n   * @param quoteChar - Carcter de comillas\n   * @param delimiter - Delimitador de campos\n   * @returns Campo escapado para CSV\n   */\n  private escapeField(value: string, quoteChar: string, delimiter: string): string {\n    const needsQuoting =\n      value.includes(delimiter) ||\n      value.includes(quoteChar) ||\n      value.includes('\\n') ||\n      value.includes('\\r');\n\n    if (needsQuoting) {\n      // Duplicar comillas existentes y encerrar en comillas\n      const escaped = value.replace(new RegExp(quoteChar, 'g'), quoteChar + quoteChar);\n      return `${quoteChar}${escaped}${quoteChar}`;\n    }\n\n    return value;\n  }\n\n  /**\n   * Formatea un valor para CSV segn su tipo.\n   *\n   * @param value - Valor a formatear\n   * @param dateFormat - Formato para fechas\n   * @returns String formateado\n   */\n  private formatValue(\n    value: string | number | boolean | Date | null | undefined,\n    dateFormat: 'iso' | 'locale' | 'short'\n  ): string {\n    if (value === null || value === undefined) {\n      return '';\n    }\n\n    if (value instanceof Date) {\n      return this.formatDate(value, dateFormat);\n    }\n\n    if (typeof value === 'boolean') {\n      return value ? 'true' : 'false';\n    }\n\n    if (typeof value === 'number') {\n      return value.toString();\n    }\n\n    return String(value);\n  }\n\n  /**\n   * Formatea una fecha segn el formato especificado.\n   *\n   * @param date - Fecha a formatear\n   * @param format - Formato de salida\n   * @returns String de fecha formateada\n   */\n  private formatDate(date: Date, format: 'iso' | 'locale' | 'short'): string {\n    switch (format) {\n      case 'iso':\n        return date.toISOString();\n      case 'locale':\n        return date.toLocaleString();\n      case 'short':\n        return date.toLocaleDateString();\n      default:\n        return date.toISOString();\n    }\n  }\n\n  /**\n   * Crea columnas predefinidas para exportar viajes.\n   *\n   * @returns Array de definiciones de columna para Trip\n   */\n  public static getTripColumns(): CSVColumn<{\n    id: string;\n    name: string;\n    description?: string;\n    startDate: Date;\n    endDate: Date;\n    createdAt: Date;\n  }>[] {\n    return [\n      { header: 'ID', accessor: (t) => t.id },\n      { header: 'Nombre', accessor: (t) => t.name },\n      { header: 'Descripcion', accessor: (t) => t.description },\n      { header: 'Fecha Inicio', accessor: (t) => t.startDate },\n      { header: 'Fecha Fin', accessor: (t) => t.endDate },\n      { header: 'Creado', accessor: (t) => t.createdAt },\n    ];\n  }\n\n  /**\n   * Crea columnas predefinidas para exportar participantes.\n   *\n   * @returns Array de definiciones de columna para Participant\n   */\n  public static getParticipantColumns(): CSVColumn<{\n    id: string;\n    tripId: string;\n    name: string;\n    email?: string;\n    notes?: string;\n    createdAt: Date;\n  }>[] {\n    return [\n      { header: 'ID', accessor: (p) => p.id },\n      { header: 'ID Viaje', accessor: (p) => p.tripId },\n      { header: 'Nombre', accessor: (p) => p.name },\n      { header: 'Email', accessor: (p) => p.email },\n      { header: 'Notas', accessor: (p) => p.notes },\n      { header: 'Creado', accessor: (p) => p.createdAt },\n    ];\n  }\n\n  /**\n   * Crea columnas predefinidas para exportar productos.\n   *\n   * @returns Array de definiciones de columna para Product\n   */\n  public static getProductColumns(): CSVColumn<{\n    id: string;\n    name: string;\n    category: string;\n    type: string;\n    unit: string;\n    defaultQuantityPerPerson?: number;\n    notes?: string;\n  }>[] {\n    return [\n      { header: 'ID', accessor: (p) => p.id },\n      { header: 'Nombre', accessor: (p) => p.name },\n      { header: 'Categoria', accessor: (p) => p.category },\n      { header: 'Tipo', accessor: (p) => p.type },\n      { header: 'Unidad', accessor: (p) => p.unit },\n      { header: 'Cantidad por Persona', accessor: (p) => p.defaultQuantityPerPerson },\n      { header: 'Notas', accessor: (p) => p.notes },\n    ];\n  }\n\n  /**\n   * Crea columnas predefinidas para exportar consumos.\n   *\n   * @returns Array de definiciones de columna para Consumption\n   */\n  public static getConsumptionColumns(): CSVColumn<{\n    id: string;\n    tripId: string;\n    participantId: string;\n    productId: string;\n    date: Date;\n    meal: string;\n    quantity: number;\n  }>[] {\n    return [\n      { header: 'ID', accessor: (c) => c.id },\n      { header: 'ID Viaje', accessor: (c) => c.tripId },\n      { header: 'ID Participante', accessor: (c) => c.participantId },\n      { header: 'ID Producto', accessor: (c) => c.productId },\n      { header: 'Fecha', accessor: (c) => c.date },\n      { header: 'Comida', accessor: (c) => c.meal },\n      { header: 'Cantidad', accessor: (c) => c.quantity },\n    ];\n  }\n\n  /**\n   * Crea columnas para exportar lista de compras.\n   *\n   * @returns Array de definiciones de columna para ShoppingListItem\n   */\n  public static getShoppingListColumns(): CSVColumn<{\n    productName: string;\n    category: string;\n    totalQuantity: number;\n    unit: string;\n  }>[] {\n    return [\n      { header: 'Producto', accessor: (s) => s.productName },\n      { header: 'Categoria', accessor: (s) => s.category },\n      { header: 'Cantidad Total', accessor: (s) => s.totalQuantity },\n      { header: 'Unidad', accessor: (s) => s.unit },\n    ];\n  }\n}\n","/**\n * useShoppingList Hook - Manages consolidated shopping list for a trip\n * Provides shopping list generation and CSV export functionality\n *\n * @module presentation/hooks/useShoppingList\n */\nimport { useState, useCallback, useEffect } from 'react';\nimport { useServices } from '../context/ServiceContext';\nimport type { ShoppingList, ProductConsumptionSummary, ShoppingListItem } from '@application/services/ShoppingService';\nimport { CSVExporter, type CSVColumn, type CSVExportResult } from '@infrastructure/export/CSVExporter';\n\n/**\n * Export format options for the shopping list\n */\nexport type ExportFormat = 'csv' | 'blob';\n\n/**\n * State interface for the useShoppingList hook\n */\nexport interface UseShoppingListState {\n  /** The generated shopping list */\n  shoppingList: ShoppingList | null;\n  /** Consumption summary by product */\n  consumptionSummary: ProductConsumptionSummary[];\n  /** Loading state indicator */\n  isLoading: boolean;\n  /** Error object if an operation failed */\n  error: Error | null;\n}\n\n/**\n * Actions interface for the useShoppingList hook\n */\nexport interface UseShoppingListActions {\n  /** Generates the shopping list from consumption data */\n  generateShoppingList: () => Promise<ShoppingList>;\n  /** Gets the consumption summary by product */\n  getConsumptionSummary: () => Promise<ProductConsumptionSummary[]>;\n  /** Exports the shopping list to CSV format */\n  exportToCSV: (fileName?: string) => Promise<CSVExportResult>;\n  /** Downloads the shopping list as a CSV file */\n  downloadCSV: (fileName?: string) => Promise<void>;\n  /** Exports the shopping list to a Blob */\n  exportToBlob: () => Promise<Blob>;\n  /** Refreshes the shopping list */\n  refresh: () => Promise<void>;\n  /** Clears the current error */\n  clearError: () => void;\n}\n\n/**\n * Combined return type for the useShoppingList hook\n */\nexport type UseShoppingListReturn = UseShoppingListState & UseShoppingListActions;\n\n/**\n * CSV columns definition for shopping list export\n */\nconst SHOPPING_LIST_COLUMNS: CSVColumn<{\n  productName: string;\n  category: string;\n  totalQuantity: number;\n  unit: string;\n}>[] = [\n  { header: 'Producto', accessor: (item) => item.productName },\n  { header: 'Categoria', accessor: (item) => item.category },\n  { header: 'Cantidad Total', accessor: (item) => item.totalQuantity },\n  { header: 'Unidad', accessor: (item) => item.unit },\n];\n\n/**\n * Hook for managing the consolidated shopping list for a trip\n *\n * @description\n * This hook provides functionality to generate and export shopping lists\n * based on trip consumption data. It includes CSV export capabilities\n * for easy sharing and printing.\n * Uses the ShoppingService from the ServiceContext for all operations.\n *\n * @param tripId - The ID of the trip to generate the shopping list for\n * @returns {UseShoppingListReturn} State and actions for shopping list management\n *\n * @example\n * ```tsx\n * function ShoppingListPage({ tripId }: { tripId: string }) {\n *   const {\n *     shoppingList,\n *     isLoading,\n *     error,\n *     generateShoppingList,\n *     downloadCSV,\n *   } = useShoppingList(tripId);\n *\n *   useEffect(() => {\n *     generateShoppingList();\n *   }, [generateShoppingList]);\n *\n *   if (isLoading) return <Loading />;\n *   if (error) return <Error message={error.message} />;\n *   if (!shoppingList) return <Empty message=\"No hay lista de compras\" />;\n *\n *   return (\n *     <div>\n *       <button onClick={() => downloadCSV('lista-compras.csv')}>\n *         Descargar CSV\n *       </button>\n *       <table>\n *         <thead>\n *           <tr>\n *             <th>Producto</th>\n *             <th>Cantidad</th>\n *             <th>Unidad</th>\n *           </tr>\n *         </thead>\n *         <tbody>\n *           {shoppingList.items.map(item => (\n *             <tr key={item.product.id}>\n *               <td>{item.product.name}</td>\n *               <td>{item.totalQuantity}</td>\n *               <td>{item.unit}</td>\n *             </tr>\n *           ))}\n *         </tbody>\n *       </table>\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useShoppingList(tripId: string): UseShoppingListReturn {\n  const [shoppingList, setShoppingList] = useState<ShoppingList | null>(null);\n  const [consumptionSummary, setConsumptionSummary] = useState<ProductConsumptionSummary[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  const { shoppingService } = useServices();\n\n  /**\n   * Clears the current error state\n   */\n  const clearError = useCallback(() => {\n    setError(null);\n  }, []);\n\n  /**\n   * Generates the shopping list from consumption data\n   */\n  const generateShoppingList = useCallback(async (): Promise<ShoppingList> => {\n    if (!tripId) {\n      throw new Error('No se ha especificado un viaje');\n    }\n\n    try {\n      setIsLoading(true);\n      setError(null);\n      const list = await shoppingService.generateShoppingList(tripId);\n      setShoppingList(list);\n      return list;\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al generar la lista de compras');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [tripId, shoppingService]);\n\n  /**\n   * Gets the consumption summary by product\n   */\n  const getConsumptionSummary = useCallback(async (): Promise<ProductConsumptionSummary[]> => {\n    if (!tripId) {\n      throw new Error('No se ha especificado un viaje');\n    }\n\n    try {\n      setIsLoading(true);\n      setError(null);\n      const summary = await shoppingService.getConsumptionSummaryByProduct(tripId);\n      setConsumptionSummary(summary);\n      return summary;\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al obtener el resumen de consumo');\n      setError(errorObj);\n      throw errorObj;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [tripId, shoppingService]);\n\n  /**\n   * Transforms shopping list items for CSV export\n   */\n  const transformItemsForExport = useCallback(() => {\n    if (!shoppingList) {\n      return [];\n    }\n\n    return shoppingList.items.map((item) => ({\n      productName: item.product.name,\n      category: item.product.category,\n      totalQuantity: item.totalQuantity,\n      unit: item.unit,\n    }));\n  }, [shoppingList]);\n\n  /**\n   * Exports the shopping list to CSV format\n   */\n  const exportToCSV = useCallback(async (fileName?: string): Promise<CSVExportResult> => {\n    if (!shoppingList) {\n      // Try to generate if not available\n      await generateShoppingList();\n    }\n\n    if (!shoppingList && !error) {\n      throw new Error('No hay datos para exportar');\n    }\n\n    const items = transformItemsForExport();\n    const exporter = new CSVExporter();\n    const defaultFileName = `lista-compras-${tripId}-${new Date().toISOString().split('T')[0]}.csv`;\n\n    return exporter.exportToCSV(items, SHOPPING_LIST_COLUMNS, {\n      fileName: fileName || defaultFileName,\n      includeHeader: true,\n      dateFormat: 'locale',\n    });\n  }, [shoppingList, tripId, transformItemsForExport, generateShoppingList, error]);\n\n  /**\n   * Downloads the shopping list as a CSV file\n   */\n  const downloadCSV = useCallback(async (fileName?: string): Promise<void> => {\n    try {\n      setError(null);\n      const result = await exportToCSV(fileName);\n      const exporter = new CSVExporter();\n      exporter.download(result);\n    } catch (err) {\n      const errorObj = err instanceof Error ? err : new Error('Error al descargar el CSV');\n      setError(errorObj);\n      throw errorObj;\n    }\n  }, [exportToCSV]);\n\n  /**\n   * Exports the shopping list to a Blob\n   */\n  const exportToBlob = useCallback(async (): Promise<Blob> => {\n    if (!shoppingList) {\n      await generateShoppingList();\n    }\n\n    const items = transformItemsForExport();\n    const exporter = new CSVExporter();\n    return exporter.exportToBlob(items, SHOPPING_LIST_COLUMNS);\n  }, [shoppingList, transformItemsForExport, generateShoppingList]);\n\n  /**\n   * Refreshes the shopping list and consumption summary\n   */\n  const refresh = useCallback(async (): Promise<void> => {\n    await Promise.all([\n      generateShoppingList(),\n      getConsumptionSummary(),\n    ]);\n  }, [generateShoppingList, getConsumptionSummary]);\n\n  // Auto-generate shopping list on mount when tripId is available\n  useEffect(() => {\n    if (tripId) {\n      generateShoppingList().catch(() => {\n        // Error is handled and stored in state\n      });\n    }\n  }, [tripId, generateShoppingList]);\n\n  return {\n    // State\n    shoppingList,\n    consumptionSummary,\n    isLoading,\n    error,\n    // Actions\n    generateShoppingList,\n    getConsumptionSummary,\n    exportToCSV,\n    downloadCSV,\n    exportToBlob,\n    refresh,\n    clearError,\n  };\n}\n\n// Re-export types for convenience\nexport type { ShoppingList, ProductConsumptionSummary } from '@application/services/ShoppingService';\nexport type { ShoppingListItem };\nexport type { CSVExportResult } from '@infrastructure/export/CSVExporter';\n","/**\n * HomePage - Landing page with trip selector, quick actions, and general statistics\n */\nimport { useMemo, type FC } from 'react';\nimport { Link } from 'react-router-dom';\nimport { MainLayout } from '../../components/layout';\nimport { Button, Card, Loading, EmptyState } from '../../components/common';\nimport { useTrips } from '../../hooks';\nimport styles from './HomePage.module.css';\n\n/**\n * Statistics interface for dashboard display\n */\ninterface DashboardStats {\n  totalTrips: number;\n  totalParticipants: number;\n  upcomingTrips: number;\n  pastTrips: number;\n}\n\nexport const HomePage: FC = () => {\n  const { trips, isLoading, error } = useTrips();\n\n  // Get recent trips (last 3)\n  const recentTrips = trips.slice(0, 3);\n\n  // Calculate general statistics\n  // Note: Trip entity doesn't have participantCount, would need to be fetched separately per trip\n  const stats = useMemo<DashboardStats>(() => {\n    const now = new Date();\n    const upcoming = trips.filter((trip) => new Date(trip.startDate) > now).length;\n    const past = trips.filter((trip) => new Date(trip.endDate) < now).length;\n    // ParticipantCount is not available on Trip entity\n    const totalParticipants = 0;\n\n    return {\n      totalTrips: trips.length,\n      totalParticipants,\n      upcomingTrips: upcoming,\n      pastTrips: past,\n    };\n  }, [trips]);\n\n  const renderContent = () => {\n    if (isLoading) {\n      return <Loading message=\"Cargando viajes...\" />;\n    }\n\n    if (error) {\n      return (\n        <div className={styles.error}>\n          <p>{error.message}</p>\n        </div>\n      );\n    }\n\n    return (\n      <>\n        {/* Hero Section */}\n        <section className={styles.hero}>\n          <div className={styles.heroContent}>\n            <h1 className={styles.heroTitle}>TripFood Manager</h1>\n            <p className={styles.heroSubtitle}>\n              Organiza las compras de comida y bebida para tus viajes en grupo de manera facil y colaborativa\n            </p>\n            <div className={styles.heroActions}>\n              <Link to=\"/trips\">\n                <Button variant=\"primary\" size=\"lg\">\n                  Ver mis viajes\n                </Button>\n              </Link>\n              <Link to=\"/trips/new\">\n                <Button variant=\"secondary\" size=\"lg\">\n                  Crear nuevo viaje\n                </Button>\n              </Link>\n            </div>\n          </div>\n          <div className={styles.heroImage} aria-hidden=\"true\">\n            <svg viewBox=\"0 0 200 200\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n              <circle cx=\"100\" cy=\"100\" r=\"80\" fill=\"var(--color-primary-100)\" />\n              <path\n                d=\"M60 80h80v60a10 10 0 01-10 10H70a10 10 0 01-10-10V80z\"\n                fill=\"var(--color-primary-500)\"\n              />\n              <rect x=\"70\" y=\"60\" width=\"60\" height=\"20\" rx=\"5\" fill=\"var(--color-primary-600)\" />\n              <circle cx=\"85\" cy=\"110\" r=\"8\" fill=\"white\" />\n              <circle cx=\"115\" cy=\"110\" r=\"8\" fill=\"white\" />\n              <rect x=\"90\" y=\"125\" width=\"20\" height=\"5\" rx=\"2\" fill=\"white\" />\n            </svg>\n          </div>\n        </section>\n\n        {/* Statistics Section */}\n        {trips.length > 0 && (\n          <section className={styles.section}>\n            <h2 className={styles.sectionTitle}>Estadisticas generales</h2>\n            <div className={styles.statsGrid}>\n              <Card className={styles.statCard}>\n                <div className={styles.statContent}>\n                  <div className={styles.statIcon} style={{ background: 'var(--color-primary-50)', color: 'var(--color-primary-600)' }}>\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <path d=\"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z\" />\n                      <polyline points=\"9 22 9 12 15 12 15 22\" />\n                    </svg>\n                  </div>\n                  <div className={styles.statInfo}>\n                    <span className={styles.statValue}>{stats.totalTrips}</span>\n                    <span className={styles.statLabel}>Viajes totales</span>\n                  </div>\n                </div>\n              </Card>\n              <Card className={styles.statCard}>\n                <div className={styles.statContent}>\n                  <div className={styles.statIcon} style={{ background: 'rgba(16, 185, 129, 0.1)', color: 'var(--color-success)' }}>\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <path d=\"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2\" />\n                      <circle cx=\"9\" cy=\"7\" r=\"4\" />\n                      <path d=\"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75\" />\n                    </svg>\n                  </div>\n                  <div className={styles.statInfo}>\n                    <span className={styles.statValue}>{stats.totalParticipants}</span>\n                    <span className={styles.statLabel}>Participantes totales</span>\n                  </div>\n                </div>\n              </Card>\n              <Card className={styles.statCard}>\n                <div className={styles.statContent}>\n                  <div className={styles.statIcon} style={{ background: 'rgba(59, 130, 246, 0.1)', color: '#2563eb' }}>\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\" />\n                      <line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\" />\n                      <line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\" />\n                      <line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\" />\n                    </svg>\n                  </div>\n                  <div className={styles.statInfo}>\n                    <span className={styles.statValue}>{stats.upcomingTrips}</span>\n                    <span className={styles.statLabel}>Viajes proximos</span>\n                  </div>\n                </div>\n              </Card>\n              <Card className={styles.statCard}>\n                <div className={styles.statContent}>\n                  <div className={styles.statIcon} style={{ background: 'var(--color-gray-100)', color: 'var(--color-gray-600)' }}>\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                      <polyline points=\"22 12 18 12 15 21 9 3 6 12 2 12\" />\n                    </svg>\n                  </div>\n                  <div className={styles.statInfo}>\n                    <span className={styles.statValue}>{stats.pastTrips}</span>\n                    <span className={styles.statLabel}>Viajes completados</span>\n                  </div>\n                </div>\n              </Card>\n            </div>\n          </section>\n        )}\n\n        {/* Recent Trips Section */}\n        <section className={styles.section}>\n          <div className={styles.sectionHeader}>\n            <h2 className={styles.sectionTitle}>Viajes recientes</h2>\n            <Link to=\"/trips\" className={styles.sectionLink}>\n              Ver todos\n            </Link>\n          </div>\n\n          {recentTrips.length === 0 ? (\n            <EmptyState\n              title=\"No tienes viajes todavia\"\n              description=\"Crea tu primer viaje para empezar a organizar las compras del grupo\"\n              action={\n                <Link to=\"/trips/new\">\n                  <Button variant=\"primary\">Crear viaje</Button>\n                </Link>\n              }\n            />\n          ) : (\n            <div className={styles.tripGrid}>\n              {recentTrips.map((trip) => (\n                <Link key={trip.id} to={`/trips/${trip.id}`} className={styles.tripLink}>\n                  <Card\n                    title={trip.name}\n                    subtitle={trip.description}\n                    interactive\n                    className={styles.tripCard}\n                  >\n                    <div className={styles.tripInfo}>\n                      <div className={styles.tripDate}>\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                          <rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\" />\n                          <line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\" />\n                          <line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\" />\n                          <line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\" />\n                        </svg>\n                        <span>\n                          {new Date(trip.startDate).toLocaleDateString('es-ES', {\n                            day: 'numeric',\n                            month: 'short',\n                          })} - {new Date(trip.endDate).toLocaleDateString('es-ES', {\n                            day: 'numeric',\n                            month: 'short',\n                          })}\n                        </span>\n                      </div>\n                      <div className={styles.tripParticipants}>\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                          <path d=\"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2\" />\n                          <circle cx=\"9\" cy=\"7\" r=\"4\" />\n                          <path d=\"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75\" />\n                        </svg>\n                        <span>{trip.getDurationInDays()} dias</span>\n                      </div>\n                    </div>\n                  </Card>\n                </Link>\n              ))}\n            </div>\n          )}\n        </section>\n\n        {/* Features Section */}\n        <section className={styles.section}>\n          <h2 className={styles.sectionTitle}>Funcionalidades</h2>\n          <div className={styles.featureGrid}>\n            <div className={styles.featureCard}>\n              <div className={styles.featureIcon}>\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <path d=\"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2\" />\n                  <circle cx=\"9\" cy=\"7\" r=\"4\" />\n                  <path d=\"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75\" />\n                </svg>\n              </div>\n              <h3 className={styles.featureTitle}>Gestion de participantes</h3>\n              <p className={styles.featureDescription}>\n                Anade y gestiona los participantes del viaje facilmente\n              </p>\n            </div>\n            <div className={styles.featureCard}>\n              <div className={styles.featureIcon}>\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <path d=\"M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0\" />\n                </svg>\n              </div>\n              <h3 className={styles.featureTitle}>Catalogo de productos</h3>\n              <p className={styles.featureDescription}>\n                Crea una lista completa de productos necesarios para el viaje\n              </p>\n            </div>\n            <div className={styles.featureCard}>\n              <div className={styles.featureIcon}>\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <path d=\"M9 11l3 3L22 4\" />\n                  <path d=\"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11\" />\n                </svg>\n              </div>\n              <h3 className={styles.featureTitle}>Matriz de disponibilidad</h3>\n              <p className={styles.featureDescription}>\n                Cada participante indica que productos puede conseguir\n              </p>\n            </div>\n            <div className={styles.featureCard}>\n              <div className={styles.featureIcon}>\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <circle cx=\"9\" cy=\"21\" r=\"1\" />\n                  <circle cx=\"20\" cy=\"21\" r=\"1\" />\n                  <path d=\"M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6\" />\n                </svg>\n              </div>\n              <h3 className={styles.featureTitle}>Lista de compras</h3>\n              <p className={styles.featureDescription}>\n                Genera automaticamente la lista de compras optimizada\n              </p>\n            </div>\n          </div>\n        </section>\n      </>\n    );\n  };\n\n  return (\n    <MainLayout showNav>\n      <div className={styles.page}>\n        {renderContent()}\n      </div>\n    </MainLayout>\n  );\n};\n","/**\n * TripsPage - List of trips with CRUD operations\n */\nimport { useState, type FC, type FormEvent } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport { MainLayout } from '../../components/layout';\nimport {\n  Button,\n  Card,\n  Input,\n  Modal,\n  Loading,\n  EmptyState,\n  ErrorDisplay,\n  ConfirmDialog,\n} from '../../components/common';\nimport { useTrips, useModal } from '../../hooks';\nimport styles from './TripsPage.module.css';\n\n/**\n * Form data for creating a trip (uses string dates for HTML inputs)\n */\ninterface TripFormData {\n  name: string;\n  description: string;\n  startDate: string;\n  endDate: string;\n}\n\nexport const TripsPage: FC = () => {\n  const navigate = useNavigate();\n  const { trips, isLoading, error, createTrip, deleteTrip, clearError } = useTrips();\n\n  // Modal states\n  const createModal = useModal();\n  const deleteModal = useModal();\n\n  // Form state\n  const [formData, setFormData] = useState<TripFormData>({\n    name: '',\n    description: '',\n    startDate: '',\n    endDate: '',\n  });\n  const [formErrors, setFormErrors] = useState<Record<string, string>>({});\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [tripToDelete, setTripToDelete] = useState<string | null>(null);\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      description: '',\n      startDate: '',\n      endDate: '',\n    });\n    setFormErrors({});\n  };\n\n  const validateForm = (): boolean => {\n    const errors: Record<string, string> = {};\n\n    if (!formData.name.trim()) {\n      errors.name = 'El nombre es obligatorio';\n    }\n    if (!formData.startDate) {\n      errors.startDate = 'La fecha de inicio es obligatoria';\n    }\n    if (!formData.endDate) {\n      errors.endDate = 'La fecha de fin es obligatoria';\n    }\n    if (formData.startDate && formData.endDate && formData.startDate > formData.endDate) {\n      errors.endDate = 'La fecha de fin debe ser posterior a la de inicio';\n    }\n\n    setFormErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  const handleSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n\n    if (!validateForm()) return;\n\n    setIsSubmitting(true);\n    try {\n      // Convert string dates to Date objects for the DTO\n      const newTrip = await createTrip({\n        name: formData.name,\n        description: formData.description || undefined,\n        startDate: new Date(formData.startDate),\n        endDate: new Date(formData.endDate),\n      });\n      createModal.close();\n      resetForm();\n      navigate(`/trips/${newTrip.id}`);\n    } catch (err) {\n      // Error is handled by useTrips hook\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleDeleteClick = (tripId: string) => {\n    setTripToDelete(tripId);\n    deleteModal.open();\n  };\n\n  const handleConfirmDelete = async () => {\n    if (!tripToDelete) return;\n\n    try {\n      await deleteTrip(tripToDelete);\n      deleteModal.close();\n      setTripToDelete(null);\n    } catch (err) {\n      // Error is handled by useTrips hook\n    }\n  };\n\n  const handleOpenCreate = () => {\n    resetForm();\n    createModal.open();\n  };\n\n  const renderContent = () => {\n    if (isLoading && trips.length === 0) {\n      return <Loading message=\"Cargando viajes...\" />;\n    }\n\n    if (error) {\n      return (\n        <ErrorDisplay\n          title=\"Error al cargar viajes\"\n          message={error.message}\n          onRetry={clearError}\n        />\n      );\n    }\n\n    if (trips.length === 0) {\n      return (\n        <EmptyState\n          title=\"No tienes viajes todavia\"\n          description=\"Crea tu primer viaje para empezar a organizar las compras del grupo\"\n          action={\n            <Button variant=\"primary\" onClick={handleOpenCreate}>\n              Crear viaje\n            </Button>\n          }\n        />\n      );\n    }\n\n    return (\n      <div className={styles.tripGrid}>\n        {trips.map((trip) => (\n          <Card\n            key={trip.id}\n            title={trip.name}\n            className={styles.tripCard}\n            headerActions={\n              <button\n                type=\"button\"\n                className={styles.deleteButton}\n                onClick={(e) => {\n                  e.stopPropagation();\n                  handleDeleteClick(trip.id);\n                }}\n                aria-label={`Eliminar ${trip.name}`}\n              >\n                <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <polyline points=\"3 6 5 6 21 6\" />\n                  <path d=\"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\" />\n                </svg>\n              </button>\n            }\n          >\n            <div className={styles.tripContent}>\n              {trip.description && (\n                <p className={styles.tripDescription}>{trip.description}</p>\n              )}\n              <div className={styles.tripMeta}>\n                <div className={styles.tripDate}>\n                  <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\" />\n                    <line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\" />\n                    <line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\" />\n                    <line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\" />\n                  </svg>\n                  <span>\n                    {new Date(trip.startDate).toLocaleDateString('es-ES', {\n                      day: 'numeric',\n                      month: 'short',\n                      year: 'numeric',\n                    })} - {new Date(trip.endDate).toLocaleDateString('es-ES', {\n                      day: 'numeric',\n                      month: 'short',\n                      year: 'numeric',\n                    })}\n                  </span>\n                </div>\n              </div>\n              <Link to={`/trips/${trip.id}`} className={styles.viewLink}>\n                <Button variant=\"primary\" fullWidth>\n                  Ver viaje\n                </Button>\n              </Link>\n            </div>\n          </Card>\n        ))}\n      </div>\n    );\n  };\n\n  return (\n    <MainLayout showNav>\n      <div className={styles.page}>\n        <div className={styles.header}>\n          <h1 className={styles.title}>Mis Viajes</h1>\n          <Button variant=\"primary\" onClick={handleOpenCreate}>\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\" />\n              <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\" />\n            </svg>\n            Nuevo viaje\n          </Button>\n        </div>\n\n        {renderContent()}\n\n        {/* Create Trip Modal */}\n        <Modal\n          isOpen={createModal.isOpen}\n          onClose={createModal.close}\n          title=\"Crear nuevo viaje\"\n          size=\"md\"\n        >\n          <form onSubmit={handleSubmit} className={styles.form}>\n            <Input\n              label=\"Nombre del viaje\"\n              placeholder=\"Ej: Viaje a la playa\"\n              value={formData.name}\n              onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n              error={formErrors.name}\n              required\n              fullWidth\n            />\n            <Input\n              label=\"Descripcion\"\n              placeholder=\"Describe brevemente el viaje\"\n              value={formData.description}\n              onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n              fullWidth\n            />\n            <div className={styles.dateRow}>\n              <Input\n                type=\"date\"\n                label=\"Fecha de inicio\"\n                value={formData.startDate}\n                onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}\n                error={formErrors.startDate}\n                required\n                fullWidth\n              />\n              <Input\n                type=\"date\"\n                label=\"Fecha de fin\"\n                value={formData.endDate}\n                onChange={(e) => setFormData({ ...formData, endDate: e.target.value })}\n                error={formErrors.endDate}\n                required\n                fullWidth\n              />\n            </div>\n            <div className={styles.formActions}>\n              <Button\n                type=\"button\"\n                variant=\"secondary\"\n                onClick={createModal.close}\n                disabled={isSubmitting}\n              >\n                Cancelar\n              </Button>\n              <Button\n                type=\"submit\"\n                variant=\"primary\"\n                isLoading={isSubmitting}\n              >\n                Crear viaje\n              </Button>\n            </div>\n          </form>\n        </Modal>\n\n        {/* Delete Confirmation Dialog */}\n        <ConfirmDialog\n          isOpen={deleteModal.isOpen}\n          onClose={deleteModal.close}\n          onConfirm={handleConfirmDelete}\n          title=\"Eliminar viaje\"\n          message=\"Estas seguro de que quieres eliminar este viaje? Esta accion no se puede deshacer y se eliminaran todos los datos asociados.\"\n          confirmText=\"Eliminar\"\n          variant=\"danger\"\n        />\n      </div>\n    </MainLayout>\n  );\n};\n","/**\n * TripDetailPage - Dashboard for a specific trip\n */\nimport type { FC } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { MainLayout } from '../../components/layout';\nimport { Card, Button, Loading, EmptyState, ErrorDisplay } from '../../components/common';\nimport { useTrips, useParticipants, useProducts } from '../../hooks';\nimport styles from './TripDetailPage.module.css';\n\nexport const TripDetailPage: FC = () => {\n  const { tripId } = useParams<{ tripId: string }>();\n  const { trips, isLoading: tripsLoading, error: tripsError } = useTrips();\n  const { participants, isLoading: participantsLoading } = useParticipants(tripId || '');\n  const { products, isLoading: productsLoading } = useProducts();\n\n  const trip = trips.find((t) => t.id === tripId);\n  const isLoading = tripsLoading || participantsLoading || productsLoading;\n\n  // Calculate statistics (all participants are active in this domain)\n  const totalParticipants = participants.length;\n  const totalProducts = products.length;\n\n  if (isLoading) {\n    return (\n      <MainLayout showSidebar tripName=\"Cargando...\">\n        <Loading message=\"Cargando viaje...\" />\n      </MainLayout>\n    );\n  }\n\n  if (tripsError) {\n    return (\n      <MainLayout showSidebar>\n        <ErrorDisplay\n          title=\"Error al cargar el viaje\"\n          message={tripsError.message}\n        />\n      </MainLayout>\n    );\n  }\n\n  if (!trip) {\n    return (\n      <MainLayout showSidebar>\n        <EmptyState\n          title=\"Viaje no encontrado\"\n          description=\"El viaje que buscas no existe o ha sido eliminado\"\n          action={\n            <Link to=\"/trips\">\n              <Button variant=\"primary\">Volver a viajes</Button>\n            </Link>\n          }\n        />\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout showSidebar tripName={trip.name}>\n      <div className={styles.page}>\n        {/* Header */}\n        <div className={styles.header}>\n          <div className={styles.headerContent}>\n            <h1 className={styles.title}>{trip.name}</h1>\n            {trip.description && (\n              <p className={styles.description}>{trip.description}</p>\n            )}\n            <div className={styles.meta}>\n              <span className={styles.metaItem}>\n                <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <rect x=\"3\" y=\"4\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\" />\n                  <line x1=\"16\" y1=\"2\" x2=\"16\" y2=\"6\" />\n                  <line x1=\"8\" y1=\"2\" x2=\"8\" y2=\"6\" />\n                  <line x1=\"3\" y1=\"10\" x2=\"21\" y2=\"10\" />\n                </svg>\n                {new Date(trip.startDate).toLocaleDateString('es-ES', {\n                  day: 'numeric',\n                  month: 'long',\n                  year: 'numeric',\n                })} - {new Date(trip.endDate).toLocaleDateString('es-ES', {\n                  day: 'numeric',\n                  month: 'long',\n                  year: 'numeric',\n                })}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Stats */}\n        <div className={styles.statsGrid}>\n          <Card className={styles.statCard}>\n            <div className={styles.statContent}>\n              <div className={styles.statIcon} style={{ background: 'var(--color-primary-50)', color: 'var(--color-primary-600)' }}>\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <path d=\"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2\" />\n                  <circle cx=\"9\" cy=\"7\" r=\"4\" />\n                  <path d=\"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75\" />\n                </svg>\n              </div>\n              <div className={styles.statInfo}>\n                <span className={styles.statValue}>{totalParticipants}</span>\n                <span className={styles.statLabel}>Participantes</span>\n              </div>\n            </div>\n          </Card>\n\n          <Card className={styles.statCard}>\n            <div className={styles.statContent}>\n              <div className={styles.statIcon} style={{ background: 'rgba(16, 185, 129, 0.1)', color: 'var(--color-success)' }}>\n                <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <path d=\"M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0\" />\n                </svg>\n              </div>\n              <div className={styles.statInfo}>\n                <span className={styles.statValue}>{totalProducts}</span>\n                <span className={styles.statLabel}>Productos planificados</span>\n              </div>\n            </div>\n          </Card>\n        </div>\n\n        {/* Trip Info Summary */}\n        <Card title=\"Resumen del viaje\" className={styles.progressCard}>\n          <div className={styles.progressContent}>\n            <div className={styles.progressInfo}>\n              <span>Viaje con {totalParticipants} participantes y {totalProducts} productos para planificar</span>\n            </div>\n          </div>\n        </Card>\n\n        {/* Quick Actions */}\n        <div className={styles.actionsGrid}>\n          <Link to={`/trips/${tripId}/participants`} className={styles.actionLink}>\n            <Card interactive className={styles.actionCard}>\n              <div className={styles.actionContent}>\n                <div className={styles.actionIcon}>\n                  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <path d=\"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2\" />\n                    <circle cx=\"9\" cy=\"7\" r=\"4\" />\n                    <path d=\"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75\" />\n                  </svg>\n                </div>\n                <div className={styles.actionText}>\n                  <h3>Participantes</h3>\n                  <p>Gestiona los miembros del viaje</p>\n                </div>\n                <svg className={styles.actionArrow} width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <path d=\"M9 18l6-6-6-6\" />\n                </svg>\n              </div>\n            </Card>\n          </Link>\n\n          <Link to={`/trips/${tripId}/products`} className={styles.actionLink}>\n            <Card interactive className={styles.actionCard}>\n              <div className={styles.actionContent}>\n                <div className={styles.actionIcon}>\n                  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <path d=\"M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0\" />\n                  </svg>\n                </div>\n                <div className={styles.actionText}>\n                  <h3>Productos</h3>\n                  <p>Gestiona el catalogo de productos</p>\n                </div>\n                <svg className={styles.actionArrow} width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <path d=\"M9 18l6-6-6-6\" />\n                </svg>\n              </div>\n            </Card>\n          </Link>\n\n          <Link to={`/trips/${tripId}/availability`} className={styles.actionLink}>\n            <Card interactive className={styles.actionCard}>\n              <div className={styles.actionContent}>\n                <div className={styles.actionIcon}>\n                  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <path d=\"M9 11l3 3L22 4\" />\n                    <path d=\"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11\" />\n                  </svg>\n                </div>\n                <div className={styles.actionText}>\n                  <h3>Disponibilidad</h3>\n                  <p>Matriz de quien trae que</p>\n                </div>\n                <svg className={styles.actionArrow} width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <path d=\"M9 18l6-6-6-6\" />\n                </svg>\n              </div>\n            </Card>\n          </Link>\n\n          <Link to={`/trips/${tripId}/shopping`} className={styles.actionLink}>\n            <Card interactive className={styles.actionCard}>\n              <div className={styles.actionContent}>\n                <div className={styles.actionIcon}>\n                  <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                    <circle cx=\"9\" cy=\"21\" r=\"1\" />\n                    <circle cx=\"20\" cy=\"21\" r=\"1\" />\n                    <path d=\"M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6\" />\n                  </svg>\n                </div>\n                <div className={styles.actionText}>\n                  <h3>Lista de compras</h3>\n                  <p>Ver y gestionar la lista final</p>\n                </div>\n                <svg className={styles.actionArrow} width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                  <path d=\"M9 18l6-6-6-6\" />\n                </svg>\n              </div>\n            </Card>\n          </Link>\n        </div>\n      </div>\n    </MainLayout>\n  );\n};\n","/**\n * ParticipantsPage - Manage trip participants\n */\nimport { useState, type FC, type FormEvent } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { MainLayout } from '../../components/layout';\nimport {\n  Button,\n  Input,\n  Table,\n  Modal,\n  Loading,\n  EmptyState,\n  ErrorDisplay,\n  ConfirmDialog,\n  type TableColumn,\n} from '../../components/common';\nimport { useParticipants, useModal, type Participant, type IParticipantUpdateDTO } from '../../hooks';\nimport styles from './ParticipantsPage.module.css';\n\nexport const ParticipantsPage: FC = () => {\n  const { tripId } = useParams<{ tripId: string }>();\n  const {\n    participants,\n    isLoading,\n    error,\n    createParticipant,\n    updateParticipant,\n    deleteParticipant,\n    clearError,\n  } = useParticipants(tripId || '');\n\n  // Modal states\n  const createModal = useModal();\n  const editModal = useModal();\n  const deleteModal = useModal();\n\n  // Form state - using domain DTO compatible structure\n  interface ParticipantFormData {\n    name: string;\n    email: string;\n    notes: string;\n  }\n  const [formData, setFormData] = useState<ParticipantFormData>({\n    name: '',\n    email: '',\n    notes: '',\n  });\n  const [formErrors, setFormErrors] = useState<Record<string, string>>({});\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [editingParticipant, setEditingParticipant] = useState<Participant | null>(null);\n  const [participantToDelete, setParticipantToDelete] = useState<Participant | null>(null);\n\n  const resetForm = () => {\n    setFormData({ name: '', email: '', notes: '' });\n    setFormErrors({});\n    setEditingParticipant(null);\n  };\n\n  const validateForm = (): boolean => {\n    const errors: Record<string, string> = {};\n\n    if (!formData.name.trim()) {\n      errors.name = 'El nombre es obligatorio';\n    }\n    if (formData.email && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email)) {\n      errors.email = 'El email no es valido';\n    }\n\n    setFormErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  const handleCreate = async (e: FormEvent) => {\n    e.preventDefault();\n    if (!validateForm()) return;\n\n    setIsSubmitting(true);\n    try {\n      await createParticipant({\n        name: formData.name,\n        email: formData.email || undefined,\n        notes: formData.notes || undefined,\n      });\n      createModal.close();\n      resetForm();\n    } catch (_err) {\n      // Error handled by hook\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleEdit = async (e: FormEvent) => {\n    e.preventDefault();\n    if (!validateForm() || !editingParticipant) return;\n\n    setIsSubmitting(true);\n    try {\n      const updateData: IParticipantUpdateDTO = {\n        name: formData.name,\n        email: formData.email || undefined,\n        notes: formData.notes || undefined,\n      };\n      await updateParticipant(editingParticipant.id, updateData);\n      editModal.close();\n      resetForm();\n    } catch (_err) {\n      // Error handled by hook\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleOpenEdit = (participant: Participant) => {\n    setEditingParticipant(participant);\n    setFormData({\n      name: participant.name,\n      email: participant.email || '',\n      notes: participant.notes || '',\n    });\n    editModal.open();\n  };\n\n  const handleOpenDelete = (participant: Participant) => {\n    setParticipantToDelete(participant);\n    deleteModal.open();\n  };\n\n  const handleConfirmDelete = async () => {\n    if (!participantToDelete) return;\n\n    try {\n      await deleteParticipant(participantToDelete.id);\n      deleteModal.close();\n      setParticipantToDelete(null);\n    } catch (_err) {\n      // Error handled by hook\n    }\n  };\n\n  const handleOpenCreate = () => {\n    resetForm();\n    createModal.open();\n  };\n\n  const columns: TableColumn<Participant>[] = [\n    {\n      key: 'name',\n      header: 'Nombre',\n      render: (participant) => (\n        <div className={styles.nameCell}>\n          <div className={styles.avatar}>\n            {participant.name.charAt(0).toUpperCase()}\n          </div>\n          <span>{participant.name}</span>\n        </div>\n      ),\n    },\n    {\n      key: 'email',\n      header: 'Email',\n      render: (participant) => participant.email || '-',\n    },\n    {\n      key: 'notes',\n      header: 'Notas',\n      render: (participant) => participant.notes || '-',\n    },\n    {\n      key: 'actions',\n      header: 'Acciones',\n      align: 'right',\n      render: (participant) => (\n        <div className={styles.actions}>\n          <button\n            type=\"button\"\n            className={styles.actionButton}\n            onClick={() => handleOpenEdit(participant)}\n            aria-label={`Editar ${participant.name}`}\n          >\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <path d=\"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7\" />\n              <path d=\"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z\" />\n            </svg>\n          </button>\n          <button\n            type=\"button\"\n            className={`${styles.actionButton} ${styles.danger}`}\n            onClick={() => handleOpenDelete(participant)}\n            aria-label={`Eliminar ${participant.name}`}\n          >\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <polyline points=\"3 6 5 6 21 6\" />\n              <path d=\"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\" />\n            </svg>\n          </button>\n        </div>\n      ),\n    },\n  ];\n\n  const renderContent = () => {\n    if (isLoading && participants.length === 0) {\n      return <Loading message=\"Cargando participantes...\" />;\n    }\n\n    if (error) {\n      return (\n        <ErrorDisplay\n          title=\"Error al cargar participantes\"\n          message={error.message}\n          onRetry={clearError}\n        />\n      );\n    }\n\n    if (participants.length === 0) {\n      return (\n        <EmptyState\n          title=\"No hay participantes\"\n          description=\"Anade participantes al viaje para empezar a organizar las compras\"\n          icon={\n            <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\n              <path d=\"M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2\" />\n              <circle cx=\"9\" cy=\"7\" r=\"4\" />\n              <path d=\"M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75\" />\n            </svg>\n          }\n          action={\n            <Button variant=\"primary\" onClick={handleOpenCreate}>\n              Anadir participante\n            </Button>\n          }\n        />\n      );\n    }\n\n    return (\n      <Table\n        data={participants}\n        columns={columns}\n        getRowKey={(p) => p.id}\n      />\n    );\n  };\n\n  const renderForm = (onSubmit: (e: FormEvent) => void, isEdit = false) => (\n    <form onSubmit={onSubmit} className={styles.form}>\n      <Input\n        label=\"Nombre\"\n        placeholder=\"Nombre del participante\"\n        value={formData.name}\n        onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n        error={formErrors.name}\n        required\n        fullWidth\n      />\n      <Input\n        type=\"email\"\n        label=\"Email\"\n        placeholder=\"email@ejemplo.com\"\n        value={formData.email}\n        onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n        error={formErrors.email}\n        fullWidth\n      />\n      <Input\n        label=\"Notas\"\n        placeholder=\"Notas adicionales (alergias, preferencias...)\"\n        value={formData.notes}\n        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n        fullWidth\n      />\n      <div className={styles.formActions}>\n        <Button\n          type=\"button\"\n          variant=\"secondary\"\n          onClick={() => {\n            (isEdit ? editModal : createModal).close();\n            resetForm();\n          }}\n          disabled={isSubmitting}\n        >\n          Cancelar\n        </Button>\n        <Button type=\"submit\" variant=\"primary\" isLoading={isSubmitting}>\n          {isEdit ? 'Guardar cambios' : 'Anadir'}\n        </Button>\n      </div>\n    </form>\n  );\n\n  return (\n    <MainLayout showSidebar tripName=\"Viaje\">\n      <div className={styles.page}>\n        <div className={styles.header}>\n          <div>\n            <h1 className={styles.title}>Participantes</h1>\n            <p className={styles.subtitle}>\n              {participants.length} participantes en total\n            </p>\n          </div>\n          <Button variant=\"primary\" onClick={handleOpenCreate}>\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\" />\n              <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\" />\n            </svg>\n            Anadir participante\n          </Button>\n        </div>\n\n        {renderContent()}\n\n        {/* Create Modal */}\n        <Modal\n          isOpen={createModal.isOpen}\n          onClose={() => { createModal.close(); resetForm(); }}\n          title=\"Anadir participante\"\n          size=\"sm\"\n        >\n          {renderForm(handleCreate)}\n        </Modal>\n\n        {/* Edit Modal */}\n        <Modal\n          isOpen={editModal.isOpen}\n          onClose={() => { editModal.close(); resetForm(); }}\n          title=\"Editar participante\"\n          size=\"sm\"\n        >\n          {renderForm(handleEdit, true)}\n        </Modal>\n\n        {/* Delete Confirmation */}\n        <ConfirmDialog\n          isOpen={deleteModal.isOpen}\n          onClose={() => { deleteModal.close(); setParticipantToDelete(null); }}\n          onConfirm={handleConfirmDelete}\n          title=\"Eliminar participante\"\n          message={`Estas seguro de que quieres eliminar a \"${participantToDelete?.name}\"? Esta accion no se puede deshacer.`}\n          confirmText=\"Eliminar\"\n          variant=\"danger\"\n        />\n      </div>\n    </MainLayout>\n  );\n};\n","/**\n * ProductsPage - Manage trip products catalog\n * Simplified version matching domain entity structure\n */\nimport { useState, type FC, type FormEvent } from 'react';\nimport { MainLayout } from '../../components/layout';\nimport {\n  Button,\n  Input,\n  Select,\n  Table,\n  Modal,\n  Loading,\n  EmptyState,\n  ErrorDisplay,\n  ConfirmDialog,\n  type TableColumn,\n  type SelectOption,\n} from '../../components/common';\nimport { useProducts, useModal, type Product, type IProductUpdateDTO } from '../../hooks';\nimport type { ProductCategory, ProductType, ProductUnit } from '@domain/types';\nimport styles from './ProductsPage.module.css';\n\nconst categoryOptions: SelectOption[] = [\n  { value: 'beverage', label: 'Bebida' },\n  { value: 'food', label: 'Comida' },\n];\n\nconst typeOptions: SelectOption[] = [\n  { value: 'water', label: 'Agua' },\n  { value: 'soda', label: 'Refresco' },\n  { value: 'juice', label: 'Zumo' },\n  { value: 'alcohol', label: 'Alcohol' },\n  { value: 'meat', label: 'Carne' },\n  { value: 'dairy', label: 'Lacteos' },\n  { value: 'grains', label: 'Cereales' },\n  { value: 'vegetables', label: 'Verduras' },\n  { value: 'fruits', label: 'Frutas' },\n  { value: 'snacks', label: 'Snacks' },\n  { value: 'other', label: 'Otro' },\n];\n\nconst unitOptions: SelectOption[] = [\n  { value: 'unit', label: 'Unidad' },\n  { value: 'bottle', label: 'Botella' },\n  { value: 'can', label: 'Lata' },\n  { value: 'pack', label: 'Paquete' },\n  { value: 'kg', label: 'Kilogramo' },\n  { value: 'liter', label: 'Litro' },\n];\n\nconst categoryLabels: Record<ProductCategory, string> = {\n  beverage: 'Bebida',\n  food: 'Comida',\n  other: 'Otro',\n};\n\ninterface ProductFormData {\n  name: string;\n  category: ProductCategory;\n  type: ProductType;\n  unit: ProductUnit;\n  defaultQuantityPerPerson: number;\n  notes: string;\n}\n\nexport const ProductsPage: FC = () => {\n  const {\n    products,\n    isLoading,\n    error,\n    createProduct,\n    updateProduct,\n    deleteProduct,\n    clearError,\n  } = useProducts();\n\n  // Modal states\n  const createModal = useModal();\n  const editModal = useModal();\n  const deleteModal = useModal();\n\n  // Form state\n  const [formData, setFormData] = useState<ProductFormData>({\n    name: '',\n    category: 'food',\n    type: 'miscellaneous',\n    unit: 'unit',\n    defaultQuantityPerPerson: 1,\n    notes: '',\n  });\n  const [formErrors, setFormErrors] = useState<Record<string, string>>({});\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\n  const [productToDelete, setProductToDelete] = useState<Product | null>(null);\n\n  // Filter state\n  const [filterCategory, setFilterCategory] = useState<string>('');\n\n  const filteredProducts = filterCategory\n    ? products.filter((p) => p.category === filterCategory)\n    : products;\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      category: 'food',\n      type: 'miscellaneous',\n      unit: 'unit',\n      defaultQuantityPerPerson: 1,\n      notes: '',\n    });\n    setFormErrors({});\n    setEditingProduct(null);\n  };\n\n  const validateForm = (): boolean => {\n    const errors: Record<string, string> = {};\n\n    if (!formData.name.trim()) {\n      errors.name = 'El nombre es obligatorio';\n    }\n\n    setFormErrors(errors);\n    return Object.keys(errors).length === 0;\n  };\n\n  const handleCreate = async (e: FormEvent) => {\n    e.preventDefault();\n    if (!validateForm()) return;\n\n    setIsSubmitting(true);\n    try {\n      await createProduct({\n        name: formData.name,\n        category: formData.category,\n        type: formData.type,\n        unit: formData.unit,\n        defaultQuantityPerPerson: formData.defaultQuantityPerPerson,\n        notes: formData.notes || undefined,\n      });\n      createModal.close();\n      resetForm();\n    } catch (_err) {\n      // Error handled by hook\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleEdit = async (e: FormEvent) => {\n    e.preventDefault();\n    if (!validateForm() || !editingProduct) return;\n\n    setIsSubmitting(true);\n    try {\n      const updateData: IProductUpdateDTO = {\n        name: formData.name,\n        category: formData.category,\n        type: formData.type,\n        unit: formData.unit,\n        defaultQuantityPerPerson: formData.defaultQuantityPerPerson,\n        notes: formData.notes || null,\n      };\n      await updateProduct(editingProduct.id, updateData);\n      editModal.close();\n      resetForm();\n    } catch (_err) {\n      // Error handled by hook\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleOpenEdit = (product: Product) => {\n    setEditingProduct(product);\n    setFormData({\n      name: product.name,\n      category: product.category,\n      type: product.type,\n      unit: product.unit,\n      defaultQuantityPerPerson: product.defaultQuantityPerPerson ?? 1,\n      notes: product.notes || '',\n    });\n    editModal.open();\n  };\n\n  const handleOpenDelete = (product: Product) => {\n    setProductToDelete(product);\n    deleteModal.open();\n  };\n\n  const handleConfirmDelete = async () => {\n    if (!productToDelete) return;\n\n    try {\n      await deleteProduct(productToDelete.id);\n      deleteModal.close();\n      setProductToDelete(null);\n    } catch (_err) {\n      // Error handled by hook\n    }\n  };\n\n  const handleOpenCreate = () => {\n    resetForm();\n    createModal.open();\n  };\n\n  const columns: TableColumn<Product>[] = [\n    {\n      key: 'name',\n      header: 'Producto',\n      render: (product) => (\n        <div className={styles.productCell}>\n          <span className={styles.productName}>{product.name}</span>\n          {product.notes && (\n            <span className={styles.productNotes}>{product.notes}</span>\n          )}\n        </div>\n      ),\n    },\n    {\n      key: 'category',\n      header: 'Categoria',\n      render: (product) => (\n        <span className={`${styles.categoryBadge} ${styles[product.category]}`}>\n          {categoryLabels[product.category]}\n        </span>\n      ),\n    },\n    {\n      key: 'unit',\n      header: 'Unidad',\n      align: 'center',\n      render: (product) => <span>{product.unit}</span>,\n    },\n    {\n      key: 'defaultQuantity',\n      header: 'Cantidad/Persona',\n      align: 'center',\n      render: (product) => <span>{product.defaultQuantityPerPerson ?? '-'}</span>,\n    },\n    {\n      key: 'actions',\n      header: 'Acciones',\n      align: 'right',\n      render: (product) => (\n        <div className={styles.actions}>\n          <button\n            type=\"button\"\n            className={styles.actionButton}\n            onClick={() => handleOpenEdit(product)}\n            aria-label={`Editar ${product.name}`}\n          >\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <path d=\"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7\" />\n              <path d=\"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z\" />\n            </svg>\n          </button>\n          <button\n            type=\"button\"\n            className={`${styles.actionButton} ${styles.danger}`}\n            onClick={() => handleOpenDelete(product)}\n            aria-label={`Eliminar ${product.name}`}\n          >\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <polyline points=\"3 6 5 6 21 6\" />\n              <path d=\"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2\" />\n            </svg>\n          </button>\n        </div>\n      ),\n    },\n  ];\n\n  const renderContent = () => {\n    if (isLoading && products.length === 0) {\n      return <Loading message=\"Cargando productos...\" />;\n    }\n\n    if (error) {\n      return (\n        <ErrorDisplay\n          title=\"Error al cargar productos\"\n          message={error.message}\n          onRetry={clearError}\n        />\n      );\n    }\n\n    if (products.length === 0) {\n      return (\n        <EmptyState\n          title=\"No hay productos\"\n          description=\"Anade productos al catalogo para empezar a organizar las compras\"\n          icon={\n            <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\n              <path d=\"M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4zM3 6h18M16 10a4 4 0 01-8 0\" />\n            </svg>\n          }\n          action={\n            <Button variant=\"primary\" onClick={handleOpenCreate}>\n              Anadir producto\n            </Button>\n          }\n        />\n      );\n    }\n\n    return (\n      <Table\n        data={filteredProducts}\n        columns={columns}\n        getRowKey={(p) => p.id}\n        emptyMessage=\"No hay productos en esta categoria\"\n      />\n    );\n  };\n\n  const renderForm = (onSubmit: (e: FormEvent) => void, isEdit = false) => (\n    <form onSubmit={onSubmit} className={styles.form}>\n      <Input\n        label=\"Nombre del producto\"\n        placeholder=\"Ej: Agua mineral\"\n        value={formData.name}\n        onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n        error={formErrors.name}\n        required\n        fullWidth\n      />\n      <Select\n        label=\"Categoria\"\n        options={categoryOptions}\n        value={formData.category}\n        onChange={(e) => setFormData({ ...formData, category: e.target.value as ProductCategory })}\n        required\n        fullWidth\n      />\n      <Select\n        label=\"Tipo\"\n        options={typeOptions}\n        value={formData.type}\n        onChange={(e) => setFormData({ ...formData, type: e.target.value as ProductType })}\n        required\n        fullWidth\n      />\n      <div className={styles.row}>\n        <Input\n          type=\"number\"\n          label=\"Cantidad por persona\"\n          value={formData.defaultQuantityPerPerson.toString()}\n          onChange={(e) => setFormData({ ...formData, defaultQuantityPerPerson: parseInt(e.target.value) || 1 })}\n          required\n          fullWidth\n        />\n        <Select\n          label=\"Unidad\"\n          options={unitOptions}\n          value={formData.unit}\n          onChange={(e) => setFormData({ ...formData, unit: e.target.value as ProductUnit })}\n          required\n          fullWidth\n        />\n      </div>\n      <Input\n        label=\"Notas\"\n        placeholder=\"Notas adicionales...\"\n        value={formData.notes}\n        onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\n        fullWidth\n      />\n      <div className={styles.formActions}>\n        <Button\n          type=\"button\"\n          variant=\"secondary\"\n          onClick={() => {\n            (isEdit ? editModal : createModal).close();\n            resetForm();\n          }}\n          disabled={isSubmitting}\n        >\n          Cancelar\n        </Button>\n        <Button type=\"submit\" variant=\"primary\" isLoading={isSubmitting}>\n          {isEdit ? 'Guardar cambios' : 'Anadir'}\n        </Button>\n      </div>\n    </form>\n  );\n\n  const totalProducts = products.length;\n\n  return (\n    <MainLayout showSidebar tripName=\"Viaje\">\n      <div className={styles.page}>\n        <div className={styles.header}>\n          <div>\n            <h1 className={styles.title}>Productos</h1>\n            <p className={styles.subtitle}>\n              {totalProducts} productos en el catalogo\n            </p>\n          </div>\n          <Button variant=\"primary\" onClick={handleOpenCreate}>\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n              <line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\" />\n              <line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\" />\n            </svg>\n            Anadir producto\n          </Button>\n        </div>\n\n        {/* Filters */}\n        {products.length > 0 && (\n          <div className={styles.filters}>\n            <Select\n              options={[\n                { value: '', label: 'Todas las categorias' },\n                ...categoryOptions,\n              ]}\n              value={filterCategory}\n              onChange={(e) => setFilterCategory(e.target.value)}\n              size=\"sm\"\n            />\n          </div>\n        )}\n\n        {renderContent()}\n\n        {/* Create Modal */}\n        <Modal\n          isOpen={createModal.isOpen}\n          onClose={() => { createModal.close(); resetForm(); }}\n          title=\"Anadir producto\"\n          size=\"md\"\n        >\n          {renderForm(handleCreate)}\n        </Modal>\n\n        {/* Edit Modal */}\n        <Modal\n          isOpen={editModal.isOpen}\n          onClose={() => { editModal.close(); resetForm(); }}\n          title=\"Editar producto\"\n          size=\"md\"\n        >\n          {renderForm(handleEdit, true)}\n        </Modal>\n\n        {/* Delete Confirmation */}\n        <ConfirmDialog\n          isOpen={deleteModal.isOpen}\n          onClose={() => { deleteModal.close(); setProductToDelete(null); }}\n          onConfirm={handleConfirmDelete}\n          title=\"Eliminar producto\"\n          message={`Estas seguro de que quieres eliminar \"${productToDelete?.name}\"? Esta accion no se puede deshacer.`}\n          confirmText=\"Eliminar\"\n          variant=\"danger\"\n        />\n      </div>\n    </MainLayout>\n  );\n};\n","/**\n * AvailabilityPage - Matrix showing which participants can bring which products\n */\nimport { useState, useEffect, type FC } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { MainLayout } from '../../components/layout';\nimport { Card, Loading, EmptyState, ErrorDisplay } from '../../components/common';\nimport { useParticipants, useProducts } from '../../hooks';\nimport styles from './AvailabilityPage.module.css';\n\ninterface AvailabilityMatrix {\n  [participantId: string]: {\n    [productId: string]: boolean;\n  };\n}\n\nexport const AvailabilityPage: FC = () => {\n  const { tripId } = useParams<{ tripId: string }>();\n  const { participants, isLoading: participantsLoading, error: participantsError } = useParticipants(tripId || '');\n  const { products, isLoading: productsLoading, error: productsError } = useProducts();\n\n  const [availability, setAvailability] = useState<AvailabilityMatrix>({});\n\n  const isLoading = participantsLoading || productsLoading;\n  const error = participantsError || productsError;\n\n  // Initialize availability matrix\n  useEffect(() => {\n    const initialMatrix: AvailabilityMatrix = {};\n    participants.forEach((p) => {\n      const participantProducts: { [productId: string]: boolean } = {};\n      products.forEach((prod) => {\n        participantProducts[prod.id] = false;\n      });\n      initialMatrix[p.id] = participantProducts;\n    });\n    setAvailability(initialMatrix);\n  }, [participants, products]);\n\n  const toggleAvailability = (participantId: string, productId: string) => {\n    setAvailability((prev) => ({\n      ...prev,\n      [participantId]: {\n        ...prev[participantId],\n        [productId]: !prev[participantId]?.[productId],\n      },\n    }));\n  };\n\n  // Calculate statistics\n  const getProductAvailabilityCount = (productId: string): number => {\n    return Object.values(availability).filter((p) => p[productId]).length;\n  };\n\n  const getParticipantAvailabilityCount = (participantId: string): number => {\n    return Object.values(availability[participantId] || {}).filter(Boolean).length;\n  };\n\n  // All participants are considered active (no isActive property in domain)\n  const activeParticipants = participants;\n\n  if (isLoading) {\n    return (\n      <MainLayout showSidebar tripName=\"Viaje\">\n        <Loading message=\"Cargando matriz de disponibilidad...\" />\n      </MainLayout>\n    );\n  }\n\n  if (error) {\n    return (\n      <MainLayout showSidebar tripName=\"Viaje\">\n        <ErrorDisplay\n          title=\"Error al cargar datos\"\n          message={error.message}\n        />\n      </MainLayout>\n    );\n  }\n\n  if (activeParticipants.length === 0 || products.length === 0) {\n    return (\n      <MainLayout showSidebar tripName=\"Viaje\">\n        <div className={styles.page}>\n          <div className={styles.header}>\n            <h1 className={styles.title}>Disponibilidad</h1>\n            <p className={styles.subtitle}>\n              Indica que productos puede traer cada participante\n            </p>\n          </div>\n          <EmptyState\n            title={activeParticipants.length === 0 ? 'No hay participantes' : 'No hay productos'}\n            description={\n              activeParticipants.length === 0\n                ? 'Anade participantes al viaje para crear la matriz de disponibilidad'\n                : 'Anade productos al catalogo para crear la matriz de disponibilidad'\n            }\n            icon={\n              <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\n                <path d=\"M9 11l3 3L22 4\" />\n                <path d=\"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11\" />\n              </svg>\n            }\n          />\n        </div>\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout showSidebar tripName=\"Viaje\">\n      <div className={styles.page}>\n        <div className={styles.header}>\n          <div>\n            <h1 className={styles.title}>Disponibilidad</h1>\n            <p className={styles.subtitle}>\n              Marca las casillas para indicar que productos puede traer cada participante\n            </p>\n          </div>\n        </div>\n\n        {/* Legend */}\n        <Card className={styles.legend}>\n          <div className={styles.legendContent}>\n            <div className={styles.legendItem}>\n              <div className={`${styles.legendBox} ${styles.available}`}>\n                <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\">\n                  <polyline points=\"20 6 9 17 4 12\" />\n                </svg>\n              </div>\n              <span>Puede traer</span>\n            </div>\n            <div className={styles.legendItem}>\n              <div className={`${styles.legendBox} ${styles.unavailable}`} />\n              <span>No disponible</span>\n            </div>\n          </div>\n        </Card>\n\n        {/* Matrix */}\n        <div className={styles.matrixWrapper}>\n          <table className={styles.matrix}>\n            <thead>\n              <tr>\n                <th className={styles.cornerCell}>Producto / Participante</th>\n                {activeParticipants.map((participant) => (\n                  <th key={participant.id} className={styles.participantHeader}>\n                    <div className={styles.participantInfo}>\n                      <div className={styles.avatar}>\n                        {participant.name.charAt(0).toUpperCase()}\n                      </div>\n                      <span className={styles.participantName}>{participant.name}</span>\n                      <span className={styles.participantCount}>\n                        {getParticipantAvailabilityCount(participant.id)}\n                      </span>\n                    </div>\n                  </th>\n                ))}\n                <th className={styles.totalHeader}>Total</th>\n              </tr>\n            </thead>\n            <tbody>\n              {products.map((product) => {\n                const availabilityCount = getProductAvailabilityCount(product.id);\n                const hasNoAvailability = availabilityCount === 0;\n\n                return (\n                  <tr\n                    key={product.id}\n                    className={hasNoAvailability ? styles.warningRow : ''}\n                  >\n                    <td className={styles.productCell}>\n                      <span className={styles.productName}>{product.name}</span>\n                      <span className={styles.productUnit}>\n                        {product.unit}\n                      </span>\n                    </td>\n                    {activeParticipants.map((participant) => {\n                      const isAvailable = availability[participant.id]?.[product.id] || false;\n\n                      return (\n                        <td key={participant.id} className={styles.checkCell}>\n                          <button\n                            type=\"button\"\n                            className={`${styles.checkButton} ${isAvailable ? styles.checked : ''}`}\n                            onClick={() => toggleAvailability(participant.id, product.id)}\n                            aria-label={`${participant.name} ${isAvailable ? 'puede' : 'no puede'} traer ${product.name}`}\n                            aria-pressed={isAvailable}\n                          >\n                            {isAvailable && (\n                              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\">\n                                <polyline points=\"20 6 9 17 4 12\" />\n                              </svg>\n                            )}\n                          </button>\n                        </td>\n                      );\n                    })}\n                    <td className={`${styles.totalCell} ${hasNoAvailability ? styles.warning : ''}`}>\n                      {availabilityCount}\n                    </td>\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n\n        {/* Summary */}\n        <Card title=\"Resumen\" className={styles.summary}>\n          <div className={styles.summaryGrid}>\n            <div className={styles.summaryItem}>\n              <span className={styles.summaryValue}>{products.length}</span>\n              <span className={styles.summaryLabel}>Productos totales</span>\n            </div>\n            <div className={styles.summaryItem}>\n              <span className={styles.summaryValue}>{activeParticipants.length}</span>\n              <span className={styles.summaryLabel}>Participantes</span>\n            </div>\n            <div className={styles.summaryItem}>\n              <span className={`${styles.summaryValue} ${products.filter((p) => getProductAvailabilityCount(p.id) === 0).length > 0 ? styles.warning : ''}`}>\n                {products.filter((p) => getProductAvailabilityCount(p.id) === 0).length}\n              </span>\n              <span className={styles.summaryLabel}>Sin asignar</span>\n            </div>\n            <div className={styles.summaryItem}>\n              <span className={styles.summaryValue}>\n                {products.filter((p) => getProductAvailabilityCount(p.id) > 0).length}\n              </span>\n              <span className={styles.summaryLabel}>Asignados</span>\n            </div>\n          </div>\n        </Card>\n      </div>\n    </MainLayout>\n  );\n};\n","/**\n * ShoppingListPage - Planning shopping list with CSV export\n * Shows products to be purchased for the trip based on consumption planning\n */\nimport { type FC } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { MainLayout } from '../../components/layout';\nimport { Card, Button, Loading, EmptyState, ErrorDisplay } from '../../components/common';\nimport { useShoppingList, useParticipants } from '../../hooks';\nimport styles from './ShoppingListPage.module.css';\n\nexport const ShoppingListPage: FC = () => {\n  const { tripId } = useParams<{ tripId: string }>();\n  const {\n    shoppingList,\n    isLoading: shoppingLoading,\n    error: shoppingError,\n    downloadCSV\n  } = useShoppingList(tripId || '');\n  const { participants, isLoading: participantsLoading } = useParticipants(tripId || '');\n\n  const isLoading = shoppingLoading || participantsLoading;\n  const error = shoppingError;\n\n  // Group items by category\n  const itemsByCategory = shoppingList?.items.reduce<Record<string, typeof shoppingList.items>>((acc, item) => {\n    const category = item.product.category;\n    if (!acc[category]) {\n      acc[category] = [];\n    }\n    acc[category].push(item);\n    return acc;\n  }, {}) || {};\n\n  const categoryLabels: Record<string, string> = {\n    food: 'Comida',\n    beverage: 'Bebidas',\n    other: 'Otros',\n  };\n\n  const categoryOrder = ['food', 'beverage', 'other'];\n\n  /**\n   * Handle CSV export\n   */\n  const handleExportCSV = async () => {\n    try {\n      const date = new Date().toISOString().split('T')[0];\n      await downloadCSV(`lista-compras-${date}.csv`);\n    } catch (err) {\n      // Error is handled by the hook\n    }\n  };\n\n  // Calculate totals\n  const totalItems = shoppingList?.items.length || 0;\n  const participantCount = participants.length;\n\n  if (isLoading) {\n    return (\n      <MainLayout showSidebar tripName=\"Viaje\">\n        <Loading message=\"Cargando lista de compras...\" />\n      </MainLayout>\n    );\n  }\n\n  if (error) {\n    return (\n      <MainLayout showSidebar tripName=\"Viaje\">\n        <ErrorDisplay\n          title=\"Error al cargar datos\"\n          message={error.message}\n        />\n      </MainLayout>\n    );\n  }\n\n  if (!shoppingList || shoppingList.items.length === 0) {\n    return (\n      <MainLayout showSidebar tripName=\"Viaje\">\n        <div className={styles.page}>\n          <div className={styles.header}>\n            <h1 className={styles.title}>Lista de Compras Planificada</h1>\n          </div>\n          <EmptyState\n            title=\"No hay productos planificados\"\n            description=\"Registra consumos planificados para generar la lista de compras\"\n            icon={\n              <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1.5\">\n                <circle cx=\"9\" cy=\"21\" r=\"1\" />\n                <circle cx=\"20\" cy=\"21\" r=\"1\" />\n                <path d=\"M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6\" />\n              </svg>\n            }\n          />\n        </div>\n      </MainLayout>\n    );\n  }\n\n  return (\n    <MainLayout showSidebar tripName=\"Viaje\">\n      <div className={styles.page}>\n        <div className={styles.header}>\n          <div>\n            <h1 className={styles.title}>Lista de Compras Planificada</h1>\n            <p className={styles.subtitle}>\n              {totalItems} productos planificados para {participantCount} participantes\n            </p>\n          </div>\n          <div className={styles.headerActions}>\n            <Button\n              variant=\"secondary\"\n              onClick={handleExportCSV}\n              aria-label=\"Exportar lista de compras como CSV\"\n            >\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                <path d=\"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3\" />\n              </svg>\n              Exportar CSV\n            </Button>\n          </div>\n        </div>\n\n        {/* Summary Card */}\n        <Card className={styles.progressCard}>\n          <div className={styles.progressContent}>\n            <div className={styles.progressHeader}>\n              <span className={styles.progressTitle}>Resumen de planificacion</span>\n            </div>\n            <div className={styles.progressStats}>\n              <div className={styles.progressStat}>\n                <span className={styles.statValue}>{totalItems}</span>\n                <span className={styles.statLabel}>Productos</span>\n              </div>\n              <div className={styles.progressStat}>\n                <span className={styles.statValue}>{participantCount}</span>\n                <span className={styles.statLabel}>Participantes</span>\n              </div>\n              <div className={styles.progressStat}>\n                <span className={styles.statValue}>{Object.keys(itemsByCategory).length}</span>\n                <span className={styles.statLabel}>Categorias</span>\n              </div>\n            </div>\n          </div>\n        </Card>\n\n        {/* Shopping Lists by Category */}\n        <div className={styles.listsContainer}>\n          {categoryOrder.map((category) => {\n            const categoryItems = itemsByCategory[category];\n            if (!categoryItems || categoryItems.length === 0) return null;\n\n            return (\n              <Card\n                key={category}\n                title={categoryLabels[category] || category}\n                subtitle={`${categoryItems.length} productos`}\n                className={styles.categoryCard}\n              >\n                <ul className={styles.productList}>\n                  {categoryItems.map((item) => (\n                    <li\n                      key={item.product.id}\n                      className={styles.productItem}\n                    >\n                      <div className={styles.productInfo}>\n                        <span className={styles.productName}>{item.product.name}</span>\n                        <span className={styles.productQuantity}>\n                          {item.totalQuantity} {item.unit}\n                        </span>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              </Card>\n            );\n          })}\n        </div>\n\n        {/* Participants Summary */}\n        {participants.length > 0 && (\n          <Card title=\"Participantes del viaje\" className={styles.costCard}>\n            <div className={styles.costContent}>\n              <div className={styles.participantsList}>\n                {participants.map((participant) => (\n                  <div key={participant.id} className={styles.participantCost}>\n                    <div className={styles.participantInfo}>\n                      <div className={styles.avatar}>\n                        {participant.name.charAt(0).toUpperCase()}\n                      </div>\n                      <span>{participant.name}</span>\n                    </div>\n                    {participant.email && (\n                      <span className={styles.participantAmount}>\n                        {participant.email}\n                      </span>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n          </Card>\n        )}\n      </div>\n    </MainLayout>\n  );\n};\n","/**\n * TripContext - Context for the currently selected trip\n */\nimport { createContext, useContext, useState, useCallback, useMemo, useEffect, type FC, type ReactNode } from 'react';\nimport type { Trip } from '../hooks/useTrips';\nimport type { Participant } from '../hooks/useParticipants';\nimport type { Product } from '../hooks/useProducts';\n\n// Availability entry interface\nexport interface AvailabilityEntry {\n  participantId: string;\n  productId: string;\n  available: boolean;\n}\n\n// Trip statistics\nexport interface TripStats {\n  totalParticipants: number;\n  activeParticipants: number;\n  totalProducts: number;\n  purchasedProducts: number;\n  pendingProducts: number;\n  estimatedTotal: number;\n  completionPercentage: number;\n}\n\n// Context state\nexport interface TripContextState {\n  /** Current trip data */\n  trip: Trip | null;\n  /** Trip participants */\n  participants: Participant[];\n  /** Trip products */\n  products: Product[];\n  /** Availability matrix */\n  availability: AvailabilityEntry[];\n  /** Computed statistics */\n  stats: TripStats;\n  /** Loading state */\n  isLoading: boolean;\n  /** Error message */\n  error: string | null;\n}\n\n// Context actions\nexport interface TripContextActions {\n  /** Set the current trip */\n  setTrip: (trip: Trip | null) => void;\n  /** Set participants */\n  setParticipants: (participants: Participant[]) => void;\n  /** Set products */\n  setProducts: (products: Product[]) => void;\n  /** Update availability */\n  setAvailability: (availability: AvailabilityEntry[]) => void;\n  /** Toggle product availability for a participant */\n  toggleAvailability: (participantId: string, productId: string) => void;\n  /** Set loading state */\n  setLoading: (loading: boolean) => void;\n  /** Set error */\n  setError: (error: string | null) => void;\n  /** Clear trip data */\n  clearTrip: () => void;\n}\n\nexport type TripContextValue = TripContextState & TripContextActions;\n\n// Calculate default stats\n// Note: Domain entities don't have isActive/isPurchased/quantity/estimatedPrice\n// These would need to be tracked separately in the UI state if needed\nfunction calculateStats(\n  participants: Participant[],\n  products: Product[]\n): TripStats {\n  // All participants are considered active (domain entity doesn't have isActive)\n  const activeParticipants = participants.length;\n  // Products don't have isPurchased in domain entity - would need UI state for tracking\n  const purchasedProducts = 0;\n  const pendingProducts = products.length - purchasedProducts;\n  // Estimated total calculation not possible without UI-specific price/quantity\n  const estimatedTotal = 0;\n  const completionPercentage =\n    products.length > 0 ? Math.round((purchasedProducts / products.length) * 100) : 0;\n\n  return {\n    totalParticipants: participants.length,\n    activeParticipants,\n    totalProducts: products.length,\n    purchasedProducts,\n    pendingProducts,\n    estimatedTotal,\n    completionPercentage,\n  };\n}\n\n// Initial state (used for type reference)\nconst _initialState: TripContextState = {\n  trip: null,\n  participants: [],\n  products: [],\n  availability: [],\n  stats: {\n    totalParticipants: 0,\n    activeParticipants: 0,\n    totalProducts: 0,\n    purchasedProducts: 0,\n    pendingProducts: 0,\n    estimatedTotal: 0,\n    completionPercentage: 0,\n  },\n  isLoading: false,\n  error: null,\n};\nvoid _initialState; // Mark as intentionally unused\n\n// Context\nconst TripContext = createContext<TripContextValue | null>(null);\n\n// Provider props\ninterface TripProviderProps {\n  children: ReactNode;\n  tripId?: string;\n}\n\n/**\n * TripProvider - Provides current trip context\n */\nexport const TripProvider: FC<TripProviderProps> = ({ children, tripId }) => {\n  const [trip, setTripState] = useState<Trip | null>(null);\n  const [participants, setParticipantsState] = useState<Participant[]>([]);\n  const [products, setProductsState] = useState<Product[]>([]);\n  const [availability, setAvailabilityState] = useState<AvailabilityEntry[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setErrorState] = useState<string | null>(null);\n\n  // Computed stats\n  const stats = useMemo(\n    () => calculateStats(participants, products),\n    [participants, products]\n  );\n\n  // Actions\n  const setTrip = useCallback((newTrip: Trip | null) => {\n    setTripState(newTrip);\n  }, []);\n\n  const setParticipants = useCallback((newParticipants: Participant[]) => {\n    setParticipantsState(newParticipants);\n  }, []);\n\n  const setProducts = useCallback((newProducts: Product[]) => {\n    setProductsState(newProducts);\n  }, []);\n\n  const setAvailability = useCallback((newAvailability: AvailabilityEntry[]) => {\n    setAvailabilityState(newAvailability);\n  }, []);\n\n  const toggleAvailability = useCallback((participantId: string, productId: string) => {\n    setAvailabilityState((prev) => {\n      const existingIndex = prev.findIndex(\n        (a) => a.participantId === participantId && a.productId === productId\n      );\n\n      if (existingIndex >= 0) {\n        // Toggle existing entry\n        const updated = [...prev];\n        const existing = updated[existingIndex];\n        if (existing) {\n          updated[existingIndex] = {\n            ...existing,\n            available: !existing.available,\n          };\n        }\n        return updated;\n      } else {\n        // Add new entry with all required properties\n        const newEntry: AvailabilityEntry = { participantId, productId, available: true };\n        return [...prev, newEntry];\n      }\n    });\n  }, []);\n\n  const setLoading = useCallback((loading: boolean) => {\n    setIsLoading(loading);\n  }, []);\n\n  const setError = useCallback((err: string | null) => {\n    setErrorState(err);\n  }, []);\n\n  const clearTrip = useCallback(() => {\n    setTripState(null);\n    setParticipantsState([]);\n    setProductsState([]);\n    setAvailabilityState([]);\n    setErrorState(null);\n  }, []);\n\n  // Load trip data when tripId changes\n  useEffect(() => {\n    if (tripId) {\n      // TODO: Load trip data from services\n      // This will be implemented when services are available\n      setIsLoading(true);\n\n      // Simulate loading\n      const timer = setTimeout(() => {\n        setIsLoading(false);\n      }, 500);\n\n      return () => clearTimeout(timer);\n    } else {\n      clearTrip();\n      return undefined;\n    }\n  }, [tripId, clearTrip]);\n\n  const value = useMemo<TripContextValue>(\n    () => ({\n      trip,\n      participants,\n      products,\n      availability,\n      stats,\n      isLoading,\n      error,\n      setTrip,\n      setParticipants,\n      setProducts,\n      setAvailability,\n      toggleAvailability,\n      setLoading,\n      setError,\n      clearTrip,\n    }),\n    [\n      trip,\n      participants,\n      products,\n      availability,\n      stats,\n      isLoading,\n      error,\n      setTrip,\n      setParticipants,\n      setProducts,\n      setAvailability,\n      toggleAvailability,\n      setLoading,\n      setError,\n      clearTrip,\n    ]\n  );\n\n  return <TripContext.Provider value={value}>{children}</TripContext.Provider>;\n};\n\n/**\n * Hook to access trip context\n * @throws Error if used outside of TripProvider\n */\nexport function useTrip(): TripContextValue {\n  const context = useContext(TripContext);\n  if (!context) {\n    throw new Error('useTrip must be used within a TripProvider');\n  }\n  return context;\n}\n","/**\n * Application Router - Defines all routes for the application\n */\nimport type { FC } from 'react';\nimport { Routes, Route, Navigate } from 'react-router-dom';\nimport {\n  HomePage,\n  TripsPage,\n  TripDetailPage,\n  ParticipantsPage,\n  ProductsPage,\n  AvailabilityPage,\n  ShoppingListPage,\n} from '../pages';\nimport { TripProvider } from '../context/TripContext';\n\n/**\n * Route path constants\n */\nexport const ROUTES = {\n  HOME: '/',\n  TRIPS: '/trips',\n  TRIP_NEW: '/trips/new',\n  TRIP_DETAIL: '/trips/:tripId',\n  TRIP_EDIT: '/trips/:tripId/edit',\n  PARTICIPANTS: '/trips/:tripId/participants',\n  PRODUCTS: '/trips/:tripId/products',\n  AVAILABILITY: '/trips/:tripId/availability',\n  CONSUMPTIONS: '/trips/:tripId/consumptions',\n  SHOPPING: '/trips/:tripId/shopping',\n} as const;\n\n/**\n * Helper function to generate trip-specific routes\n */\nexport const getTripRoute = (tripId: string, route: string): string => {\n  return route.replace(':tripId', tripId);\n};\n\n/**\n * Trip routes wrapper - provides TripProvider context\n */\nconst TripRoutes: FC = () => {\n  return (\n    <Routes>\n      <Route index element={<TripDetailPage />} />\n      <Route path=\"participants\" element={<ParticipantsPage />} />\n      <Route path=\"products\" element={<ProductsPage />} />\n      <Route path=\"availability\" element={<AvailabilityPage />} />\n      <Route path=\"shopping\" element={<ShoppingListPage />} />\n      {/* Redirect unknown trip subroutes to trip detail */}\n      <Route path=\"*\" element={<Navigate to=\"\" replace />} />\n    </Routes>\n  );\n};\n\n/**\n * Main application router component\n */\nexport const AppRouter: FC = () => {\n  return (\n    <Routes>\n      {/* Public routes */}\n      <Route path={ROUTES.HOME} element={<HomePage />} />\n      <Route path={ROUTES.TRIPS} element={<TripsPage />} />\n\n      {/* Trip-specific routes with TripProvider */}\n      <Route\n        path=\"/trips/:tripId/*\"\n        element={\n          <TripProvider>\n            <TripRoutes />\n          </TripProvider>\n        }\n      />\n\n      {/* Fallback - redirect to home */}\n      <Route path=\"*\" element={<Navigate to={ROUTES.HOME} replace />} />\n    </Routes>\n  );\n};\n","import type { FC } from 'react';\nimport { BrowserRouter } from 'react-router-dom';\nimport { ServiceProvider } from '@presentation/context/ServiceContext';\nimport { AppRouter } from '@presentation/routes/AppRouter';\n\n/**\n * Root application component.\n * Sets up providers and routing for the entire application.\n */\nexport const App: FC = () => {\n  return (\n    <BrowserRouter basename=\"/tripfood-manager\">\n      <ServiceProvider>\n        <AppRouter />\n      </ServiceProvider>\n    </BrowserRouter>\n  );\n};\n","import { StrictMode } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport { App } from './App';\nimport './presentation/styles/global.css';\n\nconst rootElement = document.getElementById('root');\n\nif (!rootElement) {\n  throw new Error('Root element not found. Make sure there is a div with id=\"root\" in your HTML.');\n}\n\ncreateRoot(rootElement).render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n);\n"],"file":"assets/index-CyFwfxsh.js"}